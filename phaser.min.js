<<<<<<< HEAD
(function(){var a=this;var b=b||{};b.WEBGL_RENDERER=0;b.CANVAS_RENDERER=1;b.VERSION="v2.2.8";b._UID=0;if(typeof(Float32Array)!="undefined"){b.Float32Array=Float32Array;b.Uint16Array=Uint16Array;b.Uint32Array=Uint32Array;b.ArrayBuffer=ArrayBuffer}else{b.Float32Array=Array;b.Uint16Array=Array}b.PI_2=Math.PI*2;b.RAD_TO_DEG=180/Math.PI;b.DEG_TO_RAD=Math.PI/180;b.RETINA_PREFIX="@2x";b.defaultRenderOptions={view:null,transparent:false,antialias:false,preserveDrawingBuffer:false,resolution:1,clearBeforeRender:true,autoResize:false};b.DisplayObject=function(){this.position=new b.Point(0,0);this.scale=new b.Point(1,1);this.transformCallback=null;this.transformCallbackContext=null;this.pivot=new b.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.stage=null;this.worldAlpha=1;this.worldTransform=new b.Matrix();this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new b.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};b.DisplayObject.prototype.constructor=b.DisplayObject;b.DisplayObject.prototype.destroy=function(){if(this.children){var c=this.children.length;while(c--){this.children[c].destroy()}this.children=[]}this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.renderable=false;this._destroyCachedSprite()};Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var c=this;do{if(!c.visible){return false}c=c.parent}while(c);return true}});Object.defineProperty(b.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(c){if(this._mask){this._mask.isMask=false}this._mask=c;if(this._mask){this._mask.isMask=true}}});Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(f){if(f){var e=[];for(var d=0;d<f.length;d++){var g=f[d].passes;for(var c=0;c<g.length;c++){e.push(g[c])}}this._filterBlock={target:this,filterPasses:e}}this._filters=f}});Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(c){if(this._cacheAsBitmap===c){return}if(c){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=c}});b.DisplayObject.prototype.updateTransform=function(){if(!this.parent){return}var j=this.parent.worldTransform;var g=this.worldTransform;var i,f,l,k,h,e;if(this.rotation%b.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}i=this._cr*this.scale.x;f=this._sr*this.scale.x;l=-this._sr*this.scale.y;k=this._cr*this.scale.y;h=this.position.x;e=this.position.y;if(this.pivot.x||this.pivot.y){h-=this.pivot.x*i+this.pivot.y*l;e-=this.pivot.x*f+this.pivot.y*k}g.a=i*j.a+f*j.c;g.b=i*j.b+f*j.d;g.c=l*j.a+k*j.c;g.d=l*j.b+k*j.d;g.tx=h*j.a+e*j.c+j.tx;g.ty=h*j.b+e*j.d+j.ty}else{i=this.scale.x;k=this.scale.y;h=this.position.x-this.pivot.x*i;e=this.position.y-this.pivot.y*k;g.a=i*j.a;g.b=i*j.b;g.c=k*j.c;g.d=k*j.d;g.tx=h*j.a+e*j.c+j.tx;g.ty=h*j.b+e*j.d+j.ty}this.worldAlpha=this.alpha*this.parent.worldAlpha;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,g,j)}};b.DisplayObject.prototype.displayObjectUpdateTransform=b.DisplayObject.prototype.updateTransform;b.DisplayObject.prototype.getBounds=function(c){c=c;return b.EmptyRectangle};b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)};b.DisplayObject.prototype.setStageReference=function(c){this.stage=c};b.DisplayObject.prototype.preUpdate=function(){};b.DisplayObject.prototype.generateTexture=function(d,e,g){var f=this.getLocalBounds();var c=new b.RenderTexture(f.width|0,f.height|0,g,e,d);b.DisplayObject._tempMatrix.tx=-f.x;b.DisplayObject._tempMatrix.ty=-f.y;c.render(this,b.DisplayObject._tempMatrix);return c};b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};b.DisplayObject.prototype.toGlobal=function(c){this.displayObjectUpdateTransform();return this.worldTransform.apply(c)};b.DisplayObject.prototype.toLocal=function(c,d){if(d){c=d.toGlobal(c)}this.displayObjectUpdateTransform();return this.worldTransform.applyInverse(c)};b.DisplayObject.prototype._renderCachedSprite=function(c){this._cachedSprite.worldAlpha=this.worldAlpha;if(c.gl){b.Sprite.prototype._renderWebGL.call(this._cachedSprite,c)}else{b.Sprite.prototype._renderCanvas.call(this._cachedSprite,c)}};b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=false;var e=this.getLocalBounds();if(!this._cachedSprite){var c=new b.RenderTexture(e.width|0,e.height|0);this._cachedSprite=new b.Sprite(c);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(e.width|0,e.height|0)}var d=this._filters;this._filters=null;this._cachedSprite.filters=d;b.DisplayObject._tempMatrix.tx=-e.x;b.DisplayObject._tempMatrix.ty=-e.y;this._cachedSprite.texture.render(this,b.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(e.x/e.width);this._cachedSprite.anchor.y=-(e.y/e.height);this._filters=d;this._cacheAsBitmap=true};b.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null};b.DisplayObject.prototype._renderWebGL=function(c){c=c};b.DisplayObject.prototype._renderCanvas=function(c){c=c};Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(c){this.position.x=c}});Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(c){this.position.y=c}});b.DisplayObjectContainer=function(){b.DisplayObject.call(this);this.children=[]};b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype);b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer;Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(d){var c=this.getLocalBounds().width;if(c!==0){this.scale.x=d/c}else{this.scale.x=1}this._width=d}});Object.defineProperty(b.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(d){var c=this.getLocalBounds().height;if(c!==0){this.scale.y=d/c}else{this.scale.y=1}this._height=d}});b.DisplayObjectContainer.prototype.addChild=function(c){return this.addChildAt(c,this.children.length)};b.DisplayObjectContainer.prototype.addChildAt=function(d,c){if(c>=0&&c<=this.children.length){if(d.parent){d.parent.removeChild(d)}d.parent=this;this.children.splice(c,0,d);if(this.stage){d.setStageReference(this.stage)}return d}else{throw new Error(d+"addChildAt: The index "+c+" supplied is out of bounds "+this.children.length)}};b.DisplayObjectContainer.prototype.swapChildren=function(f,c){if(f===c){return}var e=this.getChildIndex(f);var d=this.getChildIndex(c);if(e<0||d<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[e]=c;this.children[d]=f};b.DisplayObjectContainer.prototype.getChildIndex=function(d){var c=this.children.indexOf(d);if(c===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return c};b.DisplayObjectContainer.prototype.setChildIndex=function(e,d){if(d<0||d>=this.children.length){throw new Error("The supplied index is out of bounds")}var c=this.getChildIndex(e);this.children.splice(c,1);this.children.splice(d,0,e)};b.DisplayObjectContainer.prototype.getChildAt=function(c){if(c<0||c>=this.children.length){throw new Error("getChildAt: Supplied index "+c+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[c]};b.DisplayObjectContainer.prototype.removeChild=function(d){var c=this.children.indexOf(d);if(c===-1){return}return this.removeChildAt(c)};b.DisplayObjectContainer.prototype.removeChildAt=function(c){var d=this.getChildAt(c);if(this.stage){d.removeStageReference()}d.parent=undefined;this.children.splice(c,1);return d};b.DisplayObjectContainer.prototype.removeChildren=function(g,h){var f=g||0;var c=typeof h==="number"?h:this.children.length;var d=c-f;if(d>0&&d<=c){var j=this.children.splice(f,d);for(var e=0;e<j.length;e++){var k=j[e];if(this.stage){k.removeStageReference()}k.parent=undefined}return j}else{if(d===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}}};b.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var d=0,c=this.children.length;d<c;d++){this.children[d].updateTransform()}};b.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=b.DisplayObjectContainer.prototype.updateTransform;b.DisplayObjectContainer.prototype.getBounds=function(){if(this.children.length===0){return b.EmptyRectangle}var k=Infinity;var h=Infinity;var e=-Infinity;var d=-Infinity;var l;var p;var o;var f=false;for(var n=0,m=this.children.length;n<m;n++){var g=this.children[n];if(!g.visible){continue}f=true;l=this.children[n].getBounds();k=k<l.x?k:l.x;h=h<l.y?h:l.y;p=l.width+l.x;o=l.height+l.y;e=e>p?e:p;d=d>o?d:o}if(!f){return b.EmptyRectangle}var c=this._bounds;c.x=k;c.y=h;c.width=e-k;c.height=d-h;return c};b.DisplayObjectContainer.prototype.getLocalBounds=function(){var c=this.worldTransform;this.worldTransform=b.identityMatrix;for(var e=0,d=this.children.length;e<d;e++){this.children[e].updateTransform()}var f=this.getBounds();this.worldTransform=c;return f};b.DisplayObjectContainer.prototype.setStageReference=function(c){this.stage=c;for(var d=0;d<this.children.length;d++){this.children[d].setStageReference(c)}};b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var c=0;c<this.children.length;c++){this.children[c].removeStageReference()}this.stage=null};b.DisplayObjectContainer.prototype._renderWebGL=function(d){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(d);return}var c;if(this._mask||this._filters){if(this._filters){d.spriteBatch.flush();d.filterManager.pushFilter(this._filterBlock)}if(this._mask){d.spriteBatch.stop();d.maskManager.pushMask(this.mask,d);d.spriteBatch.start()}for(c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}d.spriteBatch.stop();if(this._mask){d.maskManager.popMask(this._mask,d)}if(this._filters){d.filterManager.popFilter()}d.spriteBatch.start()}else{for(c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}}};b.DisplayObjectContainer.prototype._renderCanvas=function(d){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(d);return}if(this._mask){d.maskManager.pushMask(this._mask,d)}for(var c=0;c<this.children.length;c++){this.children[c]._renderCanvas(d)}if(this._mask){d.maskManager.popMask(d)}};b.Sprite=function(c){b.DisplayObjectContainer.call(this);this.anchor=new b.Point();this.texture=c||b.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.blendMode=b.blendModes.NORMAL;this.shader=null;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Sprite.prototype.constructor=b.Sprite;Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(c){this.scale.x=c/this.texture.frame.width;this._width=c}});Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(c){this.scale.y=c/this.texture.frame.height;this._height=c}});b.Sprite.prototype.setTexture=function(c){this.texture=c;this.cachedTint=16777215};b.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}};b.Sprite.prototype.getBounds=function(r){var o=this.texture.frame.width;var n=this.texture.frame.height;var m=o*(1-this.anchor.x);var l=o*-this.anchor.x;var k=n*(1-this.anchor.y);var j=n*-this.anchor.y;var p=r||this.worldTransform;var D=p.a;var B=p.b;var z=p.c;var x=p.d;var E=p.tx;var C=p.ty;var y=-Infinity;var v=-Infinity;var A=Infinity;var w=Infinity;if(B===0&&z===0){if(D<0){D*=-1}if(x<0){x*=-1}A=D*l+E;y=D*m+E;w=x*j+C;v=x*k+C}else{var u=D*l+z*j+E;var h=x*j+B*l+C;var t=D*m+z*j+E;var g=x*j+B*m+C;var s=D*m+z*k+E;var f=x*k+B*m+C;var q=D*l+z*k+E;var e=x*k+B*l+C;A=u<A?u:A;A=t<A?t:A;A=s<A?s:A;A=q<A?q:A;w=h<w?h:w;w=g<w?g:w;w=f<w?f:w;w=e<w?e:w;y=u>y?u:y;y=t>y?t:y;y=s>y?s:y;y=q>y?q:y;v=h>v?h:v;v=g>v?g:v;v=f>v?f:v;v=e>v?e:v}var i=this._bounds;i.x=A;i.width=y-A;i.y=w;i.height=v-w;this._currentBounds=i;return i};b.Sprite.prototype._renderWebGL=function(f){if(!this.visible||this.alpha<=0||!this.renderable){return}var e,d;if(this._mask||this._filters){var c=f.spriteBatch;if(this._filters){c.flush();f.filterManager.pushFilter(this._filterBlock)}if(this._mask){c.stop();f.maskManager.pushMask(this.mask,f);c.start()}c.render(this);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(f)}c.stop();if(this._mask){f.maskManager.popMask(this._mask,f)}if(this._filters){f.filterManager.popFilter()}c.start()}else{f.spriteBatch.render(this);for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(f)}}};b.Sprite.prototype._renderCanvas=function(g){if(this.visible===false||this.alpha===0||this.renderable===false||this.texture.crop.width<=0||this.texture.crop.height<=0){return}if(this.blendMode!==g.currentBlendMode){g.currentBlendMode=this.blendMode;g.context.globalCompositeOperation=b.blendModesCanvas[g.currentBlendMode]}if(this._mask){g.maskManager.pushMask(this._mask,g)}if(this.texture.valid){var e=this.texture.baseTexture.resolution/g.resolution;g.context.globalAlpha=this.worldAlpha;if(g.smoothProperty&&g.scaleMode!==this.texture.baseTexture.scaleMode){g.scaleMode=this.texture.baseTexture.scaleMode;g.context[g.smoothProperty]=(g.scaleMode===b.scaleModes.LINEAR)}var d=(this.texture.trim)?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var c=(this.texture.trim)?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(g.roundPixels){g.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,(this.worldTransform.tx*g.resolution)|0,(this.worldTransform.ty*g.resolution)|0);d=d|0;c=c|0}else{g.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*g.resolution,this.worldTransform.ty*g.resolution)}if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)}g.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,d/e,c/e,this.texture.crop.width/e,this.texture.crop.height/e)}else{g.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,d/e,c/e,this.texture.crop.width/e,this.texture.crop.height/e)}}for(var f=0;f<this.children.length;f++){this.children[f]._renderCanvas(g)}if(this._mask){g.maskManager.popMask(g)}};b.Sprite.fromFrame=function(d){var c=b.TextureCache[d];if(!c){throw new Error('The frameId "'+d+'" does not exist in the texture cache'+this)}return new b.Sprite(c)};b.Sprite.fromImage=function(d,c,e){var f=b.Texture.fromImage(d,c,e);return new b.Sprite(f)};b.SpriteBatch=function(c){b.DisplayObjectContainer.call(this);this.textureThing=c;this.ready=false};b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype);b.SpriteBatch.prototype.constructor=b.SpriteBatch;b.SpriteBatch.prototype.initWebGL=function(c){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(c);this.ready=true};b.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};b.SpriteBatch.prototype._renderWebGL=function(c){if(!this.visible||this.alpha<=0||!this.children.length){return}if(!this.ready){this.initWebGL(c.gl)}if(this.fastSpriteBatch.gl!==c.gl){this.fastSpriteBatch.setContext(c.gl)}c.spriteBatch.stop();c.shaderManager.setShader(c.shaderManager.fastShader);this.fastSpriteBatch.begin(this,c);this.fastSpriteBatch.render(this);c.spriteBatch.start()};b.SpriteBatch.prototype._renderCanvas=function(l){if(!this.visible||this.alpha<=0||!this.children.length){return}var c=l.context;c.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var f=this.worldTransform;var k=true;for(var g=0;g<this.children.length;g++){var d=this.children[g];if(!d.visible){continue}var j=d.texture;var e=j.frame;c.globalAlpha=this.worldAlpha*d.alpha;if(d.rotation%(Math.PI*2)===0){if(k){c.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty);k=false}c.drawImage(j.baseTexture.source,e.x,e.y,e.width,e.height,((d.anchor.x)*(-e.width*d.scale.x)+d.position.x+0.5)|0,((d.anchor.y)*(-e.height*d.scale.y)+d.position.y+0.5)|0,e.width*d.scale.x,e.height*d.scale.y)}else{if(!k){k=true}d.displayObjectUpdateTransform();var h=d.worldTransform;if(l.roundPixels){c.setTransform(h.a,h.b,h.c,h.d,h.tx|0,h.ty|0)}else{c.setTransform(h.a,h.b,h.c,h.d,h.tx,h.ty)}c.drawImage(j.baseTexture.source,e.x,e.y,e.width,e.height,((d.anchor.x)*(-e.width)+0.5)|0,((d.anchor.y)*(-e.height)+0.5)|0,e.width,e.height)}}};b.Text=function(d,c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=1;b.Sprite.call(this,b.Texture.fromCanvas(this.canvas));this.setText(d);this.setStyle(c)};b.Text.prototype=Object.create(b.Sprite.prototype);b.Text.prototype.constructor=b.Text;Object.defineProperty(b.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(c){this.scale.x=c/this.texture.frame.width;this._width=c}});Object.defineProperty(b.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(c){this.scale.y=c/this.texture.frame.height;this._height=c}});b.Text.prototype.setStyle=function(c){c=c||{};c.font=c.font||"bold 20pt Arial";c.fill=c.fill||"black";c.align=c.align||"left";c.stroke=c.stroke||"black";c.strokeThickness=c.strokeThickness||0;c.wordWrap=c.wordWrap||false;c.wordWrapWidth=c.wordWrapWidth||100;c.dropShadow=c.dropShadow||false;c.dropShadowAngle=c.dropShadowAngle||Math.PI/6;c.dropShadowDistance=c.dropShadowDistance||4;c.dropShadowColor=c.dropShadowColor||"black";this.style=c;this.dirty=true};b.Text.prototype.setText=function(c){this.text=c.toString()||" ";this.dirty=true};b.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var j=this.text;if(this.style.wordWrap){j=this.wordWrap(this.text)}var p=j.split(/(?:\r\n|\r|\n)/);var h=[];var q=0;var e=this.determineFontProperties(this.style.font);for(var k=0;k<p.length;k++){var l=this.context.measureText(p[k]).width;h[k]=l;q=Math.max(q,l)}var f=q+this.style.strokeThickness;if(this.style.dropShadow){f+=this.style.dropShadowDistance}this.canvas.width=(f+this.context.lineWidth)*this.resolution;var n=e.fontSize+this.style.strokeThickness;var o=n*p.length;if(this.style.dropShadow){o+=this.style.dropShadowDistance}this.canvas.height=o*this.resolution;this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="alphabetic";var g;var d;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var m=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance;var c=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(k=0;k<p.length;k++){g=this.style.strokeThickness/2;d=(this.style.strokeThickness/2+k*n)+e.ascent;if(this.style.align==="right"){g+=q-h[k]}else{if(this.style.align==="center"){g+=(q-h[k])/2}}if(this.style.fill){this.context.fillText(p[k],g+m,d+c)}}}this.context.fillStyle=this.style.fill;for(k=0;k<p.length;k++){g=this.style.strokeThickness/2;d=(this.style.strokeThickness/2+k*n)+e.ascent;if(this.style.align==="right"){g+=q-h[k]}else{if(this.style.align==="center"){g+=(q-h[k])/2}}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(p[k],g,d)}if(this.style.fill){this.context.fillText(p[k],g,d)}}this.updateTexture()};b.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.texture.baseTexture.dirty()};b.Text.prototype._renderWebGL=function(c){if(this.dirty){this.resolution=c.resolution;this.updateText();this.dirty=false}b.Sprite.prototype._renderWebGL.call(this,c)};b.Text.prototype._renderCanvas=function(c){if(this.dirty){this.resolution=c.resolution;this.updateText();this.dirty=false}b.Sprite.prototype._renderCanvas.call(this,c)};b.Text.prototype.determineFontProperties=function(h){var m=b.Text.fontPropertiesCache[h];if(!m){m={};var e=b.Text.fontPropertiesCanvas;var d=b.Text.fontPropertiesContext;d.font=h;var c=Math.ceil(d.measureText("|MÉq").width);var l=Math.ceil(d.measureText("|MÉq").width);var q=2*l;l=l*1.4|0;e.width=c;e.height=q;d.fillStyle="#f00";d.fillRect(0,0,c,q);d.font=h;d.textBaseline="alphabetic";d.fillStyle="#000";d.fillText("|MÉq",0,l);var n=d.getImageData(0,0,c,q).data;var f=n.length;var r=c*4;var k,g;var p=0;var o=false;for(k=0;k<l;k++){for(g=0;g<r;g+=4){if(n[p+g]!==255){o=true;break}}if(!o){p+=r}else{break}}m.ascent=l-k;p=f-r;o=false;for(k=q;k>l;k--){for(g=0;g<r;g+=4){if(n[p+g]!==255){o=true;break}}if(!o){p-=r}else{break}}m.descent=k-l;m.descent+=6;m.fontSize=m.ascent+m.descent;b.Text.fontPropertiesCache[h]=m}return m};b.Text.prototype.wordWrap=function(h){var m="";var l=h.split("\n");for(var e=0;e<l.length;e++){var d=this.style.wordWrapWidth;var g=l[e].split(" ");for(var c=0;c<g.length;c++){var k=this.context.measureText(g[c]).width;var f=k+this.context.measureText(" ").width;if(c===0||f>d){if(c>0){m+="\n"}m+=g[c];d=this.style.wordWrapWidth-k}else{d-=f;m+=" "+g[c]}}if(e<l.length-1){m+="\n"}}return m};b.Text.prototype.getBounds=function(c){if(this.dirty){this.updateText();this.dirty=false}return b.Sprite.prototype.getBounds.call(this,c)};b.Text.prototype.destroy=function(c){this.context=null;this.canvas=null;this.texture.destroy(c===undefined?true:c)};b.Text.fontPropertiesCache={};b.Text.fontPropertiesCanvas=document.createElement("canvas");b.Text.fontPropertiesContext=b.Text.fontPropertiesCanvas.getContext("2d");b.BitmapText=function(d,c){b.DisplayObjectContainer.call(this);this.textWidth=0;this.textHeight=0;this.maxWidth=0;this.anchor=new Phaser.Point(0,0);this._prevAnchor=new Phaser.Point(0,0);this._pool=[];this.setText(d);this.setStyle(c);this.updateText();this.dirty=false};b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.BitmapText.prototype.setText=function(c){this.text=c||" ";this.dirty=true};b.BitmapText.prototype.setStyle=function(d){d=d||{};d.align=d.align||"left";this.style=d;var c=d.font.split(" ");this.fontName=c[c.length-1];this.fontSize=c.length>=2?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size;this.dirty=true;this.tint=d.tint};b.BitmapText.prototype.updateText=function(){var v=b.BitmapText.fonts[this.fontName];var j=new b.Point();var k=null;var q=[];var r=0;var y=[];var p=0;var w=this.fontSize/v.size;var l=0;for(var t=0;t<this.text.length;t++){var e=this.text.charCodeAt(t);l=/(\s)/.test(this.text.charAt(t))?t:l;if(/(?:\r\n|\r|\n)/.test(this.text.charAt(t))){y.push(j.x);r=Math.max(r,j.x);p++;j.x=0;j.y+=v.lineHeight;k=null;continue}if(l!==-1&&this.maxWidth>0&&j.x*w>this.maxWidth){q.splice(l,t-l);t=l;l=-1;y.push(lastLineWidth);r=Math.max(r,lastLineWidth);p++;j.x=0;j.y+=v.lineHeight;k=null;continue}var d=v.chars[e];if(!d){continue}if(k&&d.kerning[k]){j.x+=d.kerning[k]}q.push({texture:d.texture,line:p,charCode:e,position:new b.Point(j.x+d.xOffset,j.y+d.yOffset)});j.x+=d.xAdvance;k=e}y.push(j.x);r=Math.max(r,j.x);var s=[];for(t=0;t<=p;t++){var x=0;if(this.style.align==="right"){x=r-y[t]}else{if(this.style.align==="center"){x=(r-y[t])/2}}s.push(x)}var f=this.children.length;var g=q.length;var m=this.tint||16777215;this.textWidth=r*w;this.textHeight=(j.y+v.lineHeight)*w;var o=this.textWidth*this.anchor.x;var n=this.textHeight*this.anchor.y;for(t=0;t<g;t++){var u=t<f?this.children[t]:this._pool.pop();if(u){u.setTexture(q[t].texture)}else{u=new b.Sprite(q[t].texture)}u.position.x=((q[t].position.x+s[q[t].line])*w)-o;u.position.y=(q[t].position.y*w)-n;u.scale.x=u.scale.y=w;u.tint=m;if(!u.parent){this.addChild(u)}}while(this.children.length>g){var h=this.getChildAt(this.children.length-1);this._pool.push(h);this.removeChild(h)}};b.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.BitmapText.fonts={};b.Stage=function(c){b.DisplayObjectContainer.call(this);this.worldTransform=new b.Matrix();this.stage=this;this.setBackgroundColor(c)};b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Stage.prototype.constructor=b.Stage;b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var c=0;c<this.children.length;c++){this.children[c].updateTransform()}};b.Stage.prototype.setBackgroundColor=function(c){this.backgroundColor=c||0;this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);var d=this.backgroundColor.toString(16);d="000000".substr(0,6-d.length)+d;this.backgroundColorString="#"+d};b.hex2rgb=function(c){return[(c>>16&255)/255,(c>>8&255)/255,(c&255)/255]};b.rgb2hex=function(c){return((c[0]*255<<16)+(c[1]*255<<8)+c[2]*255)};b.canUseNewCanvasBlendModes=function(){if(typeof document==="undefined"){return false}var d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/";var h="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var c=new Image();c.src=d+"AP804Oa6"+h;var i=new Image();i.src=d+"/wCKxvRF"+h;var e=document.createElement("canvas");e.width=6;e.height=1;var f=e.getContext("2d");f.globalCompositeOperation="multiply";f.drawImage(c,0,0);f.drawImage(i,2,0);var g=f.getImageData(2,0,1,1).data;return(g[0]===255&&g[1]===0&&g[2]===0)};b.getNextPowerOfTwo=function(d){if(d>0&&(d&(d-1))===0){return d}else{var c=1;while(c<d){c<<=1}return c}};b.isPowerOfTwo=function(d,c){return(d>0&&(d&(d-1))===0&&c>0&&(c&(c-1))===0)};b.PolyK={};b.PolyK.Triangulate=function(k){var y=true;var l=k.length>>1;if(l<3){return[]}var v=[];var h=[];for(var t=0;t<l;t++){h.push(t)}t=0;var q=l;while(q>3){var r=h[(t+0)%q];var o=h[(t+1)%q];var m=h[(t+2)%q];var g=k[2*r],e=k[2*r+1];var w=k[2*o],u=k[2*o+1];var d=k[2*m],c=k[2*m+1];var f=false;if(b.PolyK._convex(g,e,w,u,d,c,y)){f=true;for(var s=0;s<q;s++){var x=h[s];if(x===r||x===o||x===m){continue}if(b.PolyK._PointInTriangle(k[2*x],k[2*x+1],g,e,w,u,d,c)){f=false;break}}}if(f){v.push(r,o,m);h.splice((t+1)%q,1);q--;t=0}else{if(t++>3*q){if(y){v=[];h=[];for(t=0;t<l;t++){h.push(t)}t=0;q=l;y=false}else{return null}}}}v.push(h[0],h[1],h[2]);return v};b.PolyK._PointInTriangle=function(q,p,m,l,z,y,i,g){var f=i-m;var e=g-l;var k=z-m;var j=y-l;var x=q-m;var t=p-l;var w=f*f+e*e;var s=f*k+e*j;var r=f*x+e*t;var d=k*k+j*j;var c=k*x+j*t;var h=1/(w*d-s*s);var o=(d*r-s*c)*h;var n=(w*c-s*r)*h;return(o>=0)&&(n>=0)&&(o+n<1)};b.PolyK._convex=function(f,e,h,g,c,i,d){return((e-g)*(c-h)+(h-f)*(i-g)>=0)===d};b.initDefaultShaders=function(){};b.CompileVertexShader=function(d,c){return b._CompileShader(d,c,d.VERTEX_SHADER)};b.CompileFragmentShader=function(d,c){return b._CompileShader(d,c,d.FRAGMENT_SHADER)};b._CompileShader=function(g,f,e){var d=f.join("\n");var c=g.createShader(e);g.shaderSource(c,d);g.compileShader(c);if(!g.getShaderParameter(c,g.COMPILE_STATUS)){window.console.log(g.getShaderInfoLog(c));return null}return c};b.compileProgram=function(g,c,e){var d=b.CompileFragmentShader(g,e);var f=b.CompileVertexShader(g,c);var h=g.createProgram();g.attachShader(h,f);g.attachShader(h,d);g.linkProgram(h);if(!g.getProgramParameter(h,g.LINK_STATUS)){window.console.log("Could not initialise shaders")}return h};b.PixiShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};b.PixiShader.prototype.constructor=b.PixiShader;b.PixiShader.prototype.init=function(){var e=this.gl;var c=b.compileProgram(e,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(c);this.uSampler=e.getUniformLocation(c,"uSampler");this.projectionVector=e.getUniformLocation(c,"projectionVector");this.offsetVector=e.getUniformLocation(c,"offsetVector");this.dimensions=e.getUniformLocation(c,"dimensions");this.aVertexPosition=e.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=e.getAttribLocation(c,"aTextureCoord");this.colorAttribute=e.getAttribLocation(c,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var d in this.uniforms){this.uniforms[d].uniformLocation=e.getUniformLocation(c,d)}this.initUniforms();this.program=c};b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var f=this.gl;var c;for(var d in this.uniforms){c=this.uniforms[d];var e=c.type;if(e==="sampler2D"){c._init=false;if(c.value!==null){this.initSampler2D(c)}}else{if(e==="mat2"||e==="mat3"||e==="mat4"){c.glMatrix=true;c.glValueLength=1;if(e==="mat2"){c.glFunc=f.uniformMatrix2fv}else{if(e==="mat3"){c.glFunc=f.uniformMatrix3fv}else{if(e==="mat4"){c.glFunc=f.uniformMatrix4fv}}}}else{c.glFunc=f["uniform"+e];if(e==="2f"||e==="2i"){c.glValueLength=2}else{if(e==="3f"||e==="3i"){c.glValueLength=3}else{if(e==="4f"||e==="4i"){c.glValueLength=4}else{c.glValueLength=1}}}}}}};b.PixiShader.prototype.initSampler2D=function(e){if(!e.value||!e.value.baseTexture||!e.value.baseTexture.hasLoaded){return}var j=this.gl;j.activeTexture(j["TEXTURE"+this.textureCount]);j.bindTexture(j.TEXTURE_2D,e.value.baseTexture._glTextures[j.id]);if(e.textureData){var h=e.textureData;var l=(h.magFilter)?h.magFilter:j.LINEAR;var d=(h.minFilter)?h.minFilter:j.LINEAR;var i=(h.wrapS)?h.wrapS:j.CLAMP_TO_EDGE;var g=(h.wrapT)?h.wrapT:j.CLAMP_TO_EDGE;var k=(h.luminance)?j.LUMINANCE:j.RGBA;if(h.repeat){i=j.REPEAT;g=j.REPEAT}j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,!!h.flipY);if(h.width){var c=(h.width)?h.width:512;var m=(h.height)?h.height:2;var f=(h.border)?h.border:0;j.texImage2D(j.TEXTURE_2D,0,k,c,m,f,k,j.UNSIGNED_BYTE,null)}else{j.texImage2D(j.TEXTURE_2D,0,k,j.RGBA,j.UNSIGNED_BYTE,e.value.baseTexture.source)}j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,l);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,d);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,i);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,g)}j.uniform1i(e.uniformLocation,this.textureCount);e._init=true;this.textureCount++};b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var c;var e=this.gl;for(var d in this.uniforms){c=this.uniforms[d];if(c.glValueLength===1){if(c.glMatrix===true){c.glFunc.call(e,c.uniformLocation,c.transpose,c.value)}else{c.glFunc.call(e,c.uniformLocation,c.value)}}else{if(c.glValueLength===2){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y)}else{if(c.glValueLength===3){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y,c.value.z)}else{if(c.glValueLength===4){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y,c.value.z,c.value.w)}else{if(c.type==="sampler2D"){if(c._init){e.activeTexture(e["TEXTURE"+this.textureCount]);if(c.value.baseTexture._dirty[e.id]){b.instances[e.id].updateTexture(c.value.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,c.value.baseTexture._glTextures[e.id])}e.uniform1i(c.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(c)}}}}}}}};b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];b.PixiFastShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};b.PixiFastShader.prototype.constructor=b.PixiFastShader;b.PixiFastShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.uSampler=d.getUniformLocation(c,"uSampler");this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.dimensions=d.getUniformLocation(c,"dimensions");this.uMatrix=d.getUniformLocation(c,"uMatrix");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.aPositionCoord=d.getAttribLocation(c,"aPositionCoord");this.aScale=d.getAttribLocation(c,"aScale");this.aRotation=d.getAttribLocation(c,"aRotation");this.aTextureCoord=d.getAttribLocation(c,"aTextureCoord");this.colorAttribute=d.getAttribLocation(c,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=c};b.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.StripShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};b.StripShader.prototype.constructor=b.StripShader;b.StripShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.uSampler=d.getUniformLocation(c,"uSampler");this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.colorAttribute=d.getAttribLocation(c,"aColor");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=d.getAttribLocation(c,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};b.PrimitiveShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};b.PrimitiveShader.prototype.constructor=b.PrimitiveShader;b.PrimitiveShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.tintColor=d.getUniformLocation(c,"tint");this.flipY=d.getUniformLocation(c,"flipY");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.colorAttribute=d.getAttribLocation(c,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.ComplexPrimitiveShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};b.ComplexPrimitiveShader.prototype.constructor=b.ComplexPrimitiveShader;b.ComplexPrimitiveShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.tintColor=d.getUniformLocation(c,"tint");this.color=d.getUniformLocation(c,"color");this.flipY=d.getUniformLocation(c,"flipY");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};b.WebGLGraphics=function(){};b.WebGLGraphics.renderGraphics=function(k,l){var e=l.gl;var h=l.projection,c=l.offset,g=l.shaderManager.primitiveShader,f;if(k.dirty){b.WebGLGraphics.updateGraphics(k,e)}var j=k._webGL[e.id];for(var d=0;d<j.data.length;d++){if(j.data[d].mode===1){f=j.data[d];l.stencilManager.pushStencil(k,f,l);e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);l.stencilManager.popStencil(k,f,l)}else{f=j.data[d];l.shaderManager.setShader(g);g=l.shaderManager.primitiveShader;e.uniformMatrix3fv(g.translationMatrix,false,k.worldTransform.toArray(true));e.uniform1f(g.flipY,1);e.uniform2f(g.projectionVector,h.x,-h.y);e.uniform2f(g.offsetVector,-c.x,-c.y);e.uniform3fv(g.tintColor,b.hex2rgb(k.tint));e.uniform1f(g.alpha,k.worldAlpha);e.bindBuffer(e.ARRAY_BUFFER,f.buffer);e.vertexAttribPointer(g.aVertexPosition,2,e.FLOAT,false,4*6,0);e.vertexAttribPointer(g.colorAttribute,4,e.FLOAT,false,4*6,2*4);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,f.indexBuffer);e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0)}}};b.WebGLGraphics.updateGraphics=function(c,j){var g=c._webGL[j.id];if(!g){g=c._webGL[j.id]={lastIndex:0,data:[],gl:j}}c.dirty=false;var d;if(c.clearDirty){c.clearDirty=false;for(d=0;d<g.data.length;d++){var k=g.data[d];k.reset();b.WebGLGraphics.graphicsDataPool.push(k)}g.data=[];g.lastIndex=0}var h;for(d=g.lastIndex;d<c.graphicsData.length;d++){var f=c.graphicsData[d];if(f.type===b.Graphics.POLY){f.points=f.shape.points.slice();if(f.shape.closed){if(f.points[0]!==f.points[f.points.length-2]||f.points[1]!==f.points[f.points.length-1]){f.points.push(f.points[0],f.points[1])}}if(f.fill){if(f.points.length>=6){if(f.points.length<6*2){h=b.WebGLGraphics.switchMode(g,0);var e=b.WebGLGraphics.buildPoly(f,h);if(!e){h=b.WebGLGraphics.switchMode(g,1);b.WebGLGraphics.buildComplexPoly(f,h)}}else{h=b.WebGLGraphics.switchMode(g,1);b.WebGLGraphics.buildComplexPoly(f,h)}}}if(f.lineWidth>0){h=b.WebGLGraphics.switchMode(g,0);b.WebGLGraphics.buildLine(f,h)}}else{h=b.WebGLGraphics.switchMode(g,0);if(f.type===b.Graphics.RECT){b.WebGLGraphics.buildRectangle(f,h)}else{if(f.type===b.Graphics.CIRC||f.type===b.Graphics.ELIP){b.WebGLGraphics.buildCircle(f,h)}else{if(f.type===b.Graphics.RREC){b.WebGLGraphics.buildRoundedRectangle(f,h)}}}}g.lastIndex++}for(d=0;d<g.data.length;d++){h=g.data[d];if(h.dirty){h.upload()}}};b.WebGLGraphics.switchMode=function(d,c){var e;if(!d.data.length){e=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(d.gl);e.mode=c;d.data.push(e)}else{e=d.data[d.data.length-1];if(e.mode!==c||c===1){e=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(d.gl);e.mode=c;d.data.push(e)}}e.dirty=true;return e};b.WebGLGraphics.buildRectangle=function(t,i){var f=t.shape;var o=f.x;var n=f.y;var d=f.width;var s=f.height;if(t.fill){var h=b.hex2rgb(t.fillColor);var e=t.fillAlpha;var c=h[0]*e;var j=h[1]*e;var m=h[2]*e;var p=i.points;var q=i.indices;var l=p.length/6;p.push(o,n);p.push(c,j,m,e);p.push(o+d,n);p.push(c,j,m,e);p.push(o,n+s);p.push(c,j,m,e);p.push(o+d,n+s);p.push(c,j,m,e);q.push(l,l,l+1,l+2,l+3,l+3)}if(t.lineWidth){var k=t.points;t.points=[o,n,o+d,n,o+d,n+s,o,n+s,o,n];b.WebGLGraphics.buildLine(t,i);t.points=k}};b.WebGLGraphics.buildRoundedRectangle=function(m,A){var c=m.shape;var l=c.x;var k=c.y;var q=c.width;var p=c.height;var e=c.radius;var n=[];n.push(l,k+e);n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l,k+p-e,l,k+p,l+e,k+p));n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l+q-e,k+p,l+q,k+p,l+q,k+p-e));n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l+q,k+e,l+q,k,l+q-e,k));n=n.concat(b.WebGLGraphics.quadraticBezierCurve(l+e,k,l,k,l,k+e));if(m.fill){var t=b.hex2rgb(m.fillColor);var f=m.fillAlpha;var o=t[0]*f;var v=t[1]*f;var w=t[2]*f;var z=A.points;var h=A.indices;var d=z.length/6;var s=b.PolyK.Triangulate(n);var u=0;for(u=0;u<s.length;u+=3){h.push(s[u]+d);h.push(s[u]+d);h.push(s[u+1]+d);h.push(s[u+2]+d);h.push(s[u+2]+d)}for(u=0;u<n.length;u++){z.push(n[u],n[++u],o,v,w,f)}}if(m.lineWidth){var j=m.points;m.points=n;b.WebGLGraphics.buildLine(m,A);m.points=j}};b.WebGLGraphics.quadraticBezierCurve=function(s,o,q,k,t,p){var d,l,v,h,r,m,e=20,u=[];function c(n,j,i){var w=j-n;return n+(w*i)}var f=0;for(var g=0;g<=e;g++){f=g/e;d=c(s,q,f);l=c(o,k,f);v=c(q,t,f);h=c(k,p,f);r=c(d,v,f);m=c(l,h,f);u.push(r,m)}return u};b.WebGLGraphics.buildCircle=function(k,z){var t=k.shape;var j=t.x;var h=t.y;var o;var n;if(k.type===b.Graphics.CIRC){o=t.radius;n=t.radius}else{o=t.width;n=t.height}var l=40;var u=(Math.PI*2)/l;var q=0;if(k.fill){var p=b.hex2rgb(k.fillColor);var d=k.fillAlpha;var m=p[0]*d;var s=p[1]*d;var v=p[2]*d;var w=z.points;var e=z.indices;var c=w.length/6;e.push(c);for(q=0;q<l+1;q++){w.push(j,h,m,s,v,d);w.push(j+Math.sin(u*q)*o,h+Math.cos(u*q)*n,m,s,v,d);e.push(c++,c++)}e.push(c-1)}if(k.lineWidth){var f=k.points;k.points=[];for(q=0;q<l+1;q++){k.points.push(j+Math.sin(u*q)*o,h+Math.cos(u*q)*n)}b.WebGLGraphics.buildLine(k,z);k.points=f}};b.WebGLGraphics.buildLine=function(S,C){var O=0;var F=S.points;if(F.length===0){return}if(S.lineWidth%2){for(O=0;O<F.length;O++){F[O]+=0.5}}var t=new b.Point(F[0],F[1]);var l=new b.Point(F[F.length-2],F[F.length-1]);if(t.x===l.x&&t.y===l.y){F=F.slice();F.pop();F.pop();l=new b.Point(F[F.length-2],F[F.length-1]);var v=l.x+(t.x-l.x)*0.5;var s=l.y+(t.y-l.y)*0.5;F.unshift(v,s);F.push(v,s)}var P=C.points;var j=C.indices;var u=F.length/2;var q=F.length;var R=P.length/6;var c=S.lineWidth/2;var E=b.hex2rgb(S.lineColor);var N=S.lineAlpha;var K=E[0]*N;var Q=E[1]*N;var T=E[2]*N;var p,o,H,G,z,y,h,f;var J,I,x,w,e,d;var M,D,n,L,B,m;var U,A,k;H=F[0];G=F[1];z=F[2];y=F[3];J=-(G-y);I=H-z;k=Math.sqrt(J*J+I*I);J/=k;I/=k;J*=c;I*=c;P.push(H-J,G-I,K,Q,T,N);P.push(H+J,G+I,K,Q,T,N);for(O=1;O<u-1;O++){H=F[(O-1)*2];G=F[(O-1)*2+1];z=F[(O)*2];y=F[(O)*2+1];h=F[(O+1)*2];f=F[(O+1)*2+1];J=-(G-y);I=H-z;k=Math.sqrt(J*J+I*I);J/=k;I/=k;J*=c;I*=c;x=-(y-f);w=z-h;k=Math.sqrt(x*x+w*w);x/=k;w/=k;x*=c;w*=c;M=(-I+G)-(-I+y);D=(-J+z)-(-J+H);n=(-J+H)*(-I+y)-(-J+z)*(-I+G);L=(-w+f)-(-w+y);B=(-x+z)-(-x+h);m=(-x+h)*(-w+y)-(-x+z)*(-w+f);U=M*B-L*D;if(Math.abs(U)<0.1){U+=10.1;P.push(z-J,y-I,K,Q,T,N);P.push(z+J,y+I,K,Q,T,N);continue}p=(D*m-B*n)/U;o=(L*n-M*m)/U;A=(p-z)*(p-z)+(o-y)+(o-y);if(A>140*140){e=J-x;d=I-w;k=Math.sqrt(e*e+d*d);e/=k;d/=k;e*=c;d*=c;P.push(z-e,y-d);P.push(K,Q,T,N);P.push(z+e,y+d);P.push(K,Q,T,N);P.push(z-e,y-d);P.push(K,Q,T,N);q++}else{P.push(p,o);P.push(K,Q,T,N);P.push(z-(p-z),y-(o-y));P.push(K,Q,T,N)}}H=F[(u-2)*2];G=F[(u-2)*2+1];z=F[(u-1)*2];y=F[(u-1)*2+1];J=-(G-y);I=H-z;k=Math.sqrt(J*J+I*I);J/=k;I/=k;J*=c;I*=c;P.push(z-J,y-I);P.push(K,Q,T,N);P.push(z+J,y+I);P.push(K,Q,T,N);j.push(R);for(O=0;O<q;O++){j.push(R++)}j.push(R-1)};b.WebGLGraphics.buildComplexPoly=function(o,j){var m=o.points.slice();if(m.length<6){return}var n=j.indices;j.points=m;j.alpha=o.fillAlpha;j.color=b.hex2rgb(o.fillColor);var g=Infinity;var d=-Infinity;var f=Infinity;var c=-Infinity;var l,k;for(var h=0;h<m.length;h+=2){l=m[h];k=m[h+1];g=l<g?l:g;d=l>d?l:d;f=k<f?k:f;c=k>c?k:c}m.push(g,f,d,f,d,c,g,c);var e=m.length/2;for(h=0;h<e;h++){n.push(h)}};b.WebGLGraphics.buildPoly=function(s,k){var p=s.points;if(p.length<6){return}var o=k.points;var q=k.indices;var d=p.length/2;var h=b.hex2rgb(s.fillColor);var f=s.fillAlpha;var c=h[0]*f;var l=h[1]*f;var n=h[2]*f;var e=b.PolyK.Triangulate(p);if(!e){return false}var m=o.length/6;var j=0;for(j=0;j<e.length;j+=3){q.push(e[j]+m);q.push(e[j]+m);q.push(e[j+1]+m);q.push(e[j+2]+m);q.push(e[j+2]+m)}for(j=0;j<d;j++){o.push(p[j*2],p[j*2+1],c,l,n,f)}return true};b.WebGLGraphics.graphicsDataPool=[];b.WebGLGraphicsData=function(c){this.gl=c;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=c.createBuffer();this.indexBuffer=c.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};b.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};b.WebGLGraphicsData.prototype.upload=function(){var c=this.gl;this.glPoints=new b.Float32Array(this.points);c.bindBuffer(c.ARRAY_BUFFER,this.buffer);c.bufferData(c.ARRAY_BUFFER,this.glPoints,c.STATIC_DRAW);this.glIndicies=new b.Uint16Array(this.indices);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.glIndicies,c.STATIC_DRAW);this.dirty=false};b.glContexts=[];b.instances=[];b.WebGLRenderer=function(f,c,d){if(d){for(var e in b.defaultRenderOptions){if(typeof d[e]==="undefined"){d[e]=b.defaultRenderOptions[e]}}}else{d=b.defaultRenderOptions}if(!b.defaultRenderer){b.defaultRenderer=this}this.type=b.WEBGL_RENDERER;this.resolution=d.resolution;this.transparent=d.transparent;this.autoResize=d.autoResize||false;this.preserveDrawingBuffer=d.preserveDrawingBuffer;this.clearBeforeRender=d.clearBeforeRender;this.width=f||800;this.height=c||600;this.view=d.view||document.createElement("canvas");this.contextLostBound=this.handleContextLost.bind(this);this.contextRestoredBound=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLostBound,false);this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,false);this._contextOptions={alpha:this.transparent,antialias:d.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:d.preserveDrawingBuffer};this.projection=new b.Point();this.offset=new b.Point(0,0);this.shaderManager=new b.WebGLShaderManager();this.spriteBatch=new b.WebGLSpriteBatch();this.maskManager=new b.WebGLMaskManager();this.filterManager=new b.WebGLFilterManager();this.stencilManager=new b.WebGLStencilManager();this.blendModeManager=new b.WebGLBlendModeManager();this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};b.WebGLRenderer.prototype.constructor=b.WebGLRenderer;b.WebGLRenderer.prototype.initContext=function(){var c=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=c;if(!c){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=c.id=b.WebGLRenderer.glContextId++;b.glContexts[this.glContextId]=c;b.instances[this.glContextId]=this;c.disable(c.DEPTH_TEST);c.disable(c.CULL_FACE);c.enable(c.BLEND);this.shaderManager.setContext(c);this.spriteBatch.setContext(c);this.maskManager.setContext(c);this.filterManager.setContext(c);this.blendModeManager.setContext(c);this.stencilManager.setContext(c);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};b.WebGLRenderer.prototype.render=function(c){if(this.contextLost){return}if(this.__stage!==c){this.__stage=c}c.updateTransform();var d=this.gl;d.viewport(0,0,this.width,this.height);d.bindFramebuffer(d.FRAMEBUFFER,null);if(this.clearBeforeRender){if(this.transparent){d.clearColor(0,0,0,0)}else{d.clearColor(c.backgroundColorSplit[0],c.backgroundColorSplit[1],c.backgroundColorSplit[2],1)}d.clear(d.COLOR_BUFFER_BIT)}this.renderDisplayObject(c,this.projection)};b.WebGLRenderer.prototype.renderDisplayObject=function(e,c,d){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=d?-1:1;this.renderSession.projection=c;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,d);e._renderWebGL(this.renderSession);this.spriteBatch.end()};b.WebGLRenderer.prototype.resize=function(d,c){this.width=d*this.resolution;this.height=c*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};b.WebGLRenderer.prototype.updateTexture=function(c){if(!c.hasLoaded){return}var d=this.gl;if(!c._glTextures[d.id]){c._glTextures[d.id]=d.createTexture()}d.bindTexture(d.TEXTURE_2D,c._glTextures[d.id]);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.premultipliedAlpha);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c.source);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR:d.NEAREST);if(c.mipmap&&b.isPowerOfTwo(c.width,c.height)){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR_MIPMAP_LINEAR:d.NEAREST_MIPMAP_NEAREST);d.generateMipmap(d.TEXTURE_2D)}else{d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR:d.NEAREST)}if(!c._powerOf2){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)}else{d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT)}c._dirty[d.id]=false;return c._glTextures[d.id]};b.WebGLRenderer.prototype.handleContextLost=function(c){c.preventDefault();this.contextLost=true};b.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var c in b.TextureCache){var d=b.TextureCache[c].baseTexture;d._glTextures=[]}this.contextLost=false};b.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound);this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound);b.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;b.instances[this.glContextId]=null;b.WebGLRenderer.glContextId--};b.WebGLRenderer.prototype.mapBlendModes=function(){var c=this.gl;if(!b.blendModesWebGL){b.blendModesWebGL=[];b.blendModesWebGL[b.blendModes.NORMAL]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.ADD]=[c.SRC_ALPHA,c.DST_ALPHA];b.blendModesWebGL[b.blendModes.MULTIPLY]=[c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.SCREEN]=[c.SRC_ALPHA,c.ONE];b.blendModesWebGL[b.blendModes.OVERLAY]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.DARKEN]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.LIGHTEN]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.COLOR_BURN]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.DIFFERENCE]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.EXCLUSION]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.HUE]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.SATURATION]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.COLOR]=[c.ONE,c.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL[b.blendModes.LUMINOSITY]=[c.ONE,c.ONE_MINUS_SRC_ALPHA]}};b.WebGLRenderer.glContextId=0;b.WebGLBlendModeManager=function(){this.currentBlendMode=99999};b.WebGLBlendModeManager.prototype.constructor=b.WebGLBlendModeManager;b.WebGLBlendModeManager.prototype.setContext=function(c){this.gl=c};b.WebGLBlendModeManager.prototype.setBlendMode=function(c){if(this.currentBlendMode===c){return false}this.currentBlendMode=c;var d=b.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(d[0],d[1]);return true};b.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};b.WebGLMaskManager=function(){};b.WebGLMaskManager.prototype.constructor=b.WebGLMaskManager;b.WebGLMaskManager.prototype.setContext=function(c){this.gl=c};b.WebGLMaskManager.prototype.pushMask=function(d,c){var e=c.gl;if(d.dirty){b.WebGLGraphics.updateGraphics(d,e)}if(!d._webGL[e.id].data.length){return}c.stencilManager.pushStencil(d,d._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.popMask=function(d,c){var e=this.gl;c.stencilManager.popStencil(d,d._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.destroy=function(){this.gl=null};b.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};b.WebGLStencilManager.prototype.setContext=function(c){this.gl=c};b.WebGLStencilManager.prototype.pushStencil=function(c,f,d){var e=this.gl;this.bindGraphics(c,f,d);if(this.stencilStack.length===0){e.enable(e.STENCIL_TEST);e.clear(e.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(f);var g=this.count;e.colorMask(false,false,false,false);e.stencilFunc(e.ALWAYS,0,255);e.stencilOp(e.KEEP,e.KEEP,e.INVERT);if(f.mode===1){e.drawElements(e.TRIANGLE_FAN,f.indices.length-4,e.UNSIGNED_SHORT,0);if(this.reverse){e.stencilFunc(e.EQUAL,255-g,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}else{e.stencilFunc(e.EQUAL,g,255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);if(this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255)}else{e.stencilFunc(e.EQUAL,g+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){e.stencilFunc(e.EQUAL,255-g,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}else{e.stencilFunc(e.EQUAL,g,255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255)}else{e.stencilFunc(e.EQUAL,g+1,255)}}e.colorMask(true,true,true,true);e.stencilOp(e.KEEP,e.KEEP,e.KEEP);this.count++};b.WebGLStencilManager.prototype.bindGraphics=function(d,i,f){this._currentGraphics=d;var h=this.gl;var c=f.projection,g=f.offset,e;if(i.mode===1){e=f.shaderManager.complexPrimitiveShader;f.shaderManager.setShader(e);h.uniform1f(e.flipY,f.flipY);h.uniformMatrix3fv(e.translationMatrix,false,d.worldTransform.toArray(true));h.uniform2f(e.projectionVector,c.x,-c.y);h.uniform2f(e.offsetVector,-g.x,-g.y);h.uniform3fv(e.tintColor,b.hex2rgb(d.tint));h.uniform3fv(e.color,i.color);h.uniform1f(e.alpha,d.worldAlpha*i.alpha);h.bindBuffer(h.ARRAY_BUFFER,i.buffer);h.vertexAttribPointer(e.aVertexPosition,2,h.FLOAT,false,4*2,0);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}else{e=f.shaderManager.primitiveShader;f.shaderManager.setShader(e);h.uniformMatrix3fv(e.translationMatrix,false,d.worldTransform.toArray(true));h.uniform1f(e.flipY,f.flipY);h.uniform2f(e.projectionVector,c.x,-c.y);h.uniform2f(e.offsetVector,-g.x,-g.y);h.uniform3fv(e.tintColor,b.hex2rgb(d.tint));h.uniform1f(e.alpha,d.worldAlpha);h.bindBuffer(h.ARRAY_BUFFER,i.buffer);h.vertexAttribPointer(e.aVertexPosition,2,h.FLOAT,false,4*6,0);h.vertexAttribPointer(e.colorAttribute,4,h.FLOAT,false,4*6,2*4);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}};b.WebGLStencilManager.prototype.popStencil=function(c,f,d){var e=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){e.disable(e.STENCIL_TEST)}else{var g=this.count;this.bindGraphics(c,f,d);e.colorMask(false,false,false,false);if(f.mode===1){this.reverse=!this.reverse;if(this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}else{e.stencilFunc(e.EQUAL,g+1,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);e.stencilFunc(e.ALWAYS,0,255);e.stencilOp(e.KEEP,e.KEEP,e.INVERT);e.drawElements(e.TRIANGLE_FAN,f.indices.length-4,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g),255)}else{e.stencilFunc(e.EQUAL,g,255)}}else{if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}else{e.stencilFunc(e.EQUAL,g+1,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g),255)}else{e.stencilFunc(e.EQUAL,g,255)}}e.colorMask(true,true,true,true);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};b.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};b.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var c=0;c<this.maxAttibs;c++){this.attribState[c]=false}this.stack=[]};b.WebGLShaderManager.prototype.constructor=b.WebGLShaderManager;b.WebGLShaderManager.prototype.setContext=function(c){this.gl=c;this.primitiveShader=new b.PrimitiveShader(c);this.complexPrimitiveShader=new b.ComplexPrimitiveShader(c);this.defaultShader=new b.PixiShader(c);this.fastShader=new b.PixiFastShader(c);this.stripShader=new b.StripShader(c);this.setShader(this.defaultShader)};b.WebGLShaderManager.prototype.setAttribs=function(f){var d;for(d=0;d<this.tempAttribState.length;d++){this.tempAttribState[d]=false}for(d=0;d<f.length;d++){var c=f[d];this.tempAttribState[c]=true}var e=this.gl;for(d=0;d<this.attribState.length;d++){if(this.attribState[d]!==this.tempAttribState[d]){this.attribState[d]=this.tempAttribState[d];if(this.tempAttribState[d]){e.enableVertexAttribArray(d)}else{e.disableVertexAttribArray(d)}}}};b.WebGLShaderManager.prototype.setShader=function(c){if(this._currentId===c._UID){return false}this._currentId=c._UID;this.currentShader=c;this.gl.useProgram(c.program);this.setAttribs(c.attributes);return true};b.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};b.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2000;var c=this.size*4*4*this.vertSize;var f=this.size*6;this.vertices=new b.ArrayBuffer(c);this.positions=new b.Float32Array(this.vertices);this.colors=new b.Uint32Array(this.vertices);this.indices=new b.Uint16Array(f);this.lastIndexCount=0;for(var e=0,d=0;e<f;e+=6,d+=4){this.indices[e+0]=d+0;this.indices[e+1]=d+1;this.indices[e+2]=d+2;this.indices[e+3]=d+0;this.indices[e+4]=d+2;this.indices[e+5]=d+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new b.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};b.WebGLSpriteBatch.prototype.setContext=function(d){this.gl=d;this.vertexBuffer=d.createBuffer();this.indexBuffer=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.indexBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this.indices,d.STATIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,this.vertices,d.DYNAMIC_DRAW);this.currentBlendMode=99999;var c=new b.PixiShader(d);c.fragmentSrc=this.defaultShader.fragmentSrc;c.uniforms={};c.init();this.defaultShader.shaders[d.id]=c};b.WebGLSpriteBatch.prototype.begin=function(c){this.renderSession=c;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};b.WebGLSpriteBatch.prototype.end=function(){this.flush()};b.WebGLSpriteBatch.prototype.render=function(q){var p=q.texture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=p.baseTexture}var m=p._uvs;if(!m){return}var f=q.anchor.x;var e=q.anchor.y;var o,n,k,j;if(p.trim){var t=p.trim;n=t.x-f*t.width;o=n+p.crop.width;j=t.y-e*t.height;k=j+p.crop.height}else{o=(p.frame.width)*(1-f);n=(p.frame.width)*-f;k=p.frame.height*(1-e);j=p.frame.height*-e}var g=this.currentBatchSize*4*this.vertSize;var r=p.baseTexture.resolution;var s=q.worldTransform;var z=s.a/r;var x=s.b/r;var v=s.c/r;var u=s.d/r;var y=s.tx;var w=s.ty;var l=this.colors;var i=this.positions;if(this.renderSession.roundPixels){i[g]=z*n+v*j+y|0;i[g+1]=u*j+x*n+w|0;i[g+5]=z*o+v*j+y|0;i[g+6]=u*j+x*o+w|0;i[g+10]=z*o+v*k+y|0;i[g+11]=u*k+x*o+w|0;i[g+15]=z*n+v*k+y|0;i[g+16]=u*k+x*n+w|0}else{i[g]=z*n+v*j+y;i[g+1]=u*j+x*n+w;i[g+5]=z*o+v*j+y;i[g+6]=u*j+x*o+w;i[g+10]=z*o+v*k+y;i[g+11]=u*k+x*o+w;i[g+15]=z*n+v*k+y;i[g+16]=u*k+x*n+w}i[g+2]=m.x0;i[g+3]=m.y0;i[g+7]=m.x1;i[g+8]=m.y1;i[g+12]=m.x2;i[g+13]=m.y2;i[g+17]=m.x3;i[g+18]=m.y3;var h=q.tint;l[g+4]=l[g+9]=l[g+14]=l[g+19]=(h>>16)+(h&65280)+((h&255)<<16)+(q.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=q};b.WebGLSpriteBatch.prototype.renderTilingSprite=function(f){var q=f.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=q.baseTexture}if(!f._uvs){f._uvs=new b.TextureUvs()}var n=f._uvs;f.tilePosition.x%=q.baseTexture.width*f.tileScaleOffset.x;f.tilePosition.y%=q.baseTexture.height*f.tileScaleOffset.y;var x=f.tilePosition.x/(q.baseTexture.width*f.tileScaleOffset.x);var w=f.tilePosition.y/(q.baseTexture.height*f.tileScaleOffset.y);var D=(f.width/q.baseTexture.width)/(f.tileScale.x*f.tileScaleOffset.x);var A=(f.height/q.baseTexture.height)/(f.tileScale.y*f.tileScaleOffset.y);n.x0=0-x;n.y0=0-w;n.x1=(1*D)-x;n.y1=0-w;n.x2=(1*D)-x;n.y2=(1*A)-w;n.x3=0-x;n.y3=(1*A)-w;var i=f.tint;var v=(i>>16)+(i&65280)+((i&255)<<16)+(f.alpha*255<<24);var k=this.positions;var m=this.colors;var s=f.width;var r=f.height;var g=f.anchor.x;var e=f.anchor.y;var p=s*(1-g);var o=s*-g;var l=r*(1-e);var j=r*-e;var h=this.currentBatchSize*4*this.vertSize;var t=q.baseTexture.resolution;var u=f.worldTransform;var F=u.a/t;var C=u.b/t;var z=u.c/t;var y=u.d/t;var E=u.tx;var B=u.ty;k[h++]=F*o+z*j+E;k[h++]=y*j+C*o+B;k[h++]=n.x0;k[h++]=n.y0;m[h++]=v;k[h++]=(F*p+z*j+E);k[h++]=y*j+C*p+B;k[h++]=n.x1;k[h++]=n.y1;m[h++]=v;k[h++]=F*p+z*l+E;k[h++]=y*l+C*p+B;k[h++]=n.x2;k[h++]=n.y2;m[h++]=v;k[h++]=F*o+z*l+E;k[h++]=y*l+C*o+B;k[h++]=n.x3;k[h++]=n.y3;m[h++]=v;this.sprites[this.currentBatchSize++]=f};b.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var s=this.gl;var c;if(this.dirty){this.dirty=false;s.activeTexture(s.TEXTURE0);s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c=this.defaultShader.shaders[s.id];var n=this.vertSize*4;s.vertexAttribPointer(c.aVertexPosition,2,s.FLOAT,false,n,0);s.vertexAttribPointer(c.aTextureCoord,2,s.FLOAT,false,n,2*4);s.vertexAttribPointer(c.colorAttribute,4,s.UNSIGNED_BYTE,true,n,4*4)}if(this.currentBatchSize>(this.size*0.5)){s.bufferSubData(s.ARRAY_BUFFER,0,this.vertices)}else{var k=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);s.bufferSubData(s.ARRAY_BUFFER,0,k)}var q,v,h;var o=0;var g=0;var u=null;var l=this.renderSession.blendModeManager.currentBlendMode;var d=null;var f=false;var e=false;var m;for(var t=0,r=this.currentBatchSize;t<r;t++){m=this.sprites[t];q=m.texture.baseTexture;v=m.blendMode;h=m.shader||this.defaultShader;f=l!==v;e=d!==h;if(u!==q||f||e){this.renderBatch(u,o,g);g=t;o=0;u=q;if(f){l=v;this.renderSession.blendModeManager.setBlendMode(l)}if(e){d=h;c=d.shaders[s.id];if(!c){c=new b.PixiShader(s);c.fragmentSrc=d.fragmentSrc;c.uniforms=d.uniforms;c.init();d.shaders[s.id]=c}this.renderSession.shaderManager.setShader(c);if(c.dirty){c.syncUniforms()}var w=this.renderSession.projection;s.uniform2f(c.projectionVector,w.x,w.y);var p=this.renderSession.offset;s.uniform2f(c.offsetVector,p.x,p.y)}}o++}this.renderBatch(u,o,g);this.currentBatchSize=0};b.WebGLSpriteBatch.prototype.renderBatch=function(d,c,f){if(c===0){return}var e=this.gl;if(d._dirty[e.id]){this.renderSession.renderer.updateTexture(d)}else{e.bindTexture(e.TEXTURE_2D,d._glTextures[e.id])}e.drawElements(e.TRIANGLES,c*6,e.UNSIGNED_SHORT,f*6*2);this.renderSession.drawCount++};b.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};b.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};b.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};b.WebGLFastSpriteBatch=function(g){this.vertSize=10;this.maxSize=6000;this.size=this.maxSize;var c=this.size*4*this.vertSize;var f=this.maxSize*6;this.vertices=new b.Float32Array(c);this.indices=new b.Uint16Array(f);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var e=0,d=0;e<f;e+=6,d+=4){this.indices[e+0]=d+0;this.indices[e+1]=d+1;this.indices[e+2]=d+2;this.indices[e+3]=d+0;this.indices[e+4]=d+2;this.indices[e+5]=d+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(g)};b.WebGLFastSpriteBatch.prototype.constructor=b.WebGLFastSpriteBatch;b.WebGLFastSpriteBatch.prototype.setContext=function(c){this.gl=c;this.vertexBuffer=c.createBuffer();this.indexBuffer=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertices,c.DYNAMIC_DRAW)};b.WebGLFastSpriteBatch.prototype.begin=function(c,d){this.renderSession=d;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=c.worldTransform.toArray(true);this.start()};b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.render=function(c){var g=c.children;var f=g[0];if(!f.texture._uvs){return}this.currentBaseTexture=f.texture.baseTexture;if(f.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(f.blendMode)}for(var e=0,d=g.length;e<d;e++){this.renderSprite(g[e])}this.flush()};b.WebGLFastSpriteBatch.prototype.renderSprite=function(l){if(!l.visible){return}if(l.texture.baseTexture!==this.currentBaseTexture){this.flush();this.currentBaseTexture=l.texture.baseTexture;if(!l.texture._uvs){return}}var e,i=this.vertices,c,m,g,f,k,j,h;e=l.texture._uvs;c=l.texture.frame.width;m=l.texture.frame.height;if(l.texture.trim){var d=l.texture.trim;f=d.x-l.anchor.x*d.width;g=f+l.texture.crop.width;j=d.y-l.anchor.y*d.height;k=j+l.texture.crop.height}else{g=(l.texture.frame.width)*(1-l.anchor.x);f=(l.texture.frame.width)*-l.anchor.x;k=l.texture.frame.height*(1-l.anchor.y);j=l.texture.frame.height*-l.anchor.y}h=this.currentBatchSize*4*this.vertSize;i[h++]=f;i[h++]=j;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x0;i[h++]=e.y1;i[h++]=l.alpha;i[h++]=g;i[h++]=j;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x1;i[h++]=e.y1;i[h++]=l.alpha;i[h++]=g;i[h++]=k;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x2;i[h++]=e.y2;i[h++]=l.alpha;i[h++]=f;i[h++]=k;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x3;i[h++]=e.y3;i[h++]=l.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};b.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var d=this.gl;if(!this.currentBaseTexture._glTextures[d.id]){this.renderSession.renderer.updateTexture(this.currentBaseTexture,d)}d.bindTexture(d.TEXTURE_2D,this.currentBaseTexture._glTextures[d.id]);if(this.currentBatchSize>(this.size*0.5)){d.bufferSubData(d.ARRAY_BUFFER,0,this.vertices)}else{var c=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);d.bufferSubData(d.ARRAY_BUFFER,0,c)}d.drawElements(d.TRIANGLES,this.currentBatchSize*6,d.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,c.x,c.y);e.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var d=this.vertSize*4;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,false,d,0);e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,false,d,2*4);e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,false,d,4*4);e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,false,d,6*4);e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,false,d,7*4);e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,false,d,9*4)};b.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};b.WebGLFilterManager.prototype.constructor=b.WebGLFilterManager;b.WebGLFilterManager.prototype.setContext=function(c){this.gl=c;this.texturePool=[];this.initShaderBuffers()};b.WebGLFilterManager.prototype.begin=function(e,d){this.renderSession=e;this.defaultShader=e.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=c.x*2;this.height=-c.y*2;this.buffer=d};b.WebGLFilterManager.prototype.pushFilter=function(d){var j=this.gl;var c=this.renderSession.projection;var i=this.renderSession.offset;d._filterArea=d.target.filterArea||d.target.getBounds();this.filterStack.push(d);var e=d.filterPasses[0];this.offsetX+=d._filterArea.x;this.offsetY+=d._filterArea.y;var f=this.texturePool.pop();if(!f){f=new b.FilterTexture(this.gl,this.width,this.height)}else{f.resize(this.width,this.height)}j.bindTexture(j.TEXTURE_2D,f.texture);var g=d._filterArea;var h=e.padding;g.x-=h;g.y-=h;g.width+=h*2;g.height+=h*2;if(g.x<0){g.x=0}if(g.width>this.width){g.width=this.width}if(g.y<0){g.y=0}if(g.height>this.height){g.height=this.height}j.bindFramebuffer(j.FRAMEBUFFER,f.frameBuffer);j.viewport(0,0,g.width,g.height);c.x=g.width/2;c.y=-g.height/2;i.x=-g.x;i.y=-g.y;j.colorMask(true,true,true,true);j.clearColor(0,0,0,0);j.clear(j.COLOR_BUFFER_BIT);d._glFilterTexture=f};b.WebGLFilterManager.prototype.popFilter=function(){var p=this.gl;var m=this.filterStack.pop();var v=m._filterArea;var k=m._glFilterTexture;var w=this.renderSession.projection;var f=this.renderSession.offset;if(m.filterPasses.length>1){p.viewport(0,0,v.width,v.height);p.bindBuffer(p.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=v.height;this.vertexArray[2]=v.width;this.vertexArray[3]=v.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=v.width;this.vertexArray[7]=0;p.bufferSubData(p.ARRAY_BUFFER,0,this.vertexArray);p.bindBuffer(p.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=v.width/this.width;this.uvArray[5]=v.height/this.height;this.uvArray[6]=v.width/this.width;this.uvArray[7]=v.height/this.height;p.bufferSubData(p.ARRAY_BUFFER,0,this.uvArray);var r=k;var d=this.texturePool.pop();if(!d){d=new b.FilterTexture(this.gl,this.width,this.height)}d.resize(this.width,this.height);p.bindFramebuffer(p.FRAMEBUFFER,d.frameBuffer);p.clear(p.COLOR_BUFFER_BIT);p.disable(p.BLEND);for(var q=0;q<m.filterPasses.length-1;q++){var e=m.filterPasses[q];p.bindFramebuffer(p.FRAMEBUFFER,d.frameBuffer);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,r.texture);this.applyFilterPass(e,v,v.width,v.height);var u=r;r=d;d=u}p.enable(p.BLEND);k=r;this.texturePool.push(d)}var j=m.filterPasses[m.filterPasses.length-1];this.offsetX-=v.x;this.offsetY-=v.y;var n=this.width;var l=this.height;var t=0;var s=0;var o=this.buffer;if(this.filterStack.length===0){p.colorMask(true,true,true,true)}else{var c=this.filterStack[this.filterStack.length-1];v=c._filterArea;n=v.width;l=v.height;t=v.x;s=v.y;o=c._glFilterTexture.frameBuffer}w.x=n/2;w.y=-l/2;f.x=t;f.y=s;v=m._filterArea;var h=v.x-t;var g=v.y-s;p.bindBuffer(p.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=h;this.vertexArray[1]=g+v.height;this.vertexArray[2]=h+v.width;this.vertexArray[3]=g+v.height;this.vertexArray[4]=h;this.vertexArray[5]=g;this.vertexArray[6]=h+v.width;this.vertexArray[7]=g;p.bufferSubData(p.ARRAY_BUFFER,0,this.vertexArray);p.bindBuffer(p.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=v.width/this.width;this.uvArray[5]=v.height/this.height;this.uvArray[6]=v.width/this.width;this.uvArray[7]=v.height/this.height;p.bufferSubData(p.ARRAY_BUFFER,0,this.uvArray);p.viewport(0,0,n*this.renderSession.resolution,l*this.renderSession.resolution);p.bindFramebuffer(p.FRAMEBUFFER,o);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,k.texture);this.applyFilterPass(j,v,n,l);this.texturePool.push(k);m._glFilterTexture=null};b.WebGLFilterManager.prototype.applyFilterPass=function(e,g,d,c){var h=this.gl;var f=e.shaders[h.id];if(!f){f=new b.PixiShader(h);f.fragmentSrc=e.fragmentSrc;f.uniforms=e.uniforms;f.init();e.shaders[h.id]=f}this.renderSession.shaderManager.setShader(f);h.uniform2f(f.projectionVector,d/2,-c/2);h.uniform2f(f.offsetVector,0,0);if(e.uniforms.dimensions){e.uniforms.dimensions.value[0]=this.width;e.uniforms.dimensions.value[1]=this.height;e.uniforms.dimensions.value[2]=this.vertexArray[0];e.uniforms.dimensions.value[3]=this.vertexArray[5]}f.syncUniforms();h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.vertexAttribPointer(f.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this.uvBuffer);h.vertexAttribPointer(f.aTextureCoord,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this.colorBuffer);h.vertexAttribPointer(f.colorAttribute,2,h.FLOAT,false,0,0);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0);this.renderSession.drawCount++};b.WebGLFilterManager.prototype.initShaderBuffers=function(){var c=this.gl;this.vertexBuffer=c.createBuffer();this.uvBuffer=c.createBuffer();this.colorBuffer=c.createBuffer();this.indexBuffer=c.createBuffer();this.vertexArray=new b.Float32Array([0,0,1,0,0,1,1,1]);c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertexArray,c.STATIC_DRAW);this.uvArray=new b.Float32Array([0,0,1,0,0,1,1,1]);c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.bufferData(c.ARRAY_BUFFER,this.uvArray,c.STATIC_DRAW);this.colorArray=new b.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.bufferData(c.ARRAY_BUFFER,this.colorArray,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),c.STATIC_DRAW)};b.WebGLFilterManager.prototype.destroy=function(){var d=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var c=0;c<this.texturePool.length;c++){this.texturePool[c].destroy()}this.texturePool=null;d.deleteBuffer(this.vertexBuffer);d.deleteBuffer(this.uvBuffer);d.deleteBuffer(this.colorBuffer);d.deleteBuffer(this.indexBuffer)};b.FilterTexture=function(f,e,c,d){this.gl=f;this.frameBuffer=f.createFramebuffer();this.texture=f.createTexture();d=d||b.scaleModes.DEFAULT;f.bindTexture(f.TEXTURE_2D,this.texture);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,d===b.scaleModes.LINEAR?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,d===b.scaleModes.LINEAR?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer);f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.texture,0);this.renderBuffer=f.createRenderbuffer();f.bindRenderbuffer(f.RENDERBUFFER,this.renderBuffer);f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,this.renderBuffer);this.resize(e,c)};b.FilterTexture.prototype.constructor=b.FilterTexture;b.FilterTexture.prototype.clear=function(){var c=this.gl;c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT)};b.FilterTexture.prototype.resize=function(d,c){if(this.width===d&&this.height===c){return}this.width=d;this.height=c;var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.texture);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,d,c,0,e.RGBA,e.UNSIGNED_BYTE,null);e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,d,c)};b.FilterTexture.prototype.destroy=function(){var c=this.gl;c.deleteFramebuffer(this.frameBuffer);c.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};b.CanvasBuffer=function(d,c){this.width=d;this.height=c;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=d;this.canvas.height=c};b.CanvasBuffer.prototype.constructor=b.CanvasBuffer;b.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};b.CanvasBuffer.prototype.resize=function(d,c){this.width=this.canvas.width=d;this.height=this.canvas.height=c};b.CanvasMaskManager=function(){};b.CanvasMaskManager.prototype.constructor=b.CanvasMaskManager;b.CanvasMaskManager.prototype.pushMask=function(h,g){var f=g.context;f.save();var c=h.alpha;var e=h.worldTransform;var d=g.resolution;f.setTransform(e.a*d,e.b*d,e.c*d,e.d*d,e.tx*d,e.ty*d);b.CanvasGraphics.renderGraphicsMask(h,f);f.clip();h.worldAlpha=c};b.CanvasMaskManager.prototype.popMask=function(c){c.context.restore()};b.CanvasTinter=function(){};b.CanvasTinter.getTintedTexture=function(f,c){var g=f.texture;var d=b.CanvasTinter.canvas||document.createElement("canvas");b.CanvasTinter.tintMethod(g,c,d);if(b.CanvasTinter.convertTintToImage){var e=new Image();e.src=d.toDataURL()}else{b.CanvasTinter.canvas=null}return d};b.CanvasTinter.tintWithMultiply=function(g,c,d){var e=d.getContext("2d");var f=g.crop;d.width=f.width;d.height=f.height;e.fillStyle="#"+("00000"+(c|0).toString(16)).substr(-6);e.fillRect(0,0,f.width,f.height);e.globalCompositeOperation="multiply";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);e.globalCompositeOperation="destination-atop";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithOverlay=function(g,c,d){var e=d.getContext("2d");var f=g.crop;d.width=f.width;d.height=f.height;e.globalCompositeOperation="copy";e.fillStyle="#"+("00000"+(c|0).toString(16)).substr(-6);e.fillRect(0,0,f.width,f.height);e.globalCompositeOperation="destination-atop";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithPerPixel=function(o,k,f){var e=f.getContext("2d");var m=o.crop;f.width=m.width;f.height=m.height;e.globalCompositeOperation="copy";e.drawImage(o.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);var d=b.hex2rgb(k);var c=d[0],n=d[1],p=d[2];var q=e.getImageData(0,0,m.width,m.height);var h=q.data;for(var l=0;l<h.length;l+=4){h[l+0]*=c;h[l+1]*=n;h[l+2]*=p;if(!b.CanvasTinter.canHandleAlpha){var j=h[l+3];h[l+0]/=255/j;h[l+1]/=255/j;h[l+2]/=255/j}}e.putImageData(q,0,0)};b.CanvasTinter.roundColor=function(c){var d=b.CanvasTinter.cacheStepsPerColorChannel;var e=b.hex2rgb(c);e[0]=Math.min(255,(e[0]/d)*d);e[1]=Math.min(255,(e[1]/d)*d);e[2]=Math.min(255,(e[2]/d)*d);return b.rgb2hex(e)};b.CanvasTinter.checkInverseAlpha=function(){var d=new b.CanvasBuffer(2,1);d.context.fillStyle="rgba(10, 20, 30, 0.5)";d.context.fillRect(0,0,1,1);var e=d.context.getImageData(0,0,1,1);d.context.putImageData(e,1,0);var c=d.context.getImageData(1,0,1,1);return(c.data[0]===e.data[0]&&c.data[1]===e.data[1]&&c.data[2]===e.data[2]&&c.data[3]===e.data[3])};b.CanvasTinter.cacheStepsPerColorChannel=8;b.CanvasTinter.convertTintToImage=false;b.CanvasTinter.canHandleAlpha=b.CanvasTinter.checkInverseAlpha();b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes();b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel;b.CanvasRenderer=function(f,c,d){if(d){for(var e in b.defaultRenderOptions){if(typeof d[e]==="undefined"){d[e]=b.defaultRenderOptions[e]}}}else{d=b.defaultRenderOptions}if(!b.defaultRenderer){b.defaultRenderer=this}this.type=b.CANVAS_RENDERER;this.resolution=d.resolution;this.clearBeforeRender=d.clearBeforeRender;this.transparent=d.transparent;this.autoResize=d.autoResize||false;this.width=f||800;this.height=c||600;this.width*=this.resolution;this.height*=this.resolution;this.view=d.view||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.view.width=this.width*this.resolution;this.view.height=this.height*this.resolution;this.count=0;this.maskManager=new b.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:false};this.mapBlendModes();this.resize(f,c);if("imageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="imageSmoothingEnabled"}else{if("webkitImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="webkitImageSmoothingEnabled"}else{if("mozImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="mozImageSmoothingEnabled"}else{if("oImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="oImageSmoothingEnabled"}else{if("msImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="msImageSmoothingEnabled"}}}}}};b.CanvasRenderer.prototype.constructor=b.CanvasRenderer;b.CanvasRenderer.prototype.render=function(c){c.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=b.blendModes.NORMAL;this.context.globalCompositeOperation=b.blendModesCanvas[b.blendModes.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{this.context.fillStyle=c.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(c)};b.CanvasRenderer.prototype.destroy=function(c){if(typeof c==="undefined"){c=true}if(c&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};b.CanvasRenderer.prototype.resize=function(d,c){this.width=d*this.resolution;this.height=c*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}};b.CanvasRenderer.prototype.renderDisplayObject=function(d,c){this.renderSession.context=c||this.context;this.renderSession.resolution=this.resolution;d._renderCanvas(this.renderSession)};b.CanvasRenderer.prototype.mapBlendModes=function(){if(!b.blendModesCanvas){b.blendModesCanvas=[];if(b.canUseNewCanvasBlendModes()){b.blendModesCanvas[b.blendModes.NORMAL]="source-over";b.blendModesCanvas[b.blendModes.ADD]="lighter";b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply";b.blendModesCanvas[b.blendModes.SCREEN]="screen";b.blendModesCanvas[b.blendModes.OVERLAY]="overlay";b.blendModesCanvas[b.blendModes.DARKEN]="darken";b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten";b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge";b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn";b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light";b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light";b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference";b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion";b.blendModesCanvas[b.blendModes.HUE]="hue";b.blendModesCanvas[b.blendModes.SATURATION]="saturation";b.blendModesCanvas[b.blendModes.COLOR]="color";b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"}else{b.blendModesCanvas[b.blendModes.NORMAL]="source-over";b.blendModesCanvas[b.blendModes.ADD]="lighter";b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over";b.blendModesCanvas[b.blendModes.SCREEN]="source-over";b.blendModesCanvas[b.blendModes.OVERLAY]="source-over";b.blendModesCanvas[b.blendModes.DARKEN]="source-over";b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over";b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over";b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over";b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over";b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over";b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over";b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over";b.blendModesCanvas[b.blendModes.HUE]="source-over";b.blendModesCanvas[b.blendModes.SATURATION]="source-over";b.blendModesCanvas[b.blendModes.COLOR]="source-over";b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over"}}};b.CanvasGraphics=function(){};b.CanvasGraphics.renderGraphics=function(G,f){var B=G.worldAlpha;if(G.dirty){this.updateGraphicsTint(G);G.dirty=false}for(var E=0;E<G.graphicsData.length;E++){var I=G.graphicsData[E];var e=I.shape;var n=I._fillTint;var d=I._lineTint;f.lineWidth=I.lineWidth;if(I.type===b.Graphics.POLY){f.beginPath();var D=e.points;f.moveTo(D[0],D[1]);for(var C=1;C<D.length/2;C++){f.lineTo(D[C*2],D[C*2+1])}if(e.closed){f.lineTo(D[0],D[1])}if(D[0]===D[D.length-2]&&D[1]===D[D.length-1]){f.closePath()}if(I.fill){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}else{if(I.type===b.Graphics.RECT){if(I.fillColor||I.fillColor===0){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fillRect(e.x,e.y,e.width,e.height)}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.strokeRect(e.x,e.y,e.width,e.height)}}else{if(I.type===b.Graphics.CIRC){f.beginPath();f.arc(e.x,e.y,e.radius,0,2*Math.PI);f.closePath();if(I.fill){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}else{if(I.type===b.Graphics.ELIP){var s=e.width*2;var F=e.height*2;var r=e.x-s/2;var q=e.y-F/2;f.beginPath();var t=0.5522848,m=(s/2)*t,k=(F/2)*t,A=r+s,c=q+F,u=r+s/2,H=q+F/2;f.moveTo(r,H);f.bezierCurveTo(r,H-k,u-m,q,u,q);f.bezierCurveTo(u+m,q,A,H-k,A,H);f.bezierCurveTo(A,H+k,u+m,c,u,c);f.bezierCurveTo(u-m,c,r,H+k,r,H);f.closePath();if(I.fill){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}else{if(I.type===b.Graphics.RREC){var o=e.x;var l=e.y;var z=e.width;var v=e.height;var g=e.radius;var p=Math.min(z,v)/2|0;g=g>p?p:g;f.beginPath();f.moveTo(o,l+g);f.lineTo(o,l+v-g);f.quadraticCurveTo(o,l+v,o+g,l+v);f.lineTo(o+z-g,l+v);f.quadraticCurveTo(o+z,l+v,o+z,l+v-g);f.lineTo(o+z,l+g);f.quadraticCurveTo(o+z,l,o+z-g,l);f.lineTo(o+g,l);f.quadraticCurveTo(o,l,o,l+g);f.closePath();if(I.fillColor||I.fillColor===0){f.globalAlpha=I.fillAlpha*B;f.fillStyle="#"+("00000"+(n|0).toString(16)).substr(-6);f.fill()}if(I.lineWidth){f.globalAlpha=I.lineAlpha*B;f.strokeStyle="#"+("00000"+(d|0).toString(16)).substr(-6);f.stroke()}}}}}}}};b.CanvasGraphics.renderGraphicsMask=function(E,e){var C=E.graphicsData.length;if(C===0){return}e.beginPath();for(var B=0;B<C;B++){var G=E.graphicsData[B];var d=G.shape;if(G.type===b.Graphics.POLY){var A=d.points;e.moveTo(A[0],A[1]);for(var z=1;z<A.length/2;z++){e.lineTo(A[z*2],A[z*2+1])}if(A[0]===A[A.length-2]&&A[1]===A[A.length-1]){e.closePath()}}else{if(G.type===b.Graphics.RECT){e.rect(d.x,d.y,d.width,d.height);e.closePath()}else{if(G.type===b.Graphics.CIRC){e.arc(d.x,d.y,d.radius,0,2*Math.PI);e.closePath()}else{if(G.type===b.Graphics.ELIP){var q=d.width*2;var D=d.height*2;var p=d.x-q/2;var o=d.y-D/2;var r=0.5522848,l=(q/2)*r,g=(D/2)*r,v=p+q,c=o+D,s=p+q/2,F=o+D/2;e.moveTo(p,F);e.bezierCurveTo(p,F-g,s-l,o,s,o);e.bezierCurveTo(s+l,o,v,F-g,v,F);e.bezierCurveTo(v,F+g,s+l,c,s,c);e.bezierCurveTo(s-l,c,p,F+g,p,F);e.closePath()}else{if(G.type===b.Graphics.RREC){var m=d.x;var k=d.y;var u=d.width;var t=d.height;var f=d.radius;var n=Math.min(u,t)/2|0;f=f>n?n:f;e.moveTo(m,k+f);e.lineTo(m,k+t-f);e.quadraticCurveTo(m,k+t,m+f,k+t);e.lineTo(m+u-f,k+t);e.quadraticCurveTo(m+u,k+t,m+u,k+t-f);e.lineTo(m+u,k+f);e.quadraticCurveTo(m+u,k,m+u-f,k);e.lineTo(m+f,k);e.quadraticCurveTo(m,k,m,k+f);e.closePath()}}}}}}};b.CanvasGraphics.updateGraphicsTint=function(e){if(e.tint===16777215){return}var d=(e.tint>>16&255)/255;var c=(e.tint>>8&255)/255;var h=(e.tint&255)/255;for(var f=0;f<e.graphicsData.length;f++){var g=e.graphicsData[f];var k=g.fillColor|0;var j=g.lineColor|0;g._fillTint=(((k>>16&255)/255*d*255<<16)+((k>>8&255)/255*c*255<<8)+(k&255)/255*h*255);g._lineTint=(((j>>16&255)/255*d*255<<16)+((j>>8&255)/255*c*255<<8)+(j&255)/255*h*255)}};b.Graphics=function(){b.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=b.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new b.Rectangle(0,0,1,1);this.dirty=true;this.webGLDirty=false;this.cachedSpriteDirty=false};b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Graphics.prototype.constructor=b.Graphics;b.Graphics.prototype.lineStyle=function(c,d,e){this.lineWidth=c||0;this.lineColor=d||0;this.lineAlpha=(e===undefined)?1:e;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new b.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};b.Graphics.prototype.moveTo=function(c,d){this.drawShape(new b.Polygon([c,d]));return this};b.Graphics.prototype.lineTo=function(c,d){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(c,d);this.dirty=true;return this};b.Graphics.prototype.quadraticCurveTo=function(m,g,p,l){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var c,h,d=20,q=this.currentPath.shape.points;if(q.length===0){this.moveTo(0,0)}var o=q[q.length-2];var k=q[q.length-1];var e=0;for(var f=1;f<=d;++f){e=f/d;c=o+((m-o)*e);h=k+((g-k)*e);q.push(c+(((m+((p-m)*e))-c)*e),h+(((g+((l-g)*e))-h)*e))}this.dirty=true;return this};b.Graphics.prototype.bezierCurveTo=function(s,o,r,h,u,q){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var f=20,d,e,c,m,l,v=this.currentPath.shape.points;var t=v[v.length-2];var p=v[v.length-1];var g=0;for(var k=1;k<=f;++k){g=k/f;d=(1-g);e=d*d;c=e*d;m=g*g;l=m*g;v.push(c*t+3*e*g*s+3*d*m*r+l*u,c*p+3*e*g*o+3*d*m*h+l*q)}this.dirty=true;return this};b.Graphics.prototype.arcTo=function(y,i,x,g,j){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(y,i)}}else{this.moveTo(y,i)}var v=this.currentPath.shape.points,q=v[v.length-2],o=v[v.length-1],D=o-i,l=q-y,C=g-i,k=x-y,w=Math.abs(D*k-l*C);if(w<1e-8||j===0){if(v[v.length-2]!==y||v[v.length-1]!==i){v.push(y,i)}}else{var B=D*D+l*l,s=C*C+k*k,d=D*C+l*k,n=j*Math.sqrt(B)/w,m=j*Math.sqrt(s)/w,e=n*d/B,c=m*d/s,h=n*k+m*l,f=n*C+m*D,r=l*(m+e),p=D*(m+e),A=k*(n+c),z=C*(n+c),u=Math.atan2(p-f,r-h),t=Math.atan2(z-f,A-h);this.arc(h+y,f+i,j,u,t,l*C>k*D)}this.dirty=true;return this};b.Graphics.prototype.arc=function(f,e,g,r,p,d){if(r===p){return this}if(typeof d==="undefined"){d=false}if(!d&&p<=r){p+=Math.PI*2}else{if(d&&r<=p){r+=Math.PI*2}}var l=d?(r-p)*-1:(p-r);var o=Math.ceil(Math.abs(l)/(Math.PI*2))*40;if(l===0){return this}var y=f+Math.cos(r)*g;var w=e+Math.sin(r)*g;if(d&&this.filling){this.moveTo(f,e)}else{this.moveTo(y,w)}var v=this.currentPath.shape.points;var h=l/(o*2);var n=h*2;var q=Math.cos(h);var t=Math.sin(h);var A=o-1;var j=(A%1)/A;for(var u=0;u<=A;u++){var m=u+j*u;var x=((h)+r+(n*m));var z=Math.cos(x);var k=-Math.sin(x);v.push(((q*z)+(t*k))*g+f,((q*-k)+(t*z))*g+e)}this.dirty=true;return this};b.Graphics.prototype.beginFill=function(c,d){this.filling=true;this.fillColor=c||0;this.fillAlpha=(d===undefined)?1:d;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};b.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};b.Graphics.prototype.drawRect=function(d,f,e,c){this.drawShape(new b.Rectangle(d,f,e,c));return this};b.Graphics.prototype.drawRoundedRect=function(e,g,f,d,c){this.drawShape(new b.RoundedRectangle(e,g,f,d,c));return this};b.Graphics.prototype.drawCircle=function(c,e,d){this.drawShape(new b.Circle(c,e,d));return this};b.Graphics.prototype.drawEllipse=function(d,f,e,c){this.drawShape(new b.Ellipse(d,f,e,c));return this};b.Graphics.prototype.drawPolygon=function(e){var d=e;if(!Array.isArray(d)){d=new Array(arguments.length);for(var c=0;c<d.length;++c){d[c]=arguments[c]}}this.drawShape(new Phaser.Polygon(d));return this};b.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];return this};b.Graphics.prototype.generateTexture=function(c,e){c=c||1;var g=this.getBounds();var d=new b.CanvasBuffer(g.width*c,g.height*c);var f=b.Texture.fromCanvas(d.canvas,e);f.baseTexture.resolution=c;d.context.scale(c,c);d.context.translate(-g.x,-g.y);b.CanvasGraphics.renderGraphics(this,d.context);return f};b.Graphics.prototype._renderWebGL=function(d){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;b.Sprite.prototype._renderWebGL.call(this._cachedSprite,d);return}else{d.spriteBatch.stop();d.blendModeManager.setBlendMode(this.blendMode);if(this._mask){d.maskManager.pushMask(this._mask,d)}if(this._filters){d.filterManager.pushFilter(this._filterBlock)}if(this.blendMode!==d.spriteBatch.currentBlendMode){d.spriteBatch.currentBlendMode=this.blendMode;var e=b.blendModesWebGL[d.spriteBatch.currentBlendMode];d.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}b.WebGLGraphics.renderGraphics(this,d);if(this.children.length){d.spriteBatch.start();for(var c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}d.spriteBatch.stop()}if(this._filters){d.filterManager.popFilter()}if(this._mask){d.maskManager.popMask(this.mask,d)}d.drawCount++;d.spriteBatch.start()}};b.Graphics.prototype._renderCanvas=function(g){if(this.isMask===true){return}if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;b.Sprite.prototype._renderCanvas.call(this._cachedSprite,g);return}else{var f=g.context;var d=this.worldTransform;if(this.blendMode!==g.currentBlendMode){g.currentBlendMode=this.blendMode;f.globalCompositeOperation=b.blendModesCanvas[g.currentBlendMode]}if(this._mask){g.maskManager.pushMask(this._mask,g)}var c=g.resolution;f.setTransform(d.a*c,d.b*c,d.c*c,d.d*c,d.tx*c,d.ty*c);b.CanvasGraphics.renderGraphics(this,f);for(var e=0;e<this.children.length;e++){this.children[e]._renderCanvas(g)}if(this._mask){g.maskManager.popMask(g)}}};b.Graphics.prototype.getBounds=function(p){if(!this._currentBounds){if(!this.renderable){return b.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var i=this._localBounds;var m=i.x;var l=i.width+i.x;var k=i.y;var j=i.height+i.y;var n=p||this.worldTransform;var B=n.a;var z=n.b;var y=n.c;var w=n.d;var C=n.tx;var A=n.ty;var s=B*l+y*j+C;var h=w*j+z*l+A;var r=B*m+y*j+C;var g=w*j+z*m+A;var q=B*m+y*k+C;var f=w*k+z*m+A;var o=B*l+y*k+C;var e=w*k+z*l+A;var v=s;var t=h;var x=s;var u=h;x=r<x?r:x;x=q<x?q:x;x=o<x?o:x;u=g<u?g:u;u=f<u?f:u;u=e<u?e:u;v=r>v?r:v;v=q>v?q:v;v=o>v?o:v;t=g>t?g:t;t=f>t?f:t;t=e>t?e:t;this._bounds.x=x;this._bounds.width=v-x;this._bounds.y=u;this._bounds.height=t-u;this._currentBounds=this._bounds}return this._currentBounds};b.Graphics.prototype.containsPoint=function(c){this.worldTransform.applyInverse(c,tempPoint);var f=this.graphicsData;for(var d=0;d<f.length;d++){var e=f[d];if(!e.fill){continue}if(e.shape){if(e.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};b.Graphics.prototype.updateLocalBounds=function(){var f=Infinity;var d=-Infinity;var e=Infinity;var c=-Infinity;if(this.graphicsData.length){var o,u,s,q,t,m;for(var l=0;l<this.graphicsData.length;l++){var k=this.graphicsData[l];var p=k.type;var n=k.lineWidth;o=k.shape;if(p===b.Graphics.RECT||p===b.Graphics.RREC){s=o.x-n/2;q=o.y-n/2;t=o.width+n;m=o.height+n;f=s<f?s:f;d=s+t>d?s+t:d;e=q<e?q:e;c=q+m>c?q+m:c}else{if(p===b.Graphics.CIRC){s=o.x;q=o.y;t=o.radius+n/2;m=o.radius+n/2;f=s-t<f?s-t:f;d=s+t>d?s+t:d;e=q-m<e?q-m:e;c=q+m>c?q+m:c}else{if(p===b.Graphics.ELIP){s=o.x;q=o.y;t=o.width+n/2;m=o.height+n/2;f=s-t<f?s-t:f;d=s+t>d?s+t:d;e=q-m<e?q-m:e;c=q+m>c?q+m:c}else{u=o.points;for(var g=0;g<u.length;g++){if(u[g] instanceof Phaser.Point){s=u[g].x;q=u[g].y}else{s=u[g];q=u[g+1];if(g<u.length-1){g++}}f=s-n<f?s-n:f;d=s+n>d?s+n:d;e=q-n<e?q-n:e;c=q+n>c?q+n:c}}}}}}else{f=0;d=0;e=0;c=0}var r=this.boundsPadding;this._localBounds.x=f-r;this._localBounds.width=(d-f)+r*2;this._localBounds.y=e-r;this._localBounds.height=(c-e)+r*2};b.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(!this._cachedSprite){var c=new b.CanvasBuffer(e.width,e.height);var d=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(d);this._cachedSprite.buffer=c;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(e.width,e.height)}this._cachedSprite.anchor.x=-(e.x/e.width);this._cachedSprite.anchor.y=-(e.y/e.height);this._cachedSprite.buffer.context.translate(-e.x,-e.y);this.worldAlpha=1;b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};b.Graphics.prototype.updateCachedSpriteTexture=function(){var e=this._cachedSprite;var d=e.texture;var c=e.buffer.canvas;d.baseTexture.width=c.width;d.baseTexture.height=c.height;d.crop.width=d.frame.width=c.width;d.crop.height=d.frame.height=c.height;e._width=c.width;e._height=c.height;d.baseTexture.dirty()};b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};b.Graphics.prototype.drawShape=function(c){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(c instanceof b.Polygon){c.flatten()}var d=new b.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,c);this.graphicsData.push(d);if(d.type===b.Graphics.POLY){d.shape.closed=this.filling;this.currentPath=d}this.dirty=true;return d};Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(c){this._cacheAsBitmap=c;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite();this.dirty=true}}});b.GraphicsData=function(c,h,e,i,f,g,d){this.lineWidth=c;this.lineColor=h;this.lineAlpha=e;this._lineTint=h;this.fillColor=i;this.fillAlpha=f;this._fillTint=i;this.fill=g;this.shape=d;this.type=d.type};b.GraphicsData.prototype.constructor=b.GraphicsData;b.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};b.Strip=function(c){b.DisplayObjectContainer.call(this);this.texture=c;this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new b.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new b.Float32Array([1,1,1,1]);this.indices=new b.Uint16Array([0,1,2,3]);this.dirty=true;this.blendMode=b.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=b.Strip.DrawModes.TRIANGLE_STRIP};b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Strip.prototype.constructor=b.Strip;b.Strip.prototype._renderWebGL=function(c){if(!this.visible||this.alpha<=0){return}c.spriteBatch.stop();if(!this._vertexBuffer){this._initWebGL(c)}c.shaderManager.setShader(c.shaderManager.stripShader);this._renderStrip(c);c.spriteBatch.start()};b.Strip.prototype._initWebGL=function(c){var d=c.gl;this._vertexBuffer=d.createBuffer();this._indexBuffer=d.createBuffer();this._uvBuffer=d.createBuffer();this._colorBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.bufferData(d.ARRAY_BUFFER,this.vertices,d.DYNAMIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this._uvBuffer);d.bufferData(d.ARRAY_BUFFER,this.uvs,d.STATIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this._colorBuffer);d.bufferData(d.ARRAY_BUFFER,this.colors,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._indexBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this.indices,d.STATIC_DRAW)};b.Strip.prototype._renderStrip=function(f){var h=f.gl;var c=f.projection,g=f.offset,d=f.shaderManager.stripShader;var e=this.drawMode===b.Strip.DrawModes.TRIANGLE_STRIP?h.TRIANGLE_STRIP:h.TRIANGLES;f.blendModeManager.setBlendMode(this.blendMode);h.uniformMatrix3fv(d.translationMatrix,false,this.worldTransform.toArray(true));h.uniform2f(d.projectionVector,c.x,-c.y);h.uniform2f(d.offsetVector,-g.x,-g.y);h.uniform1f(d.alpha,this.worldAlpha);if(!this.dirty){h.bindBuffer(h.ARRAY_BUFFER,this._vertexBuffer);h.bufferSubData(h.ARRAY_BUFFER,0,this.vertices);h.vertexAttribPointer(d.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this._uvBuffer);h.vertexAttribPointer(d.aTextureCoord,2,h.FLOAT,false,0,0);h.activeTexture(h.TEXTURE0);if(this.texture.baseTexture._dirty[h.id]){f.renderer.updateTexture(this.texture.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,this.texture.baseTexture._glTextures[h.id])}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;h.bindBuffer(h.ARRAY_BUFFER,this._vertexBuffer);h.bufferData(h.ARRAY_BUFFER,this.vertices,h.STATIC_DRAW);h.vertexAttribPointer(d.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this._uvBuffer);h.bufferData(h.ARRAY_BUFFER,this.uvs,h.STATIC_DRAW);h.vertexAttribPointer(d.aTextureCoord,2,h.FLOAT,false,0,0);h.activeTexture(h.TEXTURE0);if(this.texture.baseTexture._dirty[h.id]){f.renderer.updateTexture(this.texture.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,this.texture.baseTexture._glTextures[h.id])}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer);h.bufferData(h.ELEMENT_ARRAY_BUFFER,this.indices,h.STATIC_DRAW)}h.drawElements(e,this.indices.length,h.UNSIGNED_SHORT,0)};b.Strip.prototype._renderCanvas=function(e){var d=e.context;var c=this.worldTransform;if(e.roundPixels){d.setTransform(c.a,c.b,c.c,c.d,c.tx|0,c.ty|0)}else{d.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty)}if(this.drawMode===b.Strip.DrawModes.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(d)}else{this._renderCanvasTriangles(d)}};b.Strip.prototype._renderCanvasTriangleStrip=function(g){var d=this.vertices;var f=this.uvs;var h=d.length/2;this.count++;for(var e=0;e<h-2;e++){var c=e*2;this._renderCanvasDrawTriangle(g,d,f,c,(c+2),(c+4))}};b.Strip.prototype._renderCanvasTriangles=function(c){var h=this.vertices;var e=this.uvs;var l=this.indices;var d=l.length;this.count++;for(var f=0;f<d;f+=3){var k=l[f]*2,j=l[f+1]*2,g=l[f+2]*2;this._renderCanvasDrawTriangle(c,h,e,k,j,g)}};b.Strip.prototype._renderCanvasDrawTriangle=function(h,n,x,p,m,l){var e=this.texture.baseTexture.source;var c=this.texture.width;var y=this.texture.height;var J=n[p],I=n[m],G=n[l];var k=n[p+1],j=n[m+1],g=n[l+1];var H=x[p]*c,F=x[m]*c,E=x[l]*c;var i=x[p+1]*y,f=x[m+1]*y,d=x[l+1]*y;if(this.canvasPadding>0){var D=this.canvasPadding/this.worldTransform.a;var C=this.canvasPadding/this.worldTransform.d;var v=(J+I+G)/3;var t=(k+j+g)/3;var B=J-v;var A=k-t;var z=Math.sqrt(B*B+A*A);J=v+(B/z)*(z+D);k=t+(A/z)*(z+C);B=I-v;A=j-t;z=Math.sqrt(B*B+A*A);I=v+(B/z)*(z+D);j=t+(A/z)*(z+C);B=G-v;A=g-t;z=Math.sqrt(B*B+A*A);G=v+(B/z)*(z+D);g=t+(A/z)*(z+C)}h.save();h.beginPath();h.moveTo(J,k);h.lineTo(I,j);h.lineTo(G,g);h.closePath();h.clip();var K=(H*f)+(i*E)+(F*d)-(f*E)-(i*F)-(H*d);var w=(J*f)+(i*G)+(I*d)-(f*G)-(i*I)-(J*d);var u=(H*I)+(J*E)+(F*G)-(I*E)-(J*F)-(H*G);var s=(H*f*G)+(i*I*E)+(J*F*d)-(J*f*E)-(i*F*G)-(H*I*d);var r=(k*f)+(i*g)+(j*d)-(f*g)-(i*j)-(k*d);var q=(H*j)+(k*E)+(F*g)-(j*E)-(k*F)-(H*g);var o=(H*f*g)+(i*j*E)+(k*F*d)-(k*f*E)-(i*F*g)-(H*j*d);h.transform(w/K,r/K,u/K,q/K,s/K,o/K);h.drawImage(e,0,0);h.restore()};b.Strip.prototype.renderStripFlat=function(d){var e=this.context;var l=d.vertices;var g=l.length/2;this.count++;e.beginPath();for(var j=1;j<g-2;j++){var k=j*2;var h=l[k],f=l[k+2],c=l[k+4];var o=l[k+1],n=l[k+3],m=l[k+5];e.moveTo(h,o);e.lineTo(f,n);e.lineTo(c,m)}e.fillStyle="#FF0000";e.fill();e.closePath()};b.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};b.Strip.prototype.getBounds=function(o){var m=o||this.worldTransform;var A=m.a;var w=m.b;var u=m.c;var r=m.d;var B=m.tx;var z=m.ty;var t=-Infinity;var q=-Infinity;var v=Infinity;var s=Infinity;var g=this.vertices;for(var p=0,l=g.length;p<l;p+=2){var f=g[p],e=g[p+1];var k=(A*f)+(u*e)+B;var j=(r*e)+(w*f)+z;v=k<v?k:v;s=j<s?j:s;t=k>t?k:t;q=j>q?j:q}if(v===-Infinity||q===Infinity){return b.EmptyRectangle}var h=this._bounds;h.x=v;h.width=t-v;h.y=s;h.height=q-s;this._currentBounds=h;return h};b.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};b.Rope=function(d,c){b.Strip.call(this,d);this.points=c;this.vertices=new b.Float32Array(c.length*4);this.uvs=new b.Float32Array(c.length*4);this.colors=new b.Float32Array(c.length*2);this.indices=new b.Uint16Array(c.length*2);this.refresh()};b.Rope.prototype=Object.create(b.Strip.prototype);b.Rope.prototype.constructor=b.Rope;b.Rope.prototype.refresh=function(){var l=this.points;if(l.length<1){return}var d=this.uvs;var j=l[0];var m=this.indices;var c=this.colors;this.count-=0.2;d[0]=0;d[1]=0;d[2]=0;d[3]=1;c[0]=1;c[1]=1;m[0]=0;m[1]=1;var h=l.length,k,g,f;for(var e=1;e<h;e++){k=l[e];g=e*4;f=e/(h-1);if(e%2){d[g]=f;d[g+1]=0;d[g+2]=f;d[g+3]=1}else{d[g]=f;d[g+1]=0;d[g+2]=f;d[g+3]=1}g=e*2;c[g]=1;c[g+1]=1;g=e*2;m[g]=g;m[g+1]=g+1;j=k}};b.Rope.prototype.updateTransform=function(){var o=this.points;if(o.length<1){return}var m=o[0];var k;var c={x:0,y:0};this.count-=0.2;var h=this.vertices;var l=o.length,n,g,j,d,f;for(var e=0;e<l;e++){n=o[e];g=e*4;if(e<o.length-1){k=o[e+1]}else{k=n}c.y=-(k.x-m.x);c.x=k.y-m.y;j=(1-(e/(l-1)))*10;if(j>1){j=1}d=Math.sqrt(c.x*c.x+c.y*c.y);f=this.texture.height/2;c.x/=d;c.y/=d;c.x*=f;c.y*=f;h[g]=n.x+c.x;h[g+1]=n.y+c.y;h[g+2]=n.x-c.x;h[g+3]=n.y-c.y;m=n}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.Rope.prototype.setTexture=function(c){this.texture=c};b.TilingSprite=function(e,d,c){b.Sprite.call(this,e);this._width=d||100;this._height=c||100;this.tileScale=new b.Point(1,1);this.tileScaleOffset=new b.Point(1,1);this.tilePosition=new b.Point(0,0);this.renderable=true;this.tint=16777215;this.blendMode=b.blendModes.NORMAL};b.TilingSprite.prototype=Object.create(b.Sprite.prototype);b.TilingSprite.prototype.constructor=b.TilingSprite;Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(c){this._width=c}});Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(c){this._height=c}});b.TilingSprite.prototype.setTexture=function(c){if(this.texture===c){return}this.texture=c;this.refreshTexture=true;this.cachedTint=16777215};b.TilingSprite.prototype._renderWebGL=function(e){if(this.visible===false||this.alpha===0){return}var d,c;if(this._mask){e.spriteBatch.stop();e.maskManager.pushMask(this.mask,e);e.spriteBatch.start()}if(this._filters){e.spriteBatch.flush();e.filterManager.pushFilter(this._filterBlock)}if(!this.tilingTexture||this.refreshTexture){this.generateTilingTexture(true);if(this.tilingTexture&&this.tilingTexture.needsUpdate){e.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{e.spriteBatch.renderTilingSprite(this)}for(d=0,c=this.children.length;d<c;d++){this.children[d]._renderWebGL(e)}e.spriteBatch.stop();if(this._filters){e.filterManager.popFilter()}if(this._mask){e.maskManager.popMask(this._mask,e)}e.spriteBatch.start()};b.TilingSprite.prototype._renderCanvas=function(l){if(this.visible===false||this.alpha===0){return}var k=l.context;if(this._mask){l.maskManager.pushMask(this._mask,l)}k.globalAlpha=this.worldAlpha;var g=this.worldTransform;var h,f;var e=l.resolution;k.setTransform(g.a*e,g.b*e,g.c*e,g.d*e,g.tx*e,g.ty*e);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(false);if(this.tilingTexture){this.__tilePattern=k.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}if(this.blendMode!==l.currentBlendMode){l.currentBlendMode=this.blendMode;k.globalCompositeOperation=b.blendModesCanvas[l.currentBlendMode]}var c=this.tilePosition;var d=this.tileScale;c.x%=this.tilingTexture.baseTexture.width;c.y%=this.tilingTexture.baseTexture.height;k.scale(d.x,d.y);k.translate(c.x+(this.anchor.x*-this._width),c.y+(this.anchor.y*-this._height));k.fillStyle=this.__tilePattern;k.fillRect(-c.x,-c.y,this._width/d.x,this._height/d.y);k.scale(1/d.x,1/d.y);k.translate(-c.x+(this.anchor.x*this._width),-c.y+(this.anchor.y*this._height));if(this._mask){l.maskManager.popMask(l)}for(h=0,f=this.children.length;h<f;h++){this.children[h]._renderCanvas(l)}};b.TilingSprite.prototype.getBounds=function(){var o=this._width;var n=this._height;var m=o*(1-this.anchor.x);var l=o*-this.anchor.x;var k=n*(1-this.anchor.y);var j=n*-this.anchor.y;var p=this.worldTransform;var C=p.a;var A=p.b;var z=p.c;var x=p.d;var D=p.tx;var B=p.ty;var t=C*l+z*j+D;var h=x*j+A*l+B;var s=C*m+z*j+D;var g=x*j+A*m+B;var r=C*m+z*k+D;var f=x*k+A*m+B;var q=C*l+z*k+D;var e=x*k+A*l+B;var w=-Infinity;var u=-Infinity;var y=Infinity;var v=Infinity;y=t<y?t:y;y=s<y?s:y;y=r<y?r:y;y=q<y?q:y;v=h<v?h:v;v=g<v?g:v;v=f<v?f:v;v=e<v?e:v;w=t>w?t:w;w=s>w?s:w;w=r>w?r:w;w=q>w?q:w;u=h>u?h:u;u=g>u?g:u;u=f>u?f:u;u=e>u?e:u;var i=this._bounds;i.x=y;i.width=w-y;i.y=v;i.height=u-v;this._currentBounds=i;return i};b.TilingSprite.prototype.onTextureUpdate=function(){};b.TilingSprite.prototype.generateTilingTexture=function(e){if(!this.texture.baseTexture.hasLoaded){return}var i=this.originalTexture||this.texture;var j=i.frame;var h,d;var c=j.width!==i.baseTexture.width||j.height!==i.baseTexture.height;var g=false;if(!e){if(c){if(i.crop){h=i.crop.width;d=i.crop.height}else{h=j.width;d=j.height}g=true}}else{if(i.crop){h=b.getNextPowerOfTwo(i.crop.width);d=b.getNextPowerOfTwo(i.crop.height)}else{h=b.getNextPowerOfTwo(j.width);d=b.getNextPowerOfTwo(j.height)}g=true}if(g){var f;if(this.tilingTexture&&this.tilingTexture.isTiling){f=this.tilingTexture.canvasBuffer;f.resize(h,d);this.tilingTexture.baseTexture.width=h;this.tilingTexture.baseTexture.height=d;this.tilingTexture.needsUpdate=true}else{f=new b.CanvasBuffer(h,d);this.tilingTexture=b.Texture.fromCanvas(f.canvas);this.tilingTexture.canvasBuffer=f;this.tilingTexture.isTiling=true}f.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,h,d);this.tileScaleOffset.x=j.width/h;this.tileScaleOffset.y=j.height/d}else{if(this.tilingTexture&&this.tilingTexture.isTiling){this.tilingTexture.destroy(true)}this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=i}this.refreshTexture=false;this.originalTexture=this.texture;this.texture=this.tilingTexture;this.tilingTexture.baseTexture._powerOf2=true};b.TilingSprite.prototype.destroy=function(){b.Sprite.prototype.destroy.call(this);this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};b.BaseTextureCache={};b.BaseTextureCacheIdGenerator=0;b.BaseTexture=function(d,c){this.resolution=1;this.width=100;this.height=100;this.scaleMode=c||b.scaleModes.DEFAULT;this.hasLoaded=false;this.source=d;this._UID=b._UID++;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this._dirty=[true,true,true,true];if(!d){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}else{}this.imageUrl=null;this._powerOf2=false};b.BaseTexture.prototype.constructor=b.BaseTexture;b.BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete b.BaseTextureCache[this.imageUrl];delete b.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS){this.source.src=""}}else{if(this.source&&this.source._pixiId){delete b.BaseTextureCache[this.source._pixiId]}}this.source=null;this.unloadFromGPU()};b.BaseTexture.prototype.updateSourceImage=function(c){this.hasLoaded=false;this.source.src=null;this.source.src=c};b.BaseTexture.prototype.dirty=function(){for(var c=0;c<this._glTextures.length;c++){this._dirty[c]=true}};b.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var d=this._glTextures.length-1;d>=0;d--){var c=this._glTextures[d];var e=b.glContexts[d];if(e&&c){e.deleteTexture(c)}}this._glTextures.length=0;this.dirty()};b.BaseTexture.fromImage=function(d,c,e){var f=b.BaseTextureCache[d];if(c===undefined&&d.indexOf("data:")===-1){c=true}if(!f){var g=new Image();if(c){g.crossOrigin=""}g.src=d;f=new b.BaseTexture(g,e);f.imageUrl=d;b.BaseTextureCache[d]=f;if(d.indexOf(b.RETINA_PREFIX+".")!==-1){f.resolution=2}}return f};b.BaseTexture.fromCanvas=function(c,d){if(!c._pixiId){c._pixiId="canvas_"+b.TextureCacheIdGenerator++}var e=b.BaseTextureCache[c._pixiId];if(!e){e=new b.BaseTexture(c,d);b.BaseTextureCache[c._pixiId]=e}return e};b.TextureCache={};b.FrameCache={};b.TextureSilentFail=false;b.TextureCacheIdGenerator=0;b.Texture=function(e,f,d,c){this.noFrame=false;if(!f){this.noFrame=true;f=new b.Rectangle(0,0,1,1)}if(e instanceof b.Texture){e=e.baseTexture}this.baseTexture=e;this.frame=f;this.trim=c;this.valid=false;this.requiresUpdate=false;this._uvs=null;this.width=0;this.height=0;this.crop=d||new b.Rectangle(0,0,1,1);if(e.hasLoaded){if(this.noFrame){f=new b.Rectangle(0,0,e.width,e.height)}this.setFrame(f)}};b.Texture.prototype.constructor=b.Texture;b.Texture.prototype.onBaseTextureLoaded=function(){var c=this.baseTexture;if(this.noFrame){this.frame=new b.Rectangle(0,0,c.width,c.height)}this.setFrame(this.frame)};b.Texture.prototype.destroy=function(c){if(c){this.baseTexture.destroy()}this.valid=false};b.Texture.prototype.setFrame=function(c){this.noFrame=false;this.frame=c;this.width=c.width;this.height=c.height;this.crop.x=c.x;this.crop.y=c.y;this.crop.width=c.width;this.crop.height=c.height;if(!this.trim&&(c.x+c.width>this.baseTexture.width||c.y+c.height>this.baseTexture.height)){if(!b.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=c&&c.width&&c.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid){this._updateUvs()}};b.Texture.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new b.TextureUvs()}var e=this.crop;var c=this.baseTexture.width;var d=this.baseTexture.height;this._uvs.x0=e.x/c;this._uvs.y0=e.y/d;this._uvs.x1=(e.x+e.width)/c;this._uvs.y1=e.y/d;this._uvs.x2=(e.x+e.width)/c;this._uvs.y2=(e.y+e.height)/d;this._uvs.x3=e.x/c;this._uvs.y3=(e.y+e.height)/d};b.Texture.fromImage=function(d,c,e){var f=b.TextureCache[d];if(!f){f=new b.Texture(b.BaseTexture.fromImage(d,c,e));b.TextureCache[d]=f}return f};b.Texture.fromFrame=function(d){var c=b.TextureCache[d];if(!c){throw new Error('The frameId "'+d+'" does not exist in the texture cache ')}return c};b.Texture.fromCanvas=function(c,d){var e=b.BaseTexture.fromCanvas(c,d);return new b.Texture(e)};b.Texture.addTextureToCache=function(c,d){b.TextureCache[d]=c};b.Texture.removeTextureFromCache=function(d){var c=b.TextureCache[d];delete b.TextureCache[d];delete b.BaseTextureCache[d];return c};b.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};b.RenderTexture=function(f,c,g,e,d){this.width=f||100;this.height=c||100;this.resolution=d||1;this.frame=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new b.BaseTexture();this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=e||b.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;b.Texture.call(this,this.baseTexture,new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=g||b.defaultRenderer;if(this.renderer.type===b.WEBGL_RENDERER){var h=this.renderer.gl;this.baseTexture._dirty[h.id]=false;this.textureBuffer=new b.FilterTexture(h,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[h.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new b.Point(this.width*0.5,-this.height*0.5)}else{this.render=this.renderCanvas;this.textureBuffer=new b.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this._updateUvs()};b.RenderTexture.prototype=Object.create(b.Texture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.resize=function(e,c,d){if(e===this.width&&c===this.height){return}this.valid=(e>0&&c>0);this.width=e;this.height=c;this.frame.width=this.crop.width=e*this.resolution;this.frame.height=this.crop.height=c*this.resolution;if(d){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===b.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid){return}this.textureBuffer.resize(this.width,this.height)};b.RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===b.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};b.RenderTexture.prototype.renderWebGL=function(l,e,d){if(!this.valid){return}var c=l.worldTransform;c.identity();c.translate(0,this.projection.y*2);if(e){c.append(e)}c.scale(1,-1);l.worldAlpha=1;var h=l.children;for(var g=0,f=h.length;g<f;g++){h[g].updateTransform()}var k=this.renderer.gl;k.viewport(0,0,this.width*this.resolution,this.height*this.resolution);k.bindFramebuffer(k.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(d){this.textureBuffer.clear()}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(l,this.projection,this.textureBuffer.frameBuffer);this.renderer.spriteBatch.dirty=true};b.RenderTexture.prototype.renderCanvas=function(k,m,g){if(!this.valid){return}var h=k.worldTransform;h.identity();if(m){h.append(m)}k.worldAlpha=1;var d=k.children;for(var f=0,e=d.length;f<e;f++){d[f].updateTransform()}if(g){this.textureBuffer.clear()}var c=this.textureBuffer.context;var l=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(k,c);this.renderer.resolution=l};b.RenderTexture.prototype.getImage=function(){var c=new Image();c.src=this.getBase64();return c};b.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};b.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===b.WEBGL_RENDERER){var h=this.renderer.gl;var f=this.textureBuffer.width;var c=this.textureBuffer.height;var d=new Uint8Array(4*f*c);h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer);h.readPixels(0,0,f,c,h.RGBA,h.UNSIGNED_BYTE,d);h.bindFramebuffer(h.FRAMEBUFFER,null);var g=new b.CanvasBuffer(f,c);var e=g.context.getImageData(0,0,f,c);e.data.set(d);g.context.putImageData(e,0,0);return g.canvas}else{return this.textureBuffer.canvas}};b.AbstractFilter=function(d,c){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=c||{};this.fragmentSrc=d||[]};b.AbstractFilter.prototype.constructor=b.AbstractFilter;b.AbstractFilter.prototype.syncUniforms=function(){for(var d=0,c=this.shaders.length;d<c;d++){this.shaders[d].dirty=true}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.PIXI=b}else{if(typeof define!=="undefined"&&define.amd){define("PIXI",(function(){return a.PIXI=b})())}else{a.PIXI=b}}}).call(this);(function(){var l=this;var g=g||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(!Math.trunc){Math.trunc=function b(p){return p<0?Math.ceil(p):Math.floor(p)}}if(!Function.prototype.bind){Function.prototype.bind=(function(){var p=Array.prototype.slice;return function(q){var t=this,u=p.call(arguments,1);if(typeof t!=="function"){throw new TypeError()}function r(){var v=u.concat(p.call(arguments));t.apply(this instanceof r?this:q,v)}r.prototype=(function s(v){if(v){s.prototype=v}if(!(this instanceof s)){return new s}})(t.prototype);return r}})()}if(!Array.isArray){Array.isArray=function(p){return Object.prototype.toString.call(p)=="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(r){if(this===void 0||this===null){throw new TypeError()}var u=Object(this);var p=u.length>>>0;if(typeof r!=="function"){throw new TypeError()}var q=arguments.length>=2?arguments[1]:void 0;for(var s=0;s<p;s++){if(s in u){r.call(q,u[s],s,u)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var j=function(p){var q=new Array();window[p]=function(r){if(typeof(r)==="number"){Array.call(this,r);this.length=r;for(var s=0;s<this.length;s++){this[s]=0}}else{Array.call(this,r.length);this.length=r.length;for(var s=0;s<this.length;s++){this[s]=r[s]}}};window[p].prototype=q;window[p].constructor=window[p]};j("Uint32Array");j("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}g.Utils={getProperty:function(u,v){var t=v.split("."),r=t.pop(),p=t.length,q=1,s=t[0];while(q<p&&(u=u[s])){s=t[q];q++}if(u){return u[r]}else{return null}},setProperty:function(v,w,s){var u=w.split("."),r=u.pop(),p=u.length,q=1,t=u[0];while(q<p&&(v=v[t])){t=u[q];q++}if(v){v[r]=s}return v},chanceRoll:function(p){if(typeof p==="undefined"){p=50}return p>0&&(Math.random()*100<=p)},randomChoice:function(q,p){return(Math.random()<0.5)?q:p},transposeArray:function(p){return g.ArrayUtils.transposeMatrix(p)},rotateArray:function(p,q){return g.ArrayUtils.rotateMatrix(p,q)},shuffle:function(p){return g.ArrayUtils.shuffle(p)},parseDimension:function(q,s){var r=0;var p=0;if(typeof q==="string"){if(q.substr(-1)==="%"){r=parseInt(q,10)/100;if(s===0){p=window.innerWidth*r}else{p=window.innerHeight*r}}else{p=parseInt(q,10)}}else{p=q}return p},pad:function(v,p,u,q){if(typeof(p)==="undefined"){var p=0}if(typeof(u)==="undefined"){var u=" "}if(typeof(q)==="undefined"){var q=3}var s=0;if(p+1>=v.length){switch(q){case 1:v=new Array(p+1-v.length).join(u)+v;break;case 3:var r=Math.ceil((s=p-v.length)/2);var t=s-r;v=new Array(t+1).join(u)+v+new Array(r+1).join(u);break;default:v=v+new Array(p+1-v.length).join(u);break}}return v},isPlainObject:function(q){if(typeof(q)!=="object"||q.nodeType||q===q.window){return false}try{if(q.constructor&&!({}).hasOwnProperty.call(q.constructor.prototype,"isPrototypeOf")){return false}}catch(p){return false}return true},extend:function(){var y,r,p,q,v,w,u=arguments[0]||{},t=1,s=arguments.length,x=false;if(typeof u==="boolean"){x=u;u=arguments[1]||{};t=2}if(s===t){u=this;--t}for(;t<s;t++){if((y=arguments[t])!=null){for(r in y){p=u[r];q=y[r];if(u===q){continue}if(x&&q&&(g.Utils.isPlainObject(q)||(v=Array.isArray(q)))){if(v){v=false;w=p&&Array.isArray(p)?p:[]}else{w=p&&g.Utils.isPlainObject(p)?p:{}}u[r]=g.Utils.extend(x,w,q)}else{if(q!==undefined){u[r]=q}}}}}return u},mixinPrototype:function(v,p,t){if(typeof t==="undefined"){t=false}var s=Object.keys(p);for(var r=0;r<s.length;r++){var q=s[r];var u=p[q];if(!t&&(q in v)){continue}else{if(u&&(typeof u.get==="function"||typeof u.set==="function")){if(typeof u.clone==="function"){v[q]=u.clone()}else{Object.defineProperty(v,q,u)}}else{v[q]=u}}}},mixin:function(t,s){if(!t||typeof(t)!=="object"){return s}for(var p in t){var r=t[p];if(r.childNodes||r.cloneNode){continue}var q=typeof(t[p]);if(!t[p]||q!=="object"){s[p]=t[p]}else{if(typeof(s[p])===q){s[p]=g.Utils.mixin(t[p],s[p])}else{s[p]=g.Utils.mixin(t[p],new r.constructor())}}}return s}};g.Circle=function(p,r,q){p=p||0;r=r||0;q=q||0;this.x=p;this.y=r;this._diameter=q;this._radius=0;if(q>0){this._radius=q*0.5}this.type=g.CIRCLE};g.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},getBounds:function(){return new g.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(p,r,q){this.x=p;this.y=r;this._diameter=q;this._radius=q*0.5;return this},copyFrom:function(p){return this.setTo(p.x,p.y,p.diameter)},copyTo:function(p){p.x=this.x;p.y=this.y;p.diameter=this._diameter;return p},distance:function(q,p){var r=g.Math.distance(this.x,this.y,q.x,q.y);return p?Math.round(r):r},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Circle(this.x,this.y,this.diameter)}else{p.setTo(this.x,this.y,this.diameter)}return p},contains:function(p,q){return g.Circle.contains(this,p,q)},circumferencePoint:function(r,q,p){return g.Circle.circumferencePoint(this,r,q,p)},offset:function(q,p){this.x+=q;this.y+=p;return this},offsetPoint:function(p){return this.offset(p.x,p.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};g.Circle.prototype.constructor=g.Circle;Object.defineProperty(g.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(p){if(p>0){this._diameter=p;this._radius=p*0.5}}});Object.defineProperty(g.Circle.prototype,"radius",{get:function(){return this._radius},set:function(p){if(p>0){this._radius=p;this._diameter=p*2}}});Object.defineProperty(g.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(p){if(p>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-p}}});Object.defineProperty(g.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(p){if(p<this.x){this._radius=0;this._diameter=0}else{this.radius=p-this.x}}});Object.defineProperty(g.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(p){if(p>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-p}}});Object.defineProperty(g.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(p){if(p<this.y){this._radius=0;this._diameter=0}else{this.radius=p-this.y}}});Object.defineProperty(g.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(g.Circle.prototype,"empty",{get:function(){return(this._diameter===0)},set:function(p){if(p===true){this.setTo(0,0,0)}}});g.Circle.contains=function(r,p,t){if(r.radius>0&&p>=r.left&&p<=r.right&&t>=r.top&&t<=r.bottom){var s=(r.x-p)*(r.x-p);var q=(r.y-t)*(r.y-t);return(s+q)<=(r.radius*r.radius)}else{return false}};g.Circle.equals=function(q,p){return(q.x==p.x&&q.y==p.y&&q.diameter==p.diameter)};g.Circle.intersects=function(q,p){return(g.Math.distance(q.x,q.y,p.x,p.y)<=(q.radius+p.radius))};g.Circle.circumferencePoint=function(p,s,r,q){if(typeof r==="undefined"){r=false}if(typeof q==="undefined"){q=new g.Point()}if(r===true){s=g.Math.degToRad(s)}q.x=p.x+p.radius*Math.cos(s);q.y=p.y+p.radius*Math.sin(s);return q};g.Circle.intersectsRectangle=function(A,q){var u=Math.abs(A.x-q.x-q.halfWidth);var z=q.halfWidth+A.radius;if(u>z){return false}var t=Math.abs(A.y-q.y-q.halfHeight);var x=q.halfHeight+A.radius;if(t>x){return false}if(u<=q.halfWidth||t<=q.halfHeight){return true}var v=u-q.halfWidth;var s=t-q.halfHeight;var y=v*v;var p=s*s;var w=A.radius*A.radius;return y+p<=w};PIXI.Circle=g.Circle;g.Ellipse=function(q,s,r,p){q=q||0;s=s||0;r=r||0;p=p||0;this.x=q;this.y=s;this.width=r;this.height=p;this.type=g.ELLIPSE};g.Ellipse.prototype={setTo:function(q,s,r,p){this.x=q;this.y=s;this.width=r;this.height=p;return this},getBounds:function(){return new g.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(p){return this.setTo(p.x,p.y,p.width,p.height)},copyTo:function(p){p.x=this.x;p.y=this.y;p.width=this.width;p.height=this.height;return p},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Ellipse(this.x,this.y,this.width,this.height)}else{p.setTo(this.x,this.y,this.width,this.height)}return p},contains:function(p,q){return g.Ellipse.contains(this,p,q)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};g.Ellipse.prototype.constructor=g.Ellipse;Object.defineProperty(g.Ellipse.prototype,"left",{get:function(){return this.x},set:function(p){this.x=p}});Object.defineProperty(g.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(p){if(p<this.x){this.width=0}else{this.width=p-this.x}}});Object.defineProperty(g.Ellipse.prototype,"top",{get:function(){return this.y},set:function(p){this.y=p}});Object.defineProperty(g.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(p){if(p<this.y){this.height=0}else{this.height=p-this.y}}});Object.defineProperty(g.Ellipse.prototype,"empty",{get:function(){return(this.width===0||this.height===0)},set:function(p){if(p===true){this.setTo(0,0,0,0)}}});g.Ellipse.contains=function(s,q,t){if(s.width<=0||s.height<=0){return false}var r=((q-s.x)/s.width)-0.5;var p=((t-s.y)/s.height)-0.5;r*=r;p*=p;return(r+p<0.25)};PIXI.Ellipse=g.Ellipse;g.Line=function(q,s,p,r){q=q||0;s=s||0;p=p||0;r=r||0;this.start=new g.Point(q,s);this.end=new g.Point(p,r);this.type=g.LINE};g.Line.prototype={setTo:function(q,s,p,r){this.start.setTo(q,s);this.end.setTo(p,r);return this},fromSprite:function(q,r,p){if(typeof p==="undefined"){p=false}if(p){return this.setTo(q.center.x,q.center.y,r.center.x,r.center.y)}return this.setTo(q.x,q.y,r.x,r.y)},fromAngle:function(p,s,r,q){this.start.setTo(p,s);this.end.setTo(p+(Math.cos(r)*q),s+(Math.sin(r)*q));return this},intersects:function(q,r,p){return g.Line.intersectsPoints(this.start,this.end,q.start,q.end,r,p)},reflect:function(p){return g.Line.reflect(this,p)},pointOnLine:function(p,q){return((p-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(q-this.start.y))},pointOnSegment:function(q,u){var r=Math.min(this.start.x,this.end.x);var t=Math.max(this.start.x,this.end.x);var p=Math.min(this.start.y,this.end.y);var s=Math.max(this.start.y,this.end.y);return(this.pointOnLine(q,u)&&(q>=r&&q<=t)&&(u>=p&&u<=s))},coordinatesOnLine:function(u,t){if(typeof u==="undefined"){u=1}if(typeof t==="undefined"){t=[]}var q=Math.round(this.start.x);var z=Math.round(this.start.y);var p=Math.round(this.end.x);var x=Math.round(this.end.y);var B=Math.abs(p-q);var A=Math.abs(x-z);var y=(q<p)?1:-1;var w=(z<x)?1:-1;var r=B-A;t.push([q,z]);var s=1;while(!((q==p)&&(z==x))){var v=r<<1;if(v>-A){r-=A;q+=y}if(v<B){r+=B;z+=w}if(s%u===0){t.push([q,z])}s++}return t},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{p.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return p}};Object.defineProperty(g.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(g.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(g.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(g.Line.prototype,"perpSlope",{get:function(){return -((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(g.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(g.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(g.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(g.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(g.Line.prototype,"normalAngle",{get:function(){return g.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});g.Line.intersectsPoints=function(C,A,x,w,y,E){if(typeof y==="undefined"){y=true}if(typeof E==="undefined"){E=new g.Point()}var s=A.y-C.y;var r=w.y-x.y;var B=C.x-A.x;var z=x.x-w.x;var u=(A.x*C.y)-(C.x*A.y);var t=(w.x*x.y)-(x.x*w.y);var v=(s*z)-(r*B);if(v===0){return null}E.x=((B*t)-(z*u))/v;E.y=((r*u)-(s*t))/v;if(y){var D=((w.y-x.y)*(A.x-C.x)-(w.x-x.x)*(A.y-C.y));var q=(((w.x-x.x)*(C.y-x.y))-(w.y-x.y)*(C.x-x.x))/D;var p=(((A.x-C.x)*(C.y-x.y))-((A.y-C.y)*(C.x-x.x)))/D;if(q>=0&&q<=1&&p>=0&&p<=1){return E}else{return null}}return E};g.Line.intersects=function(r,q,s,p){return g.Line.intersectsPoints(r.start,r.end,q.start,q.end,s,p)};g.Line.reflect=function(q,p){return 2*p.normalAngle-3.141592653589793-q.angle};g.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;this.type=g.MATRIX};g.Matrix.prototype.fromArray=function(p){this.a=p[0];this.b=p[1];this.c=p[3];this.d=p[4];this.tx=p[2];this.ty=p[5]};g.Matrix.prototype.toArray=function(p){if(!this.array){this.array=new PIXI.Float32Array(9)}var q=this.array;if(p){q[0]=this.a;q[1]=this.b;q[2]=0;q[3]=this.c;q[4]=this.d;q[5]=0;q[6]=this.tx;q[7]=this.ty;q[8]=1}else{q[0]=this.a;q[1]=this.c;q[2]=this.tx;q[3]=this.b;q[4]=this.d;q[5]=this.ty;q[6]=0;q[7]=0;q[8]=1}return q};g.Matrix.prototype.apply=function(s,q){q=q||new g.Point();var p=s.x;var r=s.y;q.x=this.a*p+this.c*r+this.tx;q.y=this.b*p+this.d*r+this.ty;return q};g.Matrix.prototype.applyInverse=function(t,q){q=q||new g.Point();var s=1/(this.a*this.d+this.c*-this.b);var p=t.x;var r=t.y;q.x=this.d*s*p+-this.c*s*r+(this.ty*this.c-this.tx*this.d)*s;q.y=this.a*s*r+-this.b*s*p+(-this.ty*this.a+this.tx*this.b)*s;return q};g.Matrix.prototype.translate=function(p,q){this.tx+=p;this.ty+=q;return this};g.Matrix.prototype.scale=function(p,q){this.a*=p;this.d*=q;this.c*=p;this.b*=q;this.tx*=p;this.ty*=q;return this};g.Matrix.prototype.rotate=function(u){var t=Math.cos(u);var r=Math.sin(u);var q=this.a;var s=this.c;var p=this.tx;this.a=q*t-this.b*r;this.b=q*r+this.b*t;this.c=s*t-this.d*r;this.d=s*r+this.d*t;this.tx=p*t-this.ty*r;this.ty=p*r+this.ty*t;return this};g.Matrix.prototype.append=function(q){var p=this.a;var r=this.b;var s=this.c;var t=this.d;this.a=q.a*p+q.b*s;this.b=q.a*r+q.b*t;this.c=q.c*p+q.d*s;this.d=q.c*r+q.d*t;this.tx=q.tx*p+q.ty*s+this.tx;this.ty=q.tx*r+q.ty*t+this.ty;return this};g.Matrix.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};g.identityMatrix=new g.Matrix();PIXI.Matrix=g.Matrix;PIXI.identityMatrix=g.identityMatrix;g.Point=function(p,q){p=p||0;q=q||0;this.x=p;this.y=q;this.type=g.POINT};g.Point.prototype={copyFrom:function(p){return this.setTo(p.x,p.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(p,q){this.x=p||0;this.y=q||((q!==0)?this.x:0);return this},set:function(p,q){this.x=p||0;this.y=q||((q!==0)?this.x:0);return this},add:function(p,q){this.x+=p;this.y+=q;return this},subtract:function(p,q){this.x-=p;this.y-=q;return this},multiply:function(p,q){this.x*=p;this.y*=q;return this},divide:function(p,q){this.x/=p;this.y/=q;return this},clampX:function(q,p){this.x=g.Math.clamp(this.x,q,p);return this},clampY:function(q,p){this.y=g.Math.clamp(this.y,q,p);return this},clamp:function(q,p){this.x=g.Math.clamp(this.x,q,p);this.y=g.Math.clamp(this.y,q,p);return this},clone:function(p){if(typeof p==="undefined"||p===null){p=new g.Point(this.x,this.y)}else{p.setTo(this.x,this.y)}return p},copyTo:function(p){p.x=this.x;p.y=this.y;return p},distance:function(q,p){return g.Point.distance(this,q,p)},equals:function(p){return(p.x===this.x&&p.y===this.y)},angle:function(p,q){if(typeof q==="undefined"){q=false}if(q){return g.Math.radToDeg(Math.atan2(p.y-this.y,p.x-this.x))}else{return Math.atan2(p.y-this.y,p.x-this.x)}},rotate:function(p,t,r,q,s){return g.Point.rotate(this,p,t,r,q,s)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(p){return this.normalize().multiply(p,p)},normalize:function(){if(!this.isZero()){var p=this.getMagnitude();this.x/=p;this.y/=p}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(p){return((this.x*p.x)+(this.y*p.y))},cross:function(p){return((this.x*p.y)-(this.y*p.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};g.Point.prototype.constructor=g.Point;g.Point.add=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x+p.x;r.y=q.y+p.y;return r};g.Point.subtract=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x-p.x;r.y=q.y-p.y;return r};g.Point.multiply=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x*p.x;r.y=q.y*p.y;return r};g.Point.divide=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}r.x=q.x/p.x;r.y=q.y/p.y;return r};g.Point.equals=function(q,p){return(q.x===p.x&&q.y===p.y)};g.Point.angle=function(q,p){return Math.atan2(q.y-p.y,q.x-p.x)};g.Point.negative=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(-p.x,-p.y)};g.Point.multiplyAdd=function(q,p,t,r){if(typeof r==="undefined"){r=new g.Point()}return r.setTo(q.x+p.x*t,q.y+p.y*t)};g.Point.interpolate=function(q,p,s,r){if(typeof r==="undefined"){r=new g.Point()}return r.setTo(q.x+(p.x-q.x)*s,q.y+(p.y-q.y)*s)};g.Point.perp=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(-p.y,p.x)};g.Point.rperp=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(p.y,-p.x)};g.Point.distance=function(q,p,r){var s=g.Math.distance(q.x,q.y,p.x,p.y);return r?Math.round(s):s};g.Point.project=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}var s=q.dot(p)/p.getMagnitudeSq();if(s!==0){r.setTo(s*p.x,s*p.y)}return r};g.Point.projectUnit=function(q,p,r){if(typeof r==="undefined"){r=new g.Point()}var s=q.dot(p);if(s!==0){r.setTo(s*p.x,s*p.y)}return r};g.Point.normalRightHand=function(p,q){if(typeof q==="undefined"){q=new g.Point()}return q.setTo(p.y*-1,p.x)};g.Point.normalize=function(q,r){if(typeof r==="undefined"){r=new g.Point()}var p=q.getMagnitude();if(p!==0){r.setTo(q.x/p,q.y/p)}return r};g.Point.rotate=function(q,p,v,t,s,u){s=s||false;u=u||null;if(s){t=g.Math.degToRad(t)}if(u===null){u=Math.sqrt(((p-q.x)*(p-q.x))+((v-q.y)*(v-q.y)))}var r=t+Math.atan2(q.y-v,q.x-p);return q.setTo(p+u*Math.cos(r),v+u*Math.sin(r))};g.Point.centroid=function(r,p){if(typeof p==="undefined"){p=new g.Point()}if(Object.prototype.toString.call(r)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var s=r.length;if(s<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(s===1){p.copyFrom(r[0]);return p}for(var q=0;q<s;q++){g.Point.add(p,r[q],p)}p.divide(s,s);return p};g.Point.parse=function(s,q,r){q=q||"x";r=r||"y";var p=new g.Point();if(s[q]){p.x=parseInt(s[q],10)}if(s[r]){p.y=parseInt(s[r],10)}return p};PIXI.Point=g.Point;g.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.type=g.POLYGON};g.Polygon.prototype={toNumberArray:function(p){if(typeof p==="undefined"){p=[]}for(var q=0;q<this._points.length;q++){if(typeof this._points[q]==="number"){p.push(this._points[q]);p.push(this._points[q+1]);q++}else{p.push(this._points[q].x);p.push(this._points[q].y)}}return p},flatten:function(){this._points=this.toNumberArray();return this},clone:function(p){var q=this._points.slice();if(typeof p==="undefined"||p===null){p=new g.Polygon(q)}else{p.setTo(q)}return p},contains:function(w,v){var p=this._points.length;var s=false;for(var u=-1,t=p-1;++u<p;t=u){var r=this._points[u].x;var q=this._points[u].y;var A=this._points[t].x;var z=this._points[t].y;if(((q<=v&&v<z)||(z<=v&&v<q))&&(w<(A-r)*(v-q)/(z-q)+r)){s=!s}}return s},setTo:function(s){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(s)){s=Array.prototype.slice.call(arguments)}var t=Number.MAX_VALUE;for(var r=0,q=s.length;r<q;r++){if(typeof s[r]==="number"){var u=new PIXI.Point(s[r],s[r+1]);r++}else{var u=new PIXI.Point(s[r].x,s[r].y)}this._points.push(u);if(u.y<t){t=u.y}}this.calculateArea(t)}return this},calculateArea:function(t){var v;var u;var q;var s;for(var r=0,p=this._points.length;r<p;r++){v=this._points[r];if(r===p-1){u=this._points[0]}else{u=this._points[r+1]}q=((v.y-t)+(u.y-t))/2;s=v.x-u.x;this.area+=q*s}return this.area}};g.Polygon.prototype.constructor=g.Polygon;Object.defineProperty(g.Polygon.prototype,"points",{get:function(){return this._points},set:function(p){if(p!=null){this.setTo(p)}else{this.setTo()}}});PIXI.Polygon=g.Polygon;g.Rectangle=function(q,s,r,p){q=q||0;s=s||0;r=r||0;p=p||0;this.x=q;this.y=s;this.width=r;this.height=p;this.type=g.RECTANGLE};g.Rectangle.prototype={offset:function(q,p){this.x+=q;this.y+=p;return this},offsetPoint:function(p){return this.offset(p.x,p.y)},setTo:function(q,s,r,p){this.x=q;this.y=s;this.width=r;this.height=p;return this},scale:function(p,q){if(typeof q==="undefined"){q=p}this.width*=p;this.height*=q;return this},centerOn:function(p,q){this.centerX=p;this.centerY=q;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(p){return this.setTo(p.x,p.y,p.width,p.height)},copyTo:function(p){p.x=this.x;p.y=this.y;p.width=this.width;p.height=this.height;return p},inflate:function(q,p){return g.Rectangle.inflate(this,q,p)},size:function(p){return g.Rectangle.size(this,p)},clone:function(p){return g.Rectangle.clone(this,p)},contains:function(p,q){return g.Rectangle.contains(this,p,q)},containsRect:function(p){return g.Rectangle.containsRect(p,this)},equals:function(p){return g.Rectangle.equals(this,p)},intersection:function(p,q){return g.Rectangle.intersection(this,p,q)},intersects:function(p){return g.Rectangle.intersects(this,p)},intersectsRaw:function(t,r,s,q,p){return g.Rectangle.intersectsRaw(this,t,r,s,q,p)},union:function(p,q){return g.Rectangle.union(this,p,q)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(g.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(g.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(g.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(p){if(p<=this.y){this.height=0}else{this.height=p-this.y}}});Object.defineProperty(g.Rectangle.prototype,"bottomRight",{get:function(){return new g.Point(this.right,this.bottom)},set:function(p){this.right=p.x;this.bottom=p.y}});Object.defineProperty(g.Rectangle.prototype,"left",{get:function(){return this.x},set:function(p){if(p>=this.right){this.width=0}else{this.width=this.right-p}this.x=p}});Object.defineProperty(g.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(p){if(p<=this.x){this.width=0}else{this.width=p-this.x}}});Object.defineProperty(g.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(g.Rectangle.prototype,"perimeter",{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(g.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(p){this.x=p-this.halfWidth}});Object.defineProperty(g.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(p){this.y=p-this.halfHeight}});Object.defineProperty(g.Rectangle.prototype,"randomX",{get:function(){return this.x+(Math.random()*this.width)}});Object.defineProperty(g.Rectangle.prototype,"randomY",{get:function(){return this.y+(Math.random()*this.height)}});Object.defineProperty(g.Rectangle.prototype,"top",{get:function(){return this.y},set:function(p){if(p>=this.bottom){this.height=0;this.y=p}else{this.height=(this.bottom-p)}}});Object.defineProperty(g.Rectangle.prototype,"topLeft",{get:function(){return new g.Point(this.x,this.y)},set:function(p){this.x=p.x;this.y=p.y}});Object.defineProperty(g.Rectangle.prototype,"topRight",{get:function(){return new g.Point(this.x+this.width,this.y)},set:function(p){this.right=p.x;this.y=p.y}});Object.defineProperty(g.Rectangle.prototype,"empty",{get:function(){return(!this.width||!this.height)},set:function(p){if(p===true){this.setTo(0,0,0,0)}}});g.Rectangle.prototype.constructor=g.Rectangle;g.Rectangle.inflate=function(q,r,p){q.x-=r;q.width+=2*r;q.y-=p;q.height+=2*p;return q};g.Rectangle.inflatePoint=function(q,p){return g.Rectangle.inflate(q,p.x,p.y)};g.Rectangle.size=function(p,q){if(typeof q==="undefined"||q===null){q=new g.Point(p.width,p.height)}else{q.setTo(p.width,p.height)}return q};g.Rectangle.clone=function(p,q){if(typeof q==="undefined"||q===null){q=new g.Rectangle(p.x,p.y,p.width,p.height)}else{q.setTo(p.x,p.y,p.width,p.height)}return q};g.Rectangle.contains=function(q,p,r){if(q.width<=0||q.height<=0){return false}return(p>=q.x&&p<q.right&&r>=q.y&&r<q.bottom)};g.Rectangle.containsRaw=function(s,r,t,q,p,u){return(p>=s&&p<(s+t)&&u>=r&&u<(r+q))};g.Rectangle.containsPoint=function(q,p){return g.Rectangle.contains(q,p.x,p.y)};g.Rectangle.containsRect=function(q,p){if(q.volume>p.volume){return false}return(q.x>=p.x&&q.y>=p.y&&q.right<p.right&&q.bottom<p.bottom)};g.Rectangle.equals=function(q,p){return(q.x==p.x&&q.y==p.y&&q.width==p.width&&q.height==p.height)};g.Rectangle.sameDimensions=function(q,p){return(q.width===p.width&&q.height===p.height)};g.Rectangle.intersection=function(q,p,r){if(typeof r==="undefined"){r=new g.Rectangle()}if(g.Rectangle.intersects(q,p)){r.x=Math.max(q.x,p.x);r.y=Math.max(q.y,p.y);r.width=Math.min(q.right,p.right)-r.x;r.height=Math.min(q.bottom,p.bottom)-r.y}return r};g.Rectangle.intersects=function(q,p){if(q.width<=0||q.height<=0||p.width<=0||p.height<=0){return false}return !(q.right<p.x||q.bottom<p.y||q.x>p.right||q.y>p.bottom)};g.Rectangle.intersectsRaw=function(p,u,s,t,r,q){if(typeof q==="undefined"){q=0}return !(u>p.right+q||s<p.left-q||t>p.bottom+q||r<p.top-q)};g.Rectangle.union=function(q,p,r){if(typeof r==="undefined"){r=new g.Rectangle()}return r.setTo(Math.min(q.x,p.x),Math.min(q.y,p.y),Math.max(q.right,p.right)-Math.min(q.left,p.left),Math.max(q.bottom,p.bottom)-Math.min(q.top,p.top))};g.Rectangle.aabb=function(s,r){if(typeof r==="undefined"){r=new g.Rectangle()}var u=Number.MIN_VALUE,q=Number.MAX_VALUE,t=Number.MIN_VALUE,p=Number.MAX_VALUE;s.forEach(function(v){if(v.x>u){u=v.x}if(v.x<q){q=v.x}if(v.y>t){t=v.y}if(v.y<p){p=v.y}});r.setTo(q,p,u-q,t-p);return r};PIXI.Rectangle=g.Rectangle;PIXI.EmptyRectangle=new g.Rectangle(0,0,0,0);g.RoundedRectangle=function(r,t,s,q,p){this.x=r||0;this.y=t||0;this.width=s||0;this.height=q||0;this.radius=p||20;this.type=g.ROUNDEDRECTANGLE};g.RoundedRectangle.prototype.clone=function(){return new g.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};g.RoundedRectangle.prototype.contains=function(p,s){if(this.width<=0||this.height<=0){return false}var q=this.x;if(p>=q&&p<=q+this.width){var r=this.y;if(s>=r&&s<=r+this.height){return true}}return false};g.RoundedRectangle.prototype.constructor=g.RoundedRectangle;PIXI.RoundedRectangle=g.RoundedRectangle;g.Camera=function(r,u,q,t,s,p){this.game=r;this.world=r.world;this.id=0;this.view=new g.Rectangle(q,t,s,p);this.screenView=new g.Rectangle(q,t,s,p);this.bounds=new g.Rectangle(q,t,s,p);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this._targetPosition=new g.Point();this._edge=0;this._position=new g.Point()};g.Camera.FOLLOW_LOCKON=0;g.Camera.FOLLOW_PLATFORMER=1;g.Camera.FOLLOW_TOPDOWN=2;g.Camera.FOLLOW_TOPDOWN_TIGHT=3;g.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(t,r){if(typeof r==="undefined"){r=g.Camera.FOLLOW_LOCKON}this.target=t;var s;switch(r){case g.Camera.FOLLOW_PLATFORMER:var p=this.width/8;var q=this.height/3;this.deadzone=new g.Rectangle((this.width-p)/2,(this.height-q)/2-q*0.25,p,q);break;case g.Camera.FOLLOW_TOPDOWN:s=Math.max(this.width,this.height)/4;this.deadzone=new g.Rectangle((this.width-s)/2,(this.height-s)/2,s,s);break;case g.Camera.FOLLOW_TOPDOWN_TIGHT:s=Math.max(this.width,this.height)/8;this.deadzone=new g.Rectangle((this.width-s)/2,(this.height-s)/2,s,s);break;case g.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(p){this.setPosition(Math.round(p.x-this.view.halfWidth),Math.round(p.y-this.view.halfHeight))},focusOnXY:function(p,q){this.setPosition(Math.round(p-this.view.halfWidth),Math.round(q-this.view.halfHeight))},update:function(){if(this.target){this.updateTarget()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target);if(this.target.parent){this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d)}if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this._targetPosition.x-this.deadzone.left}else{if(this._edge>this.deadzone.right){this.view.x=this._targetPosition.x-this.deadzone.right}}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this._targetPosition.y-this.deadzone.top}else{if(this._edge>this.deadzone.bottom){this.view.y=this._targetPosition.y-this.deadzone.bottom}}}else{this.view.x=this._targetPosition.x-this.view.halfWidth;this.view.y=this._targetPosition.y-this.view.halfHeight}},setBoundsToWorld:function(){if(this.bounds){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;if(this.view.x<=this.bounds.x){this.atLimit.x=true;this.view.x=this.bounds.x}if(this.view.right>=this.bounds.right){this.atLimit.x=true;this.view.x=this.bounds.right-this.width}if(this.view.y<=this.bounds.top){this.atLimit.y=true;this.view.y=this.bounds.top}if(this.view.bottom>=this.bounds.bottom){this.atLimit.y=true;this.view.y=this.bounds.bottom-this.height}},setPosition:function(p,q){this.view.x=p;this.view.y=q;if(this.bounds){this.checkBounds()}},setSize:function(q,p){this.view.width=q;this.view.height=p},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};g.Camera.prototype.constructor=g.Camera;Object.defineProperty(g.Camera.prototype,"x",{get:function(){return this.view.x},set:function(p){this.view.x=p;if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"y",{get:function(){return this.view.y},set:function(p){this.view.y=p;if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"position",{get:function(){this._position.set(this.view.centerX,this.view.centerY);return this._position},set:function(p){if(typeof p.x!=="undefined"){this.view.x=p.x}if(typeof p.y!=="undefined"){this.view.y=p.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"width",{get:function(){return this.view.width},set:function(p){this.view.width=p}});Object.defineProperty(g.Camera.prototype,"height",{get:function(){return this.view.height},set:function(p){this.view.height=p}});g.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};g.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};g.State.prototype.constructor=g.State;g.StateManager=function(q,p){this.game=q;this.states={};this._pendingState=null;if(typeof p!=="undefined"&&p!==null){this._pendingState=p}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};g.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(q,r,p){if(typeof p==="undefined"){p=false}var s;if(r instanceof g.State){s=r}else{if(typeof r==="object"){s=r;s.game=this.game}else{if(typeof r==="function"){s=new r(this.game)}}}this.states[q]=s;if(p){if(this.game.isBooted){this.start(q)}else{this._pendingState=q}}return s},remove:function(p){if(this.current===p){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[p]},start:function(q,p,r){if(typeof p==="undefined"){p=true}if(typeof r==="undefined"){r=false}if(this.checkState(q)){this._pendingState=q;this._clearWorld=p;this._clearCache=r;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(p,q){if(typeof p==="undefined"){p=true}if(typeof q==="undefined"){q=false}this._pendingState=this.current;this._clearWorld=p;this._clearCache=q;if(arguments.length>2){this._args=Array.prototype.splice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){this.clearCurrentState();this.setCurrentState(this._pendingState);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache===true){this.game.cache.destroy()}}}},checkState:function(p){if(this.states[p]){var q=false;if(this.states[p]["preload"]||this.states[p]["create"]||this.states[p]["update"]||this.states[p]["render"]){q=true}if(q===false){console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}return true}else{console.warn("Phaser.StateManager - No state found with the key: "+p);return false}},link:function(p){this.states[p].game=this.game;this.states[p].add=this.game.add;this.states[p].make=this.game.make;this.states[p].camera=this.game.camera;this.states[p].cache=this.game.cache;this.states[p].input=this.game.input;this.states[p].load=this.game.load;this.states[p].math=this.game.math;this.states[p].sound=this.game.sound;this.states[p].scale=this.game.scale;this.states[p].state=this;this.states[p].stage=this.game.stage;this.states[p].time=this.game.time;this.states[p].tweens=this.game.tweens;this.states[p].world=this.game.world;this.states[p].particles=this.game.particles;this.states[p].rnd=this.game.rnd;this.states[p].physics=this.game.physics;this.states[p].key=p},unlink:function(p){if(this.states[p]){this.states[p].game=null;this.states[p].add=null;this.states[p].make=null;this.states[p].camera=null;this.states[p].cache=null;this.states[p].input=null;this.states[p].load=null;this.states[p].math=null;this.states[p].sound=null;this.states[p].scale=null;this.states[p].state=null;this.states[p].stage=null;this.states[p].time=null;this.states[p].tweens=null;this.states[p].world=null;this.states[p].particles=null;this.states[p].rnd=null;this.states[p].physics=null}},setCurrentState:function(p){this.callbackContext=this.states[p];this.link(p);this.onInitCallback=this.states[p]["init"]||this.dummy;this.onPreloadCallback=this.states[p]["preload"]||null;this.onLoadRenderCallback=this.states[p]["loadRender"]||null;this.onLoadUpdateCallback=this.states[p]["loadUpdate"]||null;this.onCreateCallback=this.states[p]["create"]||null;this.onUpdateCallback=this.states[p]["update"]||null;this.onPreRenderCallback=this.states[p]["preRender"]||null;this.onRenderCallback=this.states[p]["render"]||null;this.onResizeCallback=this.states[p]["resize"]||null;this.onPausedCallback=this.states[p]["paused"]||null;this.onResumedCallback=this.states[p]["resumed"]||null;this.onPauseUpdateCallback=this.states[p]["pauseUpdate"]||null;this.onShutDownCallback=this.states[p]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=p;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(p===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created&&this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created&&this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(p){if(this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,p)}},resize:function(q,p){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,q,p)}},render:function(){if(this._created&&this.onRenderCallback){if(this.game.renderType===g.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};g.StateManager.prototype.constructor=g.StateManager;g.Signal=function(){};g.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:true,validateListener:function(p,q){if(typeof p!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",q))}},_registerListener:function(t,r,s,q){var p=this._indexOfListener(t,s);var u;if(p!==-1){u=this._bindings[p];if(u.isOnce()!==r){throw new Error("You cannot add"+(r?"":"Once")+"() then add"+(!r?"":"Once")+"() the same listener without removing the relationship first.")}}else{u=new g.SignalBinding(this,t,r,s,q);this._addBinding(u)}if(this.memorize&&this._prevParams){u.execute(this._prevParams)}return u},_addBinding:function(p){if(!this._bindings){this._bindings=[]}var q=this._bindings.length;do{q--}while(this._bindings[q]&&p._priority<=this._bindings[q]._priority);this._bindings.splice(q+1,0,p)},_indexOfListener:function(q,p){if(!this._bindings){return -1}if(typeof p==="undefined"){p=null}var s=this._bindings.length;var r;while(s--){r=this._bindings[s];if(r._listener===q&&r.context===p){return s}}return -1},has:function(q,p){return this._indexOfListener(q,p)!==-1},add:function(r,q,p){this.validateListener(r,"add");return this._registerListener(r,false,q,p)},addOnce:function(r,q,p){this.validateListener(r,"addOnce");return this._registerListener(r,true,q,p)},remove:function(r,q){this.validateListener(r,"remove");var p=this._indexOfListener(r,q);if(p!==-1){this._bindings[p]._destroy();this._bindings.splice(p,1)}return r},removeAll:function(p){if(typeof p==="undefined"){p=null}if(!this._bindings){return}var q=this._bindings.length;while(q--){if(p){if(this._bindings[q].context===p){this._bindings[q]._destroy();this._bindings.splice(q,1)}}else{this._bindings[q]._destroy()}}if(!p){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var p=Array.prototype.slice.call(arguments);var r=this._bindings.length;var q;if(this.memorize){this._prevParams=p}if(!r){return}q=this._bindings.slice();this._shouldPropagate=true;do{r--}while(q[r]&&this._shouldPropagate&&q[r].execute(p)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(g.Signal.prototype,"boundDispatch",{get:function(){var p=this;return this._boundDispatch||(this._boundDispatch=function(){return p.dispatch.apply(p,arguments)})}});g.Signal.prototype.constructor=g.Signal;g.SignalBinding=function(t,s,q,r,p){this._listener=s;if(q){this._isOnce=true}if(r!=null){this.context=r}this._signal=t;if(p){this._priority=p}};g.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,callCount:0,active:true,params:null,execute:function(p){var r,q;if(this.active&&!!this._listener){q=this.params?this.params.concat(p):p;r=this._listener.apply(this.context,q);this.callCount++;if(this._isOnce){this.detach()}}return r},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};g.SignalBinding.prototype.constructor=g.SignalBinding;g.Filter=function(q,p,s){this.game=q;this.type=g.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new g.Point();var t=new Date();this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()*60*60+t.getMinutes()*60+t.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(p){for(var r in p){this.uniforms[r]=p[r]}}this.fragmentSrc=s||[]};g.Filter.prototype={init:function(){},setResolution:function(q,p){this.uniforms.resolution.value.x=q;this.uniforms.resolution.value.y=p},update:function(q){if(typeof q!=="undefined"){var p=q.x/this.game.width;var r=1-q.y/this.game.height;if(p!==this.prevPoint.x||r!==this.prevPoint.y){this.uniforms.mouse.value.x=p.toFixed(2);this.uniforms.mouse.value.y=r.toFixed(2);this.prevPoint.set(p,r)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};g.Filter.prototype.constructor=g.Filter;Object.defineProperty(g.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(p){this.uniforms.resolution.value.x=p}});Object.defineProperty(g.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(p){this.uniforms.resolution.value.y=p}});g.Plugin=function(p,q){if(typeof q==="undefined"){q=null}this.game=p;this.parent=q;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};g.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};g.Plugin.prototype.constructor=g.Plugin;g.PluginManager=function(p){this.game=p;this.plugins=[];this._len=0;this._i=0};g.PluginManager.prototype={add:function(r){var q=Array.prototype.splice.call(arguments,1);var p=false;if(typeof r==="function"){r=new r(this.game,this)}else{r.game=this.game;r.parent=this}if(typeof r.preUpdate==="function"){r.hasPreUpdate=true;p=true}if(typeof r.update==="function"){r.hasUpdate=true;p=true}if(typeof r.postUpdate==="function"){r.hasPostUpdate=true;p=true}if(typeof r.render==="function"){r.hasRender=true;p=true}if(typeof r.postRender==="function"){r.hasPostRender=true;p=true}if(p){if(r.hasPreUpdate||r.hasUpdate||r.hasPostUpdate){r.active=true}if(r.hasRender||r.hasPostRender){r.visible=true}this._len=this.plugins.push(r);if(typeof r.init==="function"){r.init.apply(r,q)}return r}else{return null}},remove:function(p){this._i=this._len;while(this._i--){if(this.plugins[this._i]===p){p.destroy();this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};g.PluginManager.prototype.constructor=g.PluginManager;g.Stage=function(p){this.game=p;PIXI.Stage.call(this,0);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._backgroundColor=0;if(p.config){this.parseConfig(p.config)}};g.Stage.prototype=Object.create(PIXI.Stage.prototype);g.Stage.prototype.constructor=g.Stage;g.Stage.prototype.parseConfig=function(p){if(p.disableVisibilityChange){this.disableVisibilityChange=p.disableVisibilityChange}if(p.backgroundColor){this.backgroundColor=p.backgroundColor}};g.Stage.prototype.boot=function(){g.DOM.getOffset(this.game.canvas,this.offset);g.Canvas.setUserSelect(this.game.canvas,"none");g.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};g.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}};g.Stage.prototype.update=function(){var p=this.children.length;while(p--){this.children[p].update()}};g.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();var p=this.children.length;while(p--){if(this.children[p]!==this.game.world.camera.target){this.children[p].postUpdate()}}}else{this.game.world.camera.update();var p=this.children.length;while(p--){this.children[p].postUpdate()}}};g.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var p=0;p<this.children.length;p++){this.children[p].updateTransform()}};g.Stage.prototype.checkVisibility=function(){if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else{if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else{if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{this._hiddenVar=null}}}}var p=this;this._onChange=function(q){return p.visibilityChange(q)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){g.Stage.prototype.visibilityChange.call(p,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){g.Stage.prototype.visibilityChange.call(p,{type:"resume"})})}};g.Stage.prototype.visibilityChange=function(p){if(p.type==="pagehide"||p.type==="blur"||p.type==="pageshow"||p.type==="focus"){if(p.type==="pagehide"||p.type==="blur"){this.game.focusLoss(p)}else{if(p.type==="pageshow"||p.type==="focus"){this.game.focusGain(p)}}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||p.type==="pause"){this.game.gamePaused(p)}else{this.game.gameResumed(p)}};g.Stage.prototype.setBackgroundColor=function(p){var q=g.Color.valueToColor(p);this._backgroundColor=g.Color.getColor(q.r,q.g,q.b);this.backgroundColorSplit=[q.r/255,q.g/255,q.b/255];this.backgroundColorString=g.Color.RGBtoString(q.r,q.g,q.b,255,"#")};g.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(g.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(p){if(!this.game.transparent){this.setBackgroundColor(p)}}});Object.defineProperty(g.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(p){if(p){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});g.Group=function(q,t,r,p,u,s){if(typeof p==="undefined"){p=false}if(typeof u==="undefined"){u=false}if(typeof s==="undefined"){s=g.Physics.ARCADE}this.game=q;if(typeof t==="undefined"){t=q.world}this.name=r||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(p){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(t){t.addChild(this);this.z=t.children.length}}this.type=g.GROUP;this.physicsType=g.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.classType=g.Sprite;this.scale=new g.Point(1,1);this.cursor=null;this.enableBody=u;this.enableBodyDebug=false;this.physicsBodyType=s;this.onDestroy=new g.Signal();this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new g.Point();this._hash=[];this._sortProperty="z"};g.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);g.Group.prototype.constructor=g.Group;g.Group.RETURN_NONE=0;g.Group.RETURN_TOTAL=1;g.Group.RETURN_CHILD=2;g.Group.SORT_ASCENDING=-1;g.Group.SORT_DESCENDING=1;g.Group.prototype.add=function(q,p){if(typeof p==="undefined"){p=false}if(q.parent!==this){if(this.enableBody){this.game.physics.enable(q,this.physicsBodyType)}this.addChild(q);this._hash.push(q);q.z=this.children.length;if(!p&&q.events){q.events.onAddedToGroup$dispatch(q,this)}if(this.cursor===null){this.cursor=q}}return q};g.Group.prototype.addMultiple=function(r,p){if(Array.isArray(r)){for(var q=0;q<r.length;q++){this.add(r[q],p)}}return r};g.Group.prototype.addAt=function(r,q,p){if(typeof p==="undefined"){p=false}if(r.parent!==this){if(this.enableBody){this.game.physics.enable(r,this.physicsBodyType)}this.addChildAt(r,q);this._hash.push(r);this.updateZ();if(!p&&r.events){r.events.onAddedToGroup$dispatch(r,this)}if(this.cursor===null){this.cursor=r}}return r};g.Group.prototype.getAt=function(p){if(p<0||p>=this.children.length){return -1}else{return this.getChildAt(p)}};g.Group.prototype.create=function(p,u,q,s,r){if(typeof r==="undefined"){r=true}var t=new this.classType(this.game,p,u,q,s);if(this.enableBody){this.game.physics.enable(t,this.physicsBodyType,this.enableBodyDebug)}t.exists=r;t.visible=r;t.alive=r;this.addChild(t);this._hash.push(t);t.z=this.children.length;if(t.events){t.events.onAddedToGroup$dispatch(t,this)}if(this.cursor===null){this.cursor=t}return t};g.Group.prototype.createMultiple=function(s,q,t,r){if(typeof r==="undefined"){r=false}for(var p=0;p<s;p++){this.create(0,0,q,t,r)}};g.Group.prototype.updateZ=function(){var p=this.children.length;while(p--){this.children[p].z=p}};g.Group.prototype.resetCursor=function(p){if(typeof p==="undefined"){p=0}if(p>this.children.length-1){p=0}if(this.cursor){this.cursorIndex=p;this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.swap=function(q,p){this.swapChildren(q,p);this.updateZ()};g.Group.prototype.bringToTop=function(p){if(p.parent===this&&this.getIndex(p)<this.children.length){this.remove(p,false,true);this.add(p,true)}return p};g.Group.prototype.sendToBack=function(p){if(p.parent===this&&this.getIndex(p)>0){this.remove(p,false,true);this.addAt(p,0,true)}return p};g.Group.prototype.moveUp=function(r){if(r.parent===this&&this.getIndex(r)<this.children.length-1){var q=this.getIndex(r);var p=this.getAt(q+1);if(p){this.swap(r,p)}}return r};g.Group.prototype.moveDown=function(r){if(r.parent===this&&this.getIndex(r)>0){var q=this.getIndex(r);var p=this.getAt(q-1);if(p){this.swap(r,p)}}return r};g.Group.prototype.xy=function(q,p,r){if(q<0||q>this.children.length){return -1}else{this.getChildAt(q).x=p;this.getChildAt(q).y=r}};g.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};g.Group.prototype.getIndex=function(p){return this.children.indexOf(p)};g.Group.prototype.replace=function(r,p){var q=this.getIndex(r);if(q!==-1){if(p.parent){if(p.parent instanceof g.Group){p.parent.remove(p)}else{p.parent.removeChild(p)}}this.remove(r);this.addAt(p,q);return r}};g.Group.prototype.hasProperty=function(r,q){var p=q.length;if(p===1&&q[0] in r){return true}else{if(p===2&&q[0] in r&&q[1] in r[q[0]]){return true}else{if(p===3&&q[0] in r&&q[1] in r[q[0]]&&q[2] in r[q[0]][q[1]]){return true}else{if(p===4&&q[0] in r&&q[1] in r[q[0]]&&q[2] in r[q[0]][q[1]]&&q[3] in r[q[0]][q[1]][q[2]]){return true}}}}return false};g.Group.prototype.setProperty=function(u,r,t,q,s){if(typeof s==="undefined"){s=false}q=q||0;if(!this.hasProperty(u,r)&&(!s||q>0)){return false}var p=r.length;if(p===1){if(q===0){u[r[0]]=t}else{if(q==1){u[r[0]]+=t}else{if(q==2){u[r[0]]-=t}else{if(q==3){u[r[0]]*=t}else{if(q==4){u[r[0]]/=t}}}}}}else{if(p===2){if(q===0){u[r[0]][r[1]]=t}else{if(q==1){u[r[0]][r[1]]+=t}else{if(q==2){u[r[0]][r[1]]-=t}else{if(q==3){u[r[0]][r[1]]*=t}else{if(q==4){u[r[0]][r[1]]/=t}}}}}}else{if(p===3){if(q===0){u[r[0]][r[1]][r[2]]=t}else{if(q==1){u[r[0]][r[1]][r[2]]+=t}else{if(q==2){u[r[0]][r[1]][r[2]]-=t}else{if(q==3){u[r[0]][r[1]][r[2]]*=t}else{if(q==4){u[r[0]][r[1]][r[2]]/=t}}}}}}else{if(p===4){if(q===0){u[r[0]][r[1]][r[2]][r[3]]=t}else{if(q==1){u[r[0]][r[1]][r[2]][r[3]]+=t}else{if(q==2){u[r[0]][r[1]][r[2]][r[3]]-=t}else{if(q==3){u[r[0]][r[1]][r[2]][r[3]]*=t}else{if(q==4){u[r[0]][r[1]][r[2]][r[3]]/=t}}}}}}}}}return true};g.Group.prototype.checkProperty=function(s,p,r,q){if(typeof q==="undefined"){q=false}if(!g.Utils.getProperty(s,p)&&q){return false}if(g.Utils.getProperty(s,p)!==r){return false}return true};g.Group.prototype.set=function(v,r,t,q,u,p,s){if(typeof s==="undefined"){s=false}r=r.split(".");if(typeof q==="undefined"){q=false}if(typeof u==="undefined"){u=false}if((q===false||(q&&v.alive))&&(u===false||(u&&v.visible))){return this.setProperty(v,r,t,p,s)}};g.Group.prototype.setAll=function(s,u,q,v,p,t){if(typeof q==="undefined"){q=false}if(typeof v==="undefined"){v=false}if(typeof t==="undefined"){t=false}s=s.split(".");p=p||0;for(var r=0;r<this.children.length;r++){if((!q||(q&&this.children[r].alive))&&(!v||(v&&this.children[r].visible))){this.setProperty(this.children[r],s,u,p,t)}}};g.Group.prototype.setAllChildren=function(s,u,q,v,p,t){if(typeof q==="undefined"){q=false}if(typeof v==="undefined"){v=false}if(typeof t==="undefined"){t=false}p=p||0;for(var r=0;r<this.children.length;r++){if((!q||(q&&this.children[r].alive))&&(!v||(v&&this.children[r].visible))){if(this.children[r] instanceof g.Group){this.children[r].setAllChildren(s,u,q,v,p,t)}else{this.setProperty(this.children[r],s.split("."),u,p,t)}}}};g.Group.prototype.checkAll=function(r,t,p,u,s){if(typeof p==="undefined"){p=false}if(typeof u==="undefined"){u=false}if(typeof s==="undefined"){s=false}for(var q=0;q<this.children.length;q++){if((!p||(p&&this.children[q].alive))&&(!u||(u&&this.children[q].visible))){if(!this.checkProperty(this.children[q],r,t,s)){return false}}}return true};g.Group.prototype.addAll=function(r,q,p,s){this.setAll(r,q,p,s,1)};g.Group.prototype.subAll=function(r,q,p,s){this.setAll(r,q,p,s,2)};g.Group.prototype.multiplyAll=function(r,q,p,s){this.setAll(r,q,p,s,3)};g.Group.prototype.divideAll=function(r,q,p,s){this.setAll(r,q,p,s,4)};g.Group.prototype.callAllExists=function(s,r){var p;if(arguments.length>2){p=[];for(var q=2;q<arguments.length;q++){p.push(arguments[q])}}for(var q=0;q<this.children.length;q++){if(this.children[q].exists===r&&this.children[q][s]){this.children[q][s].apply(this.children[q],p)}}};g.Group.prototype.callbackFromArray=function(r,q,p){if(p==1){if(r[q[0]]){return r[q[0]]}}else{if(p==2){if(r[q[0]][q[1]]){return r[q[0]][q[1]]}}else{if(p==3){if(r[q[0]][q[1]][q[2]]){return r[q[0]][q[1]][q[2]]}}else{if(p==4){if(r[q[0]][q[1]][q[2]][q[3]]){return r[q[0]][q[1]][q[2]][q[3]]}}else{if(r[q]){return r[q]}}}}}return false};g.Group.prototype.callAll=function(w,s){if(typeof w==="undefined"){return}w=w.split(".");var u=w.length;if(typeof s==="undefined"||s===null||s===""){s=null}else{if(typeof s==="string"){s=s.split(".");var t=s.length}}var q;if(arguments.length>2){q=[];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}var v=null;var p=null;for(var r=0;r<this.children.length;r++){v=this.callbackFromArray(this.children[r],w,u);if(s&&v){p=this.callbackFromArray(this.children[r],s,t);if(v){v.apply(p,q)}}else{if(v){v.apply(this.children[r],q)}}}};g.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}var p=this.children.length;while(p--){this.children[p].preUpdate()}return true};g.Group.prototype.update=function(){var p=this.children.length;while(p--){this.children[p].update()}};g.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var p=this.children.length;while(p--){this.children[p].postUpdate()}};g.Group.prototype.filter=function(p,u){var q=-1;var s=this.children.length;var r=[];while(++q<s){var t=this.children[q];if(!u||(u&&t.exists)){if(p(t,q,this.children)){r.push(t)}}}return new g.ArraySet(r)};g.Group.prototype.forEach=function(t,p,s){if(typeof s==="undefined"){s=false}if(arguments.length<=3){for(var r=0;r<this.children.length;r++){if(!s||(s&&this.children[r].exists)){t.call(p,this.children[r])}}}else{var q=[null];for(var r=3;r<arguments.length;r++){q.push(arguments[r])}for(var r=0;r<this.children.length;r++){if(!s||(s&&this.children[r].exists)){q[0]=this.children[r];t.apply(p,q)}}}};g.Group.prototype.forEachExists=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("exists",true,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.forEachAlive=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("alive",true,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.forEachDead=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("alive",false,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.sort=function(q,p){if(this.children.length<2){return}if(typeof q==="undefined"){q="z"}if(typeof p==="undefined"){p=g.Group.SORT_ASCENDING}this._sortProperty=q;if(p===g.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};g.Group.prototype.customSort=function(p,q){if(this.children.length<2){return}this.children.sort(p.bind(q));this.updateZ()};g.Group.prototype.ascendingSortHandler=function(q,p){if(q[this._sortProperty]<p[this._sortProperty]){return -1}else{if(q[this._sortProperty]>p[this._sortProperty]){return 1}else{if(q.z<p.z){return -1}else{return 1}}}};g.Group.prototype.descendingSortHandler=function(q,p){if(q[this._sortProperty]<p[this._sortProperty]){return 1}else{if(q[this._sortProperty]>p[this._sortProperty]){return -1}else{return 0}}};g.Group.prototype.iterate=function(t,v,r,w,p,q){if(r===g.Group.RETURN_TOTAL&&this.children.length===0){return 0}var u=0;for(var s=0;s<this.children.length;s++){if(this.children[s][t]===v){u++;if(w){if(q){q[0]=this.children[s];w.apply(p,q)}else{w.call(p,this.children[s])}}if(r===g.Group.RETURN_CHILD){return this.children[s]}}}if(r===g.Group.RETURN_TOTAL){return u}return null};g.Group.prototype.getFirstExists=function(p){if(typeof p!=="boolean"){p=true}return this.iterate("exists",p,g.Group.RETURN_CHILD)};g.Group.prototype.getFirstAlive=function(){return this.iterate("alive",true,g.Group.RETURN_CHILD)};g.Group.prototype.getFirstDead=function(){return this.iterate("alive",false,g.Group.RETURN_CHILD)};g.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};g.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};g.Group.prototype.countLiving=function(){return this.iterate("alive",true,g.Group.RETURN_TOTAL)};g.Group.prototype.countDead=function(){return this.iterate("alive",false,g.Group.RETURN_TOTAL)};g.Group.prototype.getRandom=function(q,p){if(this.children.length===0){return null}q=q||0;p=p||this.children.length;return g.ArrayUtils.getRandomItem(this.children,q,p)};g.Group.prototype.remove=function(t,r,p){if(typeof r==="undefined"){r=false}if(typeof p==="undefined"){p=false}if(this.children.length===0||this.children.indexOf(t)===-1){return false}if(!p&&t.events&&!t.destroyPhase){t.events.onRemovedFromGroup$dispatch(t,this)}var s=this.removeChild(t);var q=this._hash.indexOf(s);if(q!==-1){this._hash.splice(q,1)}this.updateZ();if(this.cursor===t){this.next()}if(r&&s){s.destroy(true)}return true};g.Group.prototype.removeAll=function(r,p){if(typeof r==="undefined"){r=false}if(typeof p==="undefined"){p=false}if(this.children.length===0){return}do{if(!p&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var s=this.removeChild(this.children[0]);var q=this._hash.indexOf(s);if(q!==-1){this._hash.splice(q,1)}if(r&&s){s.destroy(true)}}while(this.children.length>0);this._hash=[];this.cursor=null};g.Group.prototype.removeBetween=function(v,t,s,p){if(typeof t==="undefined"){t=this.children.length-1}if(typeof s==="undefined"){s=false}if(typeof p==="undefined"){p=false}if(this.children.length===0){return}if(v>t||v<0||t>this.children.length){return false}var r=t;while(r>=v){if(!p&&this.children[r].events){this.children[r].events.onRemovedFromGroup$dispatch(this.children[r],this)}var u=this.removeChild(this.children[r]);var q=this._hash.indexOf(u);if(q!==-1){this._hash.splice(q,1)}if(s&&u){u.destroy(true)}if(this.cursor===this.children[r]){this.cursor=null}r--}this.updateZ()};g.Group.prototype.destroy=function(q,p){if(this.game===null||this.ignoreDestroy){return}if(typeof q==="undefined"){q=true}if(typeof p==="undefined"){p=false}this.onDestroy.dispatch(this,q,p);this.removeAll(q);this.cursor=null;this.filters=null;if(!p){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(g.Group.prototype,"total",{get:function(){return this.iterate("exists",true,g.Group.RETURN_TOTAL)}});Object.defineProperty(g.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(g.Group.prototype,"angle",{get:function(){return g.Math.radToDeg(this.rotation)},set:function(p){this.rotation=g.Math.degToRad(p)}});g.World=function(p){g.Group.call(this,p,null,"__world",false);this.bounds=new g.Rectangle(0,0,p.width,p.height);this.camera=null;this._definedSize=false;this._width=p.width;this._height=p.height};g.World.prototype=Object.create(g.Group.prototype);g.World.prototype.constructor=g.World;g.World.prototype.boot=function(){this.camera=new g.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};g.World.prototype.setBounds=function(q,s,r,p){this._definedSize=true;this._width=r;this._height=p;this.bounds.setTo(q,s,r,p);this.x=q;this.y=s;if(this.camera.bounds){this.camera.bounds.setTo(q,s,Math.max(r,this.game.width),Math.max(p,this.game.height))}this.game.physics.setBoundsToWorld()};g.World.prototype.resize=function(q,p){if(this._definedSize){if(q<this._width){q=this._width}if(p<this._height){p=this._height}}this.bounds.width=q;this.bounds.height=p;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};g.World.prototype.shutdown=function(){this.destroy(true,true)};g.World.prototype.wrap=function(s,t,q,p,r){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=true}if(typeof r==="undefined"){r=true}if(!q){if(p&&s.x+t<this.bounds.x){s.x=this.bounds.right+t}else{if(p&&s.x-t>this.bounds.right){s.x=this.bounds.left-t}}if(r&&s.y+t<this.bounds.top){s.y=this.bounds.bottom+t}else{if(r&&s.y-t>this.bounds.bottom){s.y=this.bounds.top-t}}}else{s.getBounds();if(p){if((s.x+s._currentBounds.width)<this.bounds.x){s.x=this.bounds.right}else{if(s.x>this.bounds.right){s.x=this.bounds.left}}}if(r){if((s.y+s._currentBounds.height)<this.bounds.top){s.y=this.bounds.bottom}else{if(s.y>this.bounds.bottom){s.y=this.bounds.top}}}}};Object.defineProperty(g.World.prototype,"width",{get:function(){return this.bounds.width},set:function(p){if(p<this.game.width){p=this.game.width}this.bounds.width=p;this._width=p;this._definedSize=true}});Object.defineProperty(g.World.prototype,"height",{get:function(){return this.bounds.height},set:function(p){if(p<this.game.height){p=this.game.height}this.bounds.height=p;this._height=p;this._definedSize=true}});Object.defineProperty(g.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(g.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(g.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.integerInRange(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)))}else{return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}});Object.defineProperty(g.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.integerInRange(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)))}else{return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}});g.FlexGrid=function(q,r,p){this.game=q.game;this.manager=q;this.width=r;this.height=p;this.boundsCustom=new g.Rectangle(0,0,r,p);this.boundsFluid=new g.Rectangle(0,0,r,p);this.boundsFull=new g.Rectangle(0,0,r,p);this.boundsNone=new g.Rectangle(0,0,r,p);this.positionCustom=new g.Point(0,0);this.positionFluid=new g.Point(0,0);this.positionFull=new g.Point(0,0);this.positionNone=new g.Point(0,0);this.scaleCustom=new g.Point(1,1);this.scaleFluid=new g.Point(1,1);this.scaleFluidInversed=new g.Point(1,1);this.scaleFull=new g.Point(1,1);this.scaleNone=new g.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=r/p;this.ratioV=p/r;this.multiplier=0;this.layers=[]};g.FlexGrid.prototype={setSize:function(q,p){this.width=q;this.height=p;this.ratioH=q/p;this.ratioV=p/q;this.scaleNone=new g.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,p,r,s){if(typeof s==="undefined"){s=true}this.customWidth=t;this.customHeight=p;this.boundsCustom.width=t;this.boundsCustom.height=p;var q=new g.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(s){this.game.world.add(q)}this.layers.push(q);if(typeof r!=="undefined"&&typeof r!==null){q.addMultiple(r)}return q},createFluidLayer:function(q,r){if(typeof r==="undefined"){r=true}var p=new g.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(r){this.game.world.add(p)}this.layers.push(p);if(typeof q!=="undefined"&&typeof q!==null){p.addMultiple(q)}return p},createFullLayer:function(q){var p=new g.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(p);this.layers.push(p);if(typeof q!=="undefined"){p.addMultiple(q)}return p},createFixedLayer:function(q){var p=new g.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(p);this.layers.push(p);if(typeof q!=="undefined"){p.addMultiple(q)}return p},reset:function(){var p=this.layers.length;while(p--){if(!this.layers[p].persist){this.layers[p].position=null;this.layers[p].scale=null;this.layers.slice(p,1)}}},onResize:function(q,p){this.ratioH=q/p;this.ratioV=p/q;this.refresh(q,p)},refresh:function(){this.multiplier=Math.min((this.manager.height/this.height),(this.manager.width/this.width));this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(p){this.manager.scaleSprite(p);p.x=this.manager.bounds.centerX;p.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};g.FlexGrid.prototype.constructor=g.FlexGrid;g.FlexLayer=function(q,p,r,s){g.Group.call(this,q.game,null,"__flexLayer"+q.game.rnd.uuid(),false);this.manager=q.manager;this.grid=q;this.persist=false;this.position=p;this.bounds=r;this.scale=s;this.topLeft=r.topLeft;this.topMiddle=new g.Point(r.halfWidth,0);this.topRight=r.topRight;this.bottomLeft=r.bottomLeft;this.bottomMiddle=new g.Point(r.halfWidth,r.bottom);this.bottomRight=r.bottomRight};g.FlexLayer.prototype=Object.create(g.Group.prototype);g.FlexLayer.prototype.constructor=g.FlexLayer;g.FlexLayer.prototype.resize=function(){};g.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};g.ScaleManager=function(q,r,p){this.game=q;this.dom=g.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new g.Point();this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.maxIterations=5;this.onOrientationChange=new g.Signal();this.enterLandscape=new g.Signal();this.enterPortrait=new g.Signal();this.enterIncorrectOrientation=new g.Signal();this.leaveIncorrectOrientation=new g.Signal();this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new g.Signal();this.onFullScreenChange=new g.Signal();this.onFullScreenError=new g.Signal();this.enterFullScreen=new g.Signal();this.leaveFullScreen=new g.Signal();this.fullScreenFailed=this.onFullScreenError;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new g.Point(1,1);this.scaleFactorInversed=new g.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new g.Rectangle();this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=g.ScaleManager.NO_SCALE;this._fullScreenScaleMode=g.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new g.Point(1,1);this.trackParentInterval=2000;this.onSizeChange=new g.Signal();this.onResize=null;this.onResizeContext=null;this._fullScreenRestore=null;this._gameSize=new g.Rectangle();this._userScaleFactor=new g.Point(1,1);this._userScaleTrim=new g.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new g.Rectangle();this._tempBounds=new g.Rectangle();this._lastReportedCanvasSize=new g.Rectangle();this._lastReportedGameSize=new g.Rectangle();if(q.config){this.parseConfig(q.config)}this.setupScale(r,p)};g.ScaleManager.EXACT_FIT=0;g.ScaleManager.NO_SCALE=1;g.ScaleManager.SHOW_ALL=2;g.ScaleManager.RESIZE=3;g.ScaleManager.USER_SCALE=4;g.ScaleManager.prototype={boot:function(){var p=this.compatibility;p.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){p.scrollTo=new g.Point(0,1)}else{p.scrollTo=new g.Point(0,0)}}if(this.game.device.desktop){p.orientationFallback="screen";p.clickTrampoline="when-not-mouse"}else{p.orientationFallback="";p.clickTrampoline=""}var q=this;this._orientationChange=function(r){return q.orientationChange(r)};this._windowResize=function(r){return q.windowResize(r)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(r){return q.fullScreenChange(r)};this._fullScreenError=function(r){return q.fullScreenError(r)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.grid=new g.FlexGrid(this,this.width,this.height)},parseConfig:function(p){if(p.scaleMode){this.scaleMode=p.scaleMode}if(p.fullScreenScaleMode){this.fullScreenScaleMode=p.fullScreenScaleMode}if(p.fullScreenTarget){this.fullScreenTarget=p.fullScreenTarget}},setupScale:function(r,p){var u;var t=new g.Rectangle();if(this.game.parent!==""){if(typeof this.game.parent==="string"){u=document.getElementById(this.game.parent)}else{if(this.game.parent&&this.game.parent.nodeType===1){u=this.game.parent}}}if(!u){this.parentNode=null;this.parentIsWindow=true;t.width=this.dom.visualBounds.width;t.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=u;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);t.width=this._parentBounds.width;t.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var s=0;var q=0;if(typeof r==="number"){s=r}else{this.parentScaleFactor.x=parseInt(r,10)/100;s=t.width*this.parentScaleFactor.x}if(typeof p==="number"){q=p}else{this.parentScaleFactor.y=parseInt(p,10)/100;q=t.height*this.parentScaleFactor.y}this._gameSize.setTo(0,0,s,q);this.updateDimensions(s,q,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(q,p){this._gameSize.setTo(0,0,q,p);if(this.currentScaleMode!==g.ScaleManager.RESIZE){this.updateDimensions(q,p,true)}this.queueUpdate(true)},setUserScale:function(q,s,r,p){this._userScaleFactor.setTo(q,s);this._userScaleTrim.setTo(r|0,p|0);this.queueUpdate(true)},setResizeCallback:function(q,p){this.onResize=q;this.onResizeContext=p},signalSizeChange:function(){if(!g.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!g.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var q=this.width;var p=this.height;this._lastReportedCanvasSize.setTo(0,0,q,p);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);this.grid.onResize(q,p);this.onSizeChange.dispatch(this,q,p);if(this.currentScaleMode===g.ScaleManager.RESIZE){this.game.state.resize(q,p);this.game.load.resize(q,p)}}},setMinMax:function(p,s,r,q){this.minWidth=p;this.minHeight=s;if(typeof r!=="undefined"){this.maxWidth=r}if(typeof q!=="undefined"){this.maxHeight=q}},preUpdate:function(){if(this.game.time.time<(this._lastUpdate+this._updateThrottle)){return}var q=this._updateThrottle;this._updateThrottleReset=q>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var t=this._parentBounds.width;var v=this._parentBounds.height;var s=this.getParentBounds(this._parentBounds);var r=s.width!==t||s.height!==v;var p=this.updateOrientationState();if(r||p){if(this.onResize){this.onResize.call(this.onResizeContext,this,s)}this.updateLayout();this.signalSizeChange()}var u=this._updateThrottle*2;if(this._updateThrottle<q){u=Math.min(q,this._updateThrottleReset)}this._updateThrottle=g.Math.clamp(u,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(r,p,q){this.width=r*this.parentScaleFactor.x;this.height=p*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(q){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(q,p){if(typeof p==="undefined"){p=false}this.forceLandscape=q;this.forcePortrait=p;this.queueUpdate(true)},classifyOrientation:function(p){if(p==="portrait-primary"||p==="portrait-secondary"){return"portrait"}else{if(p==="landscape-primary"||p==="landscape-secondary"){return"landscape"}else{return null}}},updateOrientationState:function(){var r=this.screenOrientation;var q=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=(this.forceLandscape&&!this.isLandscape)||(this.forcePortrait&&!this.isPortrait);var s=r!==this.screenOrientation;var p=q!==this.incorrectOrientation;if(s){if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}}if(p){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(s||p){this.onOrientationChange.dispatch(this,r,q)}return s||p},orientationChange:function(p){this.event=p;this.queueUpdate(true)},windowResize:function(p){this.event=p;this.queueUpdate(true)},scrollTop:function(){var p=this.compatibility.scrollTo;if(p){window.scrollTo(p.x,p.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var p=this.currentScaleMode;if(p===g.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(p===g.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(p===g.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else{if(p===g.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else{if(p===g.ScaleManager.USER_SCALE){this.width=(this.game.width*this._userScaleFactor.x)-this._userScaleTrim.x;this.height=(this.game.height*this._userScaleFactor.y)-this._userScaleTrim.y}}}}}if(!this.compatibility.canExpandParent&&(p===g.ScaleManager.SHOW_ALL||p===g.ScaleManager.USER_SCALE)){var q=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,q.width);this.height=Math.min(this.height,q.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(w){var u=w||new g.Rectangle();var r=this.boundingParent;var q=this.dom.visualBounds;var p=this.dom.layoutBounds;if(!r){u.setTo(0,0,q.width,q.height)}else{var v=r.getBoundingClientRect();u.setTo(v.left,v.top,v.width,v.height);var t=this.windowConstraints;if(t.right){var s=t.right==="layout"?p:q;u.right=Math.min(u.right,s.width)}if(t.bottom){var s=t.bottom==="layout"?p:q;u.bottom=Math.min(u.bottom,s.height)}}u.setTo(Math.round(u.x),Math.round(u.y),Math.round(u.width),Math.round(u.height));return u},alignCanvas:function(q,s){var x=this.getParentBounds(this._tempBounds);var r=this.game.canvas;var t=this.margin;if(q){t.left=t.right=0;var w=r.getBoundingClientRect();if(this.width<x.width&&!this.incorrectOrientation){var p=w.left-x.x;var v=(x.width/2)-(this.width/2);v=Math.max(v,0);var u=v-p;t.left=Math.round(u)}r.style.marginLeft=t.left+"px";if(t.left!==0){t.right=-(x.width-w.width-t.left);r.style.marginRight=t.right+"px"}}if(s){t.top=t.bottom=0;var w=r.getBoundingClientRect();if(this.height<x.height&&!this.incorrectOrientation){var p=w.top-x.y;var v=(x.height/2)-(this.height/2);v=Math.max(v,0);var u=v-p;t.top=Math.round(u)}r.style.marginTop=t.top+"px";if(t.top!==0){t.bottom=-(x.height-w.height-t.top);r.style.marginBottom=t.bottom+"px"}}t.x=t.left;t.y=t.top},reflowGame:function(){this.resetCanvas("","");var p=this.getParentBounds(this._tempBounds);this.updateDimensions(p.width,p.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=g.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=g.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(r,q){if(typeof r==="undefined"){r=this.width+"px"}if(typeof q==="undefined"){q=this.height+"px"}var p=this.game.canvas;if(!this.compatibility.noMargins){p.style.marginLeft="";p.style.marginTop="";p.style.marginRight="";p.style.marginBottom=""}p.style.width=r;p.style.height=q},queueUpdate:function(p){if(p){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(p){if(p){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(t){var r=this.getParentBounds(this._tempBounds);var q=r.width;var p=r.height;var s;if(t){s=Math.max((p/this.game.height),(q/this.game.width))}else{s=Math.min((p/this.game.height),(q/this.game.width))}this.width=Math.round(this.game.width*s);this.height=Math.round(this.game.height*s)},setExactFit:function(){var p=this.getParentBounds(this._tempBounds);this.width=p.width;this.height=p.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var p=document.createElement("div");p.style.margin="0";p.style.padding="0";p.style.background="#000";return p},startFullScreen:function(q,v){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var w=this;setTimeout(function(){w.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var r=this.game.input;if(r.activePointer&&r.activePointer!==r.mousePointer&&(v||v!==false)){r.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[q,false]);return}}if(typeof q!=="undefined"&&this.game.renderType===g.CANVAS){this.game.stage.smoothed=q}var u=this.fullScreenTarget;if(!u){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();u=this._createdFullScreenTarget}var p={targetElement:u};this.onFullScreenInit.dispatch(this,p);if(this._createdFullScreenTarget){var s=this.game.canvas;var t=s.parentNode;t.insertBefore(u,s);u.appendChild(s)}if(this.game.device.fullscreenKeyboard){u[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{u[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var q=this._createdFullScreenTarget;if(q&&q.parentNode){var p=q.parentNode;p.insertBefore(this.game.canvas,q);p.removeChild(q)}this._createdFullScreenTarget=null},prepScreenMode:function(r){var p=!!this._createdFullScreenTarget;var q=this._createdFullScreenTarget||this.fullScreenTarget;if(r){if(p||this.fullScreenScaleMode===g.ScaleManager.EXACT_FIT){if(q!==this.game.canvas){this._fullScreenRestore={targetWidth:q.style.width,targetHeight:q.style.height};q.style.width="100%";q.style.height="100%"}}}else{if(this._fullScreenRestore){q.style.width=this._fullScreenRestore.targetWidth;q.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(p){this.event=p;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true);this.enterFullScreen.dispatch(this.width,this.height)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true);this.leaveFullScreen.dispatch(this.width,this.height)}this.onFullScreenChange.dispatch(this)},fullScreenError:function(p){this.event=p;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(v,q,w,p){if(typeof q==="undefined"){q=this.width}if(typeof w==="undefined"){w=this.height}if(typeof p==="undefined"){p=false}v.scale.set(1);if((v.width<=0)||(v.height<=0)||(q<=0)||(w<=0)){return v}var s=q;var x=(v.height*q)/v.width;var r=(v.width*w)/v.height;var u=w;var t=(r>q);if(t){t=p}else{t=!p}if(t){v.width=Math.floor(s);v.height=Math.floor(x)}else{v.width=Math.floor(r);v.height=Math.floor(u)}return v},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};g.ScaleManager.prototype.constructor=g.ScaleManager;g.ScaleManager.prototype.checkResize=g.ScaleManager.prototype.windowResize;g.ScaleManager.prototype.checkOrientation=g.ScaleManager.prototype.orientationChange;g.ScaleManager.prototype.setScreenSize=g.ScaleManager.prototype.updateLayout;g.ScaleManager.prototype.setSize=g.ScaleManager.prototype.reflowCanvas;g.ScaleManager.prototype.checkOrientationState=function(){var p=this.updateOrientationState();if(p){this.refresh()}return p};Object.defineProperty(g.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||(this.isFullScreen&&!this._createdFullScreenTarget)){return null}var p=this.game.canvas&&this.game.canvas.parentNode;return p||null}});Object.defineProperty(g.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(p){if(p!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=p}return this._scaleMode}});Object.defineProperty(g.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(p){if(p!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=p;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=p}}return this._fullScreenScaleMode}});Object.defineProperty(g.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(g.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(p){if(p!==this._pageAlignHorizontally){this._pageAlignHorizontally=p;this.queueUpdate(true)}}});Object.defineProperty(g.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(p){if(p!==this._pageAlignVertically){this._pageAlignVertically=p;this.queueUpdate(true)}}});Object.defineProperty(g.ScaleManager.prototype,"isFullScreen",{get:function(){return !!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(g.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(g.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(g.ScaleManager.prototype,"orientation",{get:function(){return(this.classifyOrientation(this.screenOrientation)==="portrait"?0:90)}});Object.defineProperty(g.ScaleManager.prototype,"isGamePortrait",{get:function(){return(this.height>this.width)}});Object.defineProperty(g.ScaleManager.prototype,"isGameLandscape",{get:function(){return(this.width>this.height)}});g.Game=function(t,p,v,s,u,w,q,r){this.id=g.GAMES.push(this)-1;this.config=null;this.physicsConfig=r;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=false;this.renderer=null;this.renderType=g.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=g.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new g.Signal();this.forceSingleUpdate=false;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof t!=="undefined"){this._width=t}if(typeof p!=="undefined"){this._height=p}if(typeof v!=="undefined"){this.renderType=v}if(typeof s!=="undefined"){this.parent=s}if(typeof w!=="undefined"){this.transparent=w}if(typeof q!=="undefined"){this.antialias=q}this.rnd=new g.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new g.StateManager(this,u)}this.device.whenReady(this.boot,this);return this};g.Game.prototype={parseConfig:function(q){this.config=q;if(typeof q.enableDebug==="undefined"){this.config.enableDebug=true}if(q.width){this._width=q.width}if(q.height){this._height=q.height}if(q.renderer){this.renderType=q.renderer}if(q.parent){this.parent=q.parent}if(q.transparent){this.transparent=q.transparent}if(q.antialias){this.antialias=q.antialias}if(q.resolution){this.resolution=q.resolution}if(q.preserveDrawingBuffer){this.preserveDrawingBuffer=q.preserveDrawingBuffer}if(q.physicsConfig){this.physicsConfig=q.physicsConfig}var p=[(Date.now()*Math.random()).toString()];if(q.seed){p=q.seed}this.rnd=new g.RandomDataGenerator(p);var r=null;if(q.state){r=q.state}this.state=new g.StateManager(this,r)},boot:function(){if(this.isBooted){return}this.onPause=new g.Signal();this.onResume=new g.Signal();this.onBlur=new g.Signal();this.onFocus=new g.Signal();this.isBooted=true;this.math=g.Math;this.scale=new g.ScaleManager(this,this._width,this._height);this.stage=new g.Stage(this);this.setUpRenderer();this.world=new g.World(this);this.add=new g.GameObjectFactory(this);this.make=new g.GameObjectCreator(this);this.cache=new g.Cache(this);this.load=new g.Loader(this);this.load.crossOrigin="Anonymous";this.time=new g.Time(this);this.tweens=new g.TweenManager(this);this.input=new g.Input(this);this.sound=new g.SoundManager(this);this.physics=new g.Physics(this,this.physicsConfig);this.particles=new g.Particles(this);this.plugins=new g.PluginManager(this);this.net=new g.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config.enableDebug){this.debug=new g.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){}}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new g.RequestAnimationFrame(this,this.config.forceSetTimeOut)}else{this.raf=new g.RequestAnimationFrame(this,false)}this._kickstart=true;if(window.focus){if(!window.PhaserGlobal||(window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window.PhaserGlobal&&window.PhaserGlobal.hideBanner){return}var q=g.VERSION;var u="Canvas";var p="HTML Audio";var w=1;if(this.renderType===g.WEBGL){u="WebGL";w++}else{if(this.renderType==g.HEADLESS){u="Headless"}}if(this.device.webAudio){p="WebAudio";w++}if(this.device.chrome){var s=["%c %c %c Phaser v"+q+" | Pixi.js "+PIXI.VERSION+" | "+u+" | "+p+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"];for(var t=0;t<3;t++){if(t<w){s.push("color: #ff2424; background: #fff")}else{s.push("color: #959595; background: #fff")}}console.log.apply(console,s)}else{if(window.console){console.log("Phaser v"+q+" | Pixi.js "+PIXI.VERSION+" | "+u+" | "+p+" | http://phaser.io")}}},setUpRenderer:function(){if(this.config.canvasID){this.canvas=g.Canvas.create(this.width,this.height,this.config.canvasID)}else{this.canvas=g.Canvas.create(this.width,this.height)}if(this.config.canvasStyle){this.canvas.style=this.config.canvasStyle}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.device.cocoonJS){if(this.renderType===g.CANVAS){this.canvas.screencanvas=true}else{this.canvas.screencanvas=false}}if(this.renderType===g.HEADLESS||this.renderType===g.CANVAS||(this.renderType===g.AUTO&&this.device.webGL===false)){if(this.device.canvas){if(this.renderType===g.AUTO){this.renderType=g.CANVAS}this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:true});this.context=this.renderer.context}else{throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=g.WEBGL;this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer});this.context=null}if(this.renderType!==g.HEADLESS){this.stage.smoothed=this.antialias;g.Canvas.addToDOM(this.canvas,this.parent,false);g.Canvas.setTouchAction(this.canvas)}},update:function(r){this.time.update(r);if(this._kickstart){this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+1000*10;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var p=this.time.slowMotion*1000/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(p*3,this.time.elapsed),0);var q=0;this.updatesThisFrame=Math.floor(this._deltaTime/p);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=p){this._deltaTime-=p;this.currentUpdateID=q;this.updateLogic(1/this.time.desiredFps);this.stage.updateTransform();q++;if(this.forceSingleUpdate&&q===1){break}}if(q>this._lastCount){this._spiraling++}else{if(q<this._lastCount){this._spiraling=0}}this._lastCount=q;this.updateRender(this._deltaTime/p)}},updateLogic:function(p){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.world.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(p);this.plugins.preUpdate(p);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update(p);this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate();this.debug.preUpdate()}},updateRender:function(p){if(this.lockRender){return}this.state.preRender(p);this.renderer.render(this.stage);this.plugins.render(p);this.state.render(p);this.plugins.postRender(p)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);g.Canvas.removeFromDOM(this.canvas);g.GAMES[this.id]=null},gamePaused:function(p){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.setMute();this.onPause.dispatch(p)}},gameResumed:function(p){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.unsetMute();this.onResume.dispatch(p)}},focusLoss:function(p){this.onBlur.dispatch(p);if(!this.stage.disableVisibilityChange){this.gamePaused(p)}},focusGain:function(p){this.onFocus.dispatch(p);if(!this.stage.disableVisibilityChange){this.gameResumed(p)}}};g.Game.prototype.constructor=g.Game;Object.defineProperty(g.Game.prototype,"paused",{get:function(){return this._paused},set:function(p){if(p===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});g.Input=function(p){this.game=p;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.enabled=true;this.multiInputOverride=g.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new g.ArraySet();this._localPoint=new g.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};g.Input.MOUSE_OVERRIDES_TOUCH=0;g.Input.TOUCH_OVERRIDES_MOUSE=1;g.Input.MOUSE_TOUCH_COMBINE=2;g.Input.MAX_POINTERS=10;g.Input.prototype={boot:function(){this.mousePointer=new g.Pointer(this.game,0);this.addPointer();this.addPointer();this.mouse=new g.Mouse(this.game);this.touch=new g.Touch(this.game);this.mspointer=new g.MSPointer(this.game);if(g.Keyboard){this.keyboard=new g.Keyboard(this.game)}if(g.Gamepad){this.gamepad=new g.Gamepad(this.game)}this.onDown=new g.Signal();this.onUp=new g.Signal();this.onTap=new g.Signal();this.onHold=new g.Signal();this.scale=new g.Point(1,1);this.speed=new g.Point();this.position=new g.Point();this._oldPosition=new g.Point();this.circle=new g.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var p=this;this._onClickTrampoline=function(q){p.onClickTrampoline(q)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(q,p){return this.moveCallbacks.push({callback:q,context:p})-1},deleteMoveCallback:function(p){if(this.moveCallbacks[p]){this.moveCallbacks.splice(p,1)}},addPointer:function(){if(this.pointers.length>=g.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: only "+g.Input.MAX_POINTERS+" pointer allowed");return null}var q=this.pointers.length+1;var p=new g.Pointer(this.game,q);this.pointers.push(p);this["pointer"+q]=p;return p},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var p=0;p<this.pointers.length;p++){this.pointers[p].update()}this._pollCounter=0},reset:function(q){if(!this.game.isBooted||this.resetLocked){return}if(typeof q==="undefined"){q=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(q)}if(this.gamepad){this.gamepad.reset()}for(var p=0;p<this.pointers.length;p++){this.pointers[p].reset()}this.currentPointers=0;if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(q){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new g.Signal();this.onUp=new g.Signal();this.onTap=new g.Signal();this.onHold=new g.Signal();this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(p,q){this._oldPosition.setTo(p,q);this.speed.setTo(0,0)},startPointer:function(q){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(q)}if(!this.pointer2.active){return this.pointer2.start(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(!r.active){return r.start(q)}}return null},updatePointer:function(q){if(this.pointer1.active&&this.pointer1.identifier===q.identifier){return this.pointer1.move(q)}if(this.pointer2.active&&this.pointer2.identifier===q.identifier){return this.pointer2.move(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active&&r.identifier===q.identifier){return r.move(q)}}return null},stopPointer:function(q){if(this.pointer1.active&&this.pointer1.identifier===q.identifier){return this.pointer1.stop(q)}if(this.pointer2.active&&this.pointer2.identifier===q.identifier){return this.pointer2.stop(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active&&r.identifier===q.identifier){return r.stop(q)}}return null},countActivePointers:function(p){if(typeof p==="undefined"){p=this.pointers.length}var r=p;for(var q=0;q<this.pointers.length&&r>0;q++){var s=this.pointers[q];if(s.active){r--}}this.currentPointers=(p-r);return(p-r)},getPointer:function(q){if(typeof q==="undefined"){q=false}for(var p=0;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active===q){return r}}return null},getPointerFromIdentifier:function(p){for(var q=0;q<this.pointers.length;q++){var r=this.pointers[q];if(r.identifier===p){return r}}return null},getPointerFromId:function(q){for(var p=0;p<this.pointers.length;p++){var r=this.pointers[p];if(r.pointerId===q){return r}}return null},getLocalPosition:function(s,r,q){if(typeof q==="undefined"){q=new g.Point()}var p=s.worldTransform;var t=1/(p.a*p.d+p.c*-p.b);return q.setTo(p.d*t*r.x+-p.c*t*r.y+(p.ty*p.c-p.tx*p.d)*t,p.a*t*r.y+-p.b*t*r.x+(-p.ty*p.a+p.tx*p.b)*t)},hitTest:function(v,p,y){if(!v.worldVisible){return false}this.getLocalPosition(v,p,this._localPoint);y.copyFrom(this._localPoint);if(v.hitArea&&v.hitArea.contains){return(v.hitArea.contains(this._localPoint.x,this._localPoint.y))}else{if(v instanceof g.TileSprite){var q=v.width;var x=v.height;var r=-q*v.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+q){var w=-x*v.anchor.y;if(this._localPoint.y>=w&&this._localPoint.y<w+x){return true}}}else{if(v instanceof PIXI.Sprite){var q=v.texture.frame.width;var x=v.texture.frame.height;var r=-q*v.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+q){var w=-x*v.anchor.y;if(this._localPoint.y>=w&&this._localPoint.y<w+x){return true}}}else{if(v instanceof g.Graphics){for(var t=0;t<v.graphicsData.length;t++){var s=v.graphicsData[t];if(!s.fill){continue}if(s.shape&&s.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}}}}for(var t=0,u=v.children.length;t<u;t++){if(this.hitTest(v.children[t],p,y)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};g.Input.prototype.constructor=g.Input;Object.defineProperty(g.Input.prototype,"x",{get:function(){return this._x},set:function(p){this._x=Math.floor(p)}});Object.defineProperty(g.Input.prototype,"y",{get:function(){return this._y},set:function(p){this._y=Math.floor(p)}});Object.defineProperty(g.Input.prototype,"pollLocked",{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate)}});Object.defineProperty(g.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(g.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(g.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(g.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Object.defineProperty(g.Input.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});g.Mouse=function(p){this.game=p;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new g.Signal();this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};g.Mouse.NO_BUTTON=-1;g.Mouse.LEFT_BUTTON=0;g.Mouse.MIDDLE_BUTTON=1;g.Mouse.RIGHT_BUTTON=2;g.Mouse.WHEEL_UP=1;g.Mouse.WHEEL_DOWN=-1;g.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var q=this;this._onMouseDown=function(r){return q.onMouseDown(r)};this._onMouseMove=function(r){return q.onMouseMove(r)};this._onMouseUp=function(r){return q.onMouseUp(r)};this._onMouseUpGlobal=function(r){return q.onMouseUpGlobal(r)};this._onMouseOut=function(r){return q.onMouseOut(r)};this._onMouseOver=function(r){return q.onMouseOver(r)};this._onMouseWheel=function(r){return q.onMouseWheel(r)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,true);this.game.canvas.addEventListener("mousemove",this._onMouseMove,true);this.game.canvas.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);this.game.canvas.addEventListener("mouseover",this._onMouseOver,true);this.game.canvas.addEventListener("mouseout",this._onMouseOut,true)}var p=this.game.device.wheelEvent;if(p){this.game.canvas.addEventListener(p,this._onMouseWheel,true);if(p==="mousewheel"){this._wheelEvent=new m(-1/40,1)}else{if(p==="DOMMouseScroll"){this._wheelEvent=new m(1,1)}}}},onMouseDown:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=p.button;if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=0;this.game.input.mousePointer.start(p)},onMouseMove:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=0;this.game.input.mousePointer.move(p)},onMouseUp:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=g.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=0;this.game.input.mousePointer.stop(p)},onMouseUpGlobal:function(p){if(!this.game.input.mousePointer.withinGame){this.button=g.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,p)}p.identifier=0;this.game.input.mousePointer.stop(p)}},onMouseOut:function(p){this.event=p;if(this.capture){p.preventDefault()}this.game.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}if(this.stopOnGameOut){p.identifier=0;this.game.input.mousePointer.stop(p)}},onMouseWheel:function(p){if(this._wheelEvent){p=this._wheelEvent.bindEvent(p)}this.event=p;if(this.capture){p.preventDefault()}this.wheelDelta=g.Math.clamp(-p.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,p)}},onMouseOver:function(p){this.event=p;if(this.capture){p.preventDefault()}this.game.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}},requestPointerLock:function(){if(this.game.device.pointerLock){var p=this.game.canvas;p.requestPointerLock=p.requestPointerLock||p.mozRequestPointerLock||p.webkitRequestPointerLock;p.requestPointerLock();var q=this;this._pointerLockChange=function(r){return q.pointerLockChange(r)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(q){var p=this.game.canvas;if(document.pointerLockElement===p||document.mozPointerLockElement===p||document.webkitPointerLockElement===p){this.locked=true;this.pointerLock.dispatch(true,q)}else{this.locked=false;this.pointerLock.dispatch(false,q)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,true);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,true);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,true);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,true);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,true);var p=this.game.device.wheelEvent;if(p){this.game.canvas.removeEventListener(p,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};g.Mouse.prototype.constructor=g.Mouse;Object.defineProperty(g.Mouse.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});function m(q,p){this._scaleFactor=q;this._deltaMode=p;this.originalEvent=null}m.prototype={};m.prototype.constructor=m;m.prototype.bindEvent=function(q){if(!m._stubsGenerated&&q){var p=function(s){return function(){var t=this.originalEvent[s];return typeof t!=="function"?t:t.bind(this.originalEvent)}};for(var r in q){if(!(r in m.prototype)){Object.defineProperty(m.prototype,r,{get:p(r)})}}m._stubsGenerated=true}this.originalEvent=q;return this};Object.defineProperties(m.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return(this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail))||0}},deltaX:{get:function(){return(this._scaleFactor*this.originalEvent.wheelDeltaX)||0}},deltaZ:{value:0}});g.MSPointer=function(p){this.game=p;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};g.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var p=this;if(this.game.device.mspointer){this._onMSPointerDown=function(q){return p.onPointerDown(q)};this._onMSPointerMove=function(q){return p.onPointerMove(q)};this._onMSPointerUp=function(q){return p.onPointerUp(q)};this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,false);this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,false);this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,false);this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,false);this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,false);this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,false);this.game.canvas.style["-ms-content-zooming"]="none";this.game.canvas.style["-ms-touch-action"]="none"}},onPointerDown:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=p.button;if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=p.pointerId;this.game.input.startPointer(p)},onPointerMove:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=p.pointerId;this.game.input.updatePointer(p)},onPointerUp:function(p){this.event=p;if(this.capture){p.preventDefault()}this.button=g.Mouse.NO_BUTTON;if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}p.identifier=p.pointerId;this.game.input.stopPointer(p)},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};g.MSPointer.prototype.constructor=g.MSPointer;Object.defineProperty(g.MSPointer.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});g.Pointer=function(p,q){this.game=p;this.id=q;this.type=g.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=false;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=false;this.dirty=false;this.position=new g.Point();this.positionDown=new g.Point();this.positionUp=new g.Point();this.circle=new g.Circle(0,0,44);if(q===0){this.isMouse=true}this._clickTrampolines=null;this._trampolineTargetObject=null};g.Pointer.prototype={start:function(p){if(p.pointerId){this.pointerId=p.pointerId}this.identifier=p.identifier;this.target=p.target;if(typeof p.button!=="undefined"){this.button=p.button}this._history=[];this.active=true;this.withinGame=true;this.isDown=true;this.isUp=false;this.dirty=false;this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(p,true);this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.x,this.y);this.game.input.onDown.dispatch(this,p);this.game.input.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(!this.isMouse){this.game.input.currentPointers++}if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){if(this.active){if(this.dirty){if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=this.game.input.holdRate){if(this.game.input.multiInputOverride==g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride==g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onHold.dispatch(this)}this._holdSent=true}if(this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+this.game.input.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>this.game.input.recordLimit){this._history.shift()}}}},move:function(q,r){if(this.game.input.pollLocked){return}if(typeof r==="undefined"){r=false}if(typeof q.button!=="undefined"){this.button=q.button}this.clientX=q.clientX;this.clientY=q.clientY;this.pageX=q.pageX;this.pageY=q.pageY;this.screenX=q.screenX;this.screenY=q.screenY;if(this.isMouse&&this.game.input.mouse.locked&&!r){this.rawMovementX=q.movementX||q.mozMovementX||q.webkitMovementX||0;this.rawMovementY=q.movementY||q.mozMovementY||q.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(this.game.input.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.activePointer=this;this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.game.input.x,this.game.input.y);this.game.input.circle.x=this.game.input.x;this.game.input.circle.y=this.game.input.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}var p=this.game.input.moveCallbacks.length;while(p--){this.game.input.moveCallbacks[p].callback.call(this.game.input.moveCallbacks[p].context,this,this.x,this.y,r)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else{if(this.game.input.interactiveItems.total>0){this.processInteractiveObjects(r)}}return this},processInteractiveObjects:function(t){var r=Number.MAX_VALUE;var q=-1;var p=null;var s=this.game.input.interactiveItems.first;while(s){s.checked=false;if(s.validForInput(q,r,false)){s.checked=true;if((t&&s.checkPointerDown(this,true))||(!t&&s.checkPointerOver(this,true))){r=s.sprite.renderOrderID;q=s.priorityID;p=s}}s=this.game.input.interactiveItems.next}var s=this.game.input.interactiveItems.first;while(s){if(!s.checked&&s.validForInput(q,r,true)){if((t&&s.checkPointerDown(this,false))||(!t&&s.checkPointerOver(this,false))){r=s.sprite.renderOrderID;q=s.priorityID;p=s}}s=this.game.input.interactiveItems.next}if(p===null){if(this.targetObject){this.targetObject._pointerOutHandler(this);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=p;p._pointerOverHandler(this)}else{if(this.targetObject===p){if(p.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this);this.targetObject=p;this.targetObject._pointerOverHandler(this)}}}return(this.targetObject!==null)},leave:function(p){this.withinGame=false;this.move(p,false)},stop:function(p){if(this._stateReset&&this.withinGame){p.preventDefault();return}this.timeUp=this.game.time.time;if(this.game.input.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onUp.dispatch(this,p);if(this.duration>=0&&this.duration<=this.game.input.tapRate){if(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate){this.game.input.onTap.dispatch(this,true)}else{this.game.input.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.id>0){this.active=false}this.withinGame=false;this.isDown=false;this.isUp=true;this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){this.game.input.currentPointers--}this.game.input.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(p){p=p||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+p)>this.game.time.time)},justReleased:function(p){p=p||this.game.input.justReleasedRate;return(this.isUp===true&&(this.timeUp+p)>this.game.time.time)},addClickTrampoline:function(q,u,p,s){if(!this.isDown){return}var t=(this._clickTrampolines=this._clickTrampolines||[]);for(var r=0;r<t.length;r++){if(t[r].name===q){t.splice(r,1);break}}t.push({name:q,targetObject:this.targetObject,callback:u,callbackContext:p,callbackArgs:s})},processClickTrampolines:function(){var r=this._clickTrampolines;if(!r){return}for(var p=0;p<r.length;p++){var q=r[p];if(q.targetObject===this._trampolineTargetObject){q.callback.apply(q.callbackContext,q.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.isDown=false;this.isUp=true;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};g.Pointer.prototype.constructor=g.Pointer;Object.defineProperty(g.Pointer.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.time-this.timeDown}});Object.defineProperty(g.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(g.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});g.Touch=function(p){this.game=p;this.enabled=true;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};g.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var p=this;if(this.game.device.touch){this._onTouchStart=function(q){return p.onTouchStart(q)};this._onTouchMove=function(q){return p.onTouchMove(q)};this._onTouchEnd=function(q){return p.onTouchEnd(q)};this._onTouchEnter=function(q){return p.onTouchEnter(q)};this._onTouchLeave=function(q){return p.onTouchLeave(q)};this._onTouchCancel=function(q){return p.onTouchCancel(q)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(p){p.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},onTouchStart:function(q){this.event=q;if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,q)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.startPointer(q.changedTouches[p])}},onTouchCancel:function(q){this.event=q;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,q)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.stopPointer(q.changedTouches[p])}},onTouchEnter:function(p){this.event=p;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){p.preventDefault()}},onTouchLeave:function(p){this.event=p;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,p)}if(this.preventDefault){p.preventDefault()}},onTouchMove:function(q){this.event=q;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,q)}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.updatePointer(q.changedTouches[p])}},onTouchEnd:function(q){this.event=q;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,q)}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.stopPointer(q.changedTouches[p])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};g.Touch.prototype.constructor=g.Touch;Object.defineProperty(g.Touch.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});g.InputHandler=function(p){this.sprite=p;this.game=p.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=false;this.scaleLayer=false;this.dragOffset=new g.Point();this.dragFromCenter=false;this.dragStartPoint=new g.Point();this._dragPoint=new g.Point();this._dragPhase=false;this._wasEnabled=false;this._tempPoint=new g.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};g.InputHandler.prototype={start:function(r,p){r=r||0;if(typeof p==="undefined"){p=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=p;this.priorityID=r;for(var q=0;q<10;q++){this._pointerData[q]={id:q,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new g.Point();this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);this.flagged=false;return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;this.flagged=false;for(var p=0;p<10;p++){this._pointerData[p]={id:p,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(r,q,p){if(typeof p==="undefined"){p=true}if(this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID){return false}if(!p&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>r||(this.priorityID===r&&this.sprite.renderOrderID<q)){return true}return false},isPixelPerfect:function(){return(this.pixelPerfectClick||this.pixelPerfectOver)},pointerX:function(p){p=p||0;return this._pointerData[p].x},pointerY:function(p){p=p||0;return this._pointerData[p].y},pointerDown:function(p){p=p||0;return this._pointerData[p].isDown},pointerUp:function(p){p=p||0;return this._pointerData[p].isUp},pointerTimeDown:function(p){p=p||0;return this._pointerData[p].timeDown},pointerTimeUp:function(p){p=p||0;return this._pointerData[p].timeUp},pointerOver:function(p){if(this.enabled){if(typeof p==="undefined"){for(var q=0;q<10;q++){if(this._pointerData[q].isOver){return true}}}else{return this._pointerData[p].isOver}}return false},pointerOut:function(p){if(this.enabled){if(typeof p==="undefined"){for(var q=0;q<10;q++){if(this._pointerData[q].isOut){return true}}}else{return this._pointerData[p].isOut}}return false},pointerTimeOver:function(p){p=p||0;return this._pointerData[p].timeOver},pointerTimeOut:function(p){p=p||0;return this._pointerData[p].timeOut},pointerDragged:function(p){p=p||0;return this._pointerData[p].isDragged},checkPointerDown:function(q,p){if(!q.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,q,this._tempPoint)){if(typeof p==="undefined"){p=false}if(!p&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(q,p){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,q,this._tempPoint)){if(typeof p==="undefined"){p=false}if(!p&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(p,s,r){if(this.sprite.texture.baseTexture.source){if(p===null&&s===null){this.game.input.getLocalPosition(this.sprite,r,this._tempPoint);var p=this._tempPoint.x;var s=this._tempPoint.y}if(this.sprite.anchor.x!==0){p-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){s-=-this.sprite.texture.frame.height*this.sprite.anchor.y}p+=this.sprite.texture.frame.x;s+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){p-=this.sprite.texture.trim.x;s-=this.sprite.texture.trim.y;if(p<this.sprite.texture.crop.x||p>this.sprite.texture.crop.right||s<this.sprite.texture.crop.y||s>this.sprite.texture.crop.bottom){this._dx=p;this._dy=s;return false}}this._dx=p;this._dy=s;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,p,s,1,1,0,0,1,1);var q=this.game.input.hitContext.getImageData(0,0,1,1);if(q.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(p){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(p);return false}if(this.draggable&&this._draggedPointerID===p.id){return this.updateDrag(p)}else{if(this._pointerData[p.id].isOver){if(this.checkPointerOver(p)){this._pointerData[p.id].x=p.x-this.sprite.x;this._pointerData[p.id].y=p.y-this.sprite.y;return true}else{this._pointerOutHandler(p);return false}}}},_pointerOverHandler:function(p){if(this.sprite===null){return}if(this._pointerData[p.id].isOver===false||p.dirty){this._pointerData[p.id].isOver=true;this._pointerData[p.id].isOut=false;this._pointerData[p.id].timeOver=this.game.time.time;this._pointerData[p.id].x=p.x-this.sprite.x;this._pointerData[p.id].y=p.y-this.sprite.y;if(this.useHandCursor&&this._pointerData[p.id].isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,p)}}},_pointerOutHandler:function(p){if(this.sprite===null){return}this._pointerData[p.id].isOver=false;this._pointerData[p.id].isOut=true;this._pointerData[p.id].timeOut=this.game.time.time;if(this.useHandCursor&&this._pointerData[p.id].isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,p)}},_touchedHandler:function(p){if(this.sprite===null){return}if(this._pointerData[p.id].isDown===false&&this._pointerData[p.id].isOver===true){if(this.pixelPerfectClick&&!this.checkPixel(null,null,p)){return}this._pointerData[p.id].isDown=true;this._pointerData[p.id].isUp=false;this._pointerData[p.id].timeDown=this.game.time.time;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,p)}p.dirty=true;if(this.draggable&&this.isDragged===false){this.startDrag(p)}if(this.bringToTop){this.sprite.bringToTop()}}return this.consumePointerEvent},_releasedHandler:function(p){if(this.sprite===null){return}if(this._pointerData[p.id].isDown&&p.isUp){this._pointerData[p.id].isDown=false;this._pointerData[p.id].isUp=true;this._pointerData[p.id].timeUp=this.game.time.time;this._pointerData[p.id].downDuration=this._pointerData[p.id].timeUp-this._pointerData[p.id].timeDown;if(this.checkPointerOver(p)){if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp$dispatch(this.sprite,p,true)}}else{if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp$dispatch(this.sprite,p,false)}if(this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}}p.dirty=true;if(this.draggable&&this.isDragged&&this._draggedPointerID===p.id){this.stopDrag(p)}}},updateDrag:function(r){if(r.isUp){this.stopDrag(r);return false}var q=this.globalToLocalX(r.x)+this._dragPoint.x+this.dragOffset.x;var p=this.globalToLocalY(r.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=q}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=p}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}else{if(this.allowHorizontalDrag){this.sprite.x=q}if(this.allowVerticalDrag){this.sprite.y=p}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}return true},justOver:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isOver&&this.overDuration(q)<p)},justOut:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isOut&&(this.game.time.time-this._pointerData[q].timeOut<p))},justPressed:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isDown&&this.downDuration(q)<p)},justReleased:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isUp&&(this.game.time.time-this._pointerData[q].timeUp<p))},overDuration:function(p){p=p||0;if(this._pointerData[p].isOver){return this.game.time.time-this._pointerData[p].timeOver}return -1},downDuration:function(p){p=p||0;if(this._pointerData[p].isDown){return this.game.time.time-this._pointerData[p].timeDown}return -1},enableDrag:function(q,t,p,s,u,r){if(typeof q==="undefined"){q=false}if(typeof t==="undefined"){t=false}if(typeof p==="undefined"){p=false}if(typeof s==="undefined"){s=255}if(typeof u==="undefined"){u=null}if(typeof r==="undefined"){r=null}this._dragPoint=new g.Point();this.draggable=true;this.bringToTop=t;this.dragOffset=new g.Point();this.dragFromCenter=q;this.pixelPerfectClick=p;this.pixelPerfectAlpha=s;if(u){this.boundsRect=u}if(r){this.boundsSprite=r}},disableDrag:function(){if(this._pointerData){for(var p=0;p<10;p++){this._pointerData[p].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1},startDrag:function(r){var p=this.sprite.x;var s=this.sprite.y;this.isDragged=true;this._draggedPointerID=r.id;this._pointerData[r.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){this.sprite.centerOn(r.x,r.y);this._dragPoint.setTo(this.sprite.cameraOffset.x-r.x,this.sprite.cameraOffset.y-r.y)}else{this._dragPoint.setTo(this.sprite.cameraOffset.x-r.x,this.sprite.cameraOffset.y-r.y)}}else{if(this.dragFromCenter){var q=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(r.x)+(this.sprite.x-q.centerX);this.sprite.y=this.globalToLocalY(r.y)+(this.sprite.y-q.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(r.x),this.sprite.y-this.globalToLocalY(r.y))}this.updateDrag(r);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(p,s);this.sprite.events.onDragStart$dispatch(this.sprite,r,p,s)},globalToLocalX:function(p){if(this.scaleLayer){p-=this.game.scale.grid.boundsFluid.x;p*=this.game.scale.grid.scaleFluidInversed.x}return p},globalToLocalY:function(p){if(this.scaleLayer){p-=this.game.scale.grid.boundsFluid.y;p*=this.game.scale.grid.scaleFluidInversed.y}return p},stopDrag:function(p){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[p.id].isDragged=false;this._dragPhase=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}this.sprite.events.onDragStop$dispatch(this.sprite,p);if(this.checkPointerOver(p)===false){this._pointerOutHandler(p)}},setDragLock:function(p,q){if(typeof p==="undefined"){p=true}if(typeof q==="undefined"){q=true}this.allowHorizontalDrag=p;this.allowVerticalDrag=q},enableSnap:function(s,r,q,p,u,t){if(typeof q==="undefined"){q=true}if(typeof p==="undefined"){p=false}if(typeof u==="undefined"){u=0}if(typeof t==="undefined"){t=0}this.snapX=s;this.snapY=r;this.snapOffsetX=u;this.snapOffsetY=t;this.snapOnDrag=q;this.snapOnRelease=p},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else{if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else{if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else{if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else{if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)-this.sprite.height}}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else{if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}}};g.InputHandler.prototype.constructor=g.InputHandler;g.Gamepad=function(p){this.game=p;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf("Firefox/")!=-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new g.SinglePad(p,this),new g.SinglePad(p,this),new g.SinglePad(p,this),new g.SinglePad(p,this)]};g.Gamepad.prototype={addCallbacks:function(p,q){if(typeof q!=="undefined"){this.onConnectCallback=(typeof q.onConnect==="function")?q.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof q.onDisconnect==="function")?q.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof q.onDown==="function")?q.onDown:this.onDownCallback;this.onUpCallback=(typeof q.onUp==="function")?q.onUp:this.onUpCallback;this.onAxisCallback=(typeof q.onAxis==="function")?q.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof q.onFloat==="function")?q.onFloat:this.onFloatCallback;this.callbackContext=p}},start:function(){if(this._active){return}this._active=true;var p=this;this._onGamepadConnected=function(q){return p.onGamepadConnected(q)};this._onGamepadDisconnected=function(q){return p.onGamepadDisconnected(q)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(q){var p=q.gamepad;this._rawPads.push(p);this._gamepads[p.index].connect(p)},onGamepadDisconnected:function(q){var r=q.gamepad;for(var p in this._rawPads){if(this._rawPads[p].index===r.index){this._rawPads.splice(p,1)}}this._gamepads[r.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads){var p=navigator.getGamepads()}else{if(navigator.webkitGetGamepads){var p=navigator.webkitGetGamepads()}else{if(navigator.webkitGamepads){var p=navigator.webkitGamepads()}}}if(p){this._rawPads=[];var v=false;for(var u=0;u<p.length;u++){if(typeof p[u]!==this._prevRawGamepadTypes[u]){v=true;this._prevRawGamepadTypes[u]=typeof p[u]}if(p[u]){this._rawPads.push(p[u])}if(u===3){break}}if(v){var y={rawIndices:{},padIndices:{}};var x;for(var t=0;t<this._gamepads.length;t++){x=this._gamepads[t];if(x.connected){for(var s=0;s<this._rawPads.length;s++){if(this._rawPads[s].index===x.index){y.rawIndices[x.index]=true;y.padIndices[t]=true}}}}for(var r=0;r<this._gamepads.length;r++){x=this._gamepads[r];if(y.padIndices[r]){continue}if(this._rawPads.length<1){x.disconnect()}for(var q=0;q<this._rawPads.length;q++){if(y.padIndices[r]){break}var w=this._rawPads[q];if(w){if(y.rawIndices[w.index]){x.disconnect();continue}else{x.connect(w);y.rawIndices[w.index]=true;y.padIndices[r]=true}}else{x.disconnect()}}}}}},setDeadZones:function(q){for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].deadZone=q}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].reset()}},justPressed:function(p,r){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].justPressed(p,r)===true){return true}}return false},justReleased:function(p,r){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].justReleased(p,r)===true){return true}}return false},isDown:function(p){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].isDown(p)===true){return true}}return false},destroy:function(){this.stop();for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].destroy()}}};g.Gamepad.prototype.constructor=g.Gamepad;Object.defineProperty(g.Gamepad.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});Object.defineProperty(g.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(g.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(g.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(g.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(g.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(g.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(g.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});g.Gamepad.BUTTON_0=0;g.Gamepad.BUTTON_1=1;g.Gamepad.BUTTON_2=2;g.Gamepad.BUTTON_3=3;g.Gamepad.BUTTON_4=4;g.Gamepad.BUTTON_5=5;g.Gamepad.BUTTON_6=6;g.Gamepad.BUTTON_7=7;g.Gamepad.BUTTON_8=8;g.Gamepad.BUTTON_9=9;g.Gamepad.BUTTON_10=10;g.Gamepad.BUTTON_11=11;g.Gamepad.BUTTON_12=12;g.Gamepad.BUTTON_13=13;g.Gamepad.BUTTON_14=14;g.Gamepad.BUTTON_15=15;g.Gamepad.AXIS_0=0;g.Gamepad.AXIS_1=1;g.Gamepad.AXIS_2=2;g.Gamepad.AXIS_3=3;g.Gamepad.AXIS_4=4;g.Gamepad.AXIS_5=5;g.Gamepad.AXIS_6=6;g.Gamepad.AXIS_7=7;g.Gamepad.AXIS_8=8;g.Gamepad.AXIS_9=9;g.Gamepad.XBOX360_A=0;g.Gamepad.XBOX360_B=1;g.Gamepad.XBOX360_X=2;g.Gamepad.XBOX360_Y=3;g.Gamepad.XBOX360_LEFT_BUMPER=4;g.Gamepad.XBOX360_RIGHT_BUMPER=5;g.Gamepad.XBOX360_LEFT_TRIGGER=6;g.Gamepad.XBOX360_RIGHT_TRIGGER=7;g.Gamepad.XBOX360_BACK=8;g.Gamepad.XBOX360_START=9;g.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;g.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;g.Gamepad.XBOX360_DPAD_LEFT=14;g.Gamepad.XBOX360_DPAD_RIGHT=15;g.Gamepad.XBOX360_DPAD_UP=12;g.Gamepad.XBOX360_DPAD_DOWN=13;g.Gamepad.XBOX360_STICK_LEFT_X=0;g.Gamepad.XBOX360_STICK_LEFT_Y=1;g.Gamepad.XBOX360_STICK_RIGHT_X=2;g.Gamepad.XBOX360_STICK_RIGHT_Y=3;g.Gamepad.PS3XC_X=0;g.Gamepad.PS3XC_CIRCLE=1;g.Gamepad.PS3XC_SQUARE=2;g.Gamepad.PS3XC_TRIANGLE=3;g.Gamepad.PS3XC_L1=4;g.Gamepad.PS3XC_R1=5;g.Gamepad.PS3XC_L2=6;g.Gamepad.PS3XC_R2=7;g.Gamepad.PS3XC_SELECT=8;g.Gamepad.PS3XC_START=9;g.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;g.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;g.Gamepad.PS3XC_DPAD_UP=12;g.Gamepad.PS3XC_DPAD_DOWN=13;g.Gamepad.PS3XC_DPAD_LEFT=14;g.Gamepad.PS3XC_DPAD_RIGHT=15;g.Gamepad.PS3XC_STICK_LEFT_X=0;g.Gamepad.PS3XC_STICK_LEFT_Y=1;g.Gamepad.PS3XC_STICK_RIGHT_X=2;g.Gamepad.PS3XC_STICK_RIGHT_Y=3;g.SinglePad=function(p,q){this.game=p;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26;this._padParent=q;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};g.SinglePad.prototype={addCallbacks:function(p,q){if(typeof q!=="undefined"){this.onConnectCallback=(typeof q.onConnect==="function")?q.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof q.onDisconnect==="function")?q.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof q.onDown==="function")?q.onDown:this.onDownCallback;this.onUpCallback=(typeof q.onUp==="function")?q.onUp:this.onUpCallback;this.onAxisCallback=(typeof q.onAxis==="function")?q.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof q.onFloat==="function")?q.onFloat:this.onFloatCallback}},getButton:function(p){if(this._buttons[p]){return this._buttons[p]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||(this._rawPad.timestamp&&(this._rawPad.timestamp===this._prevTimestamp))){return}for(var r=0;r<this._buttonsLen;r++){var p=isNaN(this._rawPad.buttons[r])?this._rawPad.buttons[r].value:this._rawPad.buttons[r];if(p!==this._buttons[r].value){if(p===1){this.processButtonDown(r,p)}else{if(p===0){this.processButtonUp(r,p)}else{this.processButtonFloat(r,p)}}}}for(var q=0;q<this._axesLen;q++){var s=this._rawPad.axes[q];if((s>0&&s>this.deadZone)||(s<0&&s<-this.deadZone)){this.processAxisChange(q,s)}else{this.processAxisChange(q,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(r){var s=!this.connected;this.connected=true;this.index=r.index;this._rawPad=r;this._buttons=[];this._buttonsLen=r.buttons.length;this._axes=[];this._axesLen=r.axes.length;for(var p=0;p<this._axesLen;p++){this._axes[p]=r.axes[p]}for(var q in r.buttons){q=parseInt(q,10);this._buttons[q]=new g.GamepadButton(this,q)}if(s&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(s&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var r=this.connected;var p=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var q=0;q<this._buttonsLen;q++){this._buttons[q].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(r&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,p)}if(r&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var p=0;p<this._buttonsLen;p++){this._buttons[p].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(p,q){if(this._axes[p]===q){return}this._axes[p]=q;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,p,q)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,p,q)}},processButtonDown:function(p,q){if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].processButtonDown(q)}},processButtonUp:function(p,q){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].processButtonUp(q)}},processButtonFloat:function(p,q){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].processButtonFloat(q)}},axis:function(p){if(this._axes[p]){return this._axes[p]}return false},isDown:function(p){if(this._buttons[p]){return this._buttons[p].isDown}return false},isUp:function(p){if(this._buttons[p]){return this._buttons[p].isUp}return false},justReleased:function(p,q){if(this._buttons[p]){return this._buttons[p].justReleased(q)}},justPressed:function(p,q){if(this._buttons[p]){return this._buttons[p].justPressed(q)}},buttonValue:function(p){if(this._buttons[p]){return this._buttons[p].value}return null},reset:function(){for(var p=0;p<this._axes.length;p++){this._axes[p]=0}}};g.SinglePad.prototype.constructor=g.SinglePad;g.GamepadButton=function(q,p){this.pad=q;this.game=q.game;this.isDown=false;this.isUp=true;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=p;this.onDown=new g.Signal();this.onUp=new g.Signal();this.onFloat=new g.Signal()};g.GamepadButton.prototype={processButtonDown:function(p){this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this.value=p;this.onDown.dispatch(this,p)},processButtonUp:function(p){this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.value=p;this.onUp.dispatch(this,p)},processButtonFloat:function(p){this.value=p;this.onFloat.dispatch(this,p)},justPressed:function(p){p=p||250;return(this.isDown===true&&(this.timeDown+p)>this.game.time.time)},justReleased:function(p){p=p||250;return(this.isUp===true&&(this.timeUp+p)>this.game.time.time)},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.pad=null;this.game=null}};g.GamepadButton.prototype.constructor=g.GamepadButton;g.Key=function(q,p){this.game=q;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=p;this.onDown=new g.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new g.Signal();this._justDown=false;this._justUp=false};g.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(p){if(!this._enabled){return}this.event=p;if(this.isDown){return}this.altKey=p.altKey;this.ctrlKey=p.ctrlKey;this.shiftKey=p.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(p){if(!this._enabled){return}this.event=p;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this._justUp=true;this.onUp.dispatch(this)},reset:function(p){if(typeof p==="undefined"){p=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this._enabled=true;this._justDown=false;this._justUp=false;if(p){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(p){if(typeof p==="undefined"){p=50}return(this.isDown&&this.duration<p)},upDuration:function(p){if(typeof p==="undefined"){p=50}return(!this.isDown&&((this.game.time.time-this.timeUp)<p))}};Object.defineProperty(g.Key.prototype,"justDown",{get:function(){var p=this._justDown;this._justDown=false;return p}});Object.defineProperty(g.Key.prototype,"justUp",{get:function(){var p=this._justUp;this._justUp=false;return p}});Object.defineProperty(g.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(p){p=!!p;if(p!==this._enabled){if(!p){this.reset(false)}this._enabled=p}}});g.Key.prototype.constructor=g.Key;g.Keyboard=function(p){this.game=p;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};g.Keyboard.prototype={addCallbacks:function(p,q,s,r){this.callbackContext=p;if(typeof q!=="undefined"){this.onDownCallback=q}if(typeof s!=="undefined"){this.onUpCallback=s}if(typeof r!=="undefined"){this.onPressCallback=r}},addKey:function(p){if(!this._keys[p]){this._keys[p]=new g.Key(this.game,p);this.addKeyCapture(p)}return this._keys[p]},removeKey:function(p){if(this._keys[p]){this._keys[p]=null;this.removeKeyCapture(p)}},createCursorKeys:function(){return{up:this.addKey(g.Keyboard.UP),down:this.addKey(g.Keyboard.DOWN),left:this.addKey(g.Keyboard.LEFT),right:this.addKey(g.Keyboard.RIGHT)}},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var p=this;this._onKeyDown=function(q){return p.processKeyDown(q)};this._onKeyUp=function(q){return p.processKeyUp(q)};this._onKeyPress=function(q){return p.processKeyPress(q)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(p){if(typeof p==="object"){for(var q in p){this._capture[p[q]]=true}}else{this._capture[p]=true}},removeKeyCapture:function(p){delete this._capture[p]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(p){this.event=p;if(!this.game.input.enabled||!this.enabled){return}if(this._capture[p.keyCode]){p.preventDefault()}if(!this._keys[p.keyCode]){this._keys[p.keyCode]=new g.Key(this.game,p.keyCode)}this._keys[p.keyCode].processKeyDown(p);this._k=p.keyCode;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,p)}},processKeyPress:function(p){this.pressEvent=p;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(p.charCode),p)}},processKeyUp:function(p){this.event=p;if(!this.game.input.enabled||!this.enabled){return}if(this._capture[p.keyCode]){p.preventDefault()}if(!this._keys[p.keyCode]){this._keys[p.keyCode]=new g.Key(this.game,p.keyCode)}this._keys[p.keyCode].processKeyUp(p);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,p)}},reset:function(q){if(typeof q==="undefined"){q=true}this.event=null;var p=this._keys.length;while(p--){if(this._keys[p]){this._keys[p].reset(q)}}},downDuration:function(p,q){if(this._keys[p]){return this._keys[p].downDuration(q)}else{return null}},upDuration:function(p,q){if(this._keys[p]){return this._keys[p].upDuration(q)}else{return null}},isDown:function(p){if(this._keys[p]){return this._keys[p].isDown}else{return null}}};Object.defineProperty(g.Keyboard.prototype,"disabled",{get:function(){return !this.enabled},set:function(p){this.enabled=!p}});Object.defineProperty(g.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(g.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});g.Keyboard.prototype.constructor=g.Keyboard;g.Keyboard.A="A".charCodeAt(0);g.Keyboard.B="B".charCodeAt(0);g.Keyboard.C="C".charCodeAt(0);g.Keyboard.D="D".charCodeAt(0);g.Keyboard.E="E".charCodeAt(0);g.Keyboard.F="F".charCodeAt(0);g.Keyboard.G="G".charCodeAt(0);g.Keyboard.H="H".charCodeAt(0);g.Keyboard.I="I".charCodeAt(0);g.Keyboard.J="J".charCodeAt(0);g.Keyboard.K="K".charCodeAt(0);g.Keyboard.L="L".charCodeAt(0);g.Keyboard.M="M".charCodeAt(0);g.Keyboard.N="N".charCodeAt(0);g.Keyboard.O="O".charCodeAt(0);g.Keyboard.P="P".charCodeAt(0);g.Keyboard.Q="Q".charCodeAt(0);g.Keyboard.R="R".charCodeAt(0);g.Keyboard.S="S".charCodeAt(0);g.Keyboard.T="T".charCodeAt(0);g.Keyboard.U="U".charCodeAt(0);g.Keyboard.V="V".charCodeAt(0);g.Keyboard.W="W".charCodeAt(0);g.Keyboard.X="X".charCodeAt(0);g.Keyboard.Y="Y".charCodeAt(0);g.Keyboard.Z="Z".charCodeAt(0);g.Keyboard.ZERO="0".charCodeAt(0);g.Keyboard.ONE="1".charCodeAt(0);g.Keyboard.TWO="2".charCodeAt(0);g.Keyboard.THREE="3".charCodeAt(0);g.Keyboard.FOUR="4".charCodeAt(0);g.Keyboard.FIVE="5".charCodeAt(0);g.Keyboard.SIX="6".charCodeAt(0);g.Keyboard.SEVEN="7".charCodeAt(0);g.Keyboard.EIGHT="8".charCodeAt(0);g.Keyboard.NINE="9".charCodeAt(0);g.Keyboard.NUMPAD_0=96;g.Keyboard.NUMPAD_1=97;g.Keyboard.NUMPAD_2=98;g.Keyboard.NUMPAD_3=99;g.Keyboard.NUMPAD_4=100;g.Keyboard.NUMPAD_5=101;g.Keyboard.NUMPAD_6=102;g.Keyboard.NUMPAD_7=103;g.Keyboard.NUMPAD_8=104;g.Keyboard.NUMPAD_9=105;g.Keyboard.NUMPAD_MULTIPLY=106;g.Keyboard.NUMPAD_ADD=107;g.Keyboard.NUMPAD_ENTER=108;g.Keyboard.NUMPAD_SUBTRACT=109;g.Keyboard.NUMPAD_DECIMAL=110;g.Keyboard.NUMPAD_DIVIDE=111;g.Keyboard.F1=112;g.Keyboard.F2=113;g.Keyboard.F3=114;g.Keyboard.F4=115;g.Keyboard.F5=116;g.Keyboard.F6=117;g.Keyboard.F7=118;g.Keyboard.F8=119;g.Keyboard.F9=120;g.Keyboard.F10=121;g.Keyboard.F11=122;g.Keyboard.F12=123;g.Keyboard.F13=124;g.Keyboard.F14=125;g.Keyboard.F15=126;g.Keyboard.COLON=186;g.Keyboard.EQUALS=187;g.Keyboard.UNDERSCORE=189;g.Keyboard.QUESTION_MARK=191;g.Keyboard.TILDE=192;g.Keyboard.OPEN_BRACKET=219;g.Keyboard.BACKWARD_SLASH=220;g.Keyboard.CLOSED_BRACKET=221;g.Keyboard.QUOTES=222;g.Keyboard.BACKSPACE=8;g.Keyboard.TAB=9;g.Keyboard.CLEAR=12;g.Keyboard.ENTER=13;g.Keyboard.SHIFT=16;g.Keyboard.CONTROL=17;g.Keyboard.ALT=18;g.Keyboard.CAPS_LOCK=20;g.Keyboard.ESC=27;g.Keyboard.SPACEBAR=32;g.Keyboard.PAGE_UP=33;g.Keyboard.PAGE_DOWN=34;g.Keyboard.END=35;g.Keyboard.HOME=36;g.Keyboard.LEFT=37;g.Keyboard.UP=38;g.Keyboard.RIGHT=39;g.Keyboard.DOWN=40;g.Keyboard.INSERT=45;g.Keyboard.DELETE=46;g.Keyboard.HELP=47;g.Keyboard.NUM_LOCK=144;g.Keyboard.PLUS=43;g.Keyboard.MINUS=45;g.Component=function(){};g.Component.Angle=function(){};g.Component.Angle.prototype={angle:{get:function(){return g.Math.wrapAngle(g.Math.radToDeg(this.rotation))},set:function(p){this.rotation=g.Math.degToRad(g.Math.wrapAngle(p))}}};g.Component.Animation=function(){};g.Component.Animation.prototype={play:function(s,r,q,p){if(this.animations){return this.animations.play(s,r,q,p)}}};g.Component.AutoCull=function(){};g.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};g.Component.Bounds=function(){};g.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return(this.x+this.width)-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return(this.y+this.height)-this.offsetY}}};g.Component.BringToTop=function(){};g.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};g.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};g.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};g.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};g.Component.Core=function(){};g.Component.Core.install=function(r){g.Utils.mixinPrototype(this,g.Component.Core.prototype);this.components={};for(var q=0;q<r.length;q++){var s=r[q];var p=false;if(s==="Destroy"){p=true}g.Utils.mixinPrototype(this,g.Component[s].prototype,p);this.components[s]=true}};g.Component.Core.init=function(q,p,t,r,s){this.game=q;this.key=r;this.position.set(p,t);this.world=new g.Point(p,t);this.previousPosition=new g.Point(p,t);this.events=new g.Events(this);this._bounds=new g.Rectangle();if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new g.AnimationManager(this)}if(this.components.LoadTexture&&r!==null){this.loadTexture(r,s)}if(this.components.FixedToCamera){this.cameraOffset=new g.Point(p,t)}};g.Component.Core.preUpdate=function(){this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}return true};g.Component.Core.prototype={game:null,name:"",components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(p){if(p){this._exists=true;if(this.body&&this.body.type===g.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===g.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.key instanceof g.BitmapData){this.key.render()}if(this.components.PhysicsBody){g.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){g.Component.FixedToCamera.postUpdate.call(this)}for(var p=0;p<this.children.length;p++){this.children[p].postUpdate()}}};g.Component.Crop=function(){};g.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(p,q){if(typeof q==="undefined"){q=false}if(p){if(q&&this.cropRect!==null){this.cropRect.setTo(p.x,p.y,p.width,p.height)}else{if(q&&this.cropRect===null){this.cropRect=new g.Rectangle(p.x,p.y,p.width,p.height)}else{this.cropRect=p}}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}this._crop=g.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var p=Math.max(this._frame.x,this._crop.x);var s=Math.max(this._frame.y,this._crop.y);var q=Math.min(this._frame.right,this._crop.right)-p;var r=Math.min(this._frame.bottom,this._crop.bottom)-s;this.texture.crop.x=p;this.texture.crop.y=s;this.texture.crop.width=q;this.texture.crop.height=r;this.texture.frame.width=Math.min(q,this.cropRect.width);this.texture.frame.height=Math.min(r,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs()}};g.Component.Delta=function(){};g.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};g.Component.Destroy=function(){};g.Component.Destroy.prototype={destroyPhase:false,destroy:function(q){if(this.game===null||this.destroyPhase){return}if(typeof q==="undefined"){q=true}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof g.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}var p=this.children.length;if(q){while(p--){this.children[p].destroy(q)}}else{while(p--){this.removeChild(this.children[p])}}if(this._crop){this._crop=null}if(this._frame){this._frame=null}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.renderable=false;this.transformCallback=null;this.transformCallbackContext=null;this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this.destroyPhase=false}};g.Events=function(p){this.parent=p};g.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};g.Events.prototype.constructor=g.Events;for(var e in g.Events.prototype){if(!g.Events.prototype.hasOwnProperty(e)||e.indexOf("on")!==0||g.Events.prototype[e]!==null){continue}(function(q,p){Object.defineProperty(g.Events.prototype,q,{get:function(){return this[p]||(this[p]=new g.Signal())}});g.Events.prototype[q+"$dispatch"]=function(){return this[p]?this[p].dispatch.apply(this[p],arguments):null}})(e,"_"+e)}g.Component.FixedToCamera=function(){};g.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};g.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(p){if(p){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new g.Point()};g.Component.Health=function(){};g.Component.Health.prototype={health:1,damage:function(p){if(this.alive){this.health-=p;if(this.health<=0){this.kill()}}return this}};g.Component.InCamera=function(){};g.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};g.Component.InputEnabled=function(){};g.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return(this.input&&this.input.enabled)},set:function(p){if(p){if(this.input===null){this.input=new g.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};g.Component.InWorld=function(){};g.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else{if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}}return true};g.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};g.Component.LifeSpan=function(){};g.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};g.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(p){if(typeof p==="undefined"){p=1}this.alive=true;this.exists=true;this.visible=true;if(typeof this.health==="number"){this.health=p}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};g.Component.LoadTexture=function(){};g.Component.LoadTexture.prototype={_frame:null,loadTexture:function(s,u,q){u=u||0;if((q||typeof q==="undefined")&&this.animations){this.animations.stop()}this.key=s;var p=true;var r=!this.texture.baseTexture.scaleMode;var t=false;if(g.RenderTexture&&s instanceof g.RenderTexture){this.key=s.key;this.setTexture(s);t=true}else{if(g.BitmapData&&s instanceof g.BitmapData){this.setTexture(s.texture);if(this.game.cache.getFrameData(s.key,g.Cache.BITMAPDATA)){p=!this.animations.loadFrameData(this.game.cache.getFrameData(s.key,g.Cache.BITMAPDATA),u)}}else{if(s instanceof PIXI.Texture){this.setTexture(s)}else{if(s===null||typeof s==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key])}else{if(typeof s==="string"&&!this.game.cache.checkImageKey(s)){console.warn("Texture with key '"+s+"' not found.");this.key="__missing";this.setTexture(PIXI.TextureCache[this.key])}else{this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[s]));p=!this.animations.loadFrameData(this.game.cache.getFrameData(s),u)}}}}}if(!t){this.texture.baseTexture.dirty()}if(p){this._frame=g.Rectangle.clone(this.texture.frame)}if(!r){this.texture.baseTexture.scaleMode=1}},setFrame:function(p){this._frame=p;this.texture.frame.x=p.x;this.texture.frame.y=p.y;this.texture.frame.width=p.width;this.texture.frame.height=p.height;this.texture.crop.x=p.x;this.texture.crop.y=p.y;this.texture.crop.width=p.width;this.texture.crop.height=p.height;if(p.trimmed){if(this.texture.trim){this.texture.trim.x=p.spriteSourceSizeX;this.texture.trim.y=p.spriteSourceSizeY;this.texture.trim.width=p.sourceSizeW;this.texture.trim.height=p.sourceSizeH}else{this.texture.trim={x:p.spriteSourceSizeX,y:p.spriteSourceSizeY,width:p.sourceSizeW,height:p.sourceSizeH}}this.texture.width=p.sourceSizeW;this.texture.height=p.sourceSizeH;this.texture.frame.width=p.sourceSizeW;this.texture.frame.height=p.sourceSizeH}else{if(!p.trimmed&&this.texture.trim){this.texture.trim=null}}if(this.cropRect){this.updateCrop()}if(this.tint!==16777215){this.cachedTint=-1}this.texture._updateUvs()},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(p){this.animations.frame=p}},frameName:{get:function(){return this.animations.frameName},set:function(p){this.animations.frameName=p}}};g.Component.Overlap=function(){};g.Component.Overlap.prototype={overlap:function(p){return g.Rectangle.intersects(this.getBounds(),p.getBounds())}};g.Component.PhysicsBody=function(){};g.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};g.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};g.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(p){this.position.x=p;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(p){this.position.y=p;if(this.body&&!this.body.dirty){this.body._reset=true}}}};g.Component.Reset=function(){};g.Component.Reset.prototype.reset=function(p,r,q){if(typeof q==="undefined"){q=1}this.world.set(p,r);this.position.set(p,r);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=q}if(this.components.PhysicsBody){if(this.body){this.body.reset(p,r,false,false)}}return this};g.Component.ScaleMinMax=function(){};g.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(p){if(this.scaleMin){if(p.a<this.scaleMin.x){p.a=this.scaleMin.x}if(p.d<this.scaleMin.y){p.d=this.scaleMin.y}}if(this.scaleMax){if(p.a>this.scaleMax.x){p.a=this.scaleMax.x}if(p.d>this.scaleMax.y){p.d=this.scaleMax.y}}},setScaleMinMax:function(p,s,r,q){if(typeof s==="undefined"){s=r=q=p}else{if(typeof r==="undefined"){r=q=s;s=p}}if(p===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(p,s)}else{this.scaleMin=new g.Point(p,s)}}if(r===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(r,q)}else{this.scaleMax=new g.Point(r,q)}}}};g.Component.Smoothed=function(){};g.Component.Smoothed.prototype={smoothed:{get:function(){return !this.texture.baseTexture.scaleMode},set:function(p){if(p){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};g.GameObjectFactory=function(p){this.game=p;this.world=this.game.world};g.GameObjectFactory.prototype={existing:function(p){return this.world.add(p)},image:function(p,t,q,s,r){if(typeof r==="undefined"){r=this.world}return r.add(new g.Image(this.game,p,t,q,s))},sprite:function(p,t,q,s,r){if(typeof r==="undefined"){r=this.world}return r.create(p,t,q,s)},tween:function(p){return this.game.tweens.create(p)},group:function(s,q,p,t,r){return new g.Group(this.game,s,q,p,t,r)},physicsGroup:function(s,r,q,p){return new g.Group(this.game,r,q,p,true,s)},spriteBatch:function(r,q,p){if(typeof r==="undefined"){r=null}if(typeof q==="undefined"){q="group"}if(typeof p==="undefined"){p=false}return new g.SpriteBatch(this.game,r,q,p)},audio:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},sound:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},audioSprite:function(p){return this.game.sound.addSprite(p)},tileSprite:function(q,v,s,p,r,u,t){if(typeof t==="undefined"){t=this.world}return t.add(new g.TileSprite(this.game,q,v,s,p,r,u))},rope:function(p,u,q,t,r,s){if(typeof s==="undefined"){s=this.world}return s.add(new g.Rope(this.game,p,u,q,t,r))},text:function(p,t,s,q,r){if(typeof r==="undefined"){r=this.world}return r.add(new g.Text(this.game,p,t,s,q))},button:function(v,u,z,A,q,r,p,s,t,w){if(typeof w==="undefined"){w=this.world}return w.add(new g.Button(this.game,v,u,z,A,q,r,p,s,t))},graphics:function(p,r,q){if(typeof q==="undefined"){q=this.world}return q.add(new g.Graphics(this.game,p,r))},emitter:function(p,r,q){return this.game.particles.add(new g.Particles.Arcade.Emitter(this.game,p,r,q))},retroFont:function(q,p,s,v,x,w,t,u,r){return new g.RetroFont(this.game,q,p,s,v,x,w,t,u,r)},bitmapText:function(p,u,q,t,r,s){if(typeof s==="undefined"){s=this.world}return s.add(new g.BitmapText(this.game,p,u,q,t,r))},tilemap:function(r,t,q,s,p){return new g.Tilemap(this.game,r,t,q,s,p)},renderTexture:function(s,q,r,p){if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}if(typeof p==="undefined"){p=false}var t=new g.RenderTexture(this.game,s,q,r);if(p){this.game.cache.addRenderTexture(r,t)}return t},bitmapData:function(s,q,r,p){if(typeof p==="undefined"){p=false}if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}var t=new g.BitmapData(this.game,r,s,q);if(p){this.game.cache.addBitmapData(r,t)}return t},filter:function(q){var p=Array.prototype.splice.call(arguments,1);var q=new g.Filter[q](this.game);q.init.apply(q,p);return q},plugin:function(p){return this.game.plugins.add(p)}};g.GameObjectFactory.prototype.constructor=g.GameObjectFactory;g.GameObjectCreator=function(p){this.game=p;this.world=this.game.world};g.GameObjectCreator.prototype={image:function(p,s,q,r){return new g.Image(this.game,p,s,q,r)},sprite:function(p,s,q,r){return new g.Sprite(this.game,p,s,q,r)},tween:function(p){return new g.Tween(p,this.game,this.game.tweens)},group:function(s,q,p,t,r){return new g.Group(this.game,null,q,p,t,r)},spriteBatch:function(r,q,p){if(typeof q==="undefined"){q="group"}if(typeof p==="undefined"){p=false}return new g.SpriteBatch(this.game,r,q,p)},audio:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},audioSprite:function(p){return this.game.sound.addSprite(p)},sound:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},tileSprite:function(q,u,s,p,r,t){return new g.TileSprite(this.game,q,u,s,p,r,t)},rope:function(p,t,q,s,r){return new g.Rope(this.game,p,t,q,s,r)},text:function(p,s,r,q){return new g.Text(this.game,p,s,r,q)},button:function(v,u,w,z,q,r,p,s,t){return new g.Button(this.game,v,u,w,z,q,r,p,s,t)},graphics:function(p,q){return new g.Graphics(this.game,p,q)},emitter:function(p,r,q){return new g.Particles.Arcade.Emitter(this.game,p,r,q)},retroFont:function(q,p,s,v,x,w,t,u,r){return new g.RetroFont(this.game,q,p,s,v,x,w,t,u,r)},bitmapText:function(p,t,q,s,r){return new g.BitmapText(this.game,p,t,q,s,r)},tilemap:function(r,t,q,s,p){return new g.Tilemap(this.game,r,t,q,s,p)},renderTexture:function(s,q,r,p){if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}if(typeof p==="undefined"){p=false}var t=new g.RenderTexture(this.game,s,q,r);if(p){this.game.cache.addRenderTexture(r,t)}return t},bitmapData:function(s,q,r,p){if(typeof p==="undefined"){p=false}if(typeof r==="undefined"||r===""){r=this.game.rnd.uuid()}var t=new g.BitmapData(this.game,r,s,q);if(p){this.game.cache.addBitmapData(r,t)}return t},filter:function(q){var p=Array.prototype.splice.call(arguments,1);var q=new g.Filter[q](this.game);q.init.apply(q,p);return q}};g.GameObjectCreator.prototype.constructor=g.GameObjectCreator;g.Sprite=function(q,p,t,r,s){p=p||0;t=t||0;r=r||null;s=s||null;this.type=g.SPRITE;this.physicsType=g.SPRITE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);g.Component.Core.init.call(this,q,p,t,r,s)};g.Sprite.prototype=Object.create(PIXI.Sprite.prototype);g.Sprite.prototype.constructor=g.Sprite;g.Component.Core.install.call(g.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);g.Sprite.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Sprite.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Sprite.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Sprite.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Image=function(q,p,t,r,s){p=p||0;t=t||0;r=r||null;s=s||null;this.type=g.IMAGE;PIXI.Sprite.call(this,PIXI.TextureCache.__default);g.Component.Core.init.call(this,q,p,t,r,s)};g.Image.prototype=Object.create(PIXI.Sprite.prototype);g.Image.prototype.constructor=g.Image;g.Component.Core.install.call(g.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","Smoothed"]);g.Image.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Image.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.TileSprite=function(r,q,v,t,p,s,u){q=q||0;v=v||0;t=t||256;p=p||256;s=s||null;u=u||null;this.type=g.TILESPRITE;this._scroll=new g.Point();PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,t,p);g.Component.Core.init.call(this,r,q,v,s,u)};g.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);g.TileSprite.prototype.constructor=g.TileSprite;g.Component.Core.install.call(g.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);g.TileSprite.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.TileSprite.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.TileSprite.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.TileSprite.prototype.preUpdateCore=g.Component.Core.preUpdate;g.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.TileSprite.prototype.autoScroll=function(p,q){this._scroll.set(p,q)};g.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};g.TileSprite.prototype.destroy=function(p){g.Component.Destroy.prototype.destroy.call(this,p);PIXI.TilingSprite.prototype.destroy.call(this)};g.TileSprite.prototype.reset=function(p,q){g.Component.Reset.prototype.reset.call(this,p,q);this.tilePosition.x=0;this.tilePosition.y=0;return this};g.Rope=function(q,p,u,r,t,s){this.points=[];this.points=s;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;p=p||0;u=u||0;r=r||null;t=t||null;this.type=g.ROPE;this._scroll=new g.Point();PIXI.Rope.call(this,r,this.points);g.Component.Core.init.call(this,q,p,u,r,t)};g.Rope.prototype=Object.create(PIXI.Rope.prototype);g.Rope.prototype.constructor=g.Rope;g.Component.Core.install.call(g.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);g.Rope.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Rope.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Rope.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Rope.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Rope.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};g.Rope.prototype.reset=function(p,q){g.Component.Reset.prototype.reset.call(this,p,q);this.tilePosition.x=0;this.tilePosition.y=0;return this};Object.defineProperty(g.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(p){if(p&&typeof p==="function"){this._hasUpdateAnimation=true;this._updateAnimation=p}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(g.Rope.prototype,"segments",{get:function(){var t=[];var u,r,x,p,w,q,y,v;for(var s=0;s<this.points.length;s++){u=s*4;r=this.verticies[u];x=this.verticies[u+1];p=this.verticies[u+4];w=this.verticies[u+3];q=g.Math.difference(r,p);y=g.Math.difference(x,w);r+=this.world.x;x+=this.world.y;v=new g.Rectangle(r,x,q,y);t.push(v)}return t}});g.Button=function(A,v,u,w,z,q,r,p,s,t){v=v||0;u=u||0;w=w||null;z=z||null;q=q||this;g.Image.call(this,A,v,u,w,p);this.type=g.BUTTON;this.physicsType=g.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new g.Signal();this.onInputOut=new g.Signal();this.onInputDown=new g.Signal();this.onInputUp=new g.Signal();this.onOverMouseOnly=false;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.setFrames(r,p,s,t);if(z!==null){this.onInputUp.add(z,q)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};g.Button.prototype=Object.create(g.Image.prototype);g.Button.prototype.constructor=g.Button;var n="Over";var a="Out";var d="Down";var k="Up";g.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};g.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};g.Button.prototype.setStateFrame=function(r,s,q){var p="_on"+r+"Frame";if(s!=null){this[p]=s;if(q){this.changeStateFrame(r)}}else{this[p]=null}};g.Button.prototype.changeStateFrame=function(q){if(this.freezeFrames){return false}var p="_on"+q+"Frame";var r=this[p];if(typeof r==="string"){this.frameName=r;return true}else{if(typeof r==="number"){this.frame=r;return true}else{return false}}};g.Button.prototype.setFrames=function(q,s,p,r){this.setStateFrame(n,q,this.input.pointerOver());this.setStateFrame(a,s,!this.input.pointerOver());this.setStateFrame(d,p,this.input.pointerDown());this.setStateFrame(k,r,this.input.pointerUp())};g.Button.prototype.setStateSound=function(r,s,p){var t="on"+r+"Sound";var q="on"+r+"SoundMarker";if(s instanceof g.Sound||s instanceof g.AudioSprite){this[t]=s;this[q]=typeof p==="string"?p:""}else{this[t]=null;this[q]=""}};g.Button.prototype.playStateSound=function(r){var t="on"+r+"Sound";var s=this[t];if(s){var q="on"+r+"SoundMarker";var p=this[q];s.play(p);return true}else{return false}};g.Button.prototype.setSounds=function(q,u,p,t,s,w,r,v){this.setStateSound(n,q,u);this.setStateSound(a,s,w);this.setStateSound(d,p,t);this.setStateSound(k,r,v)};g.Button.prototype.setOverSound=function(q,p){this.setStateSound(n,q,p)};g.Button.prototype.setOutSound=function(q,p){this.setStateSound(a,q,p)};g.Button.prototype.setDownSound=function(q,p){this.setStateSound(d,q,p)};g.Button.prototype.setUpSound=function(q,p){this.setStateSound(k,q,p)};g.Button.prototype.onInputOverHandler=function(p,q){if(q.justReleased()){return}this.changeStateFrame(n);if(this.onOverMouseOnly&&!q.isMouse){return}this.playStateSound(n);if(this.onInputOver){this.onInputOver.dispatch(this,q)}};g.Button.prototype.onInputOutHandler=function(p,q){this.changeStateFrame(a);this.playStateSound(a);if(this.onInputOut){this.onInputOut.dispatch(this,q)}};g.Button.prototype.onInputDownHandler=function(p,q){this.changeStateFrame(d);this.playStateSound(d);if(this.onInputDown){this.onInputDown.dispatch(this,q)}};g.Button.prototype.onInputUpHandler=function(p,s,r){this.playStateSound(k);if(this.onInputUp){this.onInputUp.dispatch(this,s,r)}if(this.freezeFrames){return}if(this.forceOut){this.changeStateFrame(a)}else{var q=this.changeStateFrame(k);if(!q){if(r){this.changeStateFrame(n)}else{this.changeStateFrame(a)}}}};g.SpriteBatch=function(q,s,r,p){if(typeof s==="undefined"||s===null){s=q.world}PIXI.SpriteBatch.call(this);g.Group.call(this,q,s,r,p);this.type=g.SPRITEBATCH};g.SpriteBatch.prototype=g.Utils.extend(true,g.SpriteBatch.prototype,g.Group.prototype,PIXI.SpriteBatch.prototype);g.SpriteBatch.prototype.constructor=g.SpriteBatch;g.Particle=function(q,p,t,r,s){g.Sprite.call(this,q,p,t,r,s);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};g.Particle.prototype=Object.create(g.Sprite.prototype);g.Particle.prototype.constructor=g.Particle;g.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};g.Particle.prototype.onEmit=function(){};g.Particle.prototype.setAlphaData=function(p){this.alphaData=p;this._a=p.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};g.Particle.prototype.setScaleData=function(p){this.scaleData=p;this._s=p.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};g.Particle.prototype.reset=function(p,r,q){g.Component.Reset.prototype.reset.call(this,p,r,q);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};g.BitmapData=function(q,r,s,p){if(typeof s==="undefined"){s=256}if(typeof p==="undefined"){p=256}this.game=q;this.key=r;this.width=s;this.height=p;this.canvas=g.Canvas.create(s,p,"",true);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.imageData=this.context.getImageData(0,0,s,p);this.data=this.imageData.data;this.pixels=null;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new g.Frame(0,0,0,s,p,"bitmapData",q.rnd.uuid());this.texture.frame=this.textureFrame;this.type=g.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new g.Point();this._size=new g.Point();this._scale=new g.Point();this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new g.Point();this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new g.Circle()};g.BitmapData.prototype={add:function(p){if(Array.isArray(p)){for(var q=0;q<p.length;q++){if(p[q]["loadTexture"]){p[q].loadTexture(this)}}}else{p.loadTexture(this)}return this},load:function(p){if(typeof p==="string"){p=this.game.cache.getImage(p)}if(p){this.resize(p.width,p.height);this.cls()}else{return}this.draw(p);this.update();return this},clear:function(){this.context.clearRect(0,0,this.width,this.height);this.dirty=true;return this},fill:function(t,s,p,q){if(typeof q==="undefined"){q=1}this.context.fillStyle="rgba("+t+","+s+","+p+","+q+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},resize:function(q,p){if(q!==this.width||p!==this.height){this.width=q;this.height=p;this.canvas.width=q;this.canvas.height=p;this.baseTexture.width=q;this.baseTexture.height=p;this.textureFrame.width=q;this.textureFrame.height=p;this.texture.width=q;this.texture.height=p;this.texture.crop.width=q;this.texture.crop.height=p;this.update();this.dirty=true}return this},update:function(q,s,r,p){if(typeof q==="undefined"){q=0}if(typeof s==="undefined"){s=0}if(typeof r==="undefined"){r=this.width}if(typeof p==="undefined"){p=this.height}this.imageData=this.context.getImageData(q,s,r,p);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(C,s,A,z,r,D){if(typeof A==="undefined"){A=0}if(typeof z==="undefined"){z=0}if(typeof r==="undefined"){r=this.width}if(typeof D==="undefined"){D=this.height}var B=A+r;var v=z+D;var q=g.Color.createColor();var E={r:0,g:0,b:0,a:0};var p=false;for(var t=z;t<v;t++){for(var u=A;u<B;u++){g.Color.unpackPixel(this.getPixel32(u,t),q);E=C.call(s,q,u,t);if(E!==false&&E!==null&&E!==undefined){this.setPixel32(u,t,E.r,E.g,E.b,E.a,false);p=true}}}if(p){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(C,s,A,z,r,D){if(typeof A==="undefined"){A=0}if(typeof z==="undefined"){z=0}if(typeof r==="undefined"){r=this.width}if(typeof D==="undefined"){D=this.height}var B=A+r;var v=z+D;var q=0;var E=0;var p=false;for(var t=z;t<v;t++){for(var u=A;u<B;u++){q=this.getPixel32(u,t);E=C.call(s,q,u,t);if(E!==q){this.pixels[t*this.width+u]=E;p=true}}}if(p){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(u,q,F,s,t,H,C,r,B){var E=0;var A=0;var G=this.width;var v=this.height;var p=g.Color.packPixel(u,q,F,s);if(B!==undefined&&B instanceof g.Rectangle){E=B.x;A=B.y;G=B.width;v=B.height}for(var z=0;z<v;z++){for(var D=0;D<G;D++){if(this.getPixel32(E+D,A+z)===p){this.setPixel32(E+D,A+z,t,H,C,r,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(u,t,q,v){if(typeof u==="undefined"||u===null){u=false}if(typeof t==="undefined"||t===null){t=false}if(typeof q==="undefined"||q===null){q=false}if(!u&&!t&&!q){return}if(typeof v==="undefined"){v=new g.Rectangle(0,0,this.width,this.height)}var r=g.Color.createColor();for(var w=v.y;w<v.bottom;w++){for(var p=v.x;p<v.right;p++){g.Color.unpackPixel(this.getPixel32(p,w),r,true);if(u){r.h=u}if(t){r.s=t}if(q){r.l=q}g.Color.HSLtoRGB(r.h,r.s,r.l,r);this.setPixel32(p,w,r.r,r.g,r.b,r.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(u,t,q,v){if(typeof u==="undefined"||u===null){u=false}if(typeof t==="undefined"||t===null){t=false}if(typeof q==="undefined"||q===null){q=false}if(!u&&!t&&!q){return}if(typeof v==="undefined"){v=new g.Rectangle(0,0,this.width,this.height)}var r=g.Color.createColor();for(var w=v.y;w<v.bottom;w++){for(var p=v.x;p<v.right;p++){g.Color.unpackPixel(this.getPixel32(p,w),r,true);if(u){r.h=this.game.math.wrap(r.h+u,0,1)}if(t){r.s=this.game.math.limitValue(r.s+t,0,1)}if(q){r.l=this.game.math.limitValue(r.l+q,0,1)}g.Color.HSLtoRGB(r.h,r.s,r.l,r);this.setPixel32(p,w,r.r,r.g,r.b,r.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(q,v,u,s,p,t,r){if(typeof r==="undefined"){r=true}if(q>=0&&q<=this.width&&v>=0&&v<=this.height){if(g.Device.LITTLE_ENDIAN){this.pixels[v*this.width+q]=(t<<24)|(p<<16)|(s<<8)|u}else{this.pixels[v*this.width+q]=(u<<24)|(s<<16)|(p<<8)|t}if(r){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(q,u,t,s,p,r){return this.setPixel32(q,u,t,s,p,255,r)},getPixel:function(p,s,r){if(!r){r=g.Color.createColor()}var q=~~(p+(s*this.width));q*=4;r.r=this.data[q];r.g=this.data[++q];r.b=this.data[++q];r.a=this.data[++q];return r},getPixel32:function(p,q){if(p>=0&&p<=this.width&&q>=0&&q<=this.height){return this.pixels[q*this.width+p]}},getPixelRGB:function(p,t,s,q,r){return g.Color.unpackPixel(this.getPixel32(p,t),s,q,r)},getPixels:function(p){return this.context.getImageData(p.x,p.y,p.width,p.height)},getFirstPixel:function(t){if(typeof t==="undefined"){t=0}var s=g.Color.createColor();var p=0;var u=0;var r=1;var q=false;if(t===1){r=-1;u=this.height}else{if(t===3){r=-1;p=this.width}}do{g.Color.unpackPixel(this.getPixel32(p,u),s);if(t===0||t===1){p++;if(p===this.width){p=0;u+=r;if(u>=this.height||u<=0){q=true}}}else{if(t===2||t===3){u++;if(u===this.height){u=0;p+=r;if(p>=this.width||p<=0){q=true}}}}}while(s.a===0&&!q);s.x=p;s.y=u;return s},getBounds:function(p){if(typeof p==="undefined"){p=new g.Rectangle()}p.x=this.getFirstPixel(2).x;if(p.x===this.width){return p.setTo(0,0,0,0)}p.y=this.getFirstPixel(0).y;p.width=(this.getFirstPixel(3).x-p.x)+1;p.height=(this.getFirstPixel(1).y-p.y)+1;return p},addToWorld:function(q,v,p,u,s,r){s=s||1;r=r||1;var t=this.game.add.image(q,v,this);t.anchor.set(p,u);t.scale.set(s,r);return t},copy:function(q,E,D,r,H,A,w,z,p,v,t,s,G,F,u,C,B){if(typeof q==="undefined"||q===null){q=this}this._image=q;if(q instanceof g.Sprite||q instanceof g.Image||q instanceof g.Text){this._pos.set(q.texture.crop.x,q.texture.crop.y);this._size.set(q.texture.crop.width,q.texture.crop.height);this._scale.set(q.scale.x,q.scale.y);this._anchor.set(q.anchor.x,q.anchor.y);this._rotate=q.rotation;this._alpha.current=q.alpha;this._image=q.texture.baseTexture.source;if(typeof A==="undefined"||A===null){A=q.x}if(typeof w==="undefined"||w===null){w=q.y}if(q.texture.trim){A+=q.texture.trim.x-q.anchor.x*q.texture.trim.width;w+=q.texture.trim.y-q.anchor.y*q.texture.trim.height}if(q.tint!==16777215){if(q.cachedTint!==q.tint){q.cachedTint=q.tint;q.tintedTexture=PIXI.CanvasTinter.getTintedTexture(q,q.tint)}this._image=q.tintedTexture}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(q instanceof g.BitmapData){this._image=q.canvas}else{if(typeof q==="string"){q=this.game.cache.getImage(q);if(q===null){return}else{this._image=q}}}this._size.set(this._image.width,this._image.height)}if(typeof E==="undefined"||E===null){E=0}if(typeof D==="undefined"||D===null){D=0}if(r){this._size.x=r}if(H){this._size.y=H}if(typeof A==="undefined"||A===null){A=E}if(typeof w==="undefined"||w===null){w=D}if(typeof z==="undefined"||z===null){z=this._size.x}if(typeof p==="undefined"||p===null){p=this._size.y}if(typeof v==="number"){this._rotate=v}if(typeof t==="number"){this._anchor.x=t}if(typeof s==="number"){this._anchor.y=s}if(typeof G==="number"){this._scale.x=G}if(typeof F==="number"){this._scale.y=F}if(typeof u==="number"){this._alpha.current=u}if(typeof C==="undefined"){C=null}if(typeof B==="undefined"){B=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}this._alpha.prev=this.context.globalAlpha;this.context.save();this.context.globalAlpha=this._alpha.current;if(C){this.context.globalCompositeOperation=C}if(B){A|=0;w|=0}this.context.translate(A,w);this.context.scale(this._scale.x,this._scale.y);this.context.rotate(this._rotate);this.context.drawImage(this._image,this._pos.x+E,this._pos.y+D,this._size.x,this._size.y,-z*this._anchor.x,-p*this._anchor.y,z,p);this.context.restore();this.context.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(t,s,p,v,u,r,q){return this.copy(t,s.x,s.y,s.width,s.height,p,v,s.width,s.height,0,0,0,1,1,u,r,q)},draw:function(u,q,v,t,p,s,r){return this.copy(u,null,null,null,null,q,v,t,p,null,null,null,null,null,null,s,r)},drawGroup:function(r,q,p){if(r.total>0){r.forEachExists(this.copy,this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,q,p)}return this},shadow:function(q,r,p,s){if(typeof q==="undefined"||q===null){this.context.shadowColor="rgba(0,0,0,0)"}else{this.context.shadowColor=q;this.context.shadowBlur=r||5;this.context.shadowOffsetX=p||10;this.context.shadowOffsetY=s||10}},alphaMask:function(s,p,q,r){if(typeof r==="undefined"||r===null){this.draw(p).blendSourceAtop()}else{this.draw(p,r.x,r.y,r.width,r.height).blendSourceAtop()}if(typeof q==="undefined"||q===null){this.draw(s).blendReset()}else{this.draw(s,q.x,q.y,q.width,q.height).blendReset()}return this},extract:function(v,p,t,w,x,q,s,y,u){if(typeof x==="undefined"){x=255}if(typeof q==="undefined"){q=false}if(typeof s==="undefined"){s=p}if(typeof y==="undefined"){y=t}if(typeof u==="undefined"){u=w}if(q){v.resize(this.width,this.height)}this.processPixelRGB(function(z,r,A){if(z.r===p&&z.g===t&&z.b===w){v.setPixel32(r,A,s,y,u,x,false)}return false},this);v.context.putImageData(v.imageData,0,0);v.dirty=true;return v},rect:function(q,t,s,p,r){if(typeof r!=="undefined"){this.context.fillStyle=r}this.context.fillRect(q,t,s,p);return this},text:function(t,p,v,r,q,u){if(typeof p==="undefined"){p=0}if(typeof v==="undefined"){v=0}if(typeof r==="undefined"){r="14px Courier"}if(typeof q==="undefined"){q="rgb(255,255,255)"}if(typeof u==="undefined"){u=true}var s=this.context.font;this.context.font=r;if(u){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(t,p+1,v+1)}this.context.fillStyle=q;this.context.fillText(t,p,v);this.context.font=s},circle:function(q,s,p,r){if(typeof r!=="undefined"){this.context.fillStyle=r}this.context.beginPath();this.context.arc(q,s,p,0,Math.PI*2,false);this.context.closePath();this.context.fill();return this},textureLine:function(p,s,r){if(typeof r==="undefined"){r="repeat-x"}if(typeof s==="string"){s=this.game.cache.getImage(s);if(!s){return}}var q=p.length;if(r==="no-repeat"&&q>s.width){q=s.width}this.context.fillStyle=this.context.createPattern(s,r);this._circle=new g.Circle(p.start.x,p.start.y,s.height);this._circle.circumferencePoint(p.angle-1.5707963267948966,false,this._pos);this.context.save();this.context.translate(this._pos.x,this._pos.y);this.context.rotate(p.angle);this.context.fillRect(0,0,q,s.height);this.context.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},blendReset:function(){this.context.globalCompositeOperation="source-over";return this},blendSourceOver:function(){this.context.globalCompositeOperation="source-over";return this},blendSourceIn:function(){this.context.globalCompositeOperation="source-in";return this},blendSourceOut:function(){this.context.globalCompositeOperation="source-out";return this},blendSourceAtop:function(){this.context.globalCompositeOperation="source-atop";return this},blendDestinationOver:function(){this.context.globalCompositeOperation="destination-over";return this},blendDestinationIn:function(){this.context.globalCompositeOperation="destination-in";return this},blendDestinationOut:function(){this.context.globalCompositeOperation="destination-out";return this},blendDestinationAtop:function(){this.context.globalCompositeOperation="destination-atop";return this},blendXor:function(){this.context.globalCompositeOperation="xor";return this},blendAdd:function(){this.context.globalCompositeOperation="lighter";return this},blendMultiply:function(){this.context.globalCompositeOperation="multiply";return this},blendScreen:function(){this.context.globalCompositeOperation="screen";return this},blendOverlay:function(){this.context.globalCompositeOperation="overlay";return this},blendDarken:function(){this.context.globalCompositeOperation="darken";return this},blendLighten:function(){this.context.globalCompositeOperation="lighten";return this},blendColorDodge:function(){this.context.globalCompositeOperation="color-dodge";return this},blendColorBurn:function(){this.context.globalCompositeOperation="color-burn";return this},blendHardLight:function(){this.context.globalCompositeOperation="hard-light";return this},blendSoftLight:function(){this.context.globalCompositeOperation="soft-light";return this},blendDifference:function(){this.context.globalCompositeOperation="difference";return this},blendExclusion:function(){this.context.globalCompositeOperation="exclusion";return this},blendHue:function(){this.context.globalCompositeOperation="hue";return this},blendSaturation:function(){this.context.globalCompositeOperation="saturation";return this},blendColor:function(){this.context.globalCompositeOperation="color";return this},blendLuminosity:function(){this.context.globalCompositeOperation="luminosity";return this}};Object.defineProperty(g.BitmapData.prototype,"smoothed",{get:function(){g.Canvas.getSmoothingEnabled(this.context)},set:function(p){g.Canvas.setSmoothingEnabled(this.context,p)}});g.BitmapData.getTransform=function(u,t,r,p,s,q){if(typeof u!=="number"){u=0}if(typeof t!=="number"){t=0}if(typeof r!=="number"){r=1}if(typeof p!=="number"){p=1}if(typeof s!=="number"){s=0}if(typeof q!=="number"){q=0}return{sx:r,sy:p,scaleX:r,scaleY:p,skewX:s,skewY:q,translateX:u,translateY:t,tx:u,ty:t}};g.BitmapData.prototype.constructor=g.BitmapData;g.Graphics=function(q,p,r){p=p||0;r=r||0;this.type=g.GRAPHICS;this.physicsType=g.SPRITE;PIXI.Graphics.call(this);g.Component.Core.init.call(this,q,p,r,"",null)};g.Graphics.prototype=Object.create(PIXI.Graphics.prototype);g.Graphics.prototype.constructor=g.Graphics;g.Component.Core.install.call(g.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);g.Graphics.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Graphics.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Graphics.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Graphics.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Graphics.prototype.destroy=function(p){this.clear();g.Component.Destroy.prototype.destroy.call(this,p)};g.Graphics.prototype.drawTriangle=function(r,q){if(typeof q==="undefined"){q=false}var v=new g.Polygon(r);if(q){var t=new g.Point(this.game.camera.x-r[0].x,this.game.camera.y-r[0].y);var s=new g.Point(r[1].x-r[0].x,r[1].y-r[0].y);var p=new g.Point(r[1].x-r[2].x,r[1].y-r[2].y);var u=p.cross(s);if(t.dot(u)>0){this.drawPolygon(v)}}else{this.drawPolygon(v)}};g.Graphics.prototype.drawTriangles=function(r,w,p){if(typeof p==="undefined"){p=false}var v=new g.Point();var t=new g.Point();var q=new g.Point();var u=[];var s;if(!w){if(r[0] instanceof g.Point){for(s=0;s<r.length/3;s++){this.drawTriangle([r[s*3],r[s*3+1],r[s*3+2]],p)}}else{for(s=0;s<r.length/6;s++){v.x=r[s*6+0];v.y=r[s*6+1];t.x=r[s*6+2];t.y=r[s*6+3];q.x=r[s*6+4];q.y=r[s*6+5];this.drawTriangle([v,t,q],p)}}}else{if(r[0] instanceof g.Point){for(s=0;s<w.length/3;s++){u.push(r[w[s*3]]);u.push(r[w[s*3+1]]);u.push(r[w[s*3+2]]);if(u.length===3){this.drawTriangle(u,p);u=[]}}}else{for(s=0;s<w.length;s++){v.x=r[w[s]*2];v.y=r[w[s]*2+1];u.push(v.copyTo({}));if(u.length===3){this.drawTriangle(u,p);u=[]}}}}};g.RenderTexture=function(q,u,p,s,t,r){if(typeof s==="undefined"){s=""}if(typeof t==="undefined"){t=g.scaleModes.DEFAULT}if(typeof r==="undefined"){r=1}this.game=q;this.key=s;this.type=g.RENDERTEXTURE;this.matrix=new PIXI.Matrix();PIXI.RenderTexture.call(this,u,p,this.game.renderer,t,r);this.render=g.RenderTexture.prototype.render};g.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);g.RenderTexture.prototype.constructor=g.RenderTexture;g.RenderTexture.prototype.renderXY=function(r,q,s,p){this.matrix.tx=q;this.matrix.ty=s;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this.matrix,p)}else{this.renderCanvas(r,this.matrix,p)}};g.RenderTexture.prototype.render=function(r,q,p){this.matrix.tx=q.x;this.matrix.ty=q.y;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this.matrix,p)}else{this.renderCanvas(r,this.matrix,p)}};g.Text=function(q,p,t,s,r){p=p||0;t=t||0;s=s||" ";r=r||{};if(s.length===0){s=" "}else{s=s.toString()}this.type=g.TEXT;this.physicsType=g.SPRITE;this.padding=new g.Point();this._text=s;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this.colors=[];this.setStyle(r);PIXI.Text.call(this,s,this.style);g.Component.Core.init.call(this,q,p,t,"",null);if(s!==" "){this.updateText()}};g.Text.prototype=Object.create(PIXI.Text.prototype);g.Text.prototype.constructor=g.Text;g.Component.Core.install.call(g.Text.prototype,["Angle","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","Overlap","PhysicsBody","Reset","Smoothed"]);g.Text.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Text.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Text.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Text.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Text.prototype.update=function(){};g.Text.prototype.destroy=function(p){this.texture.destroy(true);if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}g.Component.Destroy.prototype.destroy.call(this,p)};g.Text.prototype.setShadow=function(p,s,q,r){if(typeof p==="undefined"){p=0}if(typeof s==="undefined"){s=0}if(typeof q==="undefined"){q="rgba(0, 0, 0, 1)"}if(typeof r==="undefined"){r=0}this.style.shadowOffsetX=p;this.style.shadowOffsetY=s;this.style.shadowColor=q;this.style.shadowBlur=r;this.dirty=true};g.Text.prototype.setStyle=function(p){p=p||{};p.font=p.font||"bold 20pt Arial";p.backgroundColor=p.backgroundColor||null;p.fill=p.fill||"black";p.align=p.align||"left";p.stroke=p.stroke||"black";p.strokeThickness=p.strokeThickness||0;p.wordWrap=p.wordWrap||false;p.wordWrapWidth=p.wordWrapWidth||100;p.shadowOffsetX=p.shadowOffsetX||0;p.shadowOffsetY=p.shadowOffsetY||0;p.shadowColor=p.shadowColor||"rgba(0,0,0,0)";p.shadowBlur=p.shadowBlur||0;var q=this.fontToComponents(p.font);if(p.fontStyle){q.fontStyle=p.fontStyle}if(p.fontVariant){q.fontVariant=p.fontVariant}if(p.fontWeight){q.fontWeight=p.fontWeight}if(p.fontSize){if(typeof p.fontSize==="number"){p.fontSize=p.fontSize+"px"}q.fontSize=p.fontSize}this._fontComponents=q;p.font=this.componentsToFont(this._fontComponents);this.style=p;this.dirty=true};g.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;this.context.font=this.style.font;var u=this.text;if(this.style.wordWrap){u=this.runWordWrap(this.text)}var B=u.split(/(?:\r\n|\r|\n)/);var t=[];var C=0;var q=this.determineFontProperties(this.style.font);for(var v=0;v<B.length;v++){var w=this.context.measureText(B[v]).width+this.padding.x;t[v]=w;C=Math.max(C,w)}var r=C+this.style.strokeThickness;this.canvas.width=r*this.resolution;var z=q.fontSize+this.style.strokeThickness+this.padding.y;var A=z*B.length;var x=this._lineSpacing;if(x<0&&Math.abs(x)>z){x=-z}if(x!==0){var y=x*(B.length-1);A+=y}this.canvas.height=A*this.resolution;this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var s;var p;this._charCount=0;for(v=0;v<B.length;v++){s=this.style.strokeThickness/2;p=(this.style.strokeThickness/2+v*z)+q.ascent;if(v>0){p+=(x*v)}if(this.style.align==="right"){s+=C-t[v]}else{if(this.style.align==="center"){s+=(C-t[v])/2}}if(this.colors.length>0){this.updateLine(B[v],s,p)}else{if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(B[v],s,p)}if(this.style.fill){this.context.fillText(B[v],s,p)}}}this.updateTexture()};g.Text.prototype.updateLine=function(q,p,t){for(var r=0;r<q.length;r++){var s=q[r];if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount];this.context.strokeStyle=this.colors[this._charCount]}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(s,p,t)}if(this.style.fill){this.context.fillText(s,p,t)}p+=this.context.measureText(s).width;this._charCount++}};g.Text.prototype.clearColors=function(){this.colors=[];this.dirty=true};g.Text.prototype.addColor=function(q,p){this.colors[p]=q;this.dirty=true};g.Text.prototype.runWordWrap=function(u){var x="";var w=u.split("\n");for(var r=0;r<w.length;r++){var q=this.style.wordWrapWidth;var t=w[r].split(" ");for(var p=0;p<t.length;p++){var v=this.context.measureText(t[p]).width;var s=v+this.context.measureText(" ").width;if(s>q){if(p>0){x+="\n"}x+=t[p]+" ";q=this.style.wordWrapWidth-v}else{q-=s;x+=t[p]+" "}}if(r<w.length-1){x+="\n"}}return x};g.Text.prototype.updateFont=function(q){var p=this.componentsToFont(q);if(this.style.font!==p){this.style.font=p;this.dirty=true;if(this.parent){this.updateTransform()}}};g.Text.prototype.fontToComponents=function(q){var p=q.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(p){return{font:q,fontStyle:p[1]||"normal",fontVariant:p[2]||"normal",fontWeight:p[3]||"normal",fontSize:p[4]||"medium",fontFamily:p[5]}}else{console.warn("Phaser.Text - unparsable CSS font: "+q);return{font:q}}};g.Text.prototype.componentsToFont=function(q){var r=[];var p;p=q.fontStyle;if(p&&p!=="normal"){r.push(p)}p=q.fontVariant;if(p&&p!=="normal"){r.push(p)}p=q.fontWeight;if(p&&p!=="normal"){r.push(p)}p=q.fontSize;if(p&&p!=="medium"){r.push(p)}p=q.fontFamily;if(p){r.push(p)}if(!r.length){r.push(q.font)}return r.join(" ")};Object.defineProperty(g.Text.prototype,"text",{get:function(){return this._text},set:function(p){if(p!==this._text){this._text=p.toString()||" ";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(g.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(p){p=p||"bold 20pt Arial";this._fontComponents=this.fontToComponents(p);this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(p){p=p||"Arial";p=p.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(p)&&!/['",]/.exec(p)){p="'"+p+"'"}this._fontComponents.fontFamily=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontSize",{get:function(){var p=this._fontComponents.fontSize;if(p&&/(?:^0$|px$)/.exec(p)){return parseInt(p,10)}else{return p}},set:function(p){p=p||"0";if(typeof p==="number"){p=p+"px"}this._fontComponents.fontSize=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontWeight=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontStyle=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontVariant=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(p){if(p!==this.style.fill){this.style.fill=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"align",{get:function(){return this.style.align},set:function(p){if(p!==this.style.align){this.style.align=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(p){if(p!==this.style.stroke){this.style.stroke=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(p){if(p!==this.style.strokeThickness){this.style.strokeThickness=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(p){if(p!==this.style.wordWrap){this.style.wordWrap=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(p){if(p!==this.style.wordWrapWidth){this.style.wordWrapWidth=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(p){if(p!==this._lineSpacing){this._lineSpacing=parseFloat(p);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(g.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(p){if(p!==this.style.shadowOffsetX){this.style.shadowOffsetX=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(p){if(p!==this.style.shadowOffsetY){this.style.shadowOffsetY=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(p){if(p!==this.style.shadowColor){this.style.shadowColor=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(p){if(p!==this.style.shadowBlur){this.style.shadowBlur=p;this.dirty=true}}});g.BitmapText=function(r,p,u,q,t,s){p=p||0;u=u||0;q=q||"";t=t||"";s=s||32;this.type=g.BITMAPTEXT;this.physicsType=g.SPRITE;this._text=t;this._font=q;this._fontSize=s;this._align="left";this._tint=16777215;this._tw=0;this._th=0;PIXI.BitmapText.call(this,t);g.Component.Core.init.call(this,r,p,u,"",null)};g.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);g.BitmapText.prototype.constructor=g.BitmapText;g.Component.Core.install.call(g.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);g.BitmapText.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.BitmapText.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.BitmapText.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.BitmapText.prototype.preUpdateCore=g.Component.Core.preUpdate;g.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.BitmapText.prototype.postUpdate=function(){g.Component.PhysicsBody.postUpdate.call(this);g.Component.FixedToCamera.postUpdate.call(this);if(this.body&&((this.textWidth!==this._tw)||(this.textHeight!==this._th))){this.body.setSize(this.textWidth,this.textHeight);this._tw=this.textWidth;this._th=this.textHeight}};g.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=true};Object.defineProperty(g.BitmapText.prototype,"align",{get:function(){return this._align},set:function(p){if(p!==this._align){this._align=p;this.setStyle()}}});Object.defineProperty(g.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(p){if(p!==this._tint){this._tint=p;this.dirty=true}}});Object.defineProperty(g.BitmapText.prototype,"font",{get:function(){return this._font},set:function(p){if(p!==this._font){this._font=p.trim();this.fontName=this._font;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(g.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(p){p=parseInt(p,10);if(p!==this._fontSize){this._fontSize=p;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(g.BitmapText.prototype,"text",{get:function(){return this._text},set:function(p){if(p!==this._text){this._text=p.toString()||" ";this.dirty=true}}});g.RetroFont=function(F,E,s,x,B,D,C,z,y,w){if(!F.cache.checkImageKey(E)){return false}if(typeof D==="undefined"||D===null){D=F.cache.getImage(E).width/s}this.characterWidth=s;this.characterHeight=x;this.characterSpacingX=C||0;this.characterSpacingY=z||0;this.characterPerRow=D;this.offsetX=y||0;this.offsetY=w||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=F.cache.getImage(E);this._text="";this.grabData=[];this.frameData=new g.FrameData();var v=this.offsetX;var u=this.offsetY;var q=0;for(var A=0;A<B.length;A++){var p=F.rnd.uuid();var t=this.frameData.addFrame(new g.Frame(A,v,u,this.characterWidth,this.characterHeight,"",p));this.grabData[B.charCodeAt(A)]=t.index;PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[E],{x:v,y:u,width:this.characterWidth,height:this.characterHeight});q++;if(q==this.characterPerRow){q=0;v=this.offsetX;u+=this.characterHeight+this.characterSpacingY}else{v+=this.characterWidth+this.characterSpacingX}}F.cache.updateFrameData(E,this.frameData);this.stamp=new g.Image(F,0,0,E,0);g.RenderTexture.call(this,F,100,100,"",g.scaleModes.NEAREST);this.type=g.RETROFONT};g.RetroFont.prototype=Object.create(g.RenderTexture.prototype);g.RetroFont.prototype.constructor=g.RetroFont;g.RetroFont.ALIGN_LEFT="left";g.RetroFont.ALIGN_RIGHT="right";g.RetroFont.ALIGN_CENTER="center";g.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";g.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";g.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";g.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";g.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";g.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";g.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";g.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";g.RetroFont.prototype.setFixedWidth=function(q,p){if(typeof p==="undefined"){p="left"}this.fixedWidth=q;this.align=p};g.RetroFont.prototype.setText=function(s,t,r,u,q,p){this.multiLine=t||false;this.customSpacingX=r||0;this.customSpacingY=u||0;this.align=q||"left";if(p){this.autoUpperCase=false}else{this.autoUpperCase=true}if(s.length>0){this.text=s}};g.RetroFont.prototype.buildRetroFontText=function(){var p=0;var s=0;this.clear();if(this.multiLine){var q=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,(q.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(q.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var r=0;r<q.length;r++){switch(this.align){case g.RetroFont.ALIGN_LEFT:p=0;break;case g.RetroFont.ALIGN_RIGHT:p=this.width-(q[r].length*(this.characterWidth+this.customSpacingX));break;case g.RetroFont.ALIGN_CENTER:p=(this.width/2)-((q[r].length*(this.characterWidth+this.customSpacingX))/2);p+=this.customSpacingX/2;break}if(p<0){p=0}this.pasteLine(q[r],p,s,this.customSpacingX);s+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}switch(this.align){case g.RetroFont.ALIGN_LEFT:p=0;break;case g.RetroFont.ALIGN_RIGHT:p=this.width-(this._text.length*(this.characterWidth+this.customSpacingX));break;case g.RetroFont.ALIGN_CENTER:p=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);p+=this.customSpacingX/2;break}this.textureBuffer.clear();this.pasteLine(this._text,p,0,this.customSpacingX)}};g.RetroFont.prototype.pasteLine=function(r,q,v,s){var t=new g.Point();for(var u=0;u<r.length;u++){if(r.charAt(u)==" "){q+=this.characterWidth+s}else{if(this.grabData[r.charCodeAt(u)]>=0){this.stamp.frame=this.grabData[r.charCodeAt(u)];t.set(q,v);this.render(this.stamp,t,false);q+=this.characterWidth+s;if(q>this.width){break}}}}};g.RetroFont.prototype.getLongestLine=function(){var q=0;if(this._text.length>0){var p=this._text.split("\n");for(var r=0;r<p.length;r++){if(p[r].length>q){q=p[r].length}}}return q};g.RetroFont.prototype.removeUnsupportedCharacters=function(s){var q="";for(var t=0;t<this._text.length;t++){var p=this._text[t];var r=p.charCodeAt(0);if(this.grabData[r]>=0||(!s&&p==="\n")){q=q.concat(p)}}return q};g.RetroFont.prototype.updateOffset=function(p,u){if(this.offsetX===p&&this.offsetY===u){return}var r=p-this.offsetX;var q=u-this.offsetY;var t=this.game.cache.getFrameData(this.stamp.key).getFrames();var s=t.length;while(s--){t[s].x+=r;t[s].y+=q;PIXI.TextureCache[t[s].uuid].frame.x=t[s].x;PIXI.TextureCache[t[s].uuid].frame.y=t[s].y}this.buildRetroFontText()};Object.defineProperty(g.RetroFont.prototype,"text",{get:function(){return this._text},set:function(q){var p;if(this.autoUpperCase){p=q.toUpperCase()}else{p=q}if(p!==this._text){this._text=p;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(g.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(p){this.stamp.smoothed=p;this.buildRetroFontText()}});g.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=false;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};g.Device=new g.Device();g.Device.onInitialized=new g.Signal();g.Device.whenReady=function(u,r,q){var s=this._readyCheck;if(this.deviceReadyAt||!s){u.call(r,this)}else{if(s._monitor||q){s._queue=s._queue||[];s._queue.push([u,r])}else{s._monitor=s.bind(this);s._queue=s._queue||[];s._queue.push([u,r]);var t=typeof window.cordova!=="undefined";var p=navigator.isCocoonJS;if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(s._monitor,0)}else{if(t&&!p){document.addEventListener("deviceready",s._monitor,false)}else{document.addEventListener("DOMContentLoaded",s._monitor,false);window.addEventListener("load",s._monitor,false)}}}}};g.Device._readyCheck=function(){var q=this._readyCheck;if(!document.body){window.setTimeout(q._monitor,20)}else{if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",q._monitor);document.removeEventListener("DOMContentLoaded",q._monitor);window.removeEventListener("load",q._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var r;while((r=q._queue.shift())){var s=r[0];var p=r[1];s.call(p,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}}};g.Device._initialize=function(){var s=this;function r(){var B=navigator.userAgent;if(/Playstation Vita/.test(B)){s.vita=true}else{if(/Kindle/.test(B)||/\bKF[A-Z][A-Z]+/.test(B)||/Silk.*Mobile Safari/.test(B)){s.kindle=true}else{if(/Android/.test(B)){s.android=true}else{if(/CrOS/.test(B)){s.chromeOS=true}else{if(/iP[ao]d|iPhone/i.test(B)){s.iOS=true}else{if(/Linux/.test(B)){s.linux=true}else{if(/Mac OS/.test(B)){s.macOS=true}else{if(/Windows/.test(B)){s.windows=true;if(/Windows Phone/i.test(B)){s.windowsPhone=true}}}}}}}}}var A=/Silk/.test(B);if(s.windows||s.macOS||(s.linux&&!A)||s.chromeOS){s.desktop=true}if(s.windowsPhone||((/Windows NT/i.test(B))&&(/Touch/i.test(B)))){s.desktop=false}}function z(){s.canvas=!!window.CanvasRenderingContext2D||s.cocoonJS;try{s.localStorage=!!localStorage.getItem}catch(A){s.localStorage=false}s.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;s.fileSystem=!!window.requestFileSystem;s.webGL=(function(){try{var B=document.createElement("canvas");B.screencanvas=false;return !!window.WebGLRenderingContext&&(B.getContext("webgl")||B.getContext("experimental-webgl"))}catch(C){return false}})();s.webGL=!!s.webGL;s.worker=!!window.Worker;s.pointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;s.quirksMode=(document.compatMode==="CSS1Compat")?false:true;s.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);if(!s.iOS&&(s.ie||s.firefox||s.chrome)){s.canvasBitBltShift=true}if(s.safari||s.mobileSafari){s.canvasBitBltShift=false}}function y(){if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)){s.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){s.mspointer=true}if(!s.cocoonJS){if("onwheel" in window||(s.ie&&"WheelEvent" in window)){s.wheelEvent="wheel"}else{if("onmousewheel" in window){s.wheelEvent="mousewheel"}else{if(s.firefox&&"MouseScrollEvent" in window){s.wheelEvent="DOMMouseScroll"}}}}}function w(){var B=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var D=document.createElement("div");for(var C=0;C<B.length;C++){if(D[B[C]]){s.fullscreen=true;s.requestFullscreen=B[C];break}}var A=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(s.fullscreen){for(var C=0;C<A.length;C++){if(document[A[C]]){s.cancelFullscreen=A[C];break}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){s.fullscreenKeyboard=true}}function x(){var B=navigator.userAgent;if(/Arora/.test(B)){s.arora=true}else{if(/Chrome/.test(B)){s.chrome=true}else{if(/Epiphany/.test(B)){s.epiphany=true}else{if(/Firefox/.test(B)){s.firefox=true}else{if(/AppleWebKit/.test(B)&&s.iOS){s.mobileSafari=true}else{if(/MSIE (\d+\.\d+);/.test(B)){s.ie=true;s.ieVersion=parseInt(RegExp.$1,10)}else{if(/Midori/.test(B)){s.midori=true}else{if(/Opera/.test(B)){s.opera=true}else{if(/Safari/.test(B)){s.safari=true}else{if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(B)){s.ie=true;s.trident=true;s.tridentVersion=parseInt(RegExp.$1,10);s.ieVersion=parseInt(RegExp.$3,10)}}}}}}}}}}if(/Silk/.test(B)){s.silk=true}if(navigator.standalone){s.webApp=true}if(typeof window.cordova!=="undefined"){s.cordova=true}if(typeof process!=="undefined"&&typeof require!=="undefined"){s.node=true}if(s.node){try{s.nodeWebkit=(typeof require("nw.gui")!=="undefined")}catch(A){s.nodeWebkit=false}}if(navigator.isCocoonJS){s.cocoonJS=true}if(s.cocoonJS){try{s.cocoonJSApp=(typeof CocoonJS!=="undefined")}catch(A){s.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){s.ejecta=true}if(/Crosswalk/.test(B)){s.crosswalk=true}}function v(){s.audioData=!!(window.Audio);s.webAudio=!!(window.AudioContext||window.webkitAudioContext);var C=document.createElement("audio");var A=false;try{if(A=!!C.canPlayType){if(C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){s.ogg=true}if(C.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||C.canPlayType("audio/opus;").replace(/^no$/,"")){s.opus=true}if(C.canPlayType("audio/mpeg;").replace(/^no$/,"")){s.mp3=true}if(C.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){s.wav=true}if(C.canPlayType("audio/x-m4a;")||C.canPlayType("audio/aac;").replace(/^no$/,"")){s.m4a=true}if(C.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){s.webm=true}}}catch(B){}}function p(){s.pixelRatio=window.devicePixelRatio||1;s.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;s.iPhone4=(s.pixelRatio==2&&s.iPhone);s.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;if(typeof Int8Array!=="undefined"){s.typedArray=true}else{s.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){s.littleEndian=u();s.LITTLE_ENDIAN=s.littleEndian}s.support32bit=(typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&s.littleEndian!==null&&t());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){s.vibration=true}}function u(){var B=new ArrayBuffer(4);var A=new Uint8Array(B);var C=new Uint32Array(B);A[0]=161;A[1]=178;A[2]=195;A[3]=212;if(C[0]==3569595041){return true}if(C[0]==2712847316){return false}else{return null}}function t(){if(typeof Uint8ClampedArray==="undefined"){return false}var B=document.createElement("canvas");var A=B.getContext("2d");if(!A){return false}var C=A.createImageData(1,1);return C.data instanceof Uint8ClampedArray}function q(){var C=document.createElement("p");var D;var B={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(C,null);for(var A in B){if(C.style[A]!==undefined){C.style[A]="translate3d(1px,1px,1px)";D=window.getComputedStyle(C).getPropertyValue(B[A])}}document.body.removeChild(C);s.css3D=(D!==undefined&&D.length>0&&D!=="none")}r();v();x();q();p();z();w();y()};g.Device.canPlayAudio=function(p){if(p=="mp3"&&this.mp3){return true}else{if(p=="ogg"&&(this.ogg||this.opus)){return true}else{if(p=="m4a"&&this.m4a){return true}else{if(p=="opus"&&this.opus){return true}else{if(p=="wav"&&this.wav){return true}else{if(p=="webm"&&this.webm){return true}}}}}}return false};g.Device.isConsoleOpen=function(){if(window.console&&window.console.firebug){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console.profiles){return console.profiles.length>0}}return false};g.Device.isAndroidStockBrowser=function(){var p=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return p&&p[1]<537};g.DOM={getOffset:function(q,p){p=p||new g.Point();var r=q.getBoundingClientRect();var s=g.DOM.scrollY;var t=g.DOM.scrollX;var v=document.documentElement.clientTop;var u=document.documentElement.clientLeft;p.x=r.left+t-u;p.y=r.top+s-v;return p},getBounds:function(q,p){if(typeof p==="undefined"){p=0}q=q&&!q.nodeType?q[0]:q;if(!q||q.nodeType!==1){return false}else{return this.calibrate(q.getBoundingClientRect(),p)}},calibrate:function(r,q){q=+q||0;var p={width:0,height:0,left:0,right:0,top:0,bottom:0};p.width=(p.right=r.right+q)-(p.left=r.left-q);p.height=(p.bottom=r.bottom+q)-(p.top=r.top-q);return p},getAspectRatio:function(q){q=null==q?this.visualBounds:1===q.nodeType?this.getBounds(q):q;var p=q.width;var r=q.height;if(typeof p==="function"){p=p.call(q)}if(typeof r==="function"){r=r.call(q)}return p/r},inLayoutViewport:function(q,p){var s=this.getBounds(q,p);return !!s&&s.bottom>=0&&s.right>=0&&s.top<=this.layoutBounds.width&&s.left<=this.layoutBounds.height},getScreenOrientation:function(t){var q=window.screen;var p=q.orientation||q.mozOrientation||q.msOrientation;if(p&&typeof p.type==="string"){return p.type}else{if(typeof p==="string"){return p}}var s="portrait-primary";var r="landscape-primary";if(t==="screen"){return(q.height>q.width)?s:r}else{if(t==="viewport"){return(this.visualBounds.height>this.visualBounds.width)?s:r}else{if(t==="window.orientation"&&typeof window.orientation==="number"){return(window.orientation===0||window.orientation===180)?s:r}else{if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return s}else{if(window.matchMedia("(orientation: landscape)").matches){return r}}}}}}return(this.visualBounds.height>this.visualBounds.width)?s:r},visualBounds:new g.Rectangle(),layoutBounds:new g.Rectangle(),documentBounds:new g.Rectangle()};g.Device.whenReady(function(r){var u=window&&("pageXOffset" in window)?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var s=window&&("pageYOffset" in window)?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(g.DOM,"scrollX",{get:u});Object.defineProperty(g.DOM,"scrollY",{get:s});Object.defineProperty(g.DOM.visualBounds,"x",{get:u});Object.defineProperty(g.DOM.visualBounds,"y",{get:s});Object.defineProperty(g.DOM.layoutBounds,"x",{value:0});Object.defineProperty(g.DOM.layoutBounds,"y",{value:0});var q=r.desktop&&(document.documentElement.clientWidth<=window.innerWidth)&&(document.documentElement.clientHeight<=window.innerHeight);if(q){var t=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var p=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(g.DOM.visualBounds,"width",{get:t});Object.defineProperty(g.DOM.visualBounds,"height",{get:p});Object.defineProperty(g.DOM.layoutBounds,"width",{get:t});Object.defineProperty(g.DOM.layoutBounds,"height",{get:p})}else{Object.defineProperty(g.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(g.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(g.DOM.layoutBounds,"width",{get:function(){var w=document.documentElement.clientWidth;var v=window.innerWidth;return w<v?v:w}});Object.defineProperty(g.DOM.layoutBounds,"height",{get:function(){var w=document.documentElement.clientHeight;var v=window.innerHeight;return w<v?v:w}})}Object.defineProperty(g.DOM.documentBounds,"x",{value:0});Object.defineProperty(g.DOM.documentBounds,"y",{value:0});Object.defineProperty(g.DOM.documentBounds,"width",{get:function(){var v=document.documentElement;return Math.max(v.clientWidth,v.offsetWidth,v.scrollWidth)}});Object.defineProperty(g.DOM.documentBounds,"height",{get:function(){var v=document.documentElement;return Math.max(v.clientHeight,v.offsetHeight,v.scrollHeight)}})},null,true);g.Canvas={create:function(r,p,s){r=r||256;p=p||256;var q=document.createElement("canvas");if(typeof s==="string"&&s!==""){q.id=s}q.width=r;q.height=p;q.style.display="block";return q},setBackgroundColor:function(q,p){p=p||"rgb(0,0,0)";q.style.backgroundColor=p;return q},setTouchAction:function(p,q){q=q||"none";p.style.msTouchAction=q;p.style["ms-touch-action"]=q;p.style["touch-action"]=q;return p},setUserSelect:function(p,q){q=q||"none";p.style["-webkit-touch-callout"]=q;p.style["-webkit-user-select"]=q;p.style["-khtml-user-select"]=q;p.style["-moz-user-select"]=q;p.style["-ms-user-select"]=q;p.style["user-select"]=q;p.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return p},addToDOM:function(p,q,s){var r;if(typeof s==="undefined"){s=true}if(q){if(typeof q==="string"){r=document.getElementById(q)}else{if(typeof q==="object"&&q.nodeType===1){r=q}}}if(!r){r=document.body}if(s&&r.style){r.style.overflow="hidden"}r.appendChild(p);return p},removeFromDOM:function(p){if(p.parentNode){p.parentNode.removeChild(p)}},setTransform:function(t,v,u,r,p,s,q){t.setTransform(r,s,q,p,v,u);return t},setSmoothingEnabled:function(p,q){p.imageSmoothingEnabled=q;p.mozImageSmoothingEnabled=q;p.oImageSmoothingEnabled=q;p.webkitImageSmoothingEnabled=q;p.msImageSmoothingEnabled=q;return p},getSmoothingEnabled:function(p){return(p.imageSmoothingEnabled||p.mozImageSmoothingEnabled||p.oImageSmoothingEnabled||p.webkitImageSmoothingEnabled||p.msImageSmoothingEnabled)},setImageRenderingCrisp:function(p){p.style["image-rendering"]="optimizeSpeed";p.style["image-rendering"]="crisp-edges";p.style["image-rendering"]="-moz-crisp-edges";p.style["image-rendering"]="-webkit-optimize-contrast";p.style["image-rendering"]="optimize-contrast";p.style["image-rendering"]="pixelated";p.style.msInterpolationMode="nearest-neighbor";return p},setImageRenderingBicubic:function(p){p.style["image-rendering"]="auto";p.style.msInterpolationMode="bicubic";return p}};g.Canvas.getOffset=g.DOM.getOffset;g.Canvas.getAspectRatio=g.DOM.getAspectRatio;g.RequestAnimationFrame=function(q,r){if(typeof r==="undefined"){r=false}this.game=q;this.isRunning=false;this.forceSetTimeOut=r;var s=["ms","moz","webkit","o"];for(var p=0;p<s.length&&!window.requestAnimationFrame;p++){window.requestAnimationFrame=window[s[p]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[s[p]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};g.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var p=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return p.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(q){return p.updateRAF(q)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(p){this.game.update(Math.floor(p));this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};g.RequestAnimationFrame.prototype.constructor=g.RequestAnimationFrame;g.Math={PI2:Math.PI*2,fuzzyEqual:function(q,p,r){if(typeof r==="undefined"){r=0.0001}return Math.abs(q-p)<r},fuzzyLessThan:function(q,p,r){if(typeof r==="undefined"){r=0.0001}return q<p+r},fuzzyGreaterThan:function(q,p,r){if(typeof r==="undefined"){r=0.0001}return q>p-r},fuzzyCeil:function(p,q){if(typeof q==="undefined"){q=0.0001}return Math.ceil(p-q)},fuzzyFloor:function(p,q){if(typeof q==="undefined"){q=0.0001}return Math.floor(p+q)},average:function(){var q=0;for(var p=0;p<arguments.length;p++){q+=(+arguments[p])}return q/arguments.length},truncate:function(p){return Math.trunc(p)},shear:function(p){return p%1},snapTo:function(p,r,q){if(typeof q==="undefined"){q=0}if(r===0){return p}p-=q;p=r*Math.round(p/r);return q+p},snapToFloor:function(p,r,q){if(typeof q==="undefined"){q=0}if(r===0){return p}p-=q;p=r*Math.floor(p/r);return q+p},snapToCeil:function(p,r,q){if(typeof q==="undefined"){q=0}if(r===0){return p}p-=q;p=r*Math.ceil(p/r);return q+p},snapToInArray:function(q,p,r){if(typeof r==="undefined"){r=true}if(r){p.sort()}return g.ArrayUtils.findClosest(q,p)},roundTo:function(s,q,r){if(typeof q==="undefined"){q=0}if(typeof r==="undefined"){r=10}var t=Math.pow(r,-q);return Math.round(s*t)/t},floorTo:function(s,q,r){if(typeof q==="undefined"){q=0}if(typeof r==="undefined"){r=10}var t=Math.pow(r,-q);return Math.floor(s*t)/t},ceilTo:function(s,q,r){if(typeof q==="undefined"){q=0}if(typeof r==="undefined"){r=10}var t=Math.pow(r,-q);return Math.ceil(s*t)/t},interpolateFloat:function(q,p,r){return(p-q)*r+q},angleBetween:function(q,s,p,r){return Math.atan2(r-s,p-q)},angleBetweenY:function(q,s,p,r){return Math.atan2(p-q,r-s)},angleBetweenPoints:function(q,p){return Math.atan2(p.y-q.y,p.x-q.x)},angleBetweenPointsY:function(q,p){return Math.atan2(p.x-q.x,p.y-q.y)},reverseAngle:function(p){return this.normalizeAngle(p+Math.PI,true)},normalizeAngle:function(p){p=p%(2*Math.PI);return p>=0?p:p+2*Math.PI},normalizeLatitude:function(p){return g.Math.clamp(p,-90,90)},normalizeLongitude:function(p){return g.Math.wrap(p,-180,180)},chanceRoll:function(p){return g.Utils.chanceRoll(p)},numberArray:function(q,p){return g.ArrayUtils.numberArray(q,p)},numberArrayStep:function(r,p,q){return g.ArrayUtils.numberArrayStep(r,p,q)},maxAdd:function(r,q,p){return Math.min(r+q,p)},minSub:function(r,q,p){return Math.max(r-q,p)},wrap:function(t,s,q){var r=q-s;if(r<=0){return 0}var p=(t-s)%r;if(p<0){p+=r}return p+s},wrapValue:function(r,q,p){var s;r=Math.abs(r);q=Math.abs(q);p=Math.abs(p);s=(r+q)%p;return s},limitValue:function(r,q,p){return g.Math.clamp(r,q,p)},randomSign:function(){return g.Utils.randomChoice(-1,1)},isOdd:function(p){return(p&1)},isEven:function(p){return !(p&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var s=arguments[0]}else{var s=arguments}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r]<s[q]){q=r}}return s[q]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var s=arguments[0]}else{var s=arguments}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r]>s[q]){q=r}}return s[q]},minProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var s=arguments[1]}else{var s=arguments.slice(1)}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r][t]<s[q][t]){q=r}}return s[q][t]},maxProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var s=arguments[1]}else{var s=arguments.slice(1)}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r][t]>s[q][t]){q=r}}return s[q][t]},wrapAngle:function(q,p){return p?this.wrap(q,-Math.PI,Math.PI):this.wrap(q,-180,180)},angleLimit:function(s,r,q){var p=s;if(s>q){p=q}else{if(s<r){p=r}}return p},linearInterpolation:function(r,q){var p=r.length-1;var t=p*q;var s=Math.floor(t);if(q<0){return this.linear(r[0],r[1],t)}if(q>1){return this.linear(r[p],r[p-1],p-t)}return this.linear(r[s],r[s+1>p?p:s+1],t-s)},bezierInterpolation:function(r,q){var p=0;var t=r.length-1;for(var s=0;s<=t;s++){p+=Math.pow(1-q,t-s)*Math.pow(q,s)*r[s]*this.bernstein(t,s)}return p},catmullRomInterpolation:function(r,q){var p=r.length-1;var t=p*q;var s=Math.floor(t);if(r[0]===r[p]){if(q<0){s=Math.floor(t=p*(1+q))}return this.catmullRom(r[(s-1+p)%p],r[s],r[(s+1)%p],r[(s+2)%p],t-s)}else{if(q<0){return r[0]-(this.catmullRom(r[0],r[0],r[1],r[1],-t)-r[0])}if(q>1){return r[p]-(this.catmullRom(r[p],r[p],r[p-1],r[p-1],t-p)-r[p])}return this.catmullRom(r[s?s-1:0],r[s],r[p<s+1?p:s+1],r[p<s+2?p:s+2],t-s)}},linear:function(r,q,p){return(q-r)*p+r},bernstein:function(q,p){return this.factorial(q)/this.factorial(p)/this.factorial(q-p)},factorial:function(q){if(q===0){return 1}var p=q;while(--q){p*=q}return p},catmullRom:function(x,w,u,s,y){var v=(u-x)*0.5,r=(s-w)*0.5,q=y*y,p=y*q;return(2*w-2*u+v+r)*p+(-3*w+3*u-2*v-r)*q+v*y+w},difference:function(q,p){return Math.abs(q-p)},getRandom:function(q,r,p){return g.ArrayUtils.getRandomItem(q,r,p)},removeRandom:function(q,r,p){return g.ArrayUtils.removeRandomItem(q,r,p)},floor:function(p){return Math.trunc(p)},ceil:function(p){return g.Math.roundAwayFromZero(p)},roundAwayFromZero:function(p){return(p>0)?Math.ceil(p):Math.floor(p)},sinCosGenerator:function(p,w,q,u){if(typeof w==="undefined"){w=1}if(typeof q==="undefined"){q=1}if(typeof u==="undefined"){u=1}var v=w;var y=q;var s=u*Math.PI/p;var r=[];var x=[];for(var t=0;t<p;t++){y-=v*s;v+=y*s;r[t]=y;x[t]=v}return{sin:x,cos:r,length:p}},shift:function(q){var p=q.shift();q.push(p);return p},shuffleArray:function(p){return g.ArrayUtils.shuffle(p)},distance:function(s,u,r,t){var q=s-r;var p=u-t;return Math.sqrt(q*q+p*p)},distancePow:function(q,s,p,r,t){if(typeof t==="undefined"){t=2}return Math.sqrt(Math.pow(p-q,t)+Math.pow(r-s,t))},distanceRounded:function(q,s,p,r){return Math.round(g.Math.distance(q,s,p,r))},clamp:function(q,r,p){return(q<r)?r:((q>p)?p:q)},clampBottom:function(p,q){return p<q?q:p},within:function(q,p,r){return(Math.abs(q-p)<=r)},mapLinear:function(q,r,p,t,s){return t+(q-r)*(s-t)/(p-r)},smoothstep:function(q,r,p){q=Math.max(0,Math.min(1,(q-r)/(p-r)));return q*q*(3-2*q)},smootherstep:function(q,r,p){q=Math.max(0,Math.min(1,(q-r)/(p-r)));return q*q*q*(q*(q*6-15)+10)},sign:function(p){return(p<0)?-1:((p>0)?1:0)},percent:function(q,p,r){if(typeof r==="undefined"){r=0}if(q>p||r>p){return 1}else{if(q<r||r>q){return 0}else{return(q-r)/p}}}};var f=Math.PI/180;var c=180/Math.PI;g.Math.degToRad=function o(p){return p*f};g.Math.radToDeg=function i(p){return p*c};g.RandomDataGenerator=function(p){if(typeof p==="undefined"){p=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(p)};g.RandomDataGenerator.prototype={rnd:function(){var p=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=p|0;this.s0=this.s1;this.s1=this.s2;this.s2=p-this.c;return this.s2},sow:function(q){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!q){return}for(var r=0;r<q.length&&(q[r]!=null);r++){var p=q[r];this.s0-=this.hash(p);this.s0+=~~(this.s0<0);this.s1-=this.hash(p);this.s1+=~~(this.s1<0);this.s2-=this.hash(p);this.s2+=~~(this.s2<0)}},hash:function(r){var q,p,s;s=4022871197;r=r.toString();for(p=0;p<r.length;p++){s+=r.charCodeAt(p);q=0.02519603282416938*s;s=q>>>0;q-=s;q*=s;s=q>>>0;q-=s;s+=q*4294967296}return(s>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(q,p){return Math.floor(this.realInRange(0,p-q+1)+q)},between:function(q,p){return this.integerInRange(q,p)},realInRange:function(q,p){return this.frac()*(p-q)+q},normal:function(){return 1-2*this.frac()},uuid:function(){var q="";var p="";for(p=q="";q++<36;p+=~q%5|q*3&4?(q^15?8^this.frac()*(q^20?16:4):4).toString(16):"-"){}return p},pick:function(p){return p[this.integerInRange(0,p.length-1)]},weightedPick:function(p){return p[~~(Math.pow(this.frac(),2)*(p.length-1))]},timestamp:function(q,p){return this.realInRange(q||946684800000,p||1577862000000)},angle:function(){return this.integerInRange(-180,180)}};g.RandomDataGenerator.prototype.constructor=g.RandomDataGenerator;g.QuadTree=function(q,v,t,p,s,r,u){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(q,v,t,p,s,r,u)};g.QuadTree.prototype={reset:function(q,v,t,p,s,r,u){this.maxObjects=s||10;this.maxLevels=r||4;this.level=u||0;this.bounds={x:Math.round(q),y:Math.round(v),width:t,height:p,subWidth:Math.floor(t/2),subHeight:Math.floor(p/2),right:Math.round(q)+Math.floor(t/2),bottom:Math.round(v)+Math.floor(p/2)};this.objects.length=0;this.nodes.length=0},populate:function(p){p.forEach(this.populateHandler,this,true)},populateHandler:function(p){if(p.body&&p.exists){this.insert(p.body)}},split:function(){this.nodes[0]=new g.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[1]=new g.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[2]=new g.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[3]=new g.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1))},insert:function(p){var r=0;var q;if(this.nodes[0]!=null){q=this.getIndex(p);if(q!==-1){this.nodes[q].insert(p);return}}this.objects.push(p);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(r<this.objects.length){q=this.getIndex(this.objects[r]);if(q!==-1){this.nodes[q].insert(this.objects.splice(r,1)[0])}else{r++}}}},getIndex:function(q){var p=-1;if(q.x<this.bounds.right&&q.right<this.bounds.right){if(q.y<this.bounds.bottom&&q.bottom<this.bounds.bottom){p=1}else{if(q.y>this.bounds.bottom){p=2}}}else{if(q.x>this.bounds.right){if(q.y<this.bounds.bottom&&q.bottom<this.bounds.bottom){p=0}else{if(q.y>this.bounds.bottom){p=3}}}}return p},retrieve:function(q){if(q instanceof g.Rectangle){var r=this.objects;var p=this.getIndex(q)}else{if(!q.body){return this._empty}var r=this.objects;var p=this.getIndex(q.body)}if(this.nodes[0]){if(p!==-1){r=r.concat(this.nodes[p].retrieve(q))}else{r=r.concat(this.nodes[0].retrieve(q));r=r.concat(this.nodes[1].retrieve(q));r=r.concat(this.nodes[2].retrieve(q));r=r.concat(this.nodes[3].retrieve(q))}}return r},clear:function(){this.objects.length=0;var p=this.nodes.length;while(p--){this.nodes[p].clear();this.nodes.splice(p,1)}this.nodes.length=0}};g.QuadTree.prototype.constructor=g.QuadTree;g.Net=function(p){this.game=p};g.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(p){return window.location.hostname.indexOf(p)!==-1},updateQueryString:function(r,t,w,q){if(typeof w==="undefined"){w=false}if(typeof q==="undefined"||q===""){q=window.location.href}var p="";var s=new RegExp("([?|&])"+r+"=.*?(&|#|$)(.*)","gi");if(s.test(q)){if(typeof t!=="undefined"&&t!==null){p=q.replace(s,"$1"+r+"="+t+"$2$3")}else{p=q.replace(s,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof t!=="undefined"&&t!==null){var v=q.indexOf("?")!==-1?"&":"?";var u=q.split("#");q=u[0]+v+r+"="+t;if(u[1]){q+="#"+u[1]}p=q}else{p=q}}if(w){window.location.href=p}else{return p}},getQueryString:function(t){if(typeof t==="undefined"){t=""}var q={};var p=location.search.substring(1).split("&");for(var s in p){var r=p[s].split("=");if(r.length>1){if(t&&t==this.decodeURI(r[0])){return this.decodeURI(r[1])}else{q[this.decodeURI(r[0])]=this.decodeURI(r[1])}}}return q},decodeURI:function(p){return decodeURIComponent(p.replace(/\+/g," "))}};g.Net.prototype.constructor=g.Net;g.TweenManager=function(p){this.game=p;this._tweens=[];this._add=[];this.easeMap={Power0:g.Easing.Power0,Power1:g.Easing.Power1,Power2:g.Easing.Power2,Power3:g.Easing.Power3,Power4:g.Easing.Power4,Linear:g.Easing.Linear.None,Quad:g.Easing.Quadratic.Out,Cubic:g.Easing.Cubic.Out,Quart:g.Easing.Quartic.Out,Quint:g.Easing.Quintic.Out,Sine:g.Easing.Sinusoidal.Out,Expo:g.Easing.Exponential.Out,Circ:g.Easing.Circular.Out,Elastic:g.Easing.Elastic.Out,Back:g.Easing.Back.Out,Bounce:g.Easing.Bounce.Out,"Quad.easeIn":g.Easing.Quadratic.In,"Cubic.easeIn":g.Easing.Cubic.In,"Quart.easeIn":g.Easing.Quartic.In,"Quint.easeIn":g.Easing.Quintic.In,"Sine.easeIn":g.Easing.Sinusoidal.In,"Expo.easeIn":g.Easing.Exponential.In,"Circ.easeIn":g.Easing.Circular.In,"Elastic.easeIn":g.Easing.Elastic.In,"Back.easeIn":g.Easing.Back.In,"Bounce.easeIn":g.Easing.Bounce.In,"Quad.easeOut":g.Easing.Quadratic.Out,"Cubic.easeOut":g.Easing.Cubic.Out,"Quart.easeOut":g.Easing.Quartic.Out,"Quint.easeOut":g.Easing.Quintic.Out,"Sine.easeOut":g.Easing.Sinusoidal.Out,"Expo.easeOut":g.Easing.Exponential.Out,"Circ.easeOut":g.Easing.Circular.Out,"Elastic.easeOut":g.Easing.Elastic.Out,"Back.easeOut":g.Easing.Back.Out,"Bounce.easeOut":g.Easing.Bounce.Out,"Quad.easeInOut":g.Easing.Quadratic.InOut,"Cubic.easeInOut":g.Easing.Cubic.InOut,"Quart.easeInOut":g.Easing.Quartic.InOut,"Quint.easeInOut":g.Easing.Quintic.InOut,"Sine.easeInOut":g.Easing.Sinusoidal.InOut,"Expo.easeInOut":g.Easing.Exponential.InOut,"Circ.easeInOut":g.Easing.Circular.InOut,"Elastic.easeInOut":g.Easing.Elastic.InOut,"Back.easeInOut":g.Easing.Back.InOut,"Bounce.easeInOut":g.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};g.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var p=0;p<this._tweens.length;p++){this._tweens[p].pendingDelete=true}this._add=[]},removeFrom:function(s,r){if(typeof r==="undefined"){r=true}var q;var p;if(Array.isArray(s)){for(q=0,p=s.length;q<p;q++){this.removeFrom(s[q])}}else{if(s.type===g.GROUP&&r){for(var q=0,p=s.children.length;q<p;q++){this.removeFrom(s.children[q])}}else{for(q=0,p=this._tweens.length;q<p;q++){if(s===this._tweens[q].target){this.remove(this._tweens[q])}}for(q=0,p=this._add.length;q<p;q++){if(s===this._add[q].target){this.remove(this._add[q])}}}}},add:function(p){p._manager=this;this._add.push(p)},create:function(p){return new g.Tween(p,this.game,this)},remove:function(q){var p=this._tweens.indexOf(q);if(p!==-1){this._tweens[p].pendingDelete=true}else{p=this._add.indexOf(q);if(p!==-1){this._add[p].pendingDelete=true}}},update:function(){var r=this._add.length;var q=this._tweens.length;if(q===0&&r===0){return false}var p=0;while(p<q){if(this._tweens[p].update(this.game.time.time)){p++}else{this._tweens.splice(p,1);q--}}if(r>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(p){return this._tweens.some(function(q){return q.target===p})},_pauseAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p]._pause()}},_resumeAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p]._resume()}},pauseAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p].pause()}},resumeAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p].resume(true)}}};g.TweenManager.prototype.constructor=g.TweenManager;g.Tween=function(r,p,q){this.game=p;this.target=r;this.manager=q;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new g.Signal();this.onLoop=new g.Signal();this.onRepeat=new g.Signal();this.onChildComplete=new g.Signal();this.onComplete=new g.Signal();this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false};g.Tween.prototype={to:function(r,u,v,q,p,t,s){if(typeof u==="undefined"){u=1000}if(typeof v==="undefined"){v=g.Easing.Default}if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=0}if(typeof t==="undefined"){t=0}if(typeof s==="undefined"){s=false}if(typeof v==="string"&&this.manager.easeMap[v]){v=this.manager.easeMap[v]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new g.TweenData(this).to(r,u,v,p,t,s));if(q){this.start()}return this},from:function(r,u,v,q,p,t,s){if(typeof u==="undefined"){u=1000}if(typeof v==="undefined"){v=g.Easing.Default}if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=0}if(typeof t==="undefined"){t=0}if(typeof s==="undefined"){s=false}if(typeof v==="string"&&this.manager.easeMap[v]){v=this.manager.easeMap[v]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new g.TweenData(this).from(r,u,v,p,t,s));if(q){this.start()}return this},start:function(p){if(typeof p==="undefined"){p=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var q=0;q<this.timeline.length;q++){for(var r in this.timeline[q].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var q=0;q<this.timeline.length;q++){this.timeline[q].loadValues()}this.manager.add(this);this.isRunning=true;if(p<0||p>this.timeline.length-1){p=0}this.current=p;this.timeline[this.current].start();this.onStart.dispatch(this.target,this);return this},stop:function(p){if(typeof p==="undefined"){p=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(p){this.onComplete.dispatch(this.target,this);if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(s,r,p){if(this.timeline.length===0){return this}if(typeof p==="undefined"){p=0}if(p===-1){for(var q=0;q<this.timeline.length;q++){this.timeline[q][s]=r}}else{this.timeline[p][s]=r}return this},delay:function(q,p){return this.updateTweenData("delay",q,p)},repeat:function(q,r,p){if(typeof r==="undefined"){r=0}this.updateTweenData("repeatCounter",q,p);return this.updateTweenData("repeatDelay",r,p)},repeatDelay:function(q,p){return this.updateTweenData("repeatDelay",q,p)},yoyo:function(q,r,p){if(typeof r==="undefined"){r=0}this.updateTweenData("yoyo",q,p);return this.updateTweenData("yoyoDelay",r,p)},yoyoDelay:function(q,p){return this.updateTweenData("yoyoDelay",q,p)},easing:function(q,p){if(typeof q==="string"&&this.manager.easeMap[q]){q=this.manager.easeMap[q]}return this.updateTweenData("easingFunction",q,p)},interpolation:function(p,r,q){if(typeof r==="undefined"){r=g.Math}this.updateTweenData("interpolationFunction",p,q);return this.updateTweenData("interpolationContext",r,q)},repeatAll:function(p){if(typeof p==="undefined"){p=0}this.repeatCounter=p;return this},chain:function(){var p=arguments.length;while(p--){if(p>0){arguments[p-1].chainedTween=arguments[p]}else{this.chainedTween=arguments[p]}}return this},loop:function(p){if(typeof p==="undefined"){p=true}if(p){this.repeatAll(-1)}else{this.repeatCounter=0}return this},onUpdateCallback:function(q,p){this._onUpdateCallback=q;this._onUpdateCallbackContext=p;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var p=0;p<this.timeline.length;p++){if(!this.timeline[p].isRunning){this.timeline[p].startTime+=(this.game.time.time-this._pausedTime)}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(r){if(this.pendingDelete){return false}if(this.isPaused){return true}var q=this.timeline[this.current].update(r);if(q===g.TweenData.PENDING){return true}else{if(q===g.TweenData.RUNNING){if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else{if(q===g.TweenData.LOOPED){this.onLoop.dispatch(this.target,this);return true}else{if(q===g.TweenData.COMPLETE){var p=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;p=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;p=true}}if(p){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);if(this.chainedTween){this.chainedTween.start()}return false}}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}}}}},generateData:function(p,s){if(this.game===null||this.target===null){return null}if(typeof s==="undefined"){s=[]}for(var q=0;q<this.timeline.length;q++){for(var r in this.timeline[q].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var q=0;q<this.timeline.length;q++){this.timeline[q].loadValues()}for(var q=0;q<this.timeline.length;q++){s=s.concat(this.timeline[q].generateData(p))}return s}};Object.defineProperty(g.Tween.prototype,"totalDuration",{get:function(){var q=0;for(var p=0;p<this.timeline.length;p++){q+=this.timeline[p].duration}return q}});g.Tween.prototype.constructor=g.Tween;g.TweenData=function(p){this.parent=p;this.game=p.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1000;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=g.Easing.Default;this.interpolationFunction=g.Math.linearInterpolation;this.interpolationContext=g.Math;this.isRunning=false;this.isFrom=false};g.TweenData.PENDING=0;g.TweenData.RUNNING=1;g.TweenData.LOOPED=2;g.TweenData.COMPLETE=3;g.TweenData.prototype={to:function(q,t,u,p,s,r){this.vEnd=q;this.duration=t;this.easingFunction=u;this.delay=p;this.repeatCounter=s;this.yoyo=r;this.isFrom=false;return this},from:function(q,t,u,p,s,r){this.vEnd=q;this.duration=t;this.easingFunction=u;this.delay=p;this.repeatCounter=s;this.yoyo=r;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var p in this.vStartCache){this.vStart[p]=this.vEndCache[p];this.vEnd[p]=this.vStartCache[p];this.parent.target[p]=this.vStart[p]}}this.value=0;this.yoyoCounter=0;return this},loadValues:function(){for(var p in this.parent.properties){this.vStart[p]=this.parent.properties[p];if(Array.isArray(this.vEnd[p])){if(this.vEnd[p].length===0){continue}this.vEnd[p]=[this.vStart[p]].concat(this.vEnd[p])}if(typeof this.vEnd[p]!=="undefined"){if(typeof this.vEnd[p]==="string"){this.vEnd[p]=this.vStart[p]+parseFloat(this.vEnd[p],10)}this.parent.properties[p]=this.vEnd[p]}else{this.vEnd[p]=this.vStart[p]}this.vStartCache[p]=this.vStart[p];this.vEndCache[p]=this.vEnd[p]}return this},update:function(){if(!this.isRunning){if(this.game.time.time>=this.startTime){this.isRunning=true}else{return g.TweenData.PENDING}}else{if(this.game.time.time<this.startTime){return g.TweenData.RUNNING}}if(this.parent.reverse){this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var q in this.vEnd){var r=this.vStart[q];var p=this.vEnd[q];if(Array.isArray(p)){this.parent.target[q]=this.interpolationFunction.call(this.interpolationContext,p,this.value)}else{this.parent.target[q]=r+((p-r)*this.value)}}if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){return this.repeat()}return g.TweenData.RUNNING},generateData:function(x){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var v=[];var r=false;var s=(1/x)*1000;do{if(this.parent.reverse){this.dt-=s;this.dt=Math.max(this.dt,0)}else{this.dt+=s;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var p={};for(var w in this.vEnd){var q=this.vStart[w];var t=this.vEnd[w];if(Array.isArray(t)){p[w]=this.interpolationFunction(t,this.value)}else{p[w]=q+((t-q)*this.value)}}v.push(p);if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){r=true}}while(!r);if(this.yoyo){var u=v.slice();u.reverse();v=v.concat(u)}return v},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){return g.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return g.TweenData.COMPLETE}}if(this.inReverse){for(var p in this.vStartCache){this.vStart[p]=this.vEndCache[p];this.vEnd[p]=this.vStartCache[p]}}else{for(var p in this.vStartCache){this.vStart[p]=this.vStartCache[p];this.vEnd[p]=this.vEndCache[p]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else{if(!this.inReverse){this.startTime+=this.repeatDelay}}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return g.TweenData.LOOPED}};g.TweenData.prototype.constructor=g.TweenData;g.Easing={Linear:{None:function(p){return p}},Quadratic:{In:function(p){return p*p},Out:function(p){return p*(2-p)},InOut:function(p){if((p*=2)<1){return 0.5*p*p}return -0.5*(--p*(p-2)-1)}},Cubic:{In:function(p){return p*p*p},Out:function(p){return --p*p*p+1},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p}return 0.5*((p-=2)*p*p+2)}},Quartic:{In:function(p){return p*p*p*p},Out:function(p){return 1-(--p*p*p*p)},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p*p}return -0.5*((p-=2)*p*p*p-2)}},Quintic:{In:function(p){return p*p*p*p*p},Out:function(p){return --p*p*p*p*p+1},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p*p*p}return 0.5*((p-=2)*p*p*p*p+2)}},Sinusoidal:{In:function(p){if(p===0){return 0}if(p===1){return 1}return 1-Math.cos(p*Math.PI/2)},Out:function(p){if(p===0){return 0}if(p===1){return 1}return Math.sin(p*Math.PI/2)},InOut:function(p){if(p===0){return 0}if(p===1){return 1}return 0.5*(1-Math.cos(Math.PI*p))}},Exponential:{In:function(p){return p===0?0:Math.pow(1024,p-1)},Out:function(p){return p===1?1:1-Math.pow(2,-10*p)},InOut:function(p){if(p===0){return 0}if(p===1){return 1}if((p*=2)<1){return 0.5*Math.pow(1024,p-1)}return 0.5*(-Math.pow(2,-10*(p-1))+2)}},Circular:{In:function(p){return 1-Math.sqrt(1-p*p)},Out:function(p){return Math.sqrt(1-(--p*p))},InOut:function(p){if((p*=2)<1){return -0.5*(Math.sqrt(1-p*p)-1)}return 0.5*(Math.sqrt(1-(p-=2)*p)+1)}},Elastic:{In:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}return -(q*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u))},Out:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}return(q*Math.pow(2,-10*r)*Math.sin((r-t)*(2*Math.PI)/u)+1)},InOut:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}if((r*=2)<1){return -0.5*(q*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u))}return q*Math.pow(2,-10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u)*0.5+1}},Back:{In:function(p){var q=1.70158;return p*p*((q+1)*p-q)},Out:function(p){var q=1.70158;return --p*p*((q+1)*p+q)+1},InOut:function(p){var q=1.70158*1.525;if((p*=2)<1){return 0.5*(p*p*((q+1)*p-q))}return 0.5*((p-=2)*p*((q+1)*p+q)+2)}},Bounce:{In:function(p){return 1-g.Easing.Bounce.Out(1-p)},Out:function(p){if(p<(1/2.75)){return 7.5625*p*p}else{if(p<(2/2.75)){return 7.5625*(p-=(1.5/2.75))*p+0.75}else{if(p<(2.5/2.75)){return 7.5625*(p-=(2.25/2.75))*p+0.9375}else{return 7.5625*(p-=(2.625/2.75))*p+0.984375}}}},InOut:function(p){if(p<0.5){return g.Easing.Bounce.In(p*2)*0.5}return g.Easing.Bounce.Out(p*2-1)*0.5+0.5}}};g.Easing.Default=g.Easing.Linear.None;g.Easing.Power0=g.Easing.Linear.None;g.Easing.Power1=g.Easing.Quadratic.Out;g.Easing.Power2=g.Easing.Cubic.Out;g.Easing.Power3=g.Easing.Quartic.Out;g.Easing.Power4=g.Easing.Quintic.Out;g.Time=function(p){this.game=p;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=0;this.physicsElapsedMS=0;this.desiredFps=60;this.suggestedFps=null;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new g.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};g.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start()},add:function(p){this._timers.push(p);return p},create:function(p){if(typeof p==="undefined"){p=true}var q=new g.Timer(this.game,p);this._timers.push(q);return q},removeAll:function(){for(var p=0;p<this._timers.length;p++){this._timers[p].destroy()}this._timers=[];this.events.removeAll()},update:function(s){var r=this.time;this.time=Date.now();this.elapsedMS=this.time-r;this.prevTime=this.now;this.now=s;this.elapsed=this.now-this.prevTime;this.timeToCall=Math.floor(Math.max(0,(1000/this.desiredFps)-(this.timeCallExpected-s)));this.timeCallExpected=s+this.timeToCall;this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this.desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.physicsElapsed=1/this.desiredFps;this.physicsElapsedMS=this.physicsElapsed*1000;if(this.advancedTiming){this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){this.fps=Math.round((this.frames*1000)/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}}if(!this.game.paused){this.events.update(this.time);var q=0;var p=this._timers.length;while(q<p){if(this._timers[q].update(this.time)){q++}else{this._timers.splice(q,1);p--}}}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var p=this._timers.length;while(p--){this._timers[p]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var p=this._timers.length;while(p--){this._timers[p]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*0.001},elapsedSince:function(p){return this.time-p},elapsedSecondsSince:function(p){return(this.time-p)*0.001},reset:function(){this._started=this.time;this.removeAll()}};g.Time.prototype.constructor=g.Time;g.Timer=function(p,q){if(typeof q==="undefined"){q=true}this.game=p;this.running=false;this.autoDestroy=q;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new g.Signal();this.nextTick=0;this.timeCap=1000;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};g.Timer.MINUTE=60000;g.Timer.SECOND=1000;g.Timer.HALF=500;g.Timer.QUARTER=250;g.Timer.prototype={create:function(t,p,r,w,q,s){t=Math.round(t);var u=t;if(this._now===0){u+=this.game.time.time}else{u+=this._now}var v=new g.TimerEvent(this,t,u,r,p,w,q,s);this.events.push(v);this.order();this.expired=false;return v},add:function(q,r,p){return this.create(q,false,0,r,p,Array.prototype.splice.call(arguments,3))},repeat:function(r,q,s,p){return this.create(r,false,q,s,p,Array.prototype.splice.call(arguments,4))},loop:function(q,r,p){return this.create(q,true,0,r,p,Array.prototype.splice.call(arguments,3))},start:function(p){if(this.running){return}this._started=this.game.time.time+(p||0);this.running=true;for(var q=0;q<this.events.length;q++){this.events[q].tick=this.events[q].delay+this._started}},stop:function(p){this.running=false;if(typeof p==="undefined"){p=true}if(p){this.events.length=0}},remove:function(q){for(var p=0;p<this.events.length;p++){if(this.events[p]===q){this.events[p].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(q,p){if(q.tick<p.tick){return -1}else{if(q.tick>p.tick){return 1}}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(p){if(this.paused){return true}this.elapsed=p-this._now;this._now=p;if(this.elapsed>this.timeCap){this.adjustEvents(p-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=(this._now+this.events[this._i].delay)-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(s){for(var q=0;q<this.events.length;q++){if(!this.events[q].pendingDelete){var p=this.events[q].tick-s;if(p<0){p=0}this.events[q].tick=this._now+p}}var r=this.nextTick-s;if(r<0){this.nextTick=this._now}else{this.nextTick=this._now+r}},resume:function(){if(!this.paused){return}var p=this.game.time.time;this._pauseTotal+=p-this._now;this._now=p;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(g.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(g.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(g.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(g.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(g.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*0.001}else{return 0}}});g.Timer.prototype.constructor=g.Timer;g.TimerEvent=function(w,t,u,r,p,v,q,s){this.timer=w;this.delay=t;this.tick=u;this.repeatCount=r-1;this.loop=p;this.callback=v;this.callbackContext=q;this.args=s;this.pendingDelete=false};g.TimerEvent.prototype.constructor=g.TimerEvent;g.AnimationManager=function(p){this.sprite=p;this.game=p.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};g.AnimationManager.prototype={loadFrameData:function(p,r){if(typeof p==="undefined"){return false}if(this.isLoaded){for(var q in this._anims){this._anims[q].updateFrameData(p)}}this._frameData=p;if(typeof r==="undefined"||r===null){this.frame=0}else{if(typeof r==="string"){this.frameName=r}else{this.frame=r}}this.isLoaded=true;return true},copyFrameData:function(p,r){this._frameData=p.clone();if(this.isLoaded){for(var q in this._anims){this._anims[q].updateFrameData(this._frameData)}}if(typeof r==="undefined"||r===null){this.frame=0}else{if(typeof r==="string"){this.frameName=r}else{this.frame=r}}this.isLoaded=true;return true},add:function(s,t,r,q,p){t=t||[];r=r||60;if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){if(t&&typeof t[0]==="number"){p=true}else{p=false}}this._outputFrames.length=0;this._frameData.getFrameIndexes(t,p,this._outputFrames);this._anims[s]=new g.Animation(this.game,this.sprite,s,this._frameData,this._outputFrames,r,q);this.currentAnim=this._anims[s];this.currentFrame=this.currentAnim.currentFrame;if(this.sprite.__tilePattern){this.sprite.__tilePattern=false;this.tilingTexture=false}return this._anims[s]},validateFrames:function(r,p){if(typeof p==="undefined"){p=true}for(var q=0;q<r.length;q++){if(p===true){if(r[q]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(r[q])===false){return false}}}return true},play:function(s,r,q,p){if(this._anims[s]){if(this.currentAnim===this._anims[s]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(r,q,p)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[s];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(r,q,p)}}},stop:function(q,p){if(typeof p==="undefined"){p=false}if(typeof q==="string"){if(this._anims[q]){this.currentAnim=this._anims[q];this.currentAnim.stop(p)}}else{if(this.currentAnim){this.currentAnim.stop(p)}}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(p){if(this.currentAnim){this.currentAnim.next(p);this.currentFrame=this.currentAnim.currentFrame}},previous:function(p){if(this.currentAnim){this.currentAnim.previous(p);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(p){if(typeof p==="string"){if(this._anims[p]){return this._anims[p]}}return null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}},destroy:function(){var p=null;for(var p in this._anims){if(this._anims.hasOwnProperty(p)){this._anims[p].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};g.AnimationManager.prototype.constructor=g.AnimationManager;Object.defineProperty(g.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(g.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(g.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(p){this.currentAnim.paused=p}});Object.defineProperty(g.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(g.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(p){if(typeof p==="number"&&this._frameData&&this._frameData.getFrame(p)!==null){this.currentFrame=this._frameData.getFrame(p);if(this.currentFrame){this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}}});Object.defineProperty(g.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(p){if(typeof p==="string"&&this._frameData.getFrameByName(p)!==null){this.currentFrame=this._frameData.getFrameByName(p);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}else{console.warn("Cannot set frameName: "+p)}}});g.Animation=function(q,u,s,t,v,r,p){if(typeof p==="undefined"){p=false}this.game=q;this._parent=u;this._frameData=t;this.name=s;this._frames=[];this._frames=this._frames.concat(v);this.delay=1000/r;this.loop=p;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new g.Signal();this.onUpdate=null;this.onComplete=new g.Signal();this.onLoop=new g.Signal();this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};g.Animation.prototype={play:function(r,q,p){if(typeof r==="number"){this.delay=1000/r}if(typeof q==="boolean"){this.loop=q}if(typeof p!=="undefined"){this.killOnComplete=p}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.updateCurrentFrame(false);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},setFrame:function(r,p){var s;if(typeof p==="undefined"){p=false}if(typeof r==="string"){for(var q=0;q<this._frames.length;q++){if(this._frameData.getFrame(this._frames[q]).name===r){s=q}}}else{if(typeof r==="number"){if(p){s=r}else{for(var q=0;q<this._frames.length;q++){if(this._frames[q]===s){s=q}}}}}if(s){this._frameIndex=s-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(p,q){if(typeof p==="undefined"){p=false}if(typeof q==="undefined"){q=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(p){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(q){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);return this.updateCurrentFrame(true)}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(p){if(!this._frameData){return false}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}if(this.onUpdate&&p){this.onUpdate.dispatch(this,this.currentFrame);return !!this._frameData}else{return true}},next:function(p){if(typeof p==="undefined"){p=1}var q=this._frameIndex+p;if(q>=this._frames.length){if(this.loop){q%=this._frames.length}else{q=this._frames.length-1}}if(q!==this._frameIndex){this._frameIndex=q;this.updateCurrentFrame(true)}},previous:function(p){if(typeof p==="undefined"){p=1}var q=this._frameIndex-p;if(q<0){if(this.loop){q=this._frames.length+q}else{q++}}if(q!==this._frameIndex){this._frameIndex=q;this.updateCurrentFrame(true)}},updateFrameData:function(p){this._frameData=p;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};g.Animation.prototype.constructor=g.Animation;Object.defineProperty(g.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(p){this.isPaused=p;if(p){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(g.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(g.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(p){this.currentFrame=this._frameData.getFrame(this._frames[p]);if(this.currentFrame!==null){this._frameIndex=p;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(g.Animation.prototype,"speed",{get:function(){return Math.round(1000/this.delay)},set:function(p){if(p>=1){this.delay=1000/p}}});Object.defineProperty(g.Animation.prototype,"enableUpdate",{get:function(){return(this.onUpdate!==null)},set:function(p){if(p&&this.onUpdate===null){this.onUpdate=new g.Signal()}else{if(!p&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}}});g.Animation.generateFrameNames=function(t,w,r,u,s){if(typeof u==="undefined"){u=""}var p=[];var v="";if(w<r){for(var q=w;q<=r;q++){if(typeof s==="number"){v=g.Utils.pad(q.toString(),s,"0",1)}else{v=q.toString()}v=t+v+u;p.push(v)}}else{for(var q=w;q>=r;q--){if(typeof s==="number"){v=g.Utils.pad(q.toString(),s,"0",1)}else{v=q.toString()}v=t+v+u;p.push(v)}}return p};g.Frame=function(s,q,v,u,p,r,t){this.index=s;this.x=q;this.y=v;this.width=u;this.height=p;this.name=r;this.uuid=t;this.centerX=Math.floor(u/2);this.centerY=Math.floor(p/2);this.distance=g.Math.distance(0,0,u,p);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=u;this.sourceSizeH=p;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};g.Frame.prototype={setTrim:function(t,s,v,q,p,r,u){this.trimmed=t;if(t){this.sourceSizeW=s;this.sourceSizeH=v;this.centerX=Math.floor(s/2);this.centerY=Math.floor(v/2);this.spriteSourceSizeX=q;this.spriteSourceSizeY=p;this.spriteSourceSizeW=r;this.spriteSourceSizeH=u}},clone:function(){var p=new g.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var q in this){if(this.hasOwnProperty(q)){p[q]=this[q]}}return p},getRect:function(p){if(typeof p==="undefined"){p=new g.Rectangle(this.x,this.y,this.width,this.height)}else{p.setTo(this.x,this.y,this.width,this.height)}return p}};g.Frame.prototype.constructor=g.Frame;g.FrameData=function(){this._frames=[];this._frameNames=[]};g.FrameData.prototype={addFrame:function(p){p.index=this._frames.length;this._frames.push(p);if(p.name!==""){this._frameNames[p.name]=p.index}return p},getFrame:function(p){if(p>=this._frames.length){p=0}return this._frames[p]},getFrameByName:function(p){if(typeof this._frameNames[p]==="number"){return this._frames[this._frameNames[p]]}return null},checkFrameName:function(p){if(this._frameNames[p]==null){return false}return true},clone:function(){var q=new g.FrameData();for(var r=0;r<this._frames.length;r++){q._frames.push(this._frames[r].clone())}for(var s in this._frameNames){if(this._frameNames.hasOwnProperty(s)){q._frameNames.push(this._frameNames[s])}}return q},getFrameRange:function(s,p,q){if(typeof q==="undefined"){q=[]}for(var r=s;r<=p;r++){q.push(this._frames[r])}return q},getFrames:function(t,q,r){if(typeof q==="undefined"){q=true}if(typeof r==="undefined"){r=[]}if(typeof t==="undefined"||t.length===0){for(var s=0;s<this._frames.length;s++){r.push(this._frames[s])}}else{for(var s=0,p=t.length;s<p;s++){if(q){r.push(this.getFrame(t[s]))}else{r.push(this.getFrameByName(t[s]))}}}return r},getFrameIndexes:function(t,q,r){if(typeof q==="undefined"){q=true}if(typeof r==="undefined"){r=[]}if(typeof t==="undefined"||t.length===0){for(var s=0,p=this._frames.length;s<p;s++){r.push(this._frames[s].index)}}else{for(var s=0,p=t.length;s<p;s++){if(q){r.push(t[s])}else{if(this.getFrameByName(t[s])){r.push(this.getFrameByName(t[s]).index)}}}}return r}};g.FrameData.prototype.constructor=g.FrameData;Object.defineProperty(g.FrameData.prototype,"total",{get:function(){return this._frames.length}});g.AnimationParser={spriteSheet:function(E,G,A,s,D,v,q){var I=E.cache.getImage(G);if(I==null){return null}var z=I.width;var w=I.height;if(A<=0){A=Math.floor(-z/Math.min(-1,A))}if(s<=0){s=Math.floor(-w/Math.min(-1,s))}var r=Math.floor((z-v)/(A+q));var p=Math.floor((w-v)/(s+q));var H=r*p;if(D!==-1){H=D}if(z===0||w===0||z<A||w<s||H===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+G+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var F=new g.FrameData();var u=v;var t=v;for(var C=0;C<H;C++){var B=E.rnd.uuid();F.addFrame(new g.Frame(C,u,t,A,s,"",B));PIXI.TextureCache[B]=new PIXI.Texture(PIXI.BaseTextureCache[G],{x:u,y:t,width:A,height:s});u+=A+q;if(u+A>z){u=v;t+=s+q}}return F},JSONData:function(p,r,v){if(!r.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(r);return}var t=new g.FrameData();var u=r.frames;var w;for(var q=0;q<u.length;q++){var s=p.rnd.uuid();w=t.addFrame(new g.Frame(q,u[q].frame.x,u[q].frame.y,u[q].frame.w,u[q].frame.h,u[q].filename,s));PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[v],{x:u[q].frame.x,y:u[q].frame.y,width:u[q].frame.w,height:u[q].frame.h});if(u[q].trimmed){w.setTrim(u[q].trimmed,u[q].sourceSize.w,u[q].sourceSize.h,u[q].spriteSourceSize.x,u[q].spriteSourceSize.y,u[q].spriteSourceSize.w,u[q].spriteSourceSize.h)}}return t},JSONDataHash:function(w,x,t){if(!x.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(x);return}var q=new g.FrameData();var u=x.frames;var s;var r=0;for(var v in u){var p=w.rnd.uuid();s=q.addFrame(new g.Frame(r,u[v].frame.x,u[v].frame.y,u[v].frame.w,u[v].frame.h,v,p));PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:u[v].frame.x,y:u[v].frame.y,width:u[v].frame.w,height:u[v].frame.h});if(u[v].trimmed){s.setTrim(u[v].trimmed,u[v].sourceSize.w,u[v].sourceSize.h,u[v].spriteSourceSize.x,u[v].spriteSourceSize.y,u[v].spriteSourceSize.w,u[v].spriteSourceSize.h)}r++}return q},XMLData:function(G,r,s){if(!r.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var H=new g.FrameData();var z=r.getElementsByTagName("SubTexture");var t;var F;var I;var A;var w;var v;var C;var B;var q;var p;var D;var u;for(var E=0;E<z.length;E++){F=G.rnd.uuid();A=z[E].attributes;I=A.name.value;w=parseInt(A.x.value,10);v=parseInt(A.y.value,10);C=parseInt(A.width.value,10);B=parseInt(A.height.value,10);q=null;p=null;if(A.frameX){q=Math.abs(parseInt(A.frameX.value,10));p=Math.abs(parseInt(A.frameY.value,10));D=parseInt(A.frameWidth.value,10);u=parseInt(A.frameHeight.value,10)}t=H.addFrame(new g.Frame(E,w,v,C,B,I,F));PIXI.TextureCache[F]=new PIXI.Texture(PIXI.BaseTextureCache[s],{x:w,y:v,width:C,height:B});if(q!==null||p!==null){t.setTrim(true,C,B,q,p,D,u)}}return H}};g.Cache=function(p){this.game=p;this.autoResolveURL=false;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._xml={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this._urlMap={};this._urlResolver=new Image();this._urlTemp=null;this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new g.Signal();this._cacheMap=[];this._cacheMap[g.Cache.CANVAS]=this._canvases;this._cacheMap[g.Cache.IMAGE]=this._images;this._cacheMap[g.Cache.TEXTURE]=this._textures;this._cacheMap[g.Cache.SOUND]=this._sounds;this._cacheMap[g.Cache.TEXT]=this._text;this._cacheMap[g.Cache.PHYSICS]=this._physics;this._cacheMap[g.Cache.TILEMAP]=this._tilemaps;this._cacheMap[g.Cache.BINARY]=this._binary;this._cacheMap[g.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[g.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[g.Cache.JSON]=this._json;this._cacheMap[g.Cache.XML]=this._xml};g.Cache.CANVAS=1;g.Cache.IMAGE=2;g.Cache.TEXTURE=3;g.Cache.SOUND=4;g.Cache.TEXT=5;g.Cache.PHYSICS=6;g.Cache.TILEMAP=7;g.Cache.BINARY=8;g.Cache.BITMAPDATA=9;g.Cache.BITMAPFONT=10;g.Cache.JSON=11;g.Cache.XML=12;g.Cache.prototype={addCanvas:function(r,p,q){this._canvases[r]={canvas:p,context:q}},addBinary:function(q,p){this._binary[q]=p},addBitmapData:function(p,r,q){r.key=p;if(typeof q==="undefined"){q=new g.FrameData();q.addFrame(r.textureFrame)}this._bitmapDatas[p]={data:r,frameData:q};return r},addRenderTexture:function(p,q){var r=new g.Frame(0,0,0,q.width,q.height,"","");this._textures[p]={texture:q,frame:r}},addSpriteSheet:function(s,r,u,p,q,v,t,w){this._images[s]={url:r,data:u,frameWidth:p,frameHeight:q,margin:t,spacing:w};PIXI.BaseTextureCache[s]=new PIXI.BaseTexture(u);PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[s]);this._images[s].frameData=g.AnimationParser.spriteSheet(this.game,s,p,q,v,t,w);this._resolveURL(r,this._images[s])},addTilemap:function(q,p,s,r){this._tilemaps[q]={url:p,data:s,format:r};this._resolveURL(p,this._tilemaps[q])},addTextureAtlas:function(r,q,s,p,t){this._images[r]={url:q,data:s};PIXI.BaseTextureCache[r]=new PIXI.BaseTexture(s);PIXI.TextureCache[r]=new PIXI.Texture(PIXI.BaseTextureCache[r]);if(t==g.Loader.TEXTURE_ATLAS_JSON_ARRAY){this._images[r].frameData=g.AnimationParser.JSONData(this.game,p,r)}else{if(t==g.Loader.TEXTURE_ATLAS_JSON_HASH){this._images[r].frameData=g.AnimationParser.JSONDataHash(this.game,p,r)}else{if(t==g.Loader.TEXTURE_ATLAS_XML_STARLING){this._images[r].frameData=g.AnimationParser.XMLData(this.game,p,r)}}}this._resolveURL(q,this._images[r])},addBitmapFont:function(q,p,u,r,t,s){this._images[q]={url:p,data:u};PIXI.BaseTextureCache[q]=new PIXI.BaseTexture(u);PIXI.TextureCache[q]=new PIXI.Texture(PIXI.BaseTextureCache[q]);g.LoaderParser.bitmapFont(this.game,r,q,t,s);this._bitmapFont[q]=PIXI.BitmapText.fonts[q];this._resolveURL(p,this._bitmapFont[q])},addPhysicsData:function(q,p,r,s){this._physics[q]={url:p,data:r,format:s};this._resolveURL(p,this._physics[q])},addDefaultImage:function(){var p=new Image();p.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:p};this._images.__default.frame=new g.Frame(0,0,0,32,32,"","");this._images.__default.frameData=new g.FrameData();this._images.__default.frameData.addFrame(new g.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(p);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var p=new Image();p.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:p};this._images.__missing.frame=new g.Frame(0,0,0,32,32,"","");this._images.__missing.frameData=new g.FrameData();this._images.__missing.frameData.addFrame(new g.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(p);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(q,p,r){this._text[q]={url:p,data:r};this._resolveURL(p,this._text[q])},addJSON:function(q,p,r){this._json[q]={url:p,data:r};this._resolveURL(p,this._json[q])},addXML:function(q,p,r){this._xml[q]={url:p,data:r};this._resolveURL(p,this._xml[q])},addImage:function(q,p,r){if(this.checkImageKey(q)){this.removeImage(q)}this._images[q]={url:p,data:r};this._images[q].frame=new g.Frame(0,0,0,r.width,r.height,q,this.game.rnd.uuid());this._images[q].frameData=new g.FrameData();this._images[q].frameData.addFrame(new g.Frame(0,0,0,r.width,r.height,p,this.game.rnd.uuid()));PIXI.BaseTextureCache[q]=new PIXI.BaseTexture(r);PIXI.TextureCache[q]=new PIXI.Texture(PIXI.BaseTextureCache[q]);this._resolveURL(p,this._images[q])},addSound:function(s,r,u,q,t){q=q||true;t=t||false;var p=false;if(t){p=true}this._sounds[s]={url:r,data:u,isDecoding:false,decoded:p,webAudio:q,audioTag:t,locked:this.game.sound.touchLocked};this._resolveURL(r,this._sounds[s])},reloadSound:function(p){var q=this;if(this._sounds[p]){this._sounds[p].data.src=this._sounds[p].url;this._sounds[p].data.addEventListener("canplaythrough",function(){return q.reloadSoundComplete(p)},false);this._sounds[p].data.load()}},reloadSoundComplete:function(p){if(this._sounds[p]){this._sounds[p].locked=false;this.onSoundUnlock.dispatch(p)}},updateSound:function(p,r,q){if(this._sounds[p]){this._sounds[p][r]=q}},decodedSound:function(p,q){this._sounds[p].data=q;this._sounds[p].decoded=true;this._sounds[p].isDecoding=false},getCanvas:function(p){if(this._canvases[p]){return this._canvases[p].canvas}else{console.warn('Phaser.Cache.getCanvas: Invalid key: "'+p+'"');return null}},getBitmapData:function(p){if(this._bitmapDatas[p]){return this._bitmapDatas[p].data}else{console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+p+'"');return null}},getBitmapFont:function(p){if(this._bitmapFont[p]){return this._bitmapFont[p]}else{console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+p+'"');return null}},getPhysicsData:function(r,q,p){if(typeof q==="undefined"||q===null){if(this._physics[r]){return this._physics[r].data}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+r+'"')}}else{if(this._physics[r]&&this._physics[r].data[q]){var s=this._physics[r].data[q];if(s&&p){for(var t in s){t=s[t];if(t.fixtureKey===p){return t}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+p+" in "+r+'"')}else{return s}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+r+" / "+q+'"')}}return null},checkKey:function(q,p){if(this._cacheMap[q][p]){return true}return false},checkCanvasKey:function(p){return this.checkKey(g.Cache.CANVAS,p)},checkImageKey:function(p){return this.checkKey(g.Cache.IMAGE,p)},checkTextureKey:function(p){return this.checkKey(g.Cache.TEXTURE,p)},checkSoundKey:function(p){return this.checkKey(g.Cache.SOUND,p)},checkTextKey:function(p){return this.checkKey(g.Cache.TEXT,p)},checkPhysicsKey:function(p){return this.checkKey(g.Cache.PHYSICS,p)},checkTilemapKey:function(p){return this.checkKey(g.Cache.TILEMAP,p)},checkBinaryKey:function(p){return this.checkKey(g.Cache.BINARY,p)},checkBitmapDataKey:function(p){return this.checkKey(g.Cache.BITMAPDATA,p)},checkBitmapFontKey:function(p){return this.checkKey(g.Cache.BITMAPFONT,p)},checkJSONKey:function(p){return this.checkKey(g.Cache.JSON,p)},checkXMLKey:function(p){return this.checkKey(g.Cache.XML,p)},checkURL:function(p){if(this._urlMap[this._resolveURL(p)]){return true}return false},getImage:function(p){if(this._images[p]){return this._images[p].data}else{console.warn('Phaser.Cache.getImage: Invalid key: "'+p+'"');return null}},getTilemapData:function(p){if(this._tilemaps[p]){return this._tilemaps[p]}else{console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+p+'"');return null}},getFrameData:function(p,q){if(typeof q==="undefined"){q=g.Cache.IMAGE}if(this._cacheMap[q][p]){return this._cacheMap[q][p].frameData}return null},updateFrameData:function(p,q){if(this._images[p]){this._images[p].frameData=q}},getFrameByIndex:function(p,q){if(this._images[p]){return this._images[p].frameData.getFrame(q)}return null},getFrameByName:function(p,q){if(this._images[p]){return this._images[p].frameData.getFrameByName(q)}return null},getFrame:function(p){if(this._images[p]){return this._images[p].frame}return null},getTextureFrame:function(p){if(this._textures[p]){return this._textures[p].frame}return null},getRenderTexture:function(p){if(this._textures[p]){return this._textures[p]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+p+'"');return null}},getTexture:function(p){if(this._textures[p]){return this._textures[p]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+p+'"')}},getSound:function(p){if(this._sounds[p]){return this._sounds[p]}else{console.warn('Phaser.Cache.getSound: Invalid key: "'+p+'"');return null}},getSoundData:function(p){if(this._sounds[p]){return this._sounds[p].data}else{console.warn('Phaser.Cache.getSoundData: Invalid key: "'+p+'"');return null}},isSoundDecoded:function(p){if(this._sounds[p]){return this._sounds[p].decoded}},isSoundReady:function(p){return(this._sounds[p]&&this._sounds[p].decoded&&this.game.sound.touchLocked===false)},getFrameCount:function(p){if(this._images[p]){return this._images[p].frameData.total}return 0},getText:function(p){if(this._text[p]){return this._text[p].data}else{console.warn('Phaser.Cache.getText: Invalid key: "'+p+'"');return null}},getJSON:function(p){if(this._json[p]){return this._json[p].data}else{console.warn('Phaser.Cache.getJSON: Invalid key: "'+p+'"');return null}},getXML:function(p){if(this._xml[p]){return this._xml[p].data}else{console.warn('Phaser.Cache.getXML: Invalid key: "'+p+'"');return null}},getBinary:function(p){if(this._binary[p]){return this._binary[p]}else{console.warn('Phaser.Cache.getBinary: Invalid key: "'+p+'"');return null}},getURL:function(p){var p=this._resolveURL(p);if(p){return this._urlMap[p]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+p+'" or Cache.autoResolveURL was false');return null}},getUrl:function(p){return this.getURL(p)},getKeys:function(q){var s=null;switch(q){case g.Cache.CANVAS:s=this._canvases;break;case g.Cache.IMAGE:s=this._images;break;case g.Cache.TEXTURE:s=this._textures;break;case g.Cache.SOUND:s=this._sounds;break;case g.Cache.TEXT:s=this._text;break;case g.Cache.PHYSICS:s=this._physics;break;case g.Cache.TILEMAP:s=this._tilemaps;break;case g.Cache.BINARY:s=this._binary;break;case g.Cache.BITMAPDATA:s=this._bitmapDatas;break;case g.Cache.BITMAPFONT:s=this._bitmapFont;break;case g.Cache.JSON:s=this._json;break;case g.Cache.XML:s=this._xml;break}if(!s){return}var p=[];for(var r in s){if(r!=="__default"&&r!=="__missing"){p.push(r)}}return p},removeCanvas:function(p){delete this._canvases[p]},removeImage:function(q,p){if(typeof p==="undefined"){p=true}delete this._images[q];if(p){PIXI.BaseTextureCache[q].destroy()}},removeSound:function(p){delete this._sounds[p]},removeText:function(p){delete this._text[p]},removeJSON:function(p){delete this._json[p]},removeXML:function(p){delete this._xml[p]},removePhysics:function(p){delete this._physics[p]},removeTilemap:function(p){delete this._tilemaps[p]},removeBinary:function(p){delete this._binary[p]},removeBitmapData:function(p){delete this._bitmapDatas[p]},removeBitmapFont:function(p){delete this._bitmapFont[p]},_resolveURL:function(p,q){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+p;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(q){this._urlMap[this._urlTemp]=q}return this._urlTemp},destroy:function(){for(var q in this._images){if(q!=="__default"&&q!=="__missing"){delete this._images[q]}}var r=[this._canvases,this._sounds,this._text,this._json,this._xml,this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont];for(var p=0;p<r.length;p++){for(var q in r[p]){delete r[p][q]}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};g.Cache.prototype.constructor=g.Cache;g.Loader=function(p){this.game=p;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.onLoadStart=new g.Signal();this.onLoadComplete=new g.Signal();this.onPackComplete=new g.Signal();this.onFileStart=new g.Signal();this.onFileComplete=new g.Signal();this.onFileError=new g.Signal();this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};g.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;g.Loader.TEXTURE_ATLAS_JSON_HASH=1;g.Loader.TEXTURE_ATLAS_XML_STARLING=2;g.Loader.PHYSICS_LIME_CORONA_JSON=3;g.Loader.PHYSICS_PHASER_JSON=4;g.Loader.prototype={setPreloadSprite:function(p,q){q=q||0;this.preloadSprite={sprite:p,direction:q,width:p.width,height:p.height,rect:null};if(q===0){this.preloadSprite.rect=new g.Rectangle(0,0,1,p.height)}else{this.preloadSprite.rect=new g.Rectangle(0,0,p.width,1)}p.crop(this.preloadSprite.rect);p.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(q,p){return this.getAssetIndex(q,p)>-1},getAssetIndex:function(s,r){var t=-1;for(var q=0;q<this._fileList.length;q++){var p=this._fileList[q];if(p.type===s&&p.key===r){t=q;if(!p.loaded&&!p.loading){break}}}return t},getAsset:function(q,p){var r=this.getAssetIndex(q,p);if(r>-1){return{index:r,file:this._fileList[r]}}return false},reset:function(q,p){if(typeof p==="undefined"){p=false}if(this.resetLocked){return}if(q){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(p){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(w,x,q,v,u){var t={type:w,key:x,url:q,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(v){for(var p in v){t[p]=v[p]}}var s=this.getAssetIndex(w,x);if(u&&s>-1){var r=this._fileList[s];if(!r.loading&&!r.loaded){this._fileList[s]=t}else{this._fileList.push(t);this._totalFileCount++}}else{if(s===-1){this._fileList.push(t);this._totalFileCount++}}},replaceInFileList:function(s,r,p,q){return this.addToFileList(s,r,p,q,true)},pack:function(u,q,v,p){if(typeof q==="undefined"){q=null}if(typeof v==="undefined"){v=null}if(typeof p==="undefined"){p=null}if(!q&&!v){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var t={type:"packfile",key:u,url:q,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:p};if(v){if(typeof v==="string"){v=JSON.parse(v)}t.data=v||{};t.loaded=true}for(var s=0;s<this._fileList.length+1;s++){var r=this._fileList[s];if(!r||(!r.loaded&&!r.loading&&r.type!=="packfile")){this._fileList.splice(s,1,t);this._totalPackCount++;break}}return this},image:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("image",r,q,undefined,p);return this},text:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("text",r,q,undefined,p);return this},json:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("json",r,q,undefined,p);return this},xml:function(r,q,p){if(typeof p==="undefined"){p=false}this.addToFileList("xml",r,q,undefined,p);return this},script:function(r,q,s,p){if(typeof s==="undefined"){s=false}if(s!==false&&typeof p==="undefined"){p=s}this.addToFileList("script",r,q,{syncPoint:true,callback:s,callbackContext:p});return this},binary:function(r,q,s,p){if(typeof s==="undefined"){s=false}if(s!==false&&typeof p==="undefined"){p=s}this.addToFileList("binary",r,q,{callback:s,callbackContext:p});return this},spritesheet:function(s,r,p,q,u,t,v){if(typeof u==="undefined"){u=-1}if(typeof t==="undefined"){t=0}if(typeof v==="undefined"){v=0}this.addToFileList("spritesheet",s,r,{frameWidth:p,frameHeight:q,frameMax:u,margin:t,spacing:v});return this},audio:function(q,r,p){if(typeof p==="undefined"){p=true}if(typeof r==="string"){r=[r]}this.addToFileList("audio",q,r,{buffer:null,autoDecode:p});return this},audiosprite:function(q,t,s,r,p){if(typeof s==="undefined"){s=null}if(typeof r==="undefined"){r=null}if(typeof p==="undefined"){p=true}this.audio(q,t,p);if(s){this.json(q+"-audioatlas",s)}else{if(r){if(typeof r==="string"){r=JSON.parse(r)}this.game.cache.addJSON(q+"-audioatlas","",r)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}}return this},tilemap:function(q,p,r,s){if(typeof p==="undefined"){p=null}if(typeof r==="undefined"){r=null}if(typeof s==="undefined"){s=g.Tilemap.CSV}if(!p&&!r){console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set.");return this}if(r){switch(s){case g.Tilemap.CSV:break;case g.Tilemap.TILED_JSON:if(typeof r==="string"){r=JSON.parse(r)}break}this.game.cache.addTilemap(q,null,r,s)}else{this.addToFileList("tilemap",q,p,{format:s})}return this},physics:function(q,p,r,s){if(typeof p==="undefined"){p=null}if(typeof r==="undefined"){r=null}if(typeof s==="undefined"){s=g.Physics.LIME_CORONA_JSON}if(!p&&!r){console.warn("Phaser.Loader.physics - Both url and data are null. One must be set.");return this}if(r){if(typeof r==="string"){r=JSON.parse(r)}this.game.cache.addPhysicsData(q,null,r,s)}else{this.addToFileList("physics",q,p,{format:s})}return this},bitmapFont:function(s,r,q,t,v,u){if(typeof q==="undefined"){q=null}if(typeof t==="undefined"){t=null}if(typeof v==="undefined"){v=0}if(typeof u==="undefined"){u=0}if(q){this.addToFileList("bitmapfont",s,r,{xmlURL:q,xSpacing:v,ySpacing:u})}else{if(typeof t==="string"){var p=this.parseXml(t);if(!p){throw new Error("Phaser.Loader. Invalid Bitmap Font XML given")}this.addToFileList("bitmapfont",s,r,{xmlURL:null,xmlData:p,xSpacing:v,ySpacing:u})}}return this},atlasJSONArray:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(s,r,t,p,u){if(typeof t==="undefined"){t=null}if(typeof p==="undefined"){p=null}if(typeof u==="undefined"){u=g.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(t){this.addToFileList("textureatlas",s,r,{atlasURL:t,format:u})}else{switch(u){case g.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof p==="string"){p=JSON.parse(p)}break;case g.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof p==="string"){var q=this.parseXml(p);if(!q){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}p=q}break}this.addToFileList("textureatlas",s,r,{atlasURL:null,atlasData:p,format:u})}return this},withSyncPoint:function(q,p){this._withSyncPointDepth++;try{q.call(p||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(r,p){var q=this.getAsset(r,p);if(q){q.file.syncPoint=true}return this},removeFile:function(r,p){var q=this.getAsset(r,p);if(q){if(!q.loaded&&!q.loading){this._fileList.splice(q.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var s=0;s<this._flightQueue.length;s++){var r=this._flightQueue[s];if(r.loaded||r.error){this._flightQueue.splice(s,1);s--;r.loading=false;r.requestUrl=null;r.requestObject=null;if(r.error){this.onFileError.dispatch(r.key,r)}if(r.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,r.key,!r.error,this._loadedFileCount,this._totalFileCount)}else{if(r.type==="packfile"&&r.error){this._loadedPackCount++;this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)}}}}var p=false;var q=this.enableParallel?g.Math.clamp(this.maxParallelDownloads,1,12):1;for(var s=this._processingHead;s<this._fileList.length;s++){var r=this._fileList[s];if(r.type==="packfile"&&!r.error&&r.loaded&&s===this._processingHead){this.processPack(r);this._loadedPackCount++;this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)}if(r.loaded||r.error){if(s===this._processingHead){this._processingHead=s+1}}else{if(!r.loading&&this._flightQueue.length<q){if(r.type==="packfile"&&!r.data){this._flightQueue.push(r);r.loading=true;this.loadFile(r)}else{if(!p){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(r);r.loading=true;this.onFileStart.dispatch(this.progress,r.key,r.url);this.loadFile(r)}}}}if(!r.loaded&&r.syncPoint){p=true}if(this._flightQueue.length>=q||(p&&this._loadedPackCount===this._totalPackCount)){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else{if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var t=this;setTimeout(function(){t.finishedLoading(true)},2000)}}},finishedLoading:function(p){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!p&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.onLoadComplete.dispatch();this.reset();this.game.state.loadComplete()},asyncComplete:function(q,p){if(typeof p==="undefined"){p=""}q.loaded=true;q.error=!!p;if(p){q.errorMessage=p;console.warn("Phaser.Loader - "+q.type+"["+q.key+"]: "+p)}this.processLoadQueue()},processPack:function(s){var p=s.data[s.key];if(!p){console.warn("Phaser.Loader - "+s.key+": pack has data, but not for pack key");return}for(var r=0;r<p.length;r++){var q=p[r];switch(q.type){case"image":this.image(q.key,q.url,q.overwrite);break;case"text":this.text(q.key,q.url,q.overwrite);break;case"json":this.json(q.key,q.url,q.overwrite);break;case"xml":this.xml(q.key,q.url,q.overwrite);break;case"script":this.script(q.key,q.url,q.callback,s.callbackContext||this);break;case"binary":this.binary(q.key,q.url,q.callback,s.callbackContext||this);break;case"spritesheet":this.spritesheet(q.key,q.url,q.frameWidth,q.frameHeight,q.frameMax,q.margin,q.spacing);break;case"audio":this.audio(q.key,q.urls,q.autoDecode);break;case"audiosprite":this.audio(q.key,q.urls,q.jsonURL);break;case"tilemap":this.tilemap(q.key,q.url,q.data,g.Tilemap[q.format]);break;case"physics":this.physics(q.key,q.url,q.data,g.Loader[q.format]);break;case"bitmapFont":this.bitmapFont(q.key,q.textureURL,q.xmlURL,q.xmlData,q.xSpacing,q.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlasXML":this.atlasXML(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlas":this.atlas(q.key,q.textureURL,q.atlasURL,q.atlasData,g.Loader[q.format]);break}}},transformUrl:function(p){return this.baseURL+p},loadFile:function(p){switch(p.type){case"packfile":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(p);break;case"audio":p.url=this.getAudioURL(p.url);if(p.url){if(this.game.sound.usingWebAudio){this.xhrLoad(p,this.transformUrl(p.url,p),"arraybuffer",this.fileComplete)}else{if(this.game.sound.usingAudioTag){this.loadAudioTag(p)}}}else{this.fileError(p,null,"no supported audio URL specified")}break;case"json":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.xmlLoadComplete);break;case"tilemap":if(p.format===g.Tilemap.TILED_JSON){this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.jsonLoadComplete)}else{if(p.format===g.Tilemap.CSV){this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.csvLoadComplete)}else{this.asyncComplete(p,"invalid Tilemap format: "+p.format)}}break;case"text":case"script":case"physics":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.fileComplete);break;case"binary":this.xhrLoad(p,this.transformUrl(p.url,p),"arraybuffer",this.fileComplete);break}},loadImageTag:function(p){var q=this;p.data=new Image();p.data.name=p.key;if(this.crossOrigin){p.data.crossOrigin=this.crossOrigin}p.data.onload=function(){if(p.data.onload){p.data.onload=null;p.data.onerror=null;q.fileComplete(p)}};p.data.onerror=function(){if(p.data.onload){p.data.onload=null;p.data.onerror=null;q.fileError(p)}};p.data.src=this.transformUrl(p.url,p);if(p.data.complete&&p.data.width&&p.data.height){p.data.onload=null;p.data.onerror=null;this.fileComplete(p)}},loadAudioTag:function(q){var r=this;if(this.game.sound.touchLocked){q.data=new Audio();q.data.name=q.key;q.data.preload="auto";q.data.src=this.transformUrl(q.url,q);this.fileComplete(q)}else{q.data=new Audio();q.data.name=q.key;var p=function(){q.data.removeEventListener("canplaythrough",p,false);q.data.onerror=null;g.GAMES[r.game.id].load.fileComplete(q)};q.data.onerror=function(){q.data.removeEventListener("canplaythrough",p,false);q.data.onerror=null;r.fileError(q)};q.data.preload="auto";q.data.src=this.transformUrl(q.url,q);q.data.addEventListener("canplaythrough",p,false);q.data.load()}},xhrLoad:function(r,q,s,t,p){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(r,q,s,t,p);return}var u=new XMLHttpRequest();u.open("GET",q,true);u.responseType=s;p=p||this.fileError;var v=this;u.onload=function(){try{return t.call(v,r,u)}catch(w){if(!v.hasLoaded){v.asyncComplete(r,w.message||"Exception")}else{if(window.console){console.error(w)}}}};u.onerror=function(){try{return p.call(v,r,u)}catch(w){if(!v.hasLoaded){v.asyncComplete(r,w.message||"Exception")}else{if(window.console){console.error(w)}}}};r.requestObject=u;r.requestUrl=q;u.send()},xhrLoadWithXDR:function(r,q,s,t,p){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var u=new window.XDomainRequest();u.open("GET",q,true);u.responseType=s;u.timeout=3000;p=p||this.fileError;var v=this;u.onerror=function(){try{return p.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};u.ontimeout=function(){try{return p.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};u.onprogress=function(){};u.onload=function(){try{return t.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};r.requestObject=u;r.requestUrl=q;setTimeout(function(){u.send()},0)},getAudioURL:function(s){for(var r=0;r<s.length;r++){var q=s[r];var p;if(q.uri){q=q.uri;p=q.type}else{if(q.indexOf("blob:")===0||q.indexOf("data:")===0){return q}if(q.indexOf("?")>=0){q=q.substr(0,q.indexOf("?"))}var t=q.substr((Math.max(0,q.lastIndexOf("."))||Infinity)+1);p=t.toLowerCase()}if(this.game.device.canPlayAudio(p)){return s[r]}}return null},fileError:function(q,t,s){var p=q.requestUrl||this.transformUrl(q.url,q);var r="error loading asset from URL "+p;if(!s&&t){s=t.status}if(s){r=r+" ("+s+")"}this.asyncComplete(q,r)},fileComplete:function(p,s){var r=true;switch(p.type){case"packfile":var q=JSON.parse(s.responseText);p.data=q||{};break;case"image":this.game.cache.addImage(p.key,p.url,p.data);break;case"spritesheet":this.game.cache.addSpriteSheet(p.key,p.url,p.data,p.frameWidth,p.frameHeight,p.frameMax,p.margin,p.spacing);break;case"textureatlas":if(p.atlasURL==null){this.game.cache.addTextureAtlas(p.key,p.url,p.data,p.atlasData,p.format)}else{r=false;if(p.format==g.Loader.TEXTURE_ATLAS_JSON_ARRAY||p.format==g.Loader.TEXTURE_ATLAS_JSON_HASH){this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",this.jsonLoadComplete)}else{if(p.format==g.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+p.format)}}}break;case"bitmapfont":if(!p.xmlURL){this.game.cache.addBitmapFont(p.key,p.url,p.data,p.xmlData,p.xSpacing,p.ySpacing)}else{r=false;this.xhrLoad(p,this.transformUrl(p.xmlURL,p),"text",this.xmlLoadComplete)}break;case"audio":if(this.game.sound.usingWebAudio){p.data=s.response;this.game.cache.addSound(p.key,p.url,p.data,true,false);if(p.autoDecode){this.game.sound.decode(p.key)}}else{this.game.cache.addSound(p.key,p.url,p.data,false,true)}break;case"text":p.data=s.responseText;this.game.cache.addText(p.key,p.url,p.data);break;case"physics":var q=JSON.parse(s.responseText);this.game.cache.addPhysicsData(p.key,p.url,q,p.format);break;case"script":p.data=document.createElement("script");p.data.language="javascript";p.data.type="text/javascript";p.data.defer=false;p.data.text=s.responseText;document.head.appendChild(p.data);if(p.callback){p.data=p.callback.call(p.callbackContext,p.key,s.responseText)}break;case"binary":if(p.callback){p.data=p.callback.call(p.callbackContext,p.key,s.response)}else{p.data=s.response}this.game.cache.addBinary(p.key,p.data);break}if(r){this.asyncComplete(p)}},jsonLoadComplete:function(p,r){var q=JSON.parse(r.responseText);if(p.type==="tilemap"){this.game.cache.addTilemap(p.key,p.url,q,p.format)}else{if(p.type==="json"){this.game.cache.addJSON(p.key,p.url,q)}else{this.game.cache.addTextureAtlas(p.key,p.url,p.data,q,p.format)}}this.asyncComplete(p)},csvLoadComplete:function(p,r){var q=r.responseText;this.game.cache.addTilemap(p.key,p.url,q,p.format);this.asyncComplete(p)},xmlLoadComplete:function(r,t){var s=t.responseText;var q=this.parseXml(s);if(!q){var p=t.responseType||t.contentType;console.warn("Phaser.Loader - "+r.key+": invalid XML ("+p+")");this.asyncComplete(r,"invalid XML");return}if(r.type==="bitmapfont"){this.game.cache.addBitmapFont(r.key,r.url,r.data,q,r.xSpacing,r.ySpacing)}else{if(r.type==="textureatlas"){this.game.cache.addTextureAtlas(r.key,r.url,r.data,q,r.format)}else{if(r.type==="xml"){this.game.cache.addXML(r.key,r.url,q)}}}this.asyncComplete(r)},parseXml:function(q){var p;try{if(window.DOMParser){var s=new DOMParser();p=s.parseFromString(q,"text/xml")}else{p=new ActiveXObject("Microsoft.XMLDOM");p.async="false";p.loadXML(q)}}catch(r){p=null}if(!p||!p.documentElement||p.getElementsByTagName("parsererror").length){return null}else{return p}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(g.Loader.prototype,"progressFloat",{get:function(){var p=(this._loadedFileCount/this._totalFileCount)*100;return g.Math.clamp(p||0,0,100)}});Object.defineProperty(g.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});g.Loader.prototype.constructor=g.Loader;g.LoaderParser={bitmapFont:function(E,v,z,A,w){var s={};var q=v.getElementsByTagName("info")[0];var x=v.getElementsByTagName("common")[0];s.font=q.getAttribute("face");s.size=parseInt(q.getAttribute("size"),10);s.lineHeight=parseInt(x.getAttribute("lineHeight"),10)+w;s.chars={};var y=v.getElementsByTagName("char");for(var r=0;r<y.length;r++){var D=parseInt(y[r].getAttribute("id"),10);var C=new PIXI.Rectangle(parseInt(y[r].getAttribute("x"),10),parseInt(y[r].getAttribute("y"),10),parseInt(y[r].getAttribute("width"),10),parseInt(y[r].getAttribute("height"),10));s.chars[D]={xOffset:parseInt(y[r].getAttribute("xoffset"),10),yOffset:parseInt(y[r].getAttribute("yoffset"),10),xAdvance:parseInt(y[r].getAttribute("xadvance"),10)+A,kerning:{},texture:PIXI.TextureCache[z]=new PIXI.Texture(PIXI.BaseTextureCache[z],C)}}var B=v.getElementsByTagName("kerning");for(r=0;r<B.length;r++){var u=parseInt(B[r].getAttribute("first"),10);var p=parseInt(B[r].getAttribute("second"),10);var t=parseInt(B[r].getAttribute("amount"),10);s.chars[p].kerning[u]=t}PIXI.BitmapText.fonts[z]=s}};g.AudioSprite=function(r,s){this.game=r;this.key=s;this.config=this.game.cache.getJSON(s+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var q in this.config.spritemap){var p=this.config.spritemap[q];var t=this.game.add.sound(this.key);t.addMarker(q,p.start,(p.end-p.start),null,p.loop);this.sounds[q]=t}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};g.AudioSprite.prototype={play:function(p,q){if(typeof q==="undefined"){q=1}return this.sounds[p].play(p,null,q)},stop:function(p){if(!p){for(var q in this.sounds){this.sounds[q].stop()}}else{this.sounds[p].stop()}},get:function(p){return this.sounds[p]}};g.AudioSprite.prototype.constructor=g.AudioSprite;g.Sound=function(r,s,t,p,q){if(typeof t==="undefined"){t=1}if(typeof p==="undefined"){p=false}if(typeof q==="undefined"){q=r.sound.connectToMaster}this.game=r;this.name=s;this.key=s;this.loop=p;this.volume=t;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=t*this.game.sound.volume;if(q){this.gainNode.connect(this.masterGainNode)}}else{if(this.usingAudioTag){if(this.game.cache.getSound(s)&&this.game.cache.isSoundReady(s)){this._sound=this.game.cache.getSoundData(s);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}}this.onDecoded=new g.Signal();this.onPlay=new g.Signal();this.onPause=new g.Signal();this.onResume=new g.Signal();this.onLoop=new g.Signal();this.onStop=new g.Signal();this.onMute=new g.Signal();this.onMarkerComplete=new g.Signal();this.onFadeComplete=new g.Signal();this._volume=t;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};g.Sound.prototype={soundHasUnlocked:function(p){if(p===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(q,t,s,r,p){if(typeof r==="undefined"){r=1}if(typeof p==="undefined"){p=false}this.markers[q]={name:q,start:t,stop:t+s,volume:r,duration:s,durationMS:s*1000,loop:p}},removeMarker:function(p){delete this.markers[p]},onEndedHandler:function(){this.isPlaying=false;this.stop()},update:function(){if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(p){this.play(null,0,p,true)},play:function(r,p,t,q,s){if(typeof r==="undefined"||r===false||r===null){r=""}if(typeof s==="undefined"){s=true}if(this.isPlaying&&!this.allowMultiple&&!s&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||s)){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(u){}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}if(r===""&&Object.keys(this.markers).length>0){return this}if(r!==""){this.currentMarker=r;if(this.markers[r]){this.position=this.markers[r].start;this.volume=this.markers[r].volume;this.loop=this.markers[r].loop;this.duration=this.markers[r].duration;this.durationMS=this.markers[r].durationMS;if(typeof t!=="undefined"){this.volume=t}if(typeof q!=="undefined"){this.loop=q}this._tempMarker=r;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{return this}}else{p=p||0;if(typeof t==="undefined"){t=this._volume}if(typeof q==="undefined"){q=this.loop}this.position=p;this.volume=t;this.loop=q;this.duration=0;this.durationMS=0;this._tempMarker=r;this._tempPosition=p;this._tempVolume=t;this._tempLoop=q}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer===null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop&&r===""){this._sound.loop=true}if(!this.loop&&r===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1000)}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&r===""){this._sound.start(0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(r,p,s,q){r=r||"";p=p||0;s=s||1;if(typeof q==="undefined"){q=false}this.play(r,p,s,q,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var r=this.position+(this.pausedPosition/1000);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var q=this.duration-(this.pausedPosition/1000);if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,r,q)}else{this._sound.start(0,r,q)}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.time-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(q){}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.pendingPlayback=false;this.isPlaying=false;var p=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}if(!this.paused){this.onStop.dispatch(this,p)}},fadeIn:function(r,q,p){if(typeof q==="undefined"){q=false}if(typeof p==="undefined"){p=this.currentMarker}if(this.paused){return}this.play(p,0,0,q);this.fadeTo(r,1)},fadeOut:function(p){this.fadeTo(p,0)},fadeTo:function(q,p){if(!this.isPlaying||this.paused||p===this.volume){return}if(typeof q==="undefined"){q=1000}if(typeof p==="undefined"){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:p},q,g.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},destroy:function(p){if(typeof p==="undefined"){p=true}this.stop();if(p){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};g.Sound.prototype.constructor=g.Sound;Object.defineProperty(g.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(g.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(g.Sound.prototype,"mute",{get:function(){return(this._muted||this.game.sound.mute)},set:function(p){p=p||null;if(p){this._muted=true;if(this.usingWebAudio){this._muteVolume=this.gainNode.gain.value;this.gainNode.gain.value=0}else{if(this.usingAudioTag&&this._sound){this._muteVolume=this._sound.volume;this._sound.volume=0}}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}}this.onMute.dispatch(this)}});Object.defineProperty(g.Sound.prototype,"volume",{get:function(){return this._volume},set:function(p){if(this.usingWebAudio){this._volume=p;this.gainNode.gain.value=p}else{if(this.usingAudioTag&&this._sound){if(p>=0&&p<=1){this._volume=p;this._sound.volume=p}}}}});g.SoundManager=function(p){this.game=p;this.onSoundDecode=new g.Signal();this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new g.ArraySet();this._watching=false;this._watchCallback=null;this._watchContext=null;this.context=null;this.usingWebAudio=true;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32};g.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(!this.game.device.cocoonJS&&this.game.device.iOS||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.game.input.touch.callbackContext=this;this.game.input.touch.touchStartCallback=this.unlock;this.game.input.mouse.callbackContext=this;this.game.input.mouse.mouseDownCallback=this.unlock;this.touchLocked=true}else{this.touchLocked=false}if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(window.PhaserGlobal.disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext){this.context=window.PhaserGlobal.audioContext}else{if(!!window.AudioContext){try{this.context=new window.AudioContext()}catch(p){this.context=null;this.usingWebAudio=false;this.noAudio=true}}else{if(!!window.webkitAudioContext){try{this.context=new window.webkitAudioContext()}catch(p){this.context=null;this.usingWebAudio=false;this.noAudio=true}}}}if(!!window.Audio&&this.context===null){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}},unlock:function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||(window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===true)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null;this.game.input.mouse.callbackContext=null;this.game.input.mouse.mouseDownCallback=null}else{var p=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=p;this._unlockSource.connect(this.context.destination);if(typeof this._unlockSource.start==="undefined"){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}},stopAll:function(){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].stop()}}},pauseAll:function(){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].pause()}}},resumeAll:function(){for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].resume()}}},decode:function(q,s){s=s||null;var p=this.game.cache.getSoundData(q);if(p){if(this.game.cache.isSoundDecoded(q)===false){this.game.cache.updateSound(q,"isDecoding",true);var r=this;this.context.decodeAudioData(p,function(t){if(t){r.game.cache.decodedSound(q,t);r.onSoundDecode.dispatch(q,s)}})}}},setDecodedCallback:function(r,s,p){if(typeof r==="string"){r=[r]}this._watchList.reset();for(var q=0;q<r.length;q++){if(r[q] instanceof g.Sound){if(!this.game.cache.isSoundDecoded(r[q].key)){this._watchList.add(r[q].key)}}else{if(!this.game.cache.isSoundDecoded(r[q])){this._watchList.add(r[q])}}}if(this._watchList.total===0){this._watching=false;s.call(p)}else{this._watching=true;this._watchCallback=s;this._watchContext=p}},update:function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if((this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null}}}for(var q=0;q<this._sounds.length;q++){this._sounds[q].update()}if(this._watching){var p=this._watchList.first;while(p){if(this.game.cache.isSoundDecoded(p)){this._watchList.remove(p)}p=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(r,s,p,q){if(typeof s==="undefined"){s=1}if(typeof p==="undefined"){p=false}if(typeof q==="undefined"){q=this.connectToMaster}var t=new g.Sound(this.game,r,s,p,q);this._sounds.push(t);return t},addSprite:function(q){var p=new g.AudioSprite(this.game,q);return p},remove:function(q){var p=this._sounds.length;while(p--){if(this._sounds[p]===q){this._sounds[p].destroy(false);this._sounds.splice(p,1);return true}}return false},removeByKey:function(q){var p=this._sounds.length;var r=0;while(p--){if(this._sounds[p].key===q){this._sounds[p].destroy(false);this._sounds.splice(p,1);r++}}return r},play:function(q,r,p){var s=this.add(q,r,p);s.play();return s},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].mute=true}}},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].mute=false}}},destroy:function(){this.stopAll();for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context&&window.PhaserGlobal){window.PhaserGlobal.audioContext=this.context}}};g.SoundManager.prototype.constructor=g.SoundManager;Object.defineProperty(g.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(p){p=p||null;if(p){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(g.SoundManager.prototype,"volume",{get:function(){if(this.usingWebAudio){return this.masterGain.gain.value}else{return this._volume}},set:function(q){this._volume=q;if(this.usingWebAudio){this.masterGain.gain.value=q}else{for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].volume=this._sounds[p].volume*q}}}}});g.Utils.Debug=function(p){this.game=p;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};g.Utils.Debug.prototype={boot:function(){if(this.game.renderType===g.CANVAS){this.context=this.game.context}else{this.bmd=this.game.make.bitmapData(this.game.width,this.game.height);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.canvas=g.Canvas.create(this.game.width,this.game.height,"",true);this.context=this.canvas.getContext("2d")}},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(p,s,q,r){if(typeof p!=="number"){p=0}if(typeof s!=="number"){s=0}q=q||"rgb(255,255,255)";if(typeof r==="undefined"){r=0}this.currentX=p;this.currentY=s;this.currentColor=q;this.currentAlpha=this.context.globalAlpha;this.columnWidth=r;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=q;this.context.fillStyle=q;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha},line:function(){var p=this.currentX;for(var q=0;q<arguments.length;q++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[q],p+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[q],p,this.currentY);p+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sound: "+r.key+" Locked: "+r.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(r.key)+" Pending Playback: "+r.pendingPlayback);this.line("Decoded: "+r.isDecoded+" Decoding: "+r.isDecoding);this.line("Total Duration: "+r.totalDuration+" Playing: "+r.isPlaying);this.line("Time: "+r.currentTime);this.line("Volume: "+r.volume+" Muted: "+r.mute);this.line("WebAudio: "+r.usingWebAudio+" Audio: "+r.usingAudioTag);if(r.currentMarker!==""){this.line("Marker: "+r.currentMarker+" Duration: "+r.duration+" (ms: "+r.durationMS+")");this.line("Start: "+r.markers[r.currentMarker].start+" Stop: "+r.markers[r.currentMarker].stop);this.line("Position: "+r.position)}this.stop()},cameraInfo:function(r,p,s,q){this.start(p,s,q);this.line("Camera ("+r.width+" x "+r.height+")");this.line("X: "+r.x+" Y: "+r.y);if(r.bounds){this.line("Bounds x: "+r.bounds.x+" Y: "+r.bounds.y+" w: "+r.bounds.width+" h: "+r.bounds.height)}this.line("View x: "+r.view.x+" Y: "+r.view.y+" w: "+r.view.width+" h: "+r.view.height);this.line("Total in view: "+r.totalInView);this.stop()},timer:function(s,p,r,q){this.start(p,r,q);this.line("Timer (running: "+s.running+" expired: "+s.expired+")");this.line("Next Tick: "+s.next+" Duration: "+s.duration);this.line("Paused: "+s.paused+" Length: "+s.length);this.stop()},pointer:function(t,s,q,r,p){if(t==null){return}if(typeof s==="undefined"){s=false}q=q||"rgba(0,255,0,0.5)";r=r||"rgba(255,0,0,0.5)";if(s===true&&t.isUp===true){return}this.start(t.x,t.y-100,p);this.context.beginPath();this.context.arc(t.x,t.y,t.circle.radius,0,Math.PI*2);if(t.active){this.context.fillStyle=q}else{this.context.fillStyle=r}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(t.positionDown.x,t.positionDown.y);this.context.lineTo(t.position.x,t.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+t.id+" Active: "+t.active);this.line("World X: "+t.worldX+" World Y: "+t.worldY);this.line("Screen X: "+t.x+" Screen Y: "+t.y);this.line("Duration: "+t.duration+" ms");this.line("is Down: "+t.isDown+" is Up: "+t.isUp);this.stop()},spriteInputInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sprite Input: ("+r.width+" x "+r.height+")");this.line("x: "+r.input.pointerX().toFixed(1)+" y: "+r.input.pointerY().toFixed(1));this.line("over: "+r.input.pointerOver()+" duration: "+r.input.overDuration().toFixed(0));this.line("down: "+r.input.pointerDown()+" duration: "+r.input.downDuration().toFixed(0));this.line("just over: "+r.input.justOver()+" just out: "+r.input.justOut());this.stop()},key:function(r,p,s,q){this.start(p,s,q,150);this.line("Key:",r.keyCode,"isDown:",r.isDown);this.line("justDown:",r.justDown,"justUp:",r.justUp);this.line("Time Down:",r.timeDown.toFixed(0),"duration:",r.duration.toFixed(0));this.stop()},inputInfo:function(p,r,q){this.start(p,r,q);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(q,p,s){var r=q.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,p,s)},ropeSegments:function(s,p,r){var q=s.segments;q.forEach(function(t){this.rectangle(t,p,r)},this)},spriteInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sprite:  ("+r.width+" x "+r.height+") anchor: "+r.anchor.x+" x "+r.anchor.y);this.line("x: "+r.x.toFixed(1)+" y: "+r.y.toFixed(1));this.line("angle: "+r.angle.toFixed(1)+" rotation: "+r.rotation.toFixed(1));this.line("visible: "+r.visible+" in camera: "+r.inCamera);this.line("bounds x: "+r._bounds.x.toFixed(1)+" y: "+r._bounds.y.toFixed(1)+" w: "+r._bounds.width.toFixed(1)+" h: "+r._bounds.height.toFixed(1));this.stop()},spriteCoords:function(r,p,s,q){this.start(p,s,q,100);if(r.name){this.line(r.name)}this.line("x:",r.x.toFixed(2),"y:",r.y.toFixed(2));this.line("pos x:",r.position.x.toFixed(2),"pos y:",r.position.y.toFixed(2));this.line("world x:",r.world.x.toFixed(2),"world y:",r.world.y.toFixed(2));this.stop()},lineInfo:function(q,p,s,r){this.start(p,s,r,80);this.line("start.x:",q.start.x.toFixed(2),"start.y:",q.start.y.toFixed(2));this.line("end.x:",q.end.x.toFixed(2),"end.y:",q.end.y.toFixed(2));this.line("length:",q.length.toFixed(2),"angle:",q.angle);this.stop()},pixel:function(p,s,q,r){r=r||2;this.start();this.context.fillStyle=q;this.context.fillRect(p,s,r,r);this.stop()},geom:function(q,p,s,r){if(typeof s==="undefined"){s=true}if(typeof r==="undefined"){r=0}p=p||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=p;this.context.strokeStyle=p;if(q instanceof g.Rectangle||r===1){if(s){this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}else{this.context.strokeRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}}else{if(q instanceof g.Circle||r===2){this.context.beginPath();this.context.arc(q.x-this.game.camera.x,q.y-this.game.camera.y,q.radius,0,Math.PI*2,false);this.context.closePath();if(s){this.context.fill()}else{this.context.stroke()}}else{if(q instanceof g.Point||r===3){this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,4,4)}else{if(q instanceof g.Line||r===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo((q.start.x+0.5)-this.game.camera.x,(q.start.y+0.5)-this.game.camera.y);this.context.lineTo((q.end.x+0.5)-this.game.camera.x,(q.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}}}}this.stop()},rectangle:function(q,p,r){if(typeof r==="undefined"){r=true}p=p||"rgba(0, 255, 0, 0.4)";this.start();if(r){this.context.fillStyle=p;this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}else{this.context.strokeStyle=p;this.context.strokeRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}this.stop()},text:function(s,p,t,r,q){r=r||"rgb(255,255,255)";q=q||"16px Courier";this.start();this.context.font=q;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(s,p+1,t+1)}this.context.fillStyle=r;this.context.fillText(s,p,t);this.stop()},quadTree:function(p,q){q=q||"rgba(255,0,0,0.3)";this.start();var s=p.bounds;if(p.nodes.length===0){this.context.strokeStyle=q;this.context.strokeRect(s.x,s.y,s.width,s.height);this.text("size: "+p.objects.length,s.x+4,s.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<p.objects.length;r++){this.context.strokeRect(p.objects[r].x,p.objects[r].y,p.objects[r].width,p.objects[r].height)}}else{for(var r=0;r<p.nodes.length;r++){this.quadTree(p.nodes[r])}}this.stop()},body:function(q,p,r){if(q.body){this.start();if(q.body.type===g.Physics.ARCADE){g.Physics.Arcade.Body.render(this.context,q.body,p,r)}else{if(q.body.type===g.Physics.NINJA){g.Physics.Ninja.Body.render(this.context,q.body,p,r)}else{if(q.body.type===g.Physics.BOX2D){g.Physics.Box2D.renderBody(this.context,q.body,p)}}}this.stop()}},bodyInfo:function(r,p,s,q){if(r.body){this.start(p,s,q,210);if(r.body.type===g.Physics.ARCADE){g.Physics.Arcade.Body.renderBodyInfo(this,r.body)}else{if(r.body.type===g.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,r.body)}}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(p,q){this.start();g.Physics.Box2D.renderBody(this.context,p,q);this.stop()}};g.Utils.Debug.prototype.constructor=g.Utils.Debug;g.ArraySet=function(p){this.position=0;this.list=p||[]};g.ArraySet.prototype={add:function(p){if(!this.exists(p)){this.list.push(p)}return p},getIndex:function(p){return this.list.indexOf(p)},getByKey:function(r,q){var p=this.list.length;while(p--){if(this.list[p][r]===q){return this.list[p]}}return null},exists:function(p){return(this.list.indexOf(p)>-1)},reset:function(){this.list.length=0},remove:function(q){var p=this.list.indexOf(q);if(p>-1){this.list.splice(p,1);return q}},setAll:function(q,r){var p=this.list.length;while(p--){if(this.list[p]){this.list[p][q]=r}}},callAll:function(r){var p=Array.prototype.splice.call(arguments,1);var q=this.list.length;while(q--){if(this.list[q]&&this.list[q][r]){this.list[q][r].apply(this.list[q],p)}}},removeAll:function(q){if(typeof q==="undefined"){q=false}var p=this.list.length;while(p--){if(this.list[p]){var r=this.remove(this.list[p]);if(q){r.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(g.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(g.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(g.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});g.ArraySet.prototype.constructor=g.ArraySet;g.ArrayList=g.ArraySet;g.ArrayUtils={getRandomItem:function(r,s,q){if(r==null){return null}if(typeof s==="undefined"){s=0}if(typeof q==="undefined"){q=r.length}var p=s+Math.floor(Math.random()*q);return r[p]===undefined?null:r[p]},removeRandomItem:function(r,t,q){if(r==null){return null}if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=r.length}var p=t+Math.floor(Math.random()*q);if(p<r.length){var s=r.splice(p,1);return s[0]===undefined?null:s[0]}else{return null}},shuffle:function(s){for(var r=s.length-1;r>0;r--){var q=Math.floor(Math.random()*(r+1));var p=s[r];s[r]=s[q];s[q]=p}return s},transposeMatrix:function(u){var t=u.length;var q=u[0].length;var p=new Array(q);for(var s=0;s<q;s++){p[s]=new Array(t);for(var r=t-1;r>-1;r--){p[s][r]=u[r][s]}}return p},rotateMatrix:function(p,r){if(typeof r!=="string"){r=((r%360)+360)%360}if(r===90||r===-270||r==="rotateLeft"){p=g.ArrayUtils.transposeMatrix(p);p=p.reverse()}else{if(r===-90||r===270||r==="rotateRight"){p=p.reverse();p=g.ArrayUtils.transposeMatrix(p)}else{if(Math.abs(r)===180||r==="rotate180"){for(var q=0;q<p.length;q++){p[q].reverse()}p=p.reverse()}}}return p},findClosest:function(t,q){if(!q.length){return NaN}else{if(q.length===1||t<q[0]){return q[0]}}var r=1;while(q[r]<t){r++}var p=q[r-1];var s=(r<q.length)?q[r]:Number.POSITIVE_INFINITY;return((s-t)<=(t-p))?s:p},rotate:function(q){var p=q.shift();q.push(p);return p},numberArray:function(s,q){var p=[];for(var r=s;r<=q;r++){p.push(r)}return p},numberArrayStep:function(v,q,u){v=+v||0;var s=typeof q;if((s==="number"||s==="string")&&u&&u[q]===v){q=u=null}u=u==null?1:(+u||0);if(q===null){q=v;v=0}else{q=+q||0}var r=-1;var t=Math.max(g.Math.roundAwayFromZero((q-v)/(u||1)),0);var p=new Array(t);while(++r<t){p[r]=v;v+=u}return p}};g.Color={packPixel:function(t,s,p,q){if(g.Device.LITTLE_ENDIAN){return((q<<24)|(p<<16)|(s<<8)|t)>>>0}else{return((t<<24)|(s<<16)|(p<<8)|q)>>>0}},unpackPixel:function(s,r,p,q){if(typeof r==="undefined"||r===null){r=g.Color.createColor()}if(typeof p==="undefined"||p===null){p=false}if(typeof q==="undefined"||q===null){q=false}if(g.Device.LITTLE_ENDIAN){r.a=((s&4278190080)>>>24);r.b=((s&16711680)>>>16);r.g=((s&65280)>>>8);r.r=((s&255))}else{r.r=((s&4278190080)>>>24);r.g=((s&16711680)>>>16);r.b=((s&65280)>>>8);r.a=((s&255))}r.color=s;r.rgba="rgba("+r.r+","+r.g+","+r.b+","+(r.a/255)+")";if(p){g.Color.RGBtoHSL(r.r,r.g,r.b,r)}if(q){g.Color.RGBtoHSV(r.r,r.g,r.b,r)}return r},fromRGBA:function(q,p){if(!p){p=g.Color.createColor()}p.r=((q&4278190080)>>>24);p.g=((q&16711680)>>>16);p.b=((q&65280)>>>8);p.a=((q&255));p.rgba="rgba("+p.r+","+p.g+","+p.b+","+p.a+")";return p},toRGBA:function(t,s,p,q){return(t<<24)|(s<<16)|(p<<8)|q},RGBtoHSL:function(v,u,q,s){if(!s){s=g.Color.createColor(v,u,q,1)}v/=255;u/=255;q/=255;var t=Math.min(v,u,q);var p=Math.max(v,u,q);s.h=0;s.s=0;s.l=(p+t)/2;if(p!==t){var w=p-t;s.s=s.l>0.5?w/(2-p-t):w/(p+t);if(p===v){s.h=(u-q)/w+(u<q?6:0)}else{if(p===u){s.h=(q-v)/w+2}else{if(p===q){s.h=(v-u)/w+4}}}s.h/=6}return s},HSLtoRGB:function(v,u,r,t){if(!t){t=g.Color.createColor(r,r,r)}else{t.r=r;t.g=r;t.b=r}if(u!==0){var w=r<0.5?r*(1+u):r+u-r*u;var x=2*r-w;t.r=g.Color.hueToColor(x,w,v+1/3);t.g=g.Color.hueToColor(x,w,v);t.b=g.Color.hueToColor(x,w,v-1/3)}t.r=Math.floor((t.r*255|0));t.g=Math.floor((t.g*255|0));t.b=Math.floor((t.b*255|0));g.Color.updateColor(t);return t},RGBtoHSV:function(v,u,q,s){if(!s){s=g.Color.createColor(v,u,q,255)}v/=255;u/=255;q/=255;var t=Math.min(v,u,q);var p=Math.max(v,u,q);var w=p-t;s.h=0;s.s=p===0?0:w/p;s.v=p;if(p!==t){if(p===v){s.h=(u-q)/w+(u<q?6:0)}else{if(p===u){s.h=(q-v)/w+2}else{if(p===q){s.h=(v-u)/w+4}}}s.h/=6}return s},HSVtoRGB:function(A,G,E,y){if(typeof y==="undefined"){y=g.Color.createColor(0,0,0,1,A,G,0,E)}var u,B,D;var z=Math.floor(A*6);var C=A*6-z;var x=E*(1-G);var w=E*(1-C*G);var F=E*(1-(1-C)*G);switch(z%6){case 0:u=E;B=F;D=x;break;case 1:u=w;B=E;D=x;break;case 2:u=x;B=E;D=F;break;case 3:u=x;B=w;D=E;break;case 4:u=F;B=x;D=E;break;case 5:u=E;B=x;D=w;break}y.r=Math.floor(u*255);y.g=Math.floor(B*255);y.b=Math.floor(D*255);g.Color.updateColor(y);return y},hueToColor:function(u,s,r){if(r<0){r+=1}if(r>1){r-=1}if(r<1/6){return u+(s-u)*6*r}if(r<1/2){return s}if(r<2/3){return u+(s-u)*(2/3-r)*6}return u},createColor:function(p,w,x,y,u,A,q,z){var t={r:p||0,g:w||0,b:x||0,a:y||1,h:u||0,s:A||0,l:q||0,v:z||0,color:0,color32:0,rgba:""};t.color=g.Color.getColor(t.r,t.g,t.b);t.color32=g.Color.getColor32(t.a,t.r,t.g,t.b);return g.Color.updateColor(t)},updateColor:function(p){p.rgba="rgba("+p.r.toString()+","+p.g.toString()+","+p.b.toString()+","+p.a.toString()+")";return p},getColor32:function(q,t,s,p){return q<<24|t<<16|s<<8|p},getColor:function(s,q,p){return s<<16|q<<8|p},RGBtoString:function(t,s,p,q,u){if(typeof q==="undefined"){q=255}if(typeof u==="undefined"){u="#"}if(u==="#"){return"#"+((1<<24)+(t<<16)+(s<<8)+p).toString(16).slice(1)}else{return"0x"+g.Color.componentToHex(q)+g.Color.componentToHex(t)+g.Color.componentToHex(s)+g.Color.componentToHex(p)}},hexToRGB:function(q){var p=g.Color.hexToColor(q);if(p){return g.Color.getColor32(p.a,p.r,p.g,p.b)}},hexToColor:function(v,s){v=v.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(x,z,y,w){return z+z+y+y+w+w});var q=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(v);if(q){var u=parseInt(q[1],16);var t=parseInt(q[2],16);var p=parseInt(q[3],16);if(!s){s=g.Color.createColor(u,t,p)}else{s.r=u;s.g=t;s.b=p}}return s},webToColor:function(q,r){if(!r){r=g.Color.createColor()}var p=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(q);if(p){r.r=parseInt(p[1],10);r.g=parseInt(p[2],10);r.b=parseInt(p[3],10);r.a=p[4]!==undefined?parseFloat(p[4]):1}return r},valueToColor:function(r,q){if(!q){q=g.Color.createColor()}if(typeof r==="string"){if(r.indexOf("rgb")===0){return g.Color.webToColor(r,q)}else{q.a=1;return g.Color.hexToColor(r,q)}}else{if(typeof r==="number"){var p=g.Color.getRGB(r);q.r=p.r;q.g=p.g;q.b=p.b;q.a=p.a/255;return q}else{return q}}},componentToHex:function(p){var q=p.toString(16);return q.length==1?"0"+q:q},HSVColorWheel:function(r,q){if(typeof r==="undefined"){r=1}if(typeof q==="undefined"){q=1}var p=[];for(var t=0;t<=359;t++){p.push(g.Color.HSVtoRGB(t/359,r,q))}return p},HSLColorWheel:function(r,q){if(typeof r==="undefined"){r=0.5}if(typeof q==="undefined"){q=0.5}var p=[];for(var t=0;t<=359;t++){p.push(g.Color.HSLtoRGB(t/359,r,q))}return p},interpolateColor:function(z,y,x,q,u){if(typeof u==="undefined"){u=255}var t=g.Color.getRGB(z);var s=g.Color.getRGB(y);var p=(((s.red-t.red)*q)/x)+t.red;var v=(((s.green-t.green)*q)/x)+t.green;var w=(((s.blue-t.blue)*q)/x)+t.blue;return g.Color.getColor32(u,p,v,w)},interpolateColorWithRGB:function(u,q,w,y,x,s){var p=g.Color.getRGB(u);var v=(((q-p.red)*s)/x)+p.red;var z=(((w-p.green)*s)/x)+p.green;var t=(((y-p.blue)*s)/x)+p.blue;return g.Color.getColor(v,z,t)},interpolateRGB:function(u,q,z,t,A,x,y,s){var p=(((t-u)*s)/y)+u;var v=(((A-q)*s)/y)+q;var w=(((x-z)*s)/y)+z;return g.Color.getColor(p,v,w)},getRandomColor:function(r,q,u){if(typeof r==="undefined"){r=0}if(typeof q==="undefined"){q=255}if(typeof u==="undefined"){u=255}if(q>255||r>q){return g.Color.getColor(255,255,255)}var t=r+Math.round(Math.random()*(q-r));var s=r+Math.round(Math.random()*(q-r));var p=r+Math.round(Math.random()*(q-r));return g.Color.getColor32(u,t,s,p)},getRGB:function(p){if(p>16777215){return{alpha:p>>>24,red:p>>16&255,green:p>>8&255,blue:p&255,a:p>>>24,r:p>>16&255,g:p>>8&255,b:p&255}}else{return{alpha:255,red:p>>16&255,green:p>>8&255,blue:p&255,a:255,r:p>>16&255,g:p>>8&255,b:p&255}}},getWebRGB:function(p){if(typeof p==="object"){return"rgba("+p.r.toString()+","+p.g.toString()+","+p.b.toString()+","+(p.a/255).toString()+")"}else{var q=g.Color.getRGB(p);return"rgba("+q.r.toString()+","+q.g.toString()+","+q.b.toString()+","+(q.a/255).toString()+")"}},getAlpha:function(p){return p>>>24},getAlphaFloat:function(p){return(p>>>24)/255},getRed:function(p){return p>>16&255},getGreen:function(p){return p>>8&255},getBlue:function(p){return p&255}};g.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};g.LinkedList.prototype={add:function(p){if(this.total===0&&this.first===null&&this.last===null){this.first=p;this.last=p;this.next=p;p.prev=this;this.total++;return p}this.last.next=p;p.prev=this.last;this.last=p;this.total++;return p},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(p){if(this.total===1){this.reset();p.next=p.prev=null;return}if(p===this.first){this.first=this.first.next}else{if(p===this.last){this.last=this.last.prev}}if(p.prev){p.prev.next=p.next}if(p.next){p.next.prev=p.prev}p.next=p.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(q){if(!this.first||!this.last){return}var p=this.first;do{if(p&&p[q]){p[q].call(p)}p=p.next}while(p!=this.last.next)}};g.LinkedList.prototype.constructor=g.LinkedList;g.Physics=function(p,q){q=q||{};this.game=p;this.config=q;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};g.Physics.ARCADE=0;g.Physics.P2JS=1;g.Physics.NINJA=2;g.Physics.BOX2D=3;g.Physics.CHIPMUNK=4;g.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config.arcade===true)&&g.Physics.hasOwnProperty("Arcade")){this.arcade=new g.Physics.Arcade(this.game);this.game.time.deltaCap=0.2}if(this.config.hasOwnProperty("ninja")&&this.config.ninja===true&&g.Physics.hasOwnProperty("Ninja")){this.ninja=new g.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config.p2===true&&g.Physics.hasOwnProperty("P2")){this.p2=new g.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty("box2d")&&this.config.box2d===true&&g.Physics.hasOwnProperty("BOX2D")){this.box2d=new g.Physics.BOX2D(this.game,this.config)}},startSystem:function(p){if(p===g.Physics.ARCADE){this.arcade=new g.Physics.Arcade(this.game)}else{if(p===g.Physics.P2JS){if(this.p2===null){this.p2=new g.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else{if(p===g.Physics.NINJA){this.ninja=new g.Physics.Ninja(this.game)}else{if(p===g.Physics.BOX2D){if(this.box2d===null){this.box2d=new g.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}}}}},enable:function(q,r,p){if(typeof r==="undefined"){r=g.Physics.ARCADE}if(typeof p==="undefined"){p=false}if(r===g.Physics.ARCADE){this.arcade.enable(q)}else{if(r===g.Physics.P2JS&&this.p2){this.p2.enable(q,p)}else{if(r===g.Physics.NINJA&&this.ninja){this.ninja.enableAABB(q)}else{if(r===g.Physics.BOX2D&&this.box2d){this.box2d.enable(q)}}}}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null}};g.Physics.prototype.constructor=g.Physics;g.Physics.Arcade=function(p){this.game=p;this.gravity=new g.Point();this.bounds=new g.Rectangle(0,0,p.world.width,p.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=g.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new g.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};g.Physics.Arcade.prototype.constructor=g.Physics.Arcade;g.Physics.Arcade.SORT_NONE=0;g.Physics.Arcade.LEFT_RIGHT=1;g.Physics.Arcade.RIGHT_LEFT=2;g.Physics.Arcade.TOP_BOTTOM=3;g.Physics.Arcade.BOTTOM_TOP=4;g.Physics.Arcade.prototype={setBounds:function(q,s,r,p){this.bounds.setTo(q,s,r,p)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(p,r){if(typeof r==="undefined"){r=true}var q=1;if(Array.isArray(p)){q=p.length;while(q--){if(p[q] instanceof g.Group){this.enable(p[q].children,r)}else{this.enableBody(p[q]);if(r&&p[q].hasOwnProperty("children")&&p[q].children.length>0){this.enable(p[q],true)}}}}else{if(p instanceof g.Group){this.enable(p.children,r)}else{this.enableBody(p);if(r&&p.hasOwnProperty("children")&&p.children.length>0){this.enable(p.children,true)}}}},enableBody:function(p){if(p.hasOwnProperty("body")&&p.body===null){p.body=new g.Physics.Arcade.Body(p)}},updateMotion:function(p){var q=this.computeVelocity(0,p,p.angularVelocity,p.angularAcceleration,p.angularDrag,p.maxAngular)-p.angularVelocity;p.angularVelocity+=q;p.rotation+=(p.angularVelocity*this.game.time.physicsElapsed);p.velocity.x=this.computeVelocity(1,p,p.velocity.x,p.acceleration.x,p.drag.x,p.maxVelocity.x);p.velocity.y=this.computeVelocity(2,p,p.velocity.y,p.acceleration.y,p.drag.y,p.maxVelocity.y)},computeVelocity:function(s,q,u,t,r,p){if(typeof p==="undefined"){p=10000}if(s===1&&q.allowGravity){u+=(this.gravity.x+q.gravity.x)*this.game.time.physicsElapsed}else{if(s===2&&q.allowGravity){u+=(this.gravity.y+q.gravity.y)*this.game.time.physicsElapsed}}if(t){u+=t*this.game.time.physicsElapsed}else{if(r){r*=this.game.time.physicsElapsed;if(u-r>0){u-=r}else{if(u+r<0){u+=r}else{u=0}}}}if(u>p){u=p}else{if(u<-p){u=-p}}return u},overlap:function(v,u,p,t,q){p=p||null;t=t||null;q=q||p;this._total=0;if(!Array.isArray(v)&&Array.isArray(u)){for(var s=0;s<u.length;s++){this.collideHandler(v,u[s],p,t,q,true)}}else{if(Array.isArray(v)&&!Array.isArray(u)){for(var s=0;s<v.length;s++){this.collideHandler(v[s],u,p,t,q,true)}}else{if(Array.isArray(v)&&Array.isArray(u)){for(var s=0;s<v.length;s++){for(var r=0;r<u.length;r++){this.collideHandler(v[s],u[r],p,t,q,true)}}}else{this.collideHandler(v,u,p,t,q,true)}}}return(this._total>0)},collide:function(v,u,t,s,p){t=t||null;s=s||null;p=p||t;this._total=0;if(!Array.isArray(v)&&Array.isArray(u)){for(var r=0;r<u.length;r++){this.collideHandler(v,u[r],t,s,p,false)}}else{if(Array.isArray(v)&&!Array.isArray(u)){for(var r=0;r<v.length;r++){this.collideHandler(v[r],u,t,s,p,false)}}else{if(Array.isArray(v)&&Array.isArray(u)){for(var r=0;r<v.length;r++){for(var q=0;q<u.length;q++){this.collideHandler(v[r],u[q],t,s,p,false)}}}else{this.collideHandler(v,u,t,s,p,false)}}}return(this._total>0)},sort:function(p){if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return r.body.x-q.body.x})}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return q.body.x-r.body.x})}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return r.body.y-q.body.y})}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){p._hash.sort(function(r,q){if(!r.body||!q.body){return -1}return q.body.y-r.body.y})}}}}},collideHandler:function(u,t,s,r,p,q){if(typeof t==="undefined"&&u.physicsType===g.GROUP){this.sort(u);this.collideGroupVsSelf(u,s,r,p,q);return}if(!u||!t||!u.exists||!t.exists){return}if(this.sortDirection!==g.Physics.Arcade.SORT_NONE){if(u.physicsType===g.GROUP){this.sort(u)}if(t.physicsType===g.GROUP){this.sort(t)}}if(u.physicsType===g.SPRITE){if(t.physicsType===g.SPRITE){this.collideSpriteVsSprite(u,t,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideSpriteVsGroup(u,t,s,r,p,q)}else{if(t.physicsType===g.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(u,t,s,r,p)}}}}else{if(u.physicsType===g.GROUP){if(t.physicsType===g.SPRITE){this.collideSpriteVsGroup(t,u,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideGroupVsGroup(u,t,s,r,p,q)}else{if(t.physicsType===g.TILEMAPLAYER){this.collideGroupVsTilemapLayer(u,t,s,r,p,q)}}}}else{if(u.physicsType===g.TILEMAPLAYER){if(t.physicsType===g.SPRITE){this.collideSpriteVsTilemapLayer(t,u,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideGroupVsTilemapLayer(t,u,s,r,p,q)}}}}}},collideSpriteVsSprite:function(u,t,s,r,p,q){if(!u.body||!t.body){return false}if(this.separate(u.body,t.body,r,p,q)){if(s){s.call(p,u,t)}this._total++}return true},collideSpriteVsGroup:function(t,w,v,u,q,r){if(w.length===0||!t.body){return}if(this.skipQuadTree||t.body.skipQuadTree){for(var s=0;s<w._hash.length;s++){if(!w._hash[s]||!w._hash[s].exists||!w._hash[s].body){continue}if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){if(t.body.right<w._hash[s].body.x){break}else{if(w._hash[s].body.right<t.body.x){continue}}}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){if(t.body.x>w._hash[s].body.right){break}else{if(w._hash[s].body.x>t.body.right){continue}}}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<w._hash[s].body.y){break}else{if(w._hash[s].body.bottom<t.body.y){continue}}}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){if(t.body.y>w._hash[s].body.bottom){break}else{if(w._hash[s].body.y>t.body.bottom){continue}}}}}}this.collideSpriteVsSprite(t,w._hash[s],v,u,q,r)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(w);var p=this.quadTree.retrieve(t);for(var s=0;s<p.length;s++){if(this.separate(t.body,p[s],u,q,r)){if(v){v.call(q,t,p[s].sprite)}this._total++}}}},collideGroupVsSelf:function(w,x,p,q,t){if(w.length===0){return}for(var s=0;s<w._hash.length;s++){if(!w._hash[s]||!w._hash[s].exists||!w._hash[s].body){continue}var v=w._hash[s];for(var r=s+1;r<w._hash.length;r++){if(!w._hash[r]||!w._hash[r].exists||!w._hash[r].body){continue}var u=w._hash[r];if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){if(v.body.right<u.body.x){break}else{if(u.body.right<v.body.x){continue}}}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){if(v.body.x>u.body.right){continue}else{if(u.body.x>v.body.right){break}}}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){if(v.body.bottom<u.body.y){continue}else{if(u.body.bottom<v.body.y){break}}}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){if(v.body.y>u.body.bottom){continue}else{if(u.body.y>v.body.bottom){break}}}}}}this.collideSpriteVsSprite(v,u,x,p,q,t)}}},collideGroupVsGroup:function(p,v,u,t,q,r){if(p.length===0||v.length===0){return}for(var s=0;s<p.children.length;s++){if(p.children[s].exists){if(p.children[s].physicsType===g.GROUP){this.collideGroupVsGroup(p.children[s],v,u,t,q,r)}else{this.collideSpriteVsGroup(p.children[s],v,u,t,q,r)}}}},separate:function(t,r,u,q,s){if(!t.enable||!r.enable||!this.intersects(t,r)){return false}if(u&&u.call(q,t.sprite,r.sprite)===false){return false}var p=false;if(this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)){p=(this.separateX(t,r,s)||this.separateY(t,r,s))}else{p=(this.separateY(t,r,s)||this.separateX(t,r,s))}if(s){return true}else{return p}},intersects:function(q,p){if(q.right<=p.position.x){return false}if(q.bottom<=p.position.y){return false}if(q.position.x>=p.right){return false}if(q.position.y>=p.bottom){return false}return true},separateX:function(p,y,r){if(p.immovable&&y.immovable){return false}var w=0;if(this.intersects(p,y)){var t=p.deltaAbsX()+y.deltaAbsX()+this.OVERLAP_BIAS;if(p.deltaX()===0&&y.deltaX()===0){p.embedded=true;y.embedded=true}else{if(p.deltaX()>y.deltaX()){w=p.right-y.x;if((w>t)||p.checkCollision.right===false||y.checkCollision.left===false){w=0}else{p.touching.none=false;p.touching.right=true;y.touching.none=false;y.touching.left=true}}else{if(p.deltaX()<y.deltaX()){w=p.x-y.width-y.x;if((-w>t)||p.checkCollision.left===false||y.checkCollision.right===false){w=0}else{p.touching.none=false;p.touching.left=true;y.touching.none=false;y.touching.right=true}}}}p.overlapX=w;y.overlapX=w;if(w!==0){if(r||p.customSeparateX||y.customSeparateX){return true}var x=p.velocity.x;var v=y.velocity.x;if(!p.immovable&&!y.immovable){w*=0.5;p.x=p.x-w;y.x+=w;var u=Math.sqrt((v*v*y.mass)/p.mass)*((v>0)?1:-1);var s=Math.sqrt((x*x*p.mass)/y.mass)*((x>0)?1:-1);var q=(u+s)*0.5;u-=q;s-=q;p.velocity.x=q+u*p.bounce.x;y.velocity.x=q+s*y.bounce.x}else{if(!p.immovable){p.x=p.x-w;p.velocity.x=v-x*p.bounce.x;if(y.moves){p.y+=(y.y-y.prev.y)*y.friction.y}}else{if(!y.immovable){y.x+=w;y.velocity.x=x-v*y.bounce.x;if(p.moves){y.y+=(p.y-p.prev.y)*p.friction.y}}}}return true}}return false},separateY:function(p,y,r){if(p.immovable&&y.immovable){return false}var w=0;if(this.intersects(p,y)){var t=p.deltaAbsY()+y.deltaAbsY()+this.OVERLAP_BIAS;if(p.deltaY()===0&&y.deltaY()===0){p.embedded=true;y.embedded=true}else{if(p.deltaY()>y.deltaY()){w=p.bottom-y.y;if((w>t)||p.checkCollision.down===false||y.checkCollision.up===false){w=0}else{p.touching.none=false;p.touching.down=true;y.touching.none=false;y.touching.up=true}}else{if(p.deltaY()<y.deltaY()){w=p.y-y.bottom;if((-w>t)||p.checkCollision.up===false||y.checkCollision.down===false){w=0}else{p.touching.none=false;p.touching.up=true;y.touching.none=false;y.touching.down=true}}}}p.overlapY=w;y.overlapY=w;if(w!==0){if(r||p.customSeparateY||y.customSeparateY){return true}var x=p.velocity.y;var v=y.velocity.y;if(!p.immovable&&!y.immovable){w*=0.5;p.y=p.y-w;y.y+=w;var u=Math.sqrt((v*v*y.mass)/p.mass)*((v>0)?1:-1);var s=Math.sqrt((x*x*p.mass)/y.mass)*((x>0)?1:-1);var q=(u+s)*0.5;u-=q;s-=q;p.velocity.y=q+u*p.bounce.y;y.velocity.y=q+s*y.bounce.y}else{if(!p.immovable){p.y=p.y-w;p.velocity.y=v-x*p.bounce.y;if(y.moves){p.x+=(y.x-y.prev.x)*y.friction.x}}else{if(!y.immovable){y.y+=w;y.velocity.y=x-v*y.bounce.y;if(p.moves){y.x+=(p.x-p.prev.x)*p.friction.x}}}}return true}}return false},getObjectsUnderPointer:function(r,q,s,p){if(q.length===0||!r.exists){return}return this.getObjectsAtLocation(r.x,r.y,q,s,p,r)},getObjectsAtLocation:function(w,u,z,A,q,s){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(z);var v=new g.Rectangle(w,u,1,1);var p=[];var t=this.quadTree.retrieve(v);for(var r=0;r<t.length;r++){if(t[r].hitTest(w,u)){if(A){A.call(q,s,t[r].sprite)}p.push(t[r].sprite)}}return p},moveToObject:function(t,p,r,q){if(typeof r==="undefined"){r=60}if(typeof q==="undefined"){q=0}var s=Math.atan2(p.y-t.y,p.x-t.x);if(q>0){r=this.distanceBetween(t,p)/(q/1000)}t.body.velocity.x=Math.cos(s)*r;t.body.velocity.y=Math.sin(s)*r;return s},moveToPointer:function(t,q,s,p){if(typeof q==="undefined"){q=60}s=s||this.game.input.activePointer;if(typeof p==="undefined"){p=0}var r=this.angleToPointer(t,s);if(p>0){q=this.distanceToPointer(t,s)/(p/1000)}t.body.velocity.x=Math.cos(r)*q;t.body.velocity.y=Math.sin(r)*q;return r},moveToXY:function(t,p,u,r,q){if(typeof r==="undefined"){r=60}if(typeof q==="undefined"){q=0}var s=Math.atan2(u-t.y,p-t.x);if(q>0){r=this.distanceToXY(t,p,u)/(q/1000)}t.body.velocity.x=Math.cos(s)*r;t.body.velocity.y=Math.sin(s)*r;return s},velocityFromAngle:function(r,q,p){if(typeof q==="undefined"){q=60}p=p||new g.Point();return p.setTo((Math.cos(this.game.math.degToRad(r))*q),(Math.sin(this.game.math.degToRad(r))*q))},velocityFromRotation:function(q,r,p){if(typeof r==="undefined"){r=60}p=p||new g.Point();return p.setTo((Math.cos(q)*r),(Math.sin(q)*r))},accelerationFromRotation:function(q,r,p){if(typeof r==="undefined"){r=60}p=p||new g.Point();return p.setTo((Math.cos(q)*r),(Math.sin(q)*r))},accelerateToObject:function(t,q,r,p,u){if(typeof r==="undefined"){r=60}if(typeof p==="undefined"){p=1000}if(typeof u==="undefined"){u=1000}var s=this.angleBetween(t,q);t.body.acceleration.setTo(Math.cos(s)*r,Math.sin(s)*r);t.body.maxVelocity.setTo(p,u);return s},accelerateToPointer:function(t,s,q,p,u){if(typeof q==="undefined"){q=60}if(typeof s==="undefined"){s=this.game.input.activePointer}if(typeof p==="undefined"){p=1000}if(typeof u==="undefined"){u=1000}var r=this.angleToPointer(t,s);t.body.acceleration.setTo(Math.cos(r)*q,Math.sin(r)*q);t.body.maxVelocity.setTo(p,u);return r},accelerateToXY:function(t,q,v,r,p,u){if(typeof r==="undefined"){r=60}if(typeof p==="undefined"){p=1000}if(typeof u==="undefined"){u=1000}var s=this.angleToXY(t,q,v);t.body.acceleration.setTo(Math.cos(s)*r,Math.sin(s)*r);t.body.maxVelocity.setTo(p,u);return s},distanceBetween:function(r,s){var q=r.x-s.x;var p=r.y-s.y;return Math.sqrt(q*q+p*p)},distanceToXY:function(s,p,t){var r=s.x-p;var q=s.y-t;return Math.sqrt(r*r+q*q)},distanceToPointer:function(s,r){r=r||this.game.input.activePointer;var q=s.x-r.worldX;var p=s.y-r.worldY;return Math.sqrt(q*q+p*p)},angleBetween:function(r,s){var q=s.x-r.x;var p=s.y-r.y;return Math.atan2(p,q)},angleToXY:function(s,p,t){var r=p-s.x;var q=t-s.y;return Math.atan2(q,r)},angleToPointer:function(s,r){r=r||this.game.input.activePointer;var q=r.worldX-s.x;var p=r.worldY-s.y;return Math.atan2(p,q)}};g.Physics.Arcade.Body=function(p){this.sprite=p;this.game=p.game;this.type=g.Physics.ARCADE;this.enable=true;this.offset=new g.Point();this.position=new g.Point(p.x,p.y);this.prev=new g.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=p.rotation;this.preRotation=p.rotation;this.width=p.width;this.height=p.height;this.sourceWidth=p.width;this.sourceHeight=p.height;if(p.texture){this.sourceWidth=p.texture.frame.width;this.sourceHeight=p.texture.frame.height}this.halfWidth=Math.abs(p.width/2);this.halfHeight=Math.abs(p.height/2);this.center=new g.Point(p.x+this.halfWidth,p.y+this.halfHeight);this.velocity=new g.Point();this.newVelocity=new g.Point(0,0);this.deltaMax=new g.Point(0,0);this.acceleration=new g.Point();this.drag=new g.Point();this.allowGravity=true;this.gravity=new g.Point(0,0);this.bounce=new g.Point();this.maxVelocity=new g.Point(10000,10000);this.friction=new g.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=g.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new g.Point();this.dirty=false;this.skipQuadTree=false;this._reset=true;this._sx=p.scale.x;this._sy=p.scale.y;this._dx=0;this._dy=0};g.Physics.Arcade.Body.prototype={updateBounds:function(){var q=Math.abs(this.sprite.scale.x);var p=Math.abs(this.sprite.scale.y);if(q!==this._sx||p!==this._sy){this.width=this.sourceWidth*q;this.height=this.sourceHeight*p;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this._sx=q;this._sy=p;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this._reset=true}},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.height))+this.offset.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);this.angle=Math.atan2(this.velocity.y,this.velocity.x)}if(this.collideWorldBounds){this.checkWorldBounds()}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},postUpdate:function(){if(!this.enable||!this.dirty){return}this.dirty=false;if(this.deltaX()<0){this.facing=g.LEFT}else{if(this.deltaX()>0){this.facing=g.RIGHT}}if(this.deltaY()<0){this.facing=g.UP}else{if(this.deltaY()>0){this.facing=g.DOWN}}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else{if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else{if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},destroy:function(){this.sprite.body=null;this.sprite=null},checkWorldBounds:function(){if(this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left){this.position.x=this.game.physics.arcade.bounds.x;this.velocity.x*=-this.bounce.x;this.blocked.left=true}else{if(this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right){this.position.x=this.game.physics.arcade.bounds.right-this.width;this.velocity.x*=-this.bounce.x;this.blocked.right=true}}if(this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up){this.position.y=this.game.physics.arcade.bounds.y;this.velocity.y*=-this.bounce.y;this.blocked.up=true}else{if(this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down){this.position.y=this.game.physics.arcade.bounds.bottom-this.height;this.velocity.y*=-this.bounce.y;this.blocked.down=true}}},setSize:function(r,q,p,s){if(typeof p==="undefined"){p=this.offset.x}if(typeof s==="undefined"){s=this.offset.y}this.sourceWidth=r;this.sourceHeight=q;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(p,s);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(p,q){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;this.position.x=(p-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(q-(this.sprite.anchor.y*this.height))+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(p,q){return g.Rectangle.contains(this,p,q)},onFloor:function(){return this.blocked.down},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(g.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(p){this.position.x=p}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(p){this.position.y=p}});g.Physics.Arcade.Body.render=function(r,p,q,s){if(typeof s==="undefined"){s=true}q=q||"rgba(0,255,0,0.4)";if(s){r.fillStyle=q;r.fillRect(p.position.x-p.game.camera.x,p.position.y-p.game.camera.y,p.width,p.height)}else{r.strokeStyle=q;r.strokeRect(p.position.x-p.game.camera.x,p.position.y-p.game.camera.y,p.width,p.height)}};g.Physics.Arcade.Body.renderBodyInfo=function(q,p){q.line("x: "+p.x.toFixed(2),"y: "+p.y.toFixed(2),"width: "+p.width,"height: "+p.height);q.line("velocity x: "+p.velocity.x.toFixed(2),"y: "+p.velocity.y.toFixed(2),"deltaX: "+p._dx.toFixed(2),"deltaY: "+p._dy.toFixed(2));q.line("acceleration x: "+p.acceleration.x.toFixed(2),"y: "+p.acceleration.y.toFixed(2),"speed: "+p.speed.toFixed(2),"angle: "+p.angle.toFixed(2));q.line("gravity x: "+p.gravity.x,"y: "+p.gravity.y,"bounce x: "+p.bounce.x.toFixed(2),"y: "+p.bounce.y.toFixed(2));q.line("touching left: "+p.touching.left,"right: "+p.touching.right,"up: "+p.touching.up,"down: "+p.touching.down);q.line("blocked left: "+p.blocked.left,"right: "+p.blocked.right,"up: "+p.blocked.up,"down: "+p.blocked.down)};g.Physics.Arcade.Body.prototype.constructor=g.Physics.Arcade.Body;g.Physics.Arcade.TilemapCollision=function(){};g.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(s,p,u,t,q){if(!s.body){return}var v=p.getTiles(s.body.position.x-s.body.tilePadding.x,s.body.position.y-s.body.tilePadding.y,s.body.width+s.body.tilePadding.x,s.body.height+s.body.tilePadding.y,false,false);if(v.length===0){return}for(var r=0;r<v.length;r++){if(t){if(t.call(q,s,v[r])){if(this.separateTile(r,s.body,v[r])){this._total++;if(u){u.call(q,s,v[r])}}}}else{if(this.separateTile(r,s.body,v[r])){this._total++;if(u){u.call(q,s,v[r])}}}}},collideGroupVsTilemapLayer:function(u,p,t,s,q){if(u.length===0){return}for(var r=0;r<u.children.length;r++){if(u.children[r].exists){this.collideSpriteVsTilemapLayer(u.children[r],p,t,s,q)}}},separateTile:function(t,q,u){if(!q.enable||!u.intersects(q.position.x,q.position.y,q.right,q.bottom)){return false}if(u.collisionCallback&&!u.collisionCallback.call(u.collisionCallbackContext,q.sprite,u)){return false}else{if(u.layer.callbacks[u.index]&&!u.layer.callbacks[u.index].callback.call(u.layer.callbacks[u.index].callbackContext,q.sprite,u)){return false}}if(!u.faceLeft&&!u.faceRight&&!u.faceTop&&!u.faceBottom){return false}var s=0;var r=0;var p=0;var v=1;if(q.deltaAbsX()>q.deltaAbsY()){p=-1}else{if(q.deltaAbsX()<q.deltaAbsY()){v=-1}}if(q.deltaX()!==0&&q.deltaY()!==0&&(u.faceLeft||u.faceRight)&&(u.faceTop||u.faceBottom)){p=Math.min(Math.abs(q.position.x-u.right),Math.abs(q.right-u.left));v=Math.min(Math.abs(q.position.y-u.bottom),Math.abs(q.bottom-u.top))}if(p<v){if(u.faceLeft||u.faceRight){s=this.tileCheckX(q,u);if(s!==0&&!u.intersects(q.position.x,q.position.y,q.right,q.bottom)){return true}}if(u.faceTop||u.faceBottom){r=this.tileCheckY(q,u)}}else{if(u.faceTop||u.faceBottom){r=this.tileCheckY(q,u);if(r!==0&&!u.intersects(q.position.x,q.position.y,q.right,q.bottom)){return true}}if(u.faceLeft||u.faceRight){s=this.tileCheckX(q,u)}}return(s!==0||r!==0)},tileCheckX:function(p,r){var q=0;if(p.deltaX()<0&&!p.blocked.left&&r.collideRight&&p.checkCollision.left){if(r.faceRight&&p.x<r.right){q=p.x-r.right;if(q<-this.TILE_BIAS){q=0}}}else{if(p.deltaX()>0&&!p.blocked.right&&r.collideLeft&&p.checkCollision.right){if(r.faceLeft&&p.right>r.left){q=p.right-r.left;if(q>this.TILE_BIAS){q=0}}}}if(q!==0){if(p.customSeparateX){p.overlapX=q}else{this.processTileSeparationX(p,q)}}return q},tileCheckY:function(p,r){var q=0;if(p.deltaY()<0&&!p.blocked.up&&r.collideDown&&p.checkCollision.up){if(r.faceBottom&&p.y<r.bottom){q=p.y-r.bottom;if(q<-this.TILE_BIAS){q=0}}}else{if(p.deltaY()>0&&!p.blocked.down&&r.collideUp&&p.checkCollision.down){if(r.faceTop&&p.bottom>r.top){q=p.bottom-r.top;if(q>this.TILE_BIAS){q=0}}}}if(q!==0){if(p.customSeparateY){p.overlapY=q}else{this.processTileSeparationY(p,q)}}return q},processTileSeparationX:function(q,p){if(p<0){q.blocked.left=true}else{if(p>0){q.blocked.right=true}}q.position.x-=p;if(q.bounce.x===0){q.velocity.x=0}else{q.velocity.x=-q.velocity.x*q.bounce.x}},processTileSeparationY:function(p,q){if(q<0){p.blocked.up=true}else{if(q>0){p.blocked.down=true}}p.position.y-=q;if(p.bounce.y===0){p.velocity.y=0}else{p.velocity.y=-p.velocity.y*p.bounce.y}}};g.Utils.mixinPrototype(g.Physics.Arcade.prototype,g.Physics.Arcade.TilemapCollision.prototype);!function(p){"object"==typeof exports?module.exports=p():"function"==typeof define&&define.amd?define(p):"undefined"!=typeof window?window.p2=p():"undefined"!=typeof global?global.p2=p():"undefined"!=typeof self&&(self.p2=p())}(function(){var s,q,p;return(function r(v,z,x){function w(C,A){if(!z[C]){if(!v[C]){var t=typeof require=="function"&&require;if(!A&&t){return t(C,!0)}if(u){return u(C,!0)}throw new Error("Cannot find module '"+C+"'")}var B=z[C]={exports:{}};v[C][0].call(B.exports,function(D){var E=v[C][1][D];return w(E?E:D)},B,B.exports,r,v,z,x)}return z[C].exports}var u=typeof require=="function"&&require;for(var y=0;y<x.length;y++){w(x[y])}return w})({1:[function(v,w,u){var t=v("./Scalar");w.exports=x;function x(){}x.lineInt=function(B,A,F){F=F||0;var E=[0,0];var z,I,D,y,H,C,G;z=B[1][1]-B[0][1];I=B[0][0]-B[1][0];D=z*B[0][0]+I*B[0][1];y=A[1][1]-A[0][1];H=A[0][0]-A[1][0];C=y*A[0][0]+H*A[0][1];G=z*H-y*I;if(!t.eq(G,0,F)){E[0]=(H*D-I*C)/G;E[1]=(z*C-y*D)/G}return E};x.segmentsIntersect=function(B,A,z,y){var H=A[0]-B[0];var E=A[1]-B[1];var G=y[0]-z[0];var D=y[1]-z[1];if(G*E-D*H==0){return false}var F=(H*(z[1]-B[1])+E*(B[0]-z[0]))/(G*E-D*H);var C=(G*(B[1]-z[1])+D*(z[0]-B[0]))/(D*H-G*E);return(F>=0&&F<=1&&C>=0&&C<=1)}},{"./Scalar":4}],2:[function(w,x,v){x.exports=y;function y(){}y.area=function(A,z,B){return(((z[0]-A[0])*(B[1]-A[1]))-((B[0]-A[0])*(z[1]-A[1])))};y.left=function(A,z,B){return y.area(A,z,B)>0};y.leftOn=function(A,z,B){return y.area(A,z,B)>=0};y.right=function(A,z,B){return y.area(A,z,B)<0};y.rightOn=function(A,z,B){return y.area(A,z,B)<=0};var u=[],t=[];y.collinear=function(F,E,C,D){if(!D){return y.area(F,E,C)==0}else{var I=u,B=t;I[0]=E[0]-F[0];I[1]=E[1]-F[1];B[0]=C[0]-E[0];B[1]=C[1]-E[1];var z=I[0]*B[0]+I[1]*B[1],H=Math.sqrt(I[0]*I[0]+I[1]*I[1]),G=Math.sqrt(B[0]*B[0]+B[1]*B[1]),A=Math.acos(z/(H*G));return A<D}};y.sqdist=function(B,z){var C=z[0]-B[0];var A=z[1]-B[1];return C*C+A*A}},{}],3:[function(w,t,y){var x=w("./Line"),C=w("./Point"),z=w("./Scalar");t.exports=A;function A(){this.vertices=[]}A.prototype.at=function(E){var D=this.vertices,F=D.length;return D[E<0?E%F+F:E%F]};A.prototype.first=function(){return this.vertices[0]};A.prototype.last=function(){return this.vertices[this.vertices.length-1]};A.prototype.clear=function(){this.vertices.length=0};A.prototype.append=function(E,G,F){if(typeof(G)=="undefined"){throw new Error("From is not given!")}if(typeof(F)=="undefined"){throw new Error("To is not given!")}if(F-1<G){throw new Error("lol1")}if(F>E.vertices.length){throw new Error("lol2")}if(G<0){throw new Error("lol3")}for(var D=G;D<F;D++){this.vertices.push(E.vertices[D])}};A.prototype.makeCCW=function(){var F=0,D=this.vertices;for(var E=1;E<this.vertices.length;++E){if(D[E][1]<D[F][1]||(D[E][1]==D[F][1]&&D[E][0]>D[F][0])){F=E}}if(!C.left(this.at(F-1),this.at(F),this.at(F+1))){this.reverse()}};A.prototype.reverse=function(){var E=[];for(var D=0,F=this.vertices.length;D!==F;D++){E.push(this.vertices.pop())}this.vertices=E};A.prototype.isReflex=function(D){return C.right(this.at(D-1),this.at(D),this.at(D+1))};var v=[],u=[];A.prototype.canSee=function(G,E){var I,J,F=v,D=u;if(C.leftOn(this.at(G+1),this.at(G),this.at(E))&&C.rightOn(this.at(G-1),this.at(G),this.at(E))){return false}J=C.sqdist(this.at(G),this.at(E));for(var H=0;H!==this.vertices.length;++H){if((H+1)%this.vertices.length===G||H===G){continue}if(C.leftOn(this.at(G),this.at(E),this.at(H+1))&&C.rightOn(this.at(G),this.at(E),this.at(H))){F[0]=this.at(G);F[1]=this.at(E);D[0]=this.at(H);D[1]=this.at(H+1);I=x.lineInt(F,D);if(C.sqdist(this.at(G),I)<J){return false}}}return true};A.prototype.copy=function(F,E,H){var G=H||new A();G.clear();if(F<E){for(var D=F;D<=E;D++){G.vertices.push(this.vertices[D])}}else{for(var D=0;D<=E;D++){G.vertices.push(this.vertices[D])}for(var D=F;D<this.vertices.length;D++){G.vertices.push(this.vertices[D])}}return G};A.prototype.getCutEdges=function(){var G=[],K=[],H=[],J=new A();var I=Number.MAX_VALUE;for(var F=0;F<this.vertices.length;++F){if(this.isReflex(F)){for(var E=0;E<this.vertices.length;++E){if(this.canSee(F,E)){K=this.copy(F,E,J).getCutEdges();H=this.copy(E,F,J).getCutEdges();for(var D=0;D<H.length;D++){K.push(H[D])}if(K.length<I){G=K;I=K.length;G.push([this.at(F),this.at(E)])}}}}}return G};A.prototype.decomp=function(){var D=this.getCutEdges();if(D.length>0){return this.slice(D)}else{return[this]}};A.prototype.slice=function(F){if(F.length==0){return[this]}if(F instanceof Array&&F.length&&F[0] instanceof Array&&F[0].length==2&&F[0][0] instanceof Array){var E=[this];for(var H=0;H<F.length;H++){var I=F[H];for(var G=0;G<E.length;G++){var J=E[G];var D=J.slice(I);if(D){E.splice(G,1);E.push(D[0],D[1]);break}}}return E}else{var I=F;var H=this.vertices.indexOf(I[0]);var G=this.vertices.indexOf(I[1]);if(H!=-1&&G!=-1){return[this.copy(H,G),this.copy(G,H)]}else{return false}}};A.prototype.isSimple=function(){var F=this.vertices;for(var E=0;E<F.length-1;E++){for(var D=0;D<E-1;D++){if(x.segmentsIntersect(F[E],F[E+1],F[D],F[D+1])){return false}}}for(var E=1;E<F.length-2;E++){if(x.segmentsIntersect(F[0],F[F.length-1],F[E],F[E+1])){return false}}return true};function B(O,N,J,H,M){M=M||0;var E=N[1]-O[1];var L=O[0]-N[0];var G=(E*O[0])+(L*O[1]);var D=H[1]-J[1];var K=J[0]-H[0];var F=(D*J[0])+(K*J[1]);var I=(E*K)-(D*L);if(!z.eq(I,0,M)){return[((K*G)-(L*F))/I,((E*F)-(D*G))/I]}else{return[0,0]}}A.prototype.quickDecomp=function(L,I,K,X,Y,E){Y=Y||100;E=E||0;X=X||25;L=typeof(L)!="undefined"?L:[];I=I||[];K=K||[];var Q=[0,0],D=[0,0],P=[0,0];var N=0,U=0,W=0,G=0;var R=0,O=0,V=0;var J=new A(),F=new A();var H=this,M=this.vertices;if(M.length<3){return L}E++;if(E>Y){console.warn("quickDecomp: max level ("+Y+") reached.");return L}for(var T=0;T<this.vertices.length;++T){if(H.isReflex(T)){I.push(H.vertices[T]);N=U=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S){if(C.left(H.at(T-1),H.at(T),H.at(S))&&C.rightOn(H.at(T-1),H.at(T),H.at(S-1))){P=B(H.at(T-1),H.at(T),H.at(S),H.at(S-1));if(C.right(H.at(T+1),H.at(T),P)){W=C.sqdist(H.vertices[T],P);if(W<U){U=W;D=P;O=S}}}if(C.left(H.at(T+1),H.at(T),H.at(S+1))&&C.rightOn(H.at(T+1),H.at(T),H.at(S))){P=B(H.at(T+1),H.at(T),H.at(S),H.at(S+1));if(C.left(H.at(T-1),H.at(T),P)){W=C.sqdist(H.vertices[T],P);if(W<N){N=W;Q=P;R=S}}}}if(O==(R+1)%this.vertices.length){P[0]=(D[0]+Q[0])/2;P[1]=(D[1]+Q[1])/2;K.push(P);if(T<R){J.append(H,T,R+1);J.vertices.push(P);F.vertices.push(P);if(O!=0){F.append(H,O,H.vertices.length)}F.append(H,0,T+1)}else{if(T!=0){J.append(H,T,H.vertices.length)}J.append(H,0,R+1);J.vertices.push(P);F.vertices.push(P);F.append(H,O,T+1)}}else{if(O>R){R+=this.vertices.length}G=Number.MAX_VALUE;if(R<O){return L}for(var S=O;S<=R;++S){if(C.leftOn(H.at(T-1),H.at(T),H.at(S))&&C.rightOn(H.at(T+1),H.at(T),H.at(S))){W=C.sqdist(H.at(T),H.at(S));if(W<G){G=W;V=S%this.vertices.length}}}if(T<V){J.append(H,T,V+1);if(V!=0){F.append(H,V,M.length)}F.append(H,0,T+1)}else{if(T!=0){J.append(H,T,M.length)}J.append(H,0,V+1);F.append(H,V,T+1)}}if(J.vertices.length<F.vertices.length){J.quickDecomp(L,I,K,X,Y,E);F.quickDecomp(L,I,K,X,Y,E)}else{F.quickDecomp(L,I,K,X,Y,E);J.quickDecomp(L,I,K,X,Y,E)}return L}}L.push(this);return L};A.prototype.removeCollinearPoints=function(D){var E=0;for(var F=this.vertices.length-1;this.vertices.length>3&&F>=0;--F){if(C.collinear(this.at(F-1),this.at(F),this.at(F+1),D)){this.vertices.splice(F%this.vertices.length,1);F--;E++}}return E}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(v,w,u){w.exports=t;function t(){}t.eq=function(z,x,y){y=y||0;return Math.abs(z-x)<y}},{}],5:[function(u,v,t){v.exports={Polygon:u("./Polygon"),Point:u("./Point"),}},{"./Point":2,"./Polygon":3}],6:[function(u,v,t){v.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(u,w,t){var x=u("../math/vec2"),z=u("../utils/Utils");w.exports=y;function y(A){this.lowerBound=x.create();if(A&&A.lowerBound){x.copy(this.lowerBound,A.lowerBound)}this.upperBound=x.create();if(A&&A.upperBound){x.copy(this.upperBound,A.upperBound)}}var v=x.create();y.prototype.setFromPoints=function(L,H,D,C){var E=this.lowerBound,M=this.upperBound;if(typeof(D)!=="number"){D=0}if(D!==0){x.rotate(E,L[0],D)}else{x.copy(E,L[0])}x.copy(M,E);var J=Math.cos(D),B=Math.sin(D);for(var G=1;G<L.length;G++){var A=L[G];if(D!==0){var K=A[0],I=A[1];v[0]=J*K-B*I;v[1]=B*K+J*I;A=v}for(var F=0;F<2;F++){if(A[F]>M[F]){M[F]=A[F]}if(A[F]<E[F]){E[F]=A[F]}}}if(H){x.add(this.lowerBound,this.lowerBound,H);x.add(this.upperBound,this.upperBound,H)}if(C){this.lowerBound[0]-=C;this.lowerBound[1]-=C;this.upperBound[0]+=C;this.upperBound[1]+=C}};y.prototype.copy=function(A){x.copy(this.lowerBound,A.lowerBound);x.copy(this.upperBound,A.upperBound)};y.prototype.extend=function(B){var D=2;while(D--){var A=B.lowerBound[D];if(this.lowerBound[D]>A){this.lowerBound[D]=A}var C=B.upperBound[D];if(this.upperBound[D]<C){this.upperBound[D]=C}}};y.prototype.overlaps=function(C){var B=this.lowerBound,E=this.upperBound,A=C.lowerBound,D=C.upperBound;return((A[0]<=E[0]&&E[0]<=D[0])||(B[0]<=D[0]&&D[0]<=E[0]))&&((A[1]<=E[1]&&E[1]<=D[1])||(B[1]<=D[1]&&D[1]<=E[1]))}},{"../math/vec2":31,"../utils/Utils":50}],8:[function(v,w,u){var x=v("../math/vec2");var y=v("../objects/Body");w.exports=t;function t(A){this.type=A;this.result=[];this.world=null;this.boundingVolumeType=t.AABB}t.AABB=1;t.BOUNDING_CIRCLE=2;t.prototype.setWorld=function(A){this.world=A};t.prototype.getCollisionPairs=function(A){throw new Error("getCollisionPairs must be implemented in a subclass!")};var z=x.create();t.boundingRadiusCheck=function(D,C){x.sub(z,D.position,C.position);var B=x.squaredLength(z),A=D.boundingRadius+C.boundingRadius;return B<=A*A};t.aabbCheck=function(B,A){return B.getAABB().overlaps(A.getAABB())};t.prototype.boundingVolumeCheck=function(C,B){var A;switch(this.boundingVolumeType){case t.BOUNDING_CIRCLE:A=t.boundingRadiusCheck(C,B);break;case t.AABB:A=t.aabbCheck(C,B);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return A};t.canCollide=function(B,A){if(B.type===y.STATIC&&A.type===y.STATIC){return false}if((B.type===y.KINEMATIC&&A.type===y.STATIC)||(B.type===y.STATIC&&A.type===y.KINEMATIC)){return false}if(B.type===y.KINEMATIC&&A.type===y.KINEMATIC){return false}if(B.sleepState===y.SLEEPING&&A.sleepState===y.SLEEPING){return false}if((B.sleepState===y.SLEEPING&&A.type===y.STATIC)||(A.sleepState===y.SLEEPING&&B.type===y.STATIC)){return false}return true};t.NAIVE=1;t.SAP=2},{"../math/vec2":31,"../objects/Body":32}],9:[function(v,u,y){var t=v("../shapes/Circle"),w=v("../shapes/Plane"),x=v("../shapes/Particle"),B=v("../collision/Broadphase"),z=v("../math/vec2"),A=v("../utils/Utils");u.exports=C;function C(D){B.apply(this);D=A.defaults(D,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=D.xmin;this.ymin=D.ymin;this.xmax=D.xmax;this.ymax=D.ymax;this.nx=D.nx;this.ny=D.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}C.prototype=new B();C.prototype.constructor=C;C.prototype.getCollisionPairs=function(V){var N=[],L=V.bodies,J=L.length,ab=this.binsizeX,Z=this.binsizeY,ah=this.nx,ag=this.ny,P=this.xmin,Y=this.ymin,U=this.xmax,ad=this.ymax;var W=[],ae=ah*ag;for(var ac=0;ac<ae;ac++){W.push([])}var K=ah/(U-P);var ai=ag/(ad-Y);for(var ac=0;ac!==J;ac++){var G=L[ac];var M=G.aabb;var I=Math.max(M.lowerBound[0],P);var H=Math.max(M.lowerBound[1],Y);var al=Math.min(M.upperBound[0],U);var ak=Math.min(M.upperBound[1],ad);var E=Math.floor(K*(I-P));var T=Math.floor(ai*(H-Y));var D=Math.floor(K*(al-P));var S=Math.floor(ai*(ak-Y));for(var aa=E;aa<=D;aa++){for(var X=T;X<=S;X++){var R=aa;var aj=X;var O=R*(ag-1)+aj;if(O>=0&&O<ae){W[O].push(G)}}}}for(var ac=0;ac!==ae;ac++){var Q=W[ac];for(var aa=0,af=Q.length;aa!==af;aa++){var G=Q[aa];for(var X=0;X!==aa;X++){var F=Q[X];if(B.canCollide(G,F)&&this.boundingVolumeCheck(G,F)){N.push(G,F)}}}}return N}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../utils/Utils":50}],10:[function(v,u,z){var t=v("../shapes/Circle"),w=v("../shapes/Plane"),y=v("../shapes/Shape"),x=v("../shapes/Particle"),B=v("../collision/Broadphase"),A=v("../math/vec2");u.exports=C;function C(){B.call(this,B.NAIVE)}C.prototype=new B();C.prototype.constructor=C;C.prototype.getCollisionPairs=function(K){var G=K.bodies,D=this.result;D.length=0;for(var J=0,I=G.length;J!==I;J++){var F=G[J];for(var H=0;H<J;H++){var E=G[H];if(B.canCollide(F,E)&&this.boundingVolumeCheck(F,E)){D.push(F,E)}}}return D};C.prototype.aabbQuery=function(I,F,E){E=E||[];var G=I.bodies;for(var H=0;H<G.length;H++){var D=G[H];if(D.aabbNeedsUpdate){D.updateAABB()}if(D.aabb.overlaps(F)){E.push(D)}}return E}},{"../collision/Broadphase":8,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Shape":45}],11:[function(aJ,aQ,ai){var aA=aJ("../math/vec2"),aK=aA.sub,N=aA.add,R=aA.dot,aB=aJ("../utils/Utils"),u=aJ("../utils/TupleDictionary"),z=aJ("../equations/Equation"),aN=aJ("../equations/ContactEquation"),az=aJ("../equations/FrictionEquation"),ay=aJ("../shapes/Circle"),aG=aJ("../shapes/Convex"),af=aJ("../shapes/Shape"),ah=aJ("../objects/Body"),ac=aJ("../shapes/Rectangle");aQ.exports=aL;var an=aA.fromValues(0,1);var M=aA.fromValues(0,0),L=aA.fromValues(0,0),J=aA.fromValues(0,0),H=aA.fromValues(0,0),G=aA.fromValues(0,0),F=aA.fromValues(0,0),E=aA.fromValues(0,0),D=aA.fromValues(0,0),B=aA.fromValues(0,0),Y=aA.fromValues(0,0),X=aA.fromValues(0,0),W=aA.fromValues(0,0),V=aA.fromValues(0,0),U=aA.fromValues(0,0),T=aA.fromValues(0,0),S=aA.fromValues(0,0),Q=aA.fromValues(0,0),P=aA.fromValues(0,0),aP=[];function aL(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10;this.frictionCoefficient=0.3;this.surfaceVelocity=0;this.reuseObjects=true;this.reusableContactEquations=[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=z.DEFAULT_STIFFNESS;this.relaxation=z.DEFAULT_RELAXATION;this.frictionStiffness=z.DEFAULT_STIFFNESS;this.frictionRelaxation=z.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new u();this.contactSkinSize=0.01}var x=aA.create();var w=aA.create();aL.prototype.bodiesOverlap=function(aY,aW){var a5=x;var a4=w;for(var aZ=0,aT=aY.shapes.length;aZ!==aT;aZ++){var aX=aY.shapes[aZ],a1=aY.shapeOffsets[aZ],a3=aY.shapeAngles[aZ];aY.toWorldFrame(a5,a1);for(var aV=0,aS=aW.shapes.length;aV!==aS;aV++){var aU=aW.shapes[aV],a0=aW.shapeOffsets[aV],a2=aW.shapeAngles[aV];aW.toWorldFrame(a4,a0);if(this[aX.type|aU.type](aY,aX,a5,aX.angle+aY.angle,aW,aU,a4,aU.angle+aW.angle,true)){return true}}}return false};aL.prototype.collidedLastStep=function(aV,aU){var aT=aV.id|0,aS=aU.id|0;return !!this.collidingBodiesLastStep.get(aT,aS)};aL.prototype.reset=function(){this.collidingBodiesLastStep.reset();var aV=this.contactEquations;var aU=aV.length;while(aU--){var a0=aV[aU],aY=a0.bodyA.id,aW=a0.bodyB.id;this.collidingBodiesLastStep.set(aY,aW,true)}if(this.reuseObjects){var aT=this.contactEquations,aS=this.frictionEquations,aX=this.reusableFrictionEquations,aZ=this.reusableContactEquations;aB.appendArray(aZ,aT);aB.appendArray(aX,aS)}this.contactEquations.length=this.frictionEquations.length=0};aL.prototype.createContactEquation=function(aV,aU,aT,aS){var aW=this.reusableContactEquations.length?this.reusableContactEquations.pop():new aN(aV,aU);aW.bodyA=aV;aW.bodyB=aU;aW.shapeA=aT;aW.shapeB=aS;aW.restitution=this.restitution;aW.firstImpact=!this.collidedLastStep(aV,aU);aW.stiffness=this.stiffness;aW.relaxation=this.relaxation;aW.needsUpdate=true;aW.enabled=this.enabledEquations;aW.offset=this.contactSkinSize;return aW};aL.prototype.createFrictionEquation=function(aV,aU,aT,aS){var aW=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new az(aV,aU);aW.bodyA=aV;aW.bodyB=aU;aW.shapeA=aT;aW.shapeB=aS;aW.setSlipForce(this.slipForce);aW.frictionCoefficient=this.frictionCoefficient;aW.relativeVelocity=this.surfaceVelocity;aW.enabled=this.enabledEquations;aW.needsUpdate=true;aW.stiffness=this.frictionStiffness;aW.relaxation=this.frictionRelaxation;aW.contactEquations.length=0;return aW};aL.prototype.createFrictionFromContact=function(aT){var aS=this.createFrictionEquation(aT.bodyA,aT.bodyB,aT.shapeA,aT.shapeB);aA.copy(aS.contactPointA,aT.contactPointA);aA.copy(aS.contactPointB,aT.contactPointB);aA.rotate90cw(aS.t,aT.normalA);aS.contactEquations.push(aT);return aS};aL.prototype.createFrictionFromAverage=function(aT){var aY=this.contactEquations[this.contactEquations.length-1];var aS=this.createFrictionEquation(aY.bodyA,aY.bodyB,aY.shapeA,aY.shapeB);var aX=aY.bodyA;var aW=aY.bodyB;aA.set(aS.contactPointA,0,0);aA.set(aS.contactPointB,0,0);aA.set(aS.t,0,0);for(var aV=0;aV!==aT;aV++){aY=this.contactEquations[this.contactEquations.length-1-aV];if(aY.bodyA===aX){aA.add(aS.t,aS.t,aY.normalA);aA.add(aS.contactPointA,aS.contactPointA,aY.contactPointA);aA.add(aS.contactPointB,aS.contactPointB,aY.contactPointB)}else{aA.sub(aS.t,aS.t,aY.normalA);aA.add(aS.contactPointA,aS.contactPointA,aY.contactPointB);aA.add(aS.contactPointB,aS.contactPointB,aY.contactPointA)}aS.contactEquations.push(aY)}var aU=1/aT;aA.scale(aS.contactPointA,aS.contactPointA,aU);aA.scale(aS.contactPointB,aS.contactPointB,aU);aA.normalize(aS.t,aS.t);aA.rotate90cw(aS.t,aS.t);return aS};aL.prototype[af.LINE|af.CONVEX]=aL.prototype.convexLine=function(aT,aS,aV,aZ,aW,a0,aU,aY,aX){if(aX){return false}else{return 0}};aL.prototype[af.LINE|af.RECTANGLE]=aL.prototype.lineRectangle=function(aU,a0,aT,aX,aZ,aS,aV,aY,aW){if(aW){return false}else{return 0}};function ae(aT,aS){aA.set(aT.vertices[0],-aS.length*0.5,-aS.radius);aA.set(aT.vertices[1],aS.length*0.5,-aS.radius);aA.set(aT.vertices[2],aS.length*0.5,aS.radius);aA.set(aT.vertices[3],-aS.length*0.5,aS.radius)}var v=new ac(1,1),ag=aA.create();aL.prototype[af.CAPSULE|af.CONVEX]=aL.prototype[af.CAPSULE|af.RECTANGLE]=aL.prototype.convexCapsule=function(aX,aT,a1,a3,a0,a4,aU,a2,aZ){var aW=ag;aA.set(aW,a4.length/2,0);aA.rotate(aW,aW,a2);aA.add(aW,aW,aU);var aY=this.circleConvex(a0,a4,aW,a2,aX,aT,a1,a3,aZ,a4.radius);aA.set(aW,-a4.length/2,0);aA.rotate(aW,aW,a2);aA.add(aW,aW,aU);var aV=this.circleConvex(a0,a4,aW,a2,aX,aT,a1,a3,aZ,a4.radius);if(aZ&&(aY||aV)){return true}var aS=v;ae(aS,a4);var a5=this.convexConvex(aX,aT,a1,a3,a0,aS,aU,a2,aZ);return a5+aY+aV};aL.prototype[af.CAPSULE|af.LINE]=aL.prototype.lineCapsule=function(aU,a0,aS,aY,aW,aZ,aT,aX,aV){if(aV){return false}else{return 0}};var ad=aA.create();var ab=aA.create();var aH=new ac(1,1);aL.prototype[af.CAPSULE|af.CAPSULE]=aL.prototype.capsuleCapsule=function(aW,a9,a1,a5,aV,a8,a0,a3,aY){var aX;var a7=ad,a6=ab;var ba=0;for(var a4=0;a4<2;a4++){aA.set(a7,(a4===0?-1:1)*a9.length/2,0);aA.rotate(a7,a7,a5);aA.add(a7,a7,a1);for(var a2=0;a2<2;a2++){aA.set(a6,(a2===0?-1:1)*a8.length/2,0);aA.rotate(a6,a6,a3);aA.add(a6,a6,a0);if(this.enableFrictionReduction){aX=this.enableFriction;this.enableFriction=false}var aZ=this.circleCircle(aW,a9,a7,a5,aV,a8,a6,a3,aY,a9.radius,a8.radius);if(this.enableFrictionReduction){this.enableFriction=aX}if(aY&&aZ){return true}ba+=aZ}}if(this.enableFrictionReduction){aX=this.enableFriction;this.enableFriction=false}var aU=aH;ae(aU,a9);var aT=this.convexCapsule(aW,aU,a1,a5,aV,a8,a0,a3,aY);if(this.enableFrictionReduction){this.enableFriction=aX}if(aY&&aT){return true}ba+=aT;if(this.enableFrictionReduction){var aX=this.enableFriction;this.enableFriction=false}ae(aU,a8);var aS=this.convexCapsule(aV,aU,a0,a3,aW,a9,a1,a5,aY);if(this.enableFrictionReduction){this.enableFriction=aX}if(aY&&aS){return true}ba+=aS;if(this.enableFrictionReduction){if(ba&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(ba))}}return ba};aL.prototype[af.LINE|af.LINE]=aL.prototype.lineLine=function(aV,aU,aY,a0,aT,aS,aX,aZ,aW){if(aW){return false}else{return 0}};aL.prototype[af.PLANE|af.LINE]=aL.prototype.planeLine=function(a4,a7,bc,a3,aU,a1,a8,aV,aT){var aY=M,aW=L,bd=J,aZ=H,aX=G,bf=F,a5=E,a0=D,aS=B,bb=aP,be=0;aA.set(aY,-a1.length/2,0);aA.set(aW,a1.length/2,0);aA.rotate(bd,aY,aV);aA.rotate(aZ,aW,aV);N(bd,bd,a8);N(aZ,aZ,a8);aA.copy(aY,bd);aA.copy(aW,aZ);aK(aX,aW,aY);aA.normalize(bf,aX);aA.rotate90cw(aS,bf);aA.rotate(a0,an,a3);bb[0]=aY;bb[1]=aW;for(var a6=0;a6<bb.length;a6++){var a2=bb[a6];aK(a5,a2,bc);var a9=R(a5,a0);if(a9<0){if(aT){return true}var ba=this.createContactEquation(a4,aU,a7,a1);be++;aA.copy(ba.normalA,a0);aA.normalize(ba.normalA,ba.normalA);aA.scale(a5,a0,a9);aK(ba.contactPointA,a2,a5);aK(ba.contactPointA,ba.contactPointA,a4.position);aK(ba.contactPointB,a2,a8);N(ba.contactPointB,ba.contactPointB,a8);aK(ba.contactPointB,ba.contactPointB,aU.position);this.contactEquations.push(ba);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(ba))}}}}if(aT){return false}if(!this.enableFrictionReduction){if(be&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(be))}}return be};aL.prototype[af.PARTICLE|af.CAPSULE]=aL.prototype.particleCapsule=function(a0,aY,aS,aW,aV,aZ,aT,aX,aU){return this.circleLine(a0,aY,aS,aW,aV,aZ,aT,aX,aU,aZ.radius,0)};aL.prototype[af.CIRCLE|af.LINE]=aL.prototype.circleLine=function(a8,aT,aW,bf,aZ,ba,bg,a1,aY,be,aS){var be=be||0,aS=typeof(aS)!=="undefined"?aS:aT.radius,bm=M,aU=L,bj=J,aV=H,aX=G,a4=F,bp=E,a6=D,a3=B,bo=Y,a9=X,bc=W,a5=V,bl=U,bn=aP;aA.set(a6,-ba.length/2,0);aA.set(a3,ba.length/2,0);aA.rotate(bo,a6,a1);aA.rotate(a9,a3,a1);N(bo,bo,bg);N(a9,a9,bg);aA.copy(a6,bo);aA.copy(a3,a9);aK(a4,a3,a6);aA.normalize(bp,a4);aA.rotate90cw(aX,bp);aK(bc,aW,a6);var bh=R(bc,aX);aK(aV,a6,bg);aK(a5,aW,bg);var bk=aS+be;if(Math.abs(bh)<bk){aA.scale(bm,aX,bh);aK(bj,aW,bm);aA.scale(aU,aX,R(aX,a5));aA.normalize(aU,aU);aA.scale(aU,aU,be);N(bj,bj,aU);var a7=R(bp,bj);var a2=R(bp,a6);var a0=R(bp,a3);if(a7>a2&&a7<a0){if(aY){return true}var bi=this.createContactEquation(a8,aZ,aT,ba);aA.scale(bi.normalA,bm,-1);aA.normalize(bi.normalA,bi.normalA);aA.scale(bi.contactPointA,bi.normalA,aS);N(bi.contactPointA,bi.contactPointA,aW);aK(bi.contactPointA,bi.contactPointA,a8.position);aK(bi.contactPointB,bj,bg);N(bi.contactPointB,bi.contactPointB,bg);aK(bi.contactPointB,bi.contactPointB,aZ.position);this.contactEquations.push(bi);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bi))}return 1}}bn[0]=a6;bn[1]=a3;for(var bd=0;bd<bn.length;bd++){var bb=bn[bd];aK(bc,bb,aW);if(aA.squaredLength(bc)<Math.pow(bk,2)){if(aY){return true}var bi=this.createContactEquation(a8,aZ,aT,ba);aA.copy(bi.normalA,bc);aA.normalize(bi.normalA,bi.normalA);aA.scale(bi.contactPointA,bi.normalA,aS);N(bi.contactPointA,bi.contactPointA,aW);aK(bi.contactPointA,bi.contactPointA,a8.position);aK(bi.contactPointB,bb,bg);aA.scale(bl,bi.normalA,-be);N(bi.contactPointB,bi.contactPointB,bl);N(bi.contactPointB,bi.contactPointB,bg);aK(bi.contactPointB,bi.contactPointB,aZ.position);this.contactEquations.push(bi);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bi))}return 1}}return 0};aL.prototype[af.CIRCLE|af.CAPSULE]=aL.prototype.circleCapsule=function(aT,aV,aZ,a0,aS,aU,aY,aX,aW){return this.circleLine(aT,aV,aZ,a0,aS,aU,aY,aX,aW,aU.radius)};aL.prototype[af.CIRCLE|af.CONVEX]=aL.prototype[af.CIRCLE|af.RECTANGLE]=aL.prototype.circleConvex=function(bn,bk,br,bj,a2,bc,a3,bd,aZ,aS){var aS=typeof(aS)==="number"?aS:bk.radius;var a7=M,a6=L,aT=J,bi=H,a8=G,a4=F,bb=E,bg=D,aX=B,aV=Y,aY=X,bl=-1,a9=null,bp=W,bf=V,bh=U,a5=T,ba=S,aW=false,be=Number.MAX_VALUE;var a0=0;var bo=bc.vertices;for(var bm=0;bm!==bo.length+1;bm++){var bt=bo[bm%bo.length],bs=bo[(bm+1)%bo.length];aA.rotate(a7,bt,bd);aA.rotate(a6,bs,bd);N(a7,a7,a3);N(a6,a6,a3);aK(aT,a6,a7);aA.normalize(bi,aT);aA.rotate90cw(a8,bi);aA.scale(bh,a8,-bk.radius);N(bh,bh,br);if(t(bh,bc,a3,bd)){aA.sub(a5,a7,bh);var a1=Math.abs(aA.dot(a5,a8));if(a1<be){aA.copy(ba,bh);be=a1;aA.scale(bf,a8,a1);aA.add(bf,bf,bh);aW=true}}}if(aW){if(aZ){return true}var bq=this.createContactEquation(bn,a2,bk,bc);aA.sub(bq.normalA,ba,br);aA.normalize(bq.normalA,bq.normalA);aA.scale(bq.contactPointA,bq.normalA,aS);N(bq.contactPointA,bq.contactPointA,br);aK(bq.contactPointA,bq.contactPointA,bn.position);aK(bq.contactPointB,bf,a3);N(bq.contactPointB,bq.contactPointB,a3);aK(bq.contactPointB,bq.contactPointB,a2.position);this.contactEquations.push(bq);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bq))}return 1}if(aS>0){for(var bm=0;bm<bo.length;bm++){var aU=bo[bm];aA.rotate(aY,aU,bd);N(aY,aY,a3);aK(aV,aY,br);if(aA.squaredLength(aV)<Math.pow(aS,2)){if(aZ){return true}var bq=this.createContactEquation(bn,a2,bk,bc);aA.copy(bq.normalA,aV);aA.normalize(bq.normalA,bq.normalA);aA.scale(bq.contactPointA,bq.normalA,aS);N(bq.contactPointA,bq.contactPointA,br);aK(bq.contactPointA,bq.contactPointA,bn.position);aK(bq.contactPointB,aY,a3);N(bq.contactPointB,bq.contactPointB,a3);aK(bq.contactPointB,bq.contactPointB,a2.position);this.contactEquations.push(bq);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bq))}return 1}}}return 0};var aE=aA.create(),aD=aA.create(),ax=aA.create(),aw=aA.create();function t(aW,aS,aV,a2){var aZ=aE,aY=aD,aU=ax,aT=aw,a5=aW,a4=aS.vertices,a0=null;for(var aX=0;aX!==a4.length+1;aX++){var a6=a4[aX%a4.length],a3=a4[(aX+1)%a4.length];aA.rotate(aZ,a6,a2);aA.rotate(aY,a3,a2);N(aZ,aZ,aV);N(aY,aY,aV);aK(aU,aZ,a5);aK(aT,aY,a5);var a1=aA.crossLength(aU,aT);if(a0===null){a0=a1}if(a1*a0<=0){return false}a0=a1}return true}aL.prototype[af.PARTICLE|af.CONVEX]=aL.prototype[af.PARTICLE|af.RECTANGLE]=aL.prototype.particleConvex=function(bg,bb,bd,bc,a2,be,a3,bf,aX){var a7=M,a6=L,aS=J,bm=H,bj=G,a4=F,bt=E,bk=D,aV=B,aT=Y,aW=X,bn=-1,a9=null,br=W,bi=V,a0=U,aZ=T,bl=S,a5=Q,a8=P,bh=Number.MAX_VALUE;var aY=0,aU=false,bp=be.vertices;if(!t(bd,be,a3,bf)){return 0}if(aX){return true}var ba=null;for(var bo=0;bo!==bp.length+1;bo++){var bv=bp[bo%bp.length],bu=bp[(bo+1)%bp.length];aA.rotate(a7,bv,bf);aA.rotate(a6,bu,bf);N(a7,a7,a3);N(a6,a6,a3);aK(aS,a6,a7);aA.normalize(bm,aS);aA.rotate90cw(bj,bm);aK(aT,bd,a7);var bq=R(aT,bj);aK(a4,a7,a3);aK(bt,bd,a3);aA.sub(a5,a7,bd);var a1=Math.abs(aA.dot(a5,bj));if(a1<bh){bh=a1;aA.scale(bi,bj,a1);aA.add(bi,bi,bd);aA.copy(a8,bj);aU=true}}if(aU){var bs=this.createContactEquation(bg,a2,bb,be);aA.scale(bs.normalA,a8,-1);aA.normalize(bs.normalA,bs.normalA);aA.set(bs.contactPointA,0,0);N(bs.contactPointA,bs.contactPointA,bd);aK(bs.contactPointA,bs.contactPointA,bg.position);aK(bs.contactPointB,bi,a3);N(bs.contactPointB,bs.contactPointB,a3);aK(bs.contactPointB,bs.contactPointB,a2.position);this.contactEquations.push(bs);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bs))}return 1}return 0};aL.prototype[af.CIRCLE]=aL.prototype.circleCircle=function(aY,aX,a0,a5,aW,aV,aZ,a4,a1,aU,aT){var a3=M,aU=aU||aX.radius,aT=aT||aV.radius;aK(a3,a0,aZ);var aS=aU+aT;if(aA.squaredLength(a3)>Math.pow(aS,2)){return 0}if(a1){return true}var a2=this.createContactEquation(aY,aW,aX,aV);aK(a2.normalA,aZ,a0);aA.normalize(a2.normalA,a2.normalA);aA.scale(a2.contactPointA,a2.normalA,aU);aA.scale(a2.contactPointB,a2.normalA,-aT);N(a2.contactPointA,a2.contactPointA,a0);aK(a2.contactPointA,a2.contactPointA,aY.position);N(a2.contactPointB,a2.contactPointB,aZ);aK(a2.contactPointB,a2.contactPointB,aW.position);this.contactEquations.push(a2);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a2))}return 1};aL.prototype[af.PLANE|af.CONVEX]=aL.prototype[af.PLANE|af.RECTANGLE]=aL.prototype.planeConvex=function(aZ,aY,a3,aS,aV,aT,aX,a7,a2){var aW=M,a1=L,a6=J;var aU=0;aA.rotate(a1,an,aS);for(var a0=0;a0!==aT.vertices.length;a0++){var a8=aT.vertices[a0];aA.rotate(aW,a8,a7);N(aW,aW,aX);aK(a6,aW,a3);if(R(a6,a1)<=0){if(a2){return true}aU++;var a5=this.createContactEquation(aZ,aV,aY,aT);aK(a6,aW,a3);aA.copy(a5.normalA,a1);var a4=R(a6,a5.normalA);aA.scale(a6,a5.normalA,a4);aK(a5.contactPointB,aW,aV.position);aK(a5.contactPointA,aW,a6);aK(a5.contactPointA,a5.contactPointA,aZ.position);this.contactEquations.push(a5);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a5))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&aU){this.frictionEquations.push(this.createFrictionFromAverage(aU))}}return aU};aL.prototype[af.PARTICLE|af.PLANE]=aL.prototype.particlePlane=function(a4,a3,aT,aZ,aV,aU,aY,aS,aX){var a2=M,aW=L;aS=aS||0;aK(a2,aT,aY);aA.rotate(aW,an,aS);var a0=R(a2,aW);if(a0>0){return 0}if(aX){return true}var a1=this.createContactEquation(aV,a4,aU,a3);aA.copy(a1.normalA,aW);aA.scale(a2,a1.normalA,a0);aK(a1.contactPointA,aT,a2);aK(a1.contactPointA,a1.contactPointA,aV.position);aK(a1.contactPointB,aT,a4.position);this.contactEquations.push(a1);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a1))}return 1};aL.prototype[af.CIRCLE|af.PARTICLE]=aL.prototype.circleParticle=function(aV,aX,a0,aT,a2,a1,aS,aW,aU){var aZ=M;aK(aZ,aS,a0);if(aA.squaredLength(aZ)>Math.pow(aX.radius,2)){return 0}if(aU){return true}var aY=this.createContactEquation(aV,a2,aX,a1);aA.copy(aY.normalA,aZ);aA.normalize(aY.normalA,aY.normalA);aA.scale(aY.contactPointA,aY.normalA,aX.radius);N(aY.contactPointA,aY.contactPointA,a0);aK(aY.contactPointA,aY.contactPointA,aV.position);aK(aY.contactPointB,aS,a2.position);this.contactEquations.push(aY);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aY))}return 1};var aF=new ay(1),C=aA.create(),A=aA.create(),y=aA.create();aL.prototype[af.PLANE|af.CAPSULE]=aL.prototype.planeCapsule=function(aW,aV,aY,aT,aZ,a8,aU,a2,aX){var a4=C,a1=A,aS=aF,a6=y;aA.set(a4,-a8.length/2,0);aA.rotate(a4,a4,a2);N(a4,a4,aU);aA.set(a1,a8.length/2,0);aA.rotate(a1,a1,a2);N(a1,a1,aU);aS.radius=a8.radius;var a0;if(this.enableFrictionReduction){a0=this.enableFriction;this.enableFriction=false}var a5=this.circlePlane(aZ,aS,a4,0,aW,aV,aY,aT,aX),a3=this.circlePlane(aZ,aS,a1,0,aW,aV,aY,aT,aX);if(this.enableFrictionReduction){this.enableFriction=a0}if(aX){return a5||a3}else{var a7=a5+a3;if(this.enableFrictionReduction){if(a7){this.frictionEquations.push(this.createFrictionFromAverage(a7))}}return a7}};aL.prototype[af.CIRCLE|af.PLANE]=aL.prototype.circlePlane=function(aV,bb,a3,a7,aT,ba,a2,a6,aW){var aY=aV,aS=bb,aU=a3,a1=aT,a4=ba,bc=a2,a0=a6;a0=a0||0;var aX=M,aZ=L,a9=J;aK(aX,aU,bc);aA.rotate(aZ,an,a0);var a8=R(aZ,aX);if(a8>aS.radius){return 0}if(aW){return true}var a5=this.createContactEquation(a1,aY,ba,bb);aA.copy(a5.normalA,aZ);aA.scale(a5.contactPointB,a5.normalA,-aS.radius);N(a5.contactPointB,a5.contactPointB,aU);aK(a5.contactPointB,a5.contactPointB,aY.position);aA.scale(a9,a5.normalA,a8);aK(a5.contactPointA,aX,a9);N(a5.contactPointA,a5.contactPointA,bc);aK(a5.contactPointA,a5.contactPointA,a1.position);this.contactEquations.push(a5);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a5))}return 1};aL.prototype[af.CONVEX]=aL.prototype[af.CONVEX|af.RECTANGLE]=aL.prototype[af.RECTANGLE]=aL.prototype.convexConvex=function(br,bc,bk,a9,bq,ba,bh,a8,a7,bs){var aT=M,a6=L,a5=J,a4=H,aY=G,a1=F,be=E,aZ=D,bf=B,bg=0,bs=typeof(bs)==="number"?bs:0;var a0=aL.findSeparatingAxis(bc,bk,a9,ba,bh,a8,aT);if(!a0){return 0}aK(aZ,bh,bk);if(R(aT,aZ)>0){aA.scale(aT,aT,-1)}var bd=aL.getClosestEdge(bc,a9,aT,true),bb=aL.getClosestEdge(ba,a8,aT);if(bd===-1||bb===-1){return 0}for(var bn=0;bn<2;bn++){var a3=bd,a2=bb,aX=bc,aV=ba,by=bk,bw=bh,aW=a9,aU=a8,bA=br,bz=bq;if(bn===0){var bm;bm=a3;a3=a2;a2=bm;bm=aX;aX=aV;aV=bm;bm=by;by=bw;bw=bm;bm=aW;aW=aU;aU=bm;bm=bA;bA=bz;bz=bm}for(var bo=a2;bo<a2+2;bo++){var bl=aV.vertices[(bo+aV.vertices.length)%aV.vertices.length];aA.rotate(a6,bl,aU);N(a6,a6,bw);var aS=0;for(var bp=a3-1;bp<a3+2;bp++){var bx=aX.vertices[(bp+aX.vertices.length)%aX.vertices.length],bv=aX.vertices[(bp+1+aX.vertices.length)%aX.vertices.length];aA.rotate(a5,bx,aW);aA.rotate(a4,bv,aW);N(a5,a5,by);N(a4,a4,by);aK(aY,a4,a5);aA.rotate90cw(bf,aY);aA.normalize(bf,bf);aK(aZ,a6,a5);var bt=R(bf,aZ);if((bp===a3&&bt<=bs)||(bp!==a3&&bt<=0)){aS++}}if(aS>=3){if(a7){return true}var bu=this.createContactEquation(bA,bz,aX,aV);bg++;var bx=aX.vertices[(a3)%aX.vertices.length],bv=aX.vertices[(a3+1)%aX.vertices.length];aA.rotate(a5,bx,aW);aA.rotate(a4,bv,aW);N(a5,a5,by);N(a4,a4,by);aK(aY,a4,a5);aA.rotate90cw(bu.normalA,aY);aA.normalize(bu.normalA,bu.normalA);aK(aZ,a6,a5);var bt=R(bu.normalA,aZ);aA.scale(be,bu.normalA,bt);aK(bu.contactPointA,a6,by);aK(bu.contactPointA,bu.contactPointA,be);N(bu.contactPointA,bu.contactPointA,by);aK(bu.contactPointA,bu.contactPointA,bA.position);aK(bu.contactPointB,a6,bw);N(bu.contactPointB,bu.contactPointB,bw);aK(bu.contactPointB,bu.contactPointB,bz.position);this.contactEquations.push(bu);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bu))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&bg){this.frictionEquations.push(this.createFrictionFromAverage(bg))}}return bg};var Z=aA.fromValues(0,0);aL.projectConvexOntoAxis=function(aS,aU,a0,aX,a4){var aZ=null,aV=null,a2,a1,aY=Z;aA.rotate(aY,aX,-a0);for(var aW=0;aW<aS.vertices.length;aW++){a2=aS.vertices[aW];a1=R(a2,aY);if(aZ===null||a1>aZ){aZ=a1}if(aV===null||a1<aV){aV=a1}}if(aV>aZ){var a3=aV;aV=aZ;aZ=a3}var aT=R(aU,aX);aA.set(a4,aV+aT,aZ+aT)};var au=aA.fromValues(0,0),at=aA.fromValues(0,0),aq=aA.fromValues(0,0),ap=aA.fromValues(0,0),ao=aA.fromValues(0,0),am=aA.fromValues(0,0);aL.findSeparatingAxis=function(a2,a5,aU,a0,a3,aT,bc){var aV=null,aS=false,aX=false,aW=au,aZ=at,aY=aq,bf=ap,a6=ao,a4=am;if(a2 instanceof ac&&a0 instanceof ac){for(var a7=0;a7!==2;a7++){var ba=a2,a9=aU;if(a7===1){ba=a0;a9=aT}for(var a8=0;a8!==2;a8++){if(a8===0){aA.set(bf,0,1)}else{if(a8===1){aA.set(bf,1,0)}}if(a9!==0){aA.rotate(bf,bf,a9)}aL.projectConvexOntoAxis(a2,a5,aU,bf,a6);aL.projectConvexOntoAxis(a0,a3,aT,bf,a4);var be=a6,bb=a4,bd=false;if(a6[0]>a4[0]){bb=a6;be=a4;bd=true}var a1=bb[0]-be[1];aS=(a1<=0);if(aV===null||a1>aV){aA.copy(bc,bf);aV=a1;aX=aS}}}}else{for(var a7=0;a7!==2;a7++){var ba=a2,a9=aU;if(a7===1){ba=a0;a9=aT}for(var a8=0;a8!==ba.vertices.length;a8++){aA.rotate(aZ,ba.vertices[a8],a9);aA.rotate(aY,ba.vertices[(a8+1)%ba.vertices.length],a9);aK(aW,aY,aZ);aA.rotate90cw(bf,aW);aA.normalize(bf,bf);aL.projectConvexOntoAxis(a2,a5,aU,bf,a6);aL.projectConvexOntoAxis(a0,a3,aT,bf,a4);var be=a6,bb=a4,bd=false;if(a6[0]>a4[0]){bb=a6;be=a4;bd=true}var a1=bb[0]-be[1];aS=(a1<=0);if(aV===null||a1>aV){aA.copy(bc,bf);aV=a1;aX=aS}}}}return aX};var al=aA.fromValues(0,0),ak=aA.fromValues(0,0),aj=aA.fromValues(0,0);aL.getClosestEdge=function(a2,aU,aT,aX){var aY=al,aS=ak,a0=aj;aA.rotate(aY,aT,-aU);if(aX){aA.scale(aY,aY,-1)}var aV=-1,aZ=a2.vertices.length,a3=-1;for(var aW=0;aW!==aZ;aW++){aK(aS,a2.vertices[(aW+1)%aZ],a2.vertices[aW%aZ]);aA.rotate90cw(a0,aS);aA.normalize(a0,a0);var a1=R(a0,aY);if(aV===-1||a1>a3){aV=aW%aZ;a3=a1}}return aV};var aC=aA.create(),aI=aA.create(),K=aA.create(),I=aA.create(),aR=aA.create(),aa=aA.create(),av=aA.create();aL.prototype[af.CIRCLE|af.HEIGHTFIELD]=aL.prototype.circleHeightfield=function(aY,aS,a8,be,a1,a9,bh,a0,aV,aW){var bi=a9.data,aW=aW||aS.radius,a6=a9.elementWidth,ba=aI,aZ=aC,a3=aR,aX=av,a2=aa,aU=K,aT=I;var a5=Math.floor((a8[0]-aW-bh[0])/a6),a4=Math.ceil((a8[0]+aW-bh[0])/a6);if(a5<0){a5=0}if(a4>=bi.length){a4=bi.length-1}var bd=bi[a5],bb=bi[a4];for(var bc=a5;bc<a4;bc++){if(bi[bc]<bb){bb=bi[bc]}if(bi[bc]>bd){bd=bi[bc]}}if(a8[1]-aW>bd){return aV?false:0}var a7=false;for(var bc=a5;bc<a4;bc++){aA.set(aU,bc*a6,bi[bc]);aA.set(aT,(bc+1)*a6,bi[bc+1]);aA.add(aU,aU,bh);aA.add(aT,aT,bh);aA.sub(a2,aT,aU);aA.rotate(a2,a2,Math.PI/2);aA.normalize(a2,a2);aA.scale(aZ,a2,-aW);aA.add(aZ,aZ,a8);aA.sub(ba,aZ,aU);var bf=aA.dot(ba,a2);if(aZ[0]>=aU[0]&&aZ[0]<aT[0]&&bf<=0){if(aV){return true}a7=true;aA.scale(ba,a2,-bf);aA.add(a3,aZ,ba);aA.copy(aX,a2);var bg=this.createContactEquation(a1,aY,a9,aS);aA.copy(bg.normalA,aX);aA.scale(bg.contactPointB,bg.normalA,-aW);N(bg.contactPointB,bg.contactPointB,a8);aK(bg.contactPointB,bg.contactPointB,aY.position);aA.copy(bg.contactPointA,a3);aA.sub(bg.contactPointA,bg.contactPointA,a1.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}}}a7=false;if(aW>0){for(var bc=a5;bc<=a4;bc++){aA.set(aU,bc*a6,bi[bc]);aA.add(aU,aU,bh);aA.sub(ba,a8,aU);if(aA.squaredLength(ba)<Math.pow(aW,2)){if(aV){return true}a7=true;var bg=this.createContactEquation(a1,aY,a9,aS);aA.copy(bg.normalA,ba);aA.normalize(bg.normalA,bg.normalA);aA.scale(bg.contactPointB,bg.normalA,-aW);N(bg.contactPointB,bg.contactPointB,a8);aK(bg.contactPointB,bg.contactPointB,aY.position);aK(bg.contactPointA,aU,bh);N(bg.contactPointA,bg.contactPointA,bh);aK(bg.contactPointA,bg.contactPointA,a1.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}}}}if(a7){return 1}return 0};var aO=aA.create(),aM=aA.create(),ar=aA.create(),O=new aG([aA.create(),aA.create(),aA.create(),aA.create()]);aL.prototype[af.RECTANGLE|af.HEIGHTFIELD]=aL.prototype[af.CONVEX|af.HEIGHTFIELD]=aL.prototype.convexHeightfield=function(aX,a3,aW,aU,aZ,a6,bc,aY,aV){var bd=a6.data,a4=a6.elementWidth,aT=aO,aS=aM,a7=ar,bb=O;var a2=Math.floor((aX.aabb.lowerBound[0]-bc[0])/a4),a1=Math.ceil((aX.aabb.upperBound[0]-bc[0])/a4);if(a2<0){a2=0}if(a1>=bd.length){a1=bd.length-1}var ba=bd[a2],a8=bd[a1];for(var a9=a2;a9<a1;a9++){if(bd[a9]<a8){a8=bd[a9]}if(bd[a9]>ba){ba=bd[a9]}}if(aX.aabb.lowerBound[1]>ba){return aV?false:0}var a5=false;var be=0;for(var a9=a2;a9<a1;a9++){aA.set(aT,a9*a4,bd[a9]);aA.set(aS,(a9+1)*a4,bd[a9+1]);aA.add(aT,aT,bc);aA.add(aS,aS,bc);var a0=100;aA.set(a7,(aS[0]+aT[0])*0.5,(aS[1]+aT[1]-a0)*0.5);aA.sub(bb.vertices[0],aS,a7);aA.sub(bb.vertices[1],aT,a7);aA.copy(bb.vertices[2],bb.vertices[1]);aA.copy(bb.vertices[3],bb.vertices[0]);bb.vertices[2][1]-=a0;bb.vertices[3][1]-=a0;be+=this.convexConvex(aX,a3,aW,aU,aZ,bb,a7,0,aV)}return be}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/FrictionEquation":24,"../math/vec2":31,"../objects/Body":32,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Rectangle":44,"../shapes/Shape":45,"../utils/TupleDictionary":49,"../utils/Utils":50}],12:[function(z,y,T){y.exports=J;var W=z("../math/vec2");var M=z("../collision/RaycastResult");var A=z("../shapes/Shape");var X=z("../collision/AABB");function J(af){af=af||{};this.from=af.from?W.fromValues(af.from[0],af.from[1]):W.create();this.to=af.to?W.fromValues(af.to[0],af.to[1]):W.create();this._direction=W.create();this.precision=0.0001;this.checkCollisionResponse=true;this.skipBackfaces=false;this.collisionMask=-1;this.collisionGroup=-1;this.mode=J.ANY;this.result=new M();this.hasHit=false;this.callback=function(ag){}}J.prototype.constructor=J;J.CLOSEST=1;J.ANY=2;J.ALL=4;var S=new X();var u=[];J.prototype.intersectWorld=function(ag,af){this.mode=af.mode||J.ANY;this.result=af.result||new M();this.skipBackfaces=!!af.skipBackfaces;this.collisionMask=typeof(af.collisionMask)!=="undefined"?af.collisionMask:-1;this.collisionGroup=typeof(af.collisionGroup)!=="undefined"?af.collisionGroup:-1;if(af.from){W.copy(this.from,af.from)}if(af.to){W.copy(this.to,af.to)}this.callback=af.callback||function(){};this.hasHit=false;this.result.reset();this._updateDirection();this.getAABB(S);u.length=0;ag.broadphase.aabbQuery(ag,S,u);this.intersectBodies(u);return this.hasHit};var ad=W.create(),ab=W.create();var H=W.create();J.prototype.intersectBody=function(ag,af){if(af){this.result=af;this._updateDirection()}var ak=this.checkCollisionResponse;if(ak&&!ag.collisionResponse){return}var al=H;for(var aj=0,am=ag.shapes.length;aj<am;aj++){var ah=ag.shapes[aj];if(ak&&!ah.collisionResponse){continue}W.copy(al,ag.shapeOffsets[aj]);W.rotate(al,al,ag.angle);W.add(al,al,ag.position);var ai=ag.shapeAngles[aj]+ag.angle;this.intersectShape(ah,ai,al,ag);if(this.result._shouldStop){break}}};J.prototype.intersectBodies=function(ah,af){if(af){this.result=af;this._updateDirection()}for(var ai=0,ag=ah.length;!this.result._shouldStop&&ai<ag;ai++){this.intersectBody(ah[ai])}};J.prototype._updateDirection=function(){var af=this._direction;W.sub(af,this.to,this.from);W.normalize(af,af)};J.prototype.intersectShape=function(ah,ai,ag,af){var al=this.from;var ak=w(al,this._direction,ag);if(ak>ah.boundingSphereRadius){return}var aj=this[ah.type];if(aj){aj.call(this,ah,ai,ag,af)}};var v=W.create();var Q=W.create();var D=W.create();var ac=W.create();var aa=W.create();var Z=W.create();var Y=W.create();var F=new M();var R=W.create();var U=W.create();var B=W.create();var N=W.create();var t=W.create();var V=W.create();var E=W.create();J.prototype.intersectRectangle=function(ag,ar,aw,an){var ay=-Number.MAX_VALUE;var af=Number.MAX_VALUE;var at=R;var ap=U;var ao=B;var aq=N;var ak=t;var aj=V;var al=E;W.set(aj,-ag.width*0.5,-ag.height*0.5);W.set(al,ag.width*0.5,ag.height*0.5);W.rotate(at,this._direction,-ar);an.toLocalFrame(ap,this.from);if(at[0]!==0){var ax=(aj[0]-ap[0])/at[0];var av=(al[0]-ap[0])/at[0];var am=ay;ay=Math.max(ay,Math.min(ax,av));if(ay!==am){W.set(ao,ax>av?1:-1,0)}var au=af;af=Math.min(af,Math.max(ax,av));if(af!==au){W.set(aq,ax<av?1:-1,0)}}if(at[1]!==0){var ai=(aj[1]-ap[1])/at[1];var ah=(al[1]-ap[1])/at[1];var am=ay;ay=Math.max(ay,Math.min(ai,ah));if(ay!==am){W.set(ao,0,ai>ah?1:-1)}var au=af;af=Math.min(af,Math.max(ai,ah));if(af!==au){W.set(aq,0,ai<ah?1:-1)}}if(af>=ay){W.set(ak,ap[0]+at[0]*ay,ap[1]+at[1]*ay);W.rotate(ao,ao,ar);an.toWorldFrame(ak,ak);this.reportIntersection(ao,ak,ag,an,-1);if(this._shouldStop){return}W.rotate(aq,aq,ar);W.set(ak,ap[0]+at[0]*af,ap[1]+at[1]*af);an.toWorldFrame(ak,ak);this.reportIntersection(aq,ak,ag,an,-1)}};J.prototype[A.RECTANGLE]=J.prototype.intersectRectangle;var K=W.create();var O=W.create();var x=W.create();var G=W.create();var P=W.create();J.prototype.intersectPlane=function(an,ai,ak,al){var ar=this.from;var at=this.to;var ap=this._direction;var au=K;var aq=O;var ah=x;var aj=G;var am=P;W.set(aj,0,1);W.rotate(aj,aj,ai);W.sub(am,ar,ak);var af=W.dot(am,aj);W.sub(am,at,ak);var ao=W.dot(am,aj);if(af*ao>0){return}if(W.distance(ar,at)<af){return}var ag=W.dot(aj,ap);W.sub(au,ar,ak);var av=-W.dot(aj,au)/ag;W.scale(aq,ap,av);W.add(ah,ar,aq);this.reportIntersection(aj,ah,an,al,-1)};J.prototype[A.PLANE]=J.prototype.intersectPlane;var C=W.create();var L=W.create();J.prototype.intersectCircle=function(am,ai,aj,ak){var aq=this.from,ar=this.to,ag=am.radius;var ap=Math.pow(ar[0]-aq[0],2)+Math.pow(ar[1]-aq[1],2);var ao=2*((ar[0]-aq[0])*(aq[0]-aj[0])+(ar[1]-aq[1])*(aq[1]-aj[1]));var an=Math.pow(aq[0]-aj[0],2)+Math.pow(aq[1]-aj[1],2)-Math.pow(ag,2);var at=Math.pow(ao,2)-4*ap*an;var au=C;var al=L;if(at<0){return}else{if(at===0){W.lerp(au,aq,ar,at);W.sub(al,au,aj);W.normalize(al,al);this.reportIntersection(al,au,am,ak,-1)}else{var ah=(-ao-Math.sqrt(at))/(2*ap);var af=(-ao+Math.sqrt(at))/(2*ap);W.lerp(au,aq,ar,ah);W.sub(al,au,aj);W.normalize(al,al);this.reportIntersection(al,au,am,ak,-1);if(this.result._shouldStop){return}W.lerp(au,aq,ar,af);W.sub(al,au,aj);W.normalize(al,al);this.reportIntersection(al,au,am,ak,-1)}}};J.prototype[A.CIRCLE]=J.prototype.intersectCircle;J.prototype.getAABB=function(af){var ah=this.to;var ag=this.from;af.lowerBound[0]=Math.min(ah[0],ag[0]);af.lowerBound[1]=Math.min(ah[1],ag[1]);af.upperBound[0]=Math.max(ah[0],ag[0]);af.upperBound[1]=Math.max(ah[1],ag[1])};J.prototype.reportIntersection=function(aj,ah,ak,ai,af){var al=this.from;var am=this.to;var ag=W.distance(al,ah);var an=this.result;if(this.skipBackfaces&&W.dot(aj,this._direction)>0){return}an.hitFaceIndex=typeof(af)!=="undefined"?af:-1;switch(this.mode){case J.ALL:this.hasHit=true;an.set(al,am,aj,ah,ak,ai,ag);an.hasHit=true;this.callback(an);break;case J.CLOSEST:if(ag<an.distance||!an.hasHit){this.hasHit=true;an.hasHit=true;an.set(al,am,aj,ah,ak,ai,ag)}break;case J.ANY:this.hasHit=true;an.hasHit=true;an.set(al,am,aj,ah,ak,ai,ag);an._shouldStop=true;break}};var ae=W.create(),I=W.create();function w(aj,ah,af){W.sub(ae,af,aj);var ag=W.dot(ae,ah);W.scale(I,ah,ag);W.add(I,I,aj);var ai=W.distance(af,I);return ai}},{"../collision/AABB":7,"../collision/RaycastResult":13,"../math/vec2":31,"../shapes/Shape":45}],13:[function(v,w,u){var x=v("../math/vec2");w.exports=t;function t(){this.rayFromWorld=x.create();this.rayToWorld=x.create();this.hitNormalWorld=x.create();this.hitPointWorld=x.create();this.hasHit=false;this.shape=null;this.body=null;this.hitFaceIndex=-1;this.distance=-1;this._shouldStop=false}t.prototype.reset=function(){x.set(this.rayFromWorld,0,0);x.set(this.rayToWorld,0,0);x.set(this.hitNormalWorld,0,0);x.set(this.hitPointWorld,0,0);this.hasHit=false;this.shape=null;this.body=null;this.hitFaceIndex=-1;this.distance=-1;this._shouldStop=false};t.prototype.abort=function(){this._shouldStop=true};t.prototype.set=function(D,A,C,B,z,y,E){x.copy(this.rayFromWorld,D);x.copy(this.rayToWorld,A);x.copy(this.hitNormalWorld,C);x.copy(this.hitPointWorld,B);this.shape=z;this.body=y;this.distance=E}},{"../math/vec2":31}],14:[function(v,w,u){var y=v("../utils/Utils"),t=v("../collision/Broadphase");w.exports=x;function x(){t.call(this,t.SAP);this.axisList=[];this.axisIndex=0;var z=this;this._addBodyHandler=function(A){z.axisList.push(A.body)};this._removeBodyHandler=function(B){var A=z.axisList.indexOf(B.body);if(A!==-1){z.axisList.splice(A,1)}}}x.prototype=new t();x.prototype.constructor=x;x.prototype.setWorld=function(z){this.axisList.length=0;y.appendArray(this.axisList,z.bodies);z.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);z.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=z};x.sortAxisList=function(A,E){E=E|0;for(var D=1,z=A.length;D<z;D++){var B=A[D];for(var C=D-1;C>=0;C--){if(A[C].aabb.lowerBound[E]<=B.aabb.lowerBound[E]){break}A[C+1]=A[C]}A[C+1]=B}return A};x.prototype.sortList=function(){var z=this.axisList,A=this.axisIndex;x.sortAxisList(z,A)};x.prototype.getCollisionPairs=function(G){var z=this.axisList,K=this.result,J=this.axisIndex;K.length=0;var C=z.length;while(C--){var I=z[C];if(I.aabbNeedsUpdate){I.updateAABB()}}this.sortList();for(var F=0,H=z.length|0;F!==H;F++){var D=z[F];for(var E=F+1;E<H;E++){var B=z[E];var A=(B.aabb.lowerBound[J]<=D.aabb.upperBound[J]);if(!A){break}if(t.canCollide(D,B)&&this.boundingVolumeCheck(D,B)){K.push(D,B)}}}return K};x.prototype.aabbQuery=function(D,C,I){I=I||[];this.sortList();var H=this.axisIndex;var z="x";if(H===1){z="y"}if(H===2){z="z"}var F=this.axisList;var B=C.lowerBound[z];var G=C.upperBound[z];for(var A=0;A<F.length;A++){var E=F[A];if(E.aabbNeedsUpdate){E.updateAABB()}if(E.aabb.overlaps(C)){I.push(E)}}return I}},{"../collision/Broadphase":8,"../utils/Utils":50}],15:[function(u,w,t){w.exports=v;var x=u("../utils/Utils");function v(B,A,z,y){this.type=z;y=x.defaults(y,{collideConnected:true,wakeUpBodies:true,});this.equations=[];this.bodyA=B;this.bodyB=A;this.collideConnected=y.collideConnected;if(y.wakeUpBodies){if(B){B.wakeUp()}if(A){A.wakeUp()}}}v.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};v.DISTANCE=1;v.GEAR=2;v.LOCK=3;v.PRISMATIC=4;v.REVOLUTE=5;v.prototype.setStiffness=function(z){var A=this.equations;for(var B=0;B!==A.length;B++){var y=A[B];y.stiffness=z;y.needsUpdate=true}};v.prototype.setRelaxation=function(B){var z=this.equations;for(var A=0;A!==z.length;A++){var y=z[A];y.relaxation=B;y.needsUpdate=true}}},{"../utils/Utils":50}],16:[function(v,t,w){var D=v("./Constraint"),z=v("../equations/Equation"),x=v("../math/vec2"),y=v("../utils/Utils");t.exports=C;function C(G,F,Q){Q=y.defaults(Q,{localAnchorA:[0,0],localAnchorB:[0,0]});D.call(this,G,F,D.DISTANCE,Q);this.localAnchorA=x.fromValues(Q.localAnchorA[0],Q.localAnchorA[1]);this.localAnchorB=x.fromValues(Q.localAnchorB[0],Q.localAnchorB[1]);var K=this.localAnchorA;var I=this.localAnchorB;this.distance=0;if(typeof(Q.distance)==="number"){this.distance=Q.distance}else{var O=x.create(),N=x.create(),E=x.create();x.rotate(O,K,G.angle);x.rotate(N,I,F.angle);x.add(E,F.position,N);x.sub(E,E,O);x.sub(E,E,G.position);this.distance=x.length(E)}var P;if(typeof(Q.maxForce)==="undefined"){P=Number.MAX_VALUE}else{P=Q.maxForce}var J=new z(G,F,-P,P);this.equations=[J];this.maxForce=P;var E=x.create();var M=x.create();var L=x.create();var H=this;J.computeGq=function(){var U=this.bodyA,T=this.bodyB,S=U.position,R=T.position;x.rotate(M,K,U.angle);x.rotate(L,I,T.angle);x.add(E,R,L);x.sub(E,E,M);x.sub(E,E,S);return x.length(E)-H.distance};this.setMaxForce(P);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}C.prototype=new D();C.prototype.constructor=C;var u=x.create();var B=x.create();var A=x.create();C.prototype.update=function(){var K=this.equations[0],I=this.bodyA,H=this.bodyB,E=this.distance,M=I.position,L=H.position,F=this.equations[0],O=K.G;x.rotate(B,this.localAnchorA,I.angle);x.rotate(A,this.localAnchorB,H.angle);x.add(u,L,A);x.sub(u,u,B);x.sub(u,u,M);this.position=x.length(u);var P=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){F.maxForce=0;F.minForce=-this.maxForce;this.distance=this.upperLimit;P=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){F.maxForce=this.maxForce;F.minForce=0;this.distance=this.lowerLimit;P=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!P){F.enabled=false;return}F.enabled=true;x.normalize(u,u);var J=x.crossLength(B,u),N=x.crossLength(A,u);O[0]=-u[0];O[1]=-u[1];O[2]=-J;O[3]=u[0];O[4]=u[1];O[5]=N};C.prototype.setMaxForce=function(E){var F=this.equations[0];F.minForce=-E;F.maxForce=E};C.prototype.getMaxForce=function(E){var F=this.equations[0];return F.maxForce}},{"../equations/Equation":23,"../math/vec2":31,"../utils/Utils":50,"./Constraint":15}],17:[function(u,w,t){var v=u("./Constraint"),y=u("../equations/Equation"),z=u("../equations/AngleLockEquation"),x=u("../math/vec2");w.exports=A;function A(D,C,B){B=B||{};v.call(this,D,C,v.GEAR,B);this.ratio=typeof(B.ratio)==="number"?B.ratio:1;this.angle=typeof(B.angle)==="number"?B.angle:C.angle-this.ratio*D.angle;B.angle=this.angle;B.ratio=this.ratio;this.equations=[new z(D,C,B),];if(typeof(B.maxTorque)==="number"){this.setMaxTorque(B.maxTorque)}}A.prototype=new v();A.prototype.constructor=A;A.prototype.update=function(){var B=this.equations[0];if(B.ratio!==this.ratio){B.setRatio(this.ratio)}B.angle=this.angle};A.prototype.setMaxTorque=function(B){this.equations[0].setMaxTorque(B)};A.prototype.getMaxTorque=function(B){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":21,"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],18:[function(y,x,A){var F=y("./Constraint"),B=y("../math/vec2"),C=y("../equations/Equation");x.exports=D;function D(L,J,S){S=S||{};F.call(this,L,J,F.LOCK,S);var Q=(typeof(S.maxForce)==="undefined"?Number.MAX_VALUE:S.maxForce);var K=S.localAngleB||0;var P=new C(L,J,-Q,Q),O=new C(L,J,-Q,Q),H=new C(L,J,-Q,Q);var I=B.create(),M=B.create(),N=this;P.computeGq=function(){B.rotate(I,N.localOffsetB,L.angle);B.sub(M,J.position,L.position);B.sub(M,M,I);return M[0]};O.computeGq=function(){B.rotate(I,N.localOffsetB,L.angle);B.sub(M,J.position,L.position);B.sub(M,M,I);return M[1]};var G=B.create(),R=B.create();H.computeGq=function(){B.rotate(G,N.localOffsetB,J.angle-N.localAngleB);B.scale(G,G,-1);B.sub(M,L.position,J.position);B.add(M,M,G);B.rotate(R,G,-Math.PI/2);B.normalize(R,R);return B.dot(M,R)};this.localOffsetB=B.create();if(S.localOffsetB){B.copy(this.localOffsetB,S.localOffsetB)}else{B.sub(this.localOffsetB,J.position,L.position);B.rotate(this.localOffsetB,this.localOffsetB,-L.angle)}this.localAngleB=0;if(typeof(S.localAngleB)==="number"){this.localAngleB=S.localAngleB}else{this.localAngleB=J.angle-L.angle}this.equations.push(P,O,H);this.setMaxForce(Q)}D.prototype=new F();D.prototype.constructor=D;D.prototype.setMaxForce=function(H){var t=this.equations;for(var G=0;G<this.equations.length;G++){t[G].maxForce=H;t[G].minForce=-H}};D.prototype.getMaxForce=function(){return this.equations[0].maxForce};var z=B.create();var u=B.create();var E=B.create();var w=B.fromValues(1,0);var v=B.fromValues(0,1);D.prototype.update=function(){var t=this.equations[0],J=this.equations[1],G=this.equations[2],I=this.bodyA,H=this.bodyB;B.rotate(z,this.localOffsetB,I.angle);B.rotate(u,this.localOffsetB,H.angle-this.localAngleB);B.scale(u,u,-1);B.rotate(E,u,Math.PI/2);B.normalize(E,E);t.G[0]=-1;t.G[1]=0;t.G[2]=-B.crossLength(z,w);t.G[3]=1;J.G[0]=0;J.G[1]=-1;J.G[2]=-B.crossLength(z,v);J.G[4]=1;G.G[0]=-E[0];G.G[1]=-E[1];G.G[3]=E[0];G.G[4]=E[1];G.G[5]=B.crossLength(u,E)}},{"../equations/Equation":23,"../math/vec2":31,"./Constraint":15}],19:[function(x,v,z){var H=x("./Constraint"),B=x("../equations/ContactEquation"),D=x("../equations/Equation"),C=x("../math/vec2"),t=x("../equations/RotationalLockEquation");v.exports=y;function y(L,K,X){X=X||{};H.call(this,L,K,H.PRISMATIC,X);var Q=C.fromValues(0,0),M=C.fromValues(1,0),P=C.fromValues(0,0);if(X.localAnchorA){C.copy(Q,X.localAnchorA)}if(X.localAxisA){C.copy(M,X.localAxisA)}if(X.localAnchorB){C.copy(P,X.localAnchorB)}this.localAnchorA=Q;this.localAnchorB=P;this.localAxisA=M;var U=this.maxForce=typeof(X.maxForce)!=="undefined"?X.maxForce:Number.MAX_VALUE;var W=new D(L,K,-U,U);var T=new C.create(),S=new C.create(),R=new C.create(),V=new C.create();W.computeGq=function(){return C.dot(R,V)};W.updateJacobian=function(){var aa=this.G,Z=L.position,Y=K.position;C.rotate(T,Q,L.angle);C.rotate(S,P,K.angle);C.add(R,Y,S);C.sub(R,R,Z);C.sub(R,R,T);C.rotate(V,M,L.angle+Math.PI/2);aa[0]=-V[0];aa[1]=-V[1];aa[2]=-C.crossLength(T,V)+C.crossLength(V,R);aa[3]=V[0];aa[4]=V[1];aa[5]=C.crossLength(S,V)};this.equations.push(W);if(!X.disableRotationalLock){var I=new t(L,K,-U,U);this.equations.push(I)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof(X.lowerLimit)!=="undefined"?true:false;this.upperLimitEnabled=typeof(X.upperLimit)!=="undefined"?true:false;this.lowerLimit=typeof(X.lowerLimit)!=="undefined"?X.lowerLimit:0;this.upperLimit=typeof(X.upperLimit)!=="undefined"?X.upperLimit:1;this.upperLimitEquation=new B(L,K);this.lowerLimitEquation=new B(L,K);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=U;this.motorEquation=new D(L,K);this.motorEnabled=false;this.motorSpeed=0;var O=this;var N=this.motorEquation;var J=N.computeGW;N.computeGq=function(){return 0};N.computeGW=function(){var ab=this.G,aa=this.bodyA,Z=this.bodyB,ad=aa.velocity,ac=Z.velocity,Y=aa.angularVelocity,ae=Z.angularVelocity;return this.gmult(ab,ad,Y,ac,ae)+O.motorSpeed}}y.prototype=new H();y.prototype.constructor=y;var G=C.create(),F=C.create(),E=C.create(),w=C.create(),u=C.create(),A=C.create();y.prototype.update=function(){var Q=this.equations,V=Q[0],L=this.upperLimit,T=this.lowerLimit,U=this.upperLimitEquation,P=this.lowerLimitEquation,J=this.bodyA,I=this.bodyB,K=this.localAxisA,O=this.localAnchorA,N=this.localAnchorB;V.updateJacobian();C.rotate(G,K,J.angle);C.rotate(w,O,J.angle);C.add(F,w,J.position);C.rotate(u,N,I.angle);C.add(E,u,I.position);var M=this.position=C.dot(E,G)-C.dot(F,G);if(this.motorEnabled){var S=this.motorEquation.G;S[0]=G[0];S[1]=G[1];S[2]=C.crossLength(G,u);S[3]=-G[0];S[4]=-G[1];S[5]=-C.crossLength(G,w)}if(this.upperLimitEnabled&&M>L){C.scale(U.normalA,G,-1);C.sub(U.contactPointA,F,J.position);C.sub(U.contactPointB,E,I.position);C.scale(A,G,L);C.add(U.contactPointA,U.contactPointA,A);if(Q.indexOf(U)===-1){Q.push(U)}}else{var R=Q.indexOf(U);if(R!==-1){Q.splice(R,1)}}if(this.lowerLimitEnabled&&M<T){C.scale(P.normalA,G,1);C.sub(P.contactPointA,F,J.position);C.sub(P.contactPointB,E,I.position);C.scale(A,G,T);C.sub(P.contactPointB,P.contactPointB,A);if(Q.indexOf(P)===-1){Q.push(P)}}else{var R=Q.indexOf(P);if(R!==-1){Q.splice(R,1)}}};y.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};y.prototype.disableMotor=function(){if(!this.motorEnabled){return}var I=this.equations.indexOf(this.motorEquation);this.equations.splice(I,1);this.motorEnabled=false};y.prototype.setLimits=function(I,J){if(typeof(I)==="number"){this.lowerLimit=I;this.lowerLimitEnabled=true}else{this.lowerLimit=I;this.lowerLimitEnabled=false}if(typeof(J)==="number"){this.upperLimit=J;this.upperLimitEnabled=true}else{this.upperLimit=J;this.upperLimitEnabled=false}}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../math/vec2":31,"./Constraint":15}],20:[function(z,x,B){var G=z("./Constraint"),E=z("../equations/Equation"),F=z("../equations/RotationalVelocityEquation"),u=z("../equations/RotationalLockEquation"),D=z("../math/vec2");x.exports=A;var y=D.create(),w=D.create(),v=D.fromValues(1,0),t=D.fromValues(0,1),C=D.create();function A(N,M,J){J=J||{};G.call(this,N,M,G.REVOLUTE,J);var L=this.maxForce=typeof(J.maxForce)!=="undefined"?J.maxForce:Number.MAX_VALUE;this.pivotA=D.create();this.pivotB=D.create();if(J.worldPivot){D.sub(this.pivotA,J.worldPivot,N.position);D.sub(this.pivotB,J.worldPivot,M.position);D.rotate(this.pivotA,this.pivotA,-N.angle);D.rotate(this.pivotB,this.pivotB,-M.angle)}else{D.copy(this.pivotA,J.localPivotA);D.copy(this.pivotB,J.localPivotB)}var I=this.equations=[new E(N,M,-L,L),new E(N,M,-L,L),];var H=I[0];var O=I[1];var K=this;H.computeGq=function(){D.rotate(y,K.pivotA,N.angle);D.rotate(w,K.pivotB,M.angle);D.add(C,M.position,w);D.sub(C,C,N.position);D.sub(C,C,y);return D.dot(C,v)};O.computeGq=function(){D.rotate(y,K.pivotA,N.angle);D.rotate(w,K.pivotB,M.angle);D.add(C,M.position,w);D.sub(C,C,N.position);D.sub(C,C,y);return D.dot(C,t)};O.minForce=H.minForce=-L;O.maxForce=H.maxForce=L;this.motorEquation=new F(N,M);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new u(N,M);this.lowerLimitEquation=new u(N,M);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}A.prototype=new G();A.prototype.constructor=A;A.prototype.setLimits=function(H,I){if(typeof(H)==="number"){this.lowerLimit=H;this.lowerLimitEnabled=true}else{this.lowerLimit=H;this.lowerLimitEnabled=false}if(typeof(I)==="number"){this.upperLimit=I;this.upperLimitEnabled=true}else{this.upperLimit=I;this.upperLimitEnabled=false}};A.prototype.update=function(){var I=this.bodyA,H=this.bodyB,L=this.pivotA,J=this.pivotB,P=this.equations,N=P[0],U=P[1],R=P[0],Q=P[1],K=this.upperLimit,T=this.lowerLimit,V=this.upperLimitEquation,O=this.lowerLimitEquation;var M=this.angle=H.angle-I.angle;if(this.upperLimitEnabled&&M>K){V.angle=K;if(P.indexOf(V)===-1){P.push(V)}}else{var S=P.indexOf(V);if(S!==-1){P.splice(S,1)}}if(this.lowerLimitEnabled&&M<T){O.angle=T;if(P.indexOf(O)===-1){P.push(O)}}else{var S=P.indexOf(O);if(S!==-1){P.splice(S,1)}}D.rotate(y,L,I.angle);D.rotate(w,J,H.angle);R.G[0]=-1;R.G[1]=0;R.G[2]=-D.crossLength(y,v);R.G[3]=1;R.G[4]=0;R.G[5]=D.crossLength(w,v);Q.G[0]=0;Q.G[1]=-1;Q.G[2]=-D.crossLength(y,t);Q.G[3]=0;Q.G[4]=1;Q.G[5]=D.crossLength(w,t)};A.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};A.prototype.disableMotor=function(){if(!this.motorEnabled){return}var H=this.equations.indexOf(this.motorEquation);this.equations.splice(H,1);this.motorEnabled=false};A.prototype.motorIsEnabled=function(){return !!this.motorEnabled};A.prototype.setMotorSpeed=function(I){if(!this.motorEnabled){return}var H=this.equations.indexOf(this.motorEquation);this.equations[H].relativeVelocity=I};A.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../equations/RotationalVelocityEquation":26,"../math/vec2":31,"./Constraint":15}],21:[function(u,v,t){var x=u("./Equation"),w=u("../math/vec2");v.exports=y;function y(B,A,z){z=z||{};x.call(this,B,A,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=z.angle||0;this.ratio=typeof(z.ratio)==="number"?z.ratio:1;this.setRatio(this.ratio)}y.prototype=new x();y.prototype.constructor=y;y.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};y.prototype.setRatio=function(A){var z=this.G;z[2]=A;z[5]=-1;this.ratio=A};y.prototype.setMaxTorque=function(z){this.maxForce=z;this.minForce=-z}},{"../math/vec2":31,"./Equation":23}],22:[function(v,w,u){var y=v("./Equation"),x=v("../math/vec2");w.exports=t;function t(A,z){y.call(this,A,z,0,Number.MAX_VALUE);this.contactPointA=x.create();this.penetrationVec=x.create();this.contactPointB=x.create();this.normalA=x.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}t.prototype=new y();t.prototype.constructor=t;t.prototype.computeB=function(S,R,P){var C=this.bodyA,z=this.bodyB,H=this.contactPointA,F=this.contactPointB,L=C.position,K=z.position;var Q=this.penetrationVec,M=this.normalA,E=this.G;var I=x.crossLength(H,M),A=x.crossLength(F,M);E[0]=-M[0];E[1]=-M[1];E[2]=-I;E[3]=M[0];E[4]=M[1];E[5]=A;x.add(Q,K,F);x.sub(Q,Q,L);x.sub(Q,Q,H);var D,O;if(this.firstImpact&&this.restitution!==0){O=0;D=(1/R)*(1+this.restitution)*this.computeGW()}else{O=x.dot(M,Q)+this.offset;D=this.computeGW()}var N=this.computeGiMf();var J=-O*S-D*R-P*N;return J}},{"../math/vec2":31,"./Equation":23}],23:[function(z,x,B){x.exports=E;var C=z("../math/vec2"),D=z("../utils/Utils"),F=z("../objects/Body");function E(O,N,L,M){this.minForce=typeof(L)==="undefined"?-Number.MAX_VALUE:L;this.maxForce=typeof(M)==="undefined"?Number.MAX_VALUE:M;this.bodyA=O;this.bodyB=N;this.stiffness=E.DEFAULT_STIFFNESS;this.relaxation=E.DEFAULT_RELAXATION;this.G=new D.ARRAY_TYPE(6);for(var K=0;K<6;K++){this.G[K]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}E.prototype.constructor=E;E.DEFAULT_STIFFNESS=1000000;E.DEFAULT_RELAXATION=4;E.prototype.update=function(){var K=this.stiffness,M=this.relaxation,L=this.timeStep;this.a=4/(L*(1+4*M));this.b=(4*M)/(1+4*M);this.epsilon=4/(L*L*K*(1+4*M));this.needsUpdate=false};E.prototype.gmult=function(L,N,K,M,O){return L[0]*N[0]+L[1]*N[1]+L[2]*K+L[3]*M[0]+L[4]*M[1]+L[5]*O};E.prototype.computeB=function(M,K,N){var P=this.computeGW();var O=this.computeGq();var L=this.computeGiMf();return -O*M-P*K-L*N};var w=C.create(),v=C.create();E.prototype.computeGq=function(){var P=this.G,O=this.bodyA,M=this.bodyB,N=O.position,L=M.position,K=O.angle,Q=M.angle;return this.gmult(P,w,K,v,Q)+this.offset};E.prototype.computeGW=function(){var N=this.G,M=this.bodyA,L=this.bodyB,P=M.velocity,O=L.velocity,K=M.angularVelocity,Q=L.angularVelocity;return this.gmult(N,P,K,O,Q)+this.relativeVelocity};E.prototype.computeGWlambda=function(){var N=this.G,M=this.bodyA,L=this.bodyB,P=M.vlambda,O=L.vlambda,K=M.wlambda,Q=L.wlambda;return this.gmult(N,P,K,O,Q)};var A=C.create(),y=C.create();E.prototype.computeGiMf=function(){var N=this.bodyA,M=this.bodyB,U=N.force,L=N.angularForce,T=M.force,K=M.angularForce,P=N.invMassSolve,O=M.invMassSolve,R=N.invInertiaSolve,Q=M.invInertiaSolve,S=this.G;C.scale(A,U,P);C.scale(y,T,O);return this.gmult(S,A,L*R,y,K*Q)};E.prototype.computeGiMGt=function(){var O=this.bodyA,M=this.bodyB,N=O.invMassSolve,L=M.invMassSolve,K=O.invInertiaSolve,Q=M.invInertiaSolve,P=this.G;return P[0]*P[0]*N+P[1]*P[1]*N+P[2]*P[2]*K+P[3]*P[3]*L+P[4]*P[4]*L+P[5]*P[5]*Q};var G=C.create(),J=C.create(),H=C.create(),t=C.create(),I=C.create(),u=C.create();E.prototype.addToWlambda=function(K){var M=this.bodyA,L=this.bodyB,X=G,Q=J,P=H,S=t,R=I,O=M.invMassSolve,N=L.invMassSolve,V=M.invInertiaSolve,U=L.invInertiaSolve,T=u,W=this.G;Q[0]=W[0];Q[1]=W[1];P[0]=W[3];P[1]=W[4];C.scale(X,Q,O*K);C.add(M.vlambda,M.vlambda,X);M.wlambda+=V*W[2]*K;C.scale(X,P,N*K);C.add(L.vlambda,L.vlambda,X);L.wlambda+=U*W[5]*K};E.prototype.computeInvC=function(K){return 1/(this.computeGiMGt()+K)}},{"../math/vec2":31,"../objects/Body":32,"../utils/Utils":50}],24:[function(u,w,t){var y=u("../math/vec2"),x=u("./Equation"),z=u("../utils/Utils");w.exports=v;function v(C,B,A){x.call(this,C,B,-A,A);this.contactPointA=y.create();this.contactPointB=y.create();this.t=y.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=0.3}v.prototype=new x();v.prototype.constructor=v;v.prototype.setSlipForce=function(A){this.maxForce=A;this.minForce=-A};v.prototype.getSlipForce=function(){return this.maxForce};v.prototype.computeB=function(K,I,F){var E=this.bodyA,D=this.bodyB,L=this.contactPointA,J=this.contactPointB,N=this.t,M=this.G;M[0]=-N[0];M[1]=-N[1];M[2]=-y.crossLength(L,N);M[3]=N[0];M[4]=N[1];M[5]=y.crossLength(J,N);var H=this.computeGW(),A=this.computeGiMf();var C=-H*I-F*A;return C}},{"../math/vec2":31,"../utils/Utils":50,"./Equation":23}],25:[function(x,w,z){var C=x("./Equation"),B=x("../math/vec2");w.exports=u;function u(H,F,D){D=D||{};C.call(this,H,F,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=D.angle||0;var E=this.G;E[2]=1;E[5]=-1}u.prototype=new C();u.prototype.constructor=u;var A=B.create(),y=B.create(),v=B.fromValues(1,0),t=B.fromValues(0,1);u.prototype.computeGq=function(){B.rotate(A,v,this.bodyA.angle+this.angle);B.rotate(y,t,this.bodyB.angle);return B.dot(A,y)}},{"../math/vec2":31,"./Equation":23}],26:[function(u,v,t){var x=u("./Equation"),w=u("../math/vec2");v.exports=y;function y(A,z){x.call(this,A,z,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}y.prototype=new x();y.prototype.constructor=y;y.prototype.computeB=function(C,z,E){var D=this.G;D[2]=-1;D[5]=this.ratio;var A=this.computeGiMf();var H=this.computeGW();var F=-H*z-E*A;return F}},{"../math/vec2":31,"./Equation":23}],27:[function(u,v,t){var w=function(){};v.exports=w;w.prototype={constructor:w,on:function(z,A,x){A.context=x||this;if(this._listeners===undefined){this._listeners={}}var y=this._listeners;if(y[z]===undefined){y[z]=[]}if(y[z].indexOf(A)===-1){y[z].push(A)}return this},has:function(y,z){if(this._listeners===undefined){return false}var x=this._listeners;if(z){if(x[y]!==undefined&&x[y].indexOf(z)!==-1){return true}}else{if(x[y]!==undefined){return true}}return false},off:function(z,A){if(this._listeners===undefined){return this}var y=this._listeners;var x=y[z].indexOf(A);if(x!==-1){y[z].splice(x,1)}return this},emit:function(B){if(this._listeners===undefined){return this}var A=this._listeners;var x=A[B.type];if(x!==undefined){B.target=this;for(var z=0,y=x.length;z<y;z++){var C=x[z];C.call(C.context,B)}}return this}}},{}],28:[function(v,w,u){var y=v("./Material");var x=v("../equations/Equation");w.exports=t;function t(B,A,z){z=z||{};if(!(B instanceof y)||!(A instanceof y)){throw new Error("First two arguments must be Material instances.")}this.id=t.idCounter++;this.materialA=B;this.materialB=A;this.friction=typeof(z.friction)!=="undefined"?Number(z.friction):0.3;this.restitution=typeof(z.restitution)!=="undefined"?Number(z.restitution):0;this.stiffness=typeof(z.stiffness)!=="undefined"?Number(z.stiffness):x.DEFAULT_STIFFNESS;this.relaxation=typeof(z.relaxation)!=="undefined"?Number(z.relaxation):x.DEFAULT_RELAXATION;this.frictionStiffness=typeof(z.frictionStiffness)!=="undefined"?Number(z.frictionStiffness):x.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof(z.frictionRelaxation)!=="undefined"?Number(z.frictionRelaxation):x.DEFAULT_RELAXATION;this.surfaceVelocity=typeof(z.surfaceVelocity)!=="undefined"?Number(z.surfaceVelocity):0;this.contactSkinSize=0.005}t.idCounter=0},{"../equations/Equation":23,"./Material":29}],29:[function(u,v,t){v.exports=w;function w(x){this.id=x||w.idCounter++}w.idCounter=0},{}],30:[function(v,w,u){var t={};t.GetArea=function(A){if(A.length<6){return 0}var x=A.length-2;var z=0;for(var y=0;y<x;y+=2){z+=(A[y+2]-A[y])*(A[y+1]+A[y+3])}z+=(A[0]-A[x])*(A[x+1]+A[1]);return -z*0.5};t.Triangulate=function(D){var E=D.length>>1;if(E<3){return[]}var M=[];var C=[];for(var K=0;K<E;K++){C.push(K)}var K=0;var H=E;while(H>3){var I=C[(K+0)%H];var G=C[(K+1)%H];var F=C[(K+2)%H];var B=D[2*I],z=D[2*I+1];var N=D[2*G],L=D[2*G+1];var y=D[2*F],x=D[2*F+1];var A=false;if(t._convex(B,z,N,L,y,x)){A=true;for(var J=0;J<H;J++){var O=C[J];if(O==I||O==G||O==F){continue}if(t._PointInTriangle(D[2*O],D[2*O+1],B,z,N,L,y,x)){A=false;break}}}if(A){M.push(I,G,F);C.splice((K+1)%H,1);H--;K=0}else{if(K++>3*H){break}}}M.push(C[0],C[1],C[2]);return M};t._PointInTriangle=function(L,K,H,G,S,R,D,B){var A=D-H;var z=B-G;var F=S-H;var E=R-G;var Q=L-H;var O=K-G;var P=A*A+z*z;var N=A*F+z*E;var M=A*Q+z*O;var y=F*F+E*E;var x=F*Q+E*O;var C=1/(P*y-N*N);var J=(y*M-N*x)*C;var I=(P*x-N*M)*C;return(J>=0)&&(I>=0)&&(J+I<1)};t._convex=function(z,y,B,A,x,C){return(y-A)*(x-B)+(B-z)*(C-A)>=0};w.exports=t},{}],31:[function(u,v,t){var w=v.exports={};var x=u("../utils/Utils");w.crossLength=function(z,y){return z[0]*y[1]-z[1]*y[0]};w.crossVZ=function(y,z,A){w.rotate(y,z,-Math.PI/2);w.scale(y,y,A);return y};w.crossZV=function(y,A,z){w.rotate(y,z,Math.PI/2);w.scale(y,y,A);return y};w.rotate=function(B,A,D){if(D!==0){var F=Math.cos(D),C=Math.sin(D),z=A[0],E=A[1];B[0]=F*z-C*E;B[1]=C*z+F*E}else{B[0]=A[0];B[1]=A[1]}};w.rotate90cw=function(B,A){var z=A[0];var C=A[1];B[0]=C;B[1]=-z};w.toLocalFrame=function(y,B,z,A){w.copy(y,B);w.sub(y,y,z);w.rotate(y,y,-A)};w.toGlobalFrame=function(y,B,z,A){w.copy(y,B);w.rotate(y,y,A);w.add(y,y,z)};w.centroid=function(A,z,y,B){w.add(A,z,y);w.add(A,A,B);w.scale(A,A,1/3);return A};w.create=function(){var y=new x.ARRAY_TYPE(2);y[0]=0;y[1]=0;return y};w.clone=function(y){var z=new x.ARRAY_TYPE(2);z[0]=y[0];z[1]=y[1];return z};w.fromValues=function(z,B){var A=new x.ARRAY_TYPE(2);A[0]=z;A[1]=B;return A};w.copy=function(z,y){z[0]=y[0];z[1]=y[1];return z};w.set=function(A,z,B){A[0]=z;A[1]=B;return A};w.add=function(A,z,y){A[0]=z[0]+y[0];A[1]=z[1]+y[1];return A};w.subtract=function(A,z,y){A[0]=z[0]-y[0];A[1]=z[1]-y[1];return A};w.sub=w.subtract;w.multiply=function(A,z,y){A[0]=z[0]*y[0];A[1]=z[1]*y[1];return A};w.mul=w.multiply;w.divide=function(A,z,y){A[0]=z[0]/y[0];A[1]=z[1]/y[1];return A};w.div=w.divide;w.scale=function(A,z,y){A[0]=z[0]*y;A[1]=z[1]*y;return A};w.distance=function(B,A){var z=A[0]-B[0],C=A[1]-B[1];return Math.sqrt(z*z+C*C)};w.dist=w.distance;w.squaredDistance=function(B,A){var z=A[0]-B[0],C=A[1]-B[1];return z*z+C*C};w.sqrDist=w.squaredDistance;w.length=function(A){var z=A[0],B=A[1];return Math.sqrt(z*z+B*B)};w.len=w.length;w.squaredLength=function(A){var z=A[0],B=A[1];return z*z+B*B};w.sqrLen=w.squaredLength;w.negate=function(z,y){z[0]=-y[0];z[1]=-y[1];return z};w.normalize=function(C,B){var A=B[0],D=B[1];var z=A*A+D*D;if(z>0){z=1/Math.sqrt(z);C[0]=B[0]*z;C[1]=B[1]*z}return C};w.dot=function(z,y){return z[0]*y[0]+z[1]*y[1]};w.str=function(y){return"vec2("+y[0]+", "+y[1]+")"};w.lerp=function(A,z,y,B){var D=z[0],C=z[1];A[0]=D+B*(y[0]-D);A[1]=C+B*(y[1]-C);return A}},{"../utils/Utils":50}],32:[function(D,u,O){var t=D("../math/vec2"),E=D("poly-decomp"),G=D("../shapes/Convex"),K=D("../collision/AABB"),B=D("../events/EventEmitter");u.exports=J;function J(P){P=P||{};B.call(this);this.id=++J._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=P.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!P.fixedRotation;this.position=t.fromValues(0,0);if(P.position){t.copy(this.position,P.position)}this.interpolatedPosition=t.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=t.fromValues(0,0);this.previousAngle=0;this.velocity=t.fromValues(0,0);if(P.velocity){t.copy(this.velocity,P.velocity)}this.vlambda=t.fromValues(0,0);this.wlambda=0;this.angle=P.angle||0;this.angularVelocity=P.angularVelocity||0;this.force=t.create();if(P.force){t.copy(this.force,P.force)}this.angularForce=P.angularForce||0;this.damping=typeof(P.damping)==="number"?P.damping:0.1;this.angularDamping=typeof(P.angularDamping)==="number"?P.angularDamping:0.1;this.type=J.STATIC;if(typeof(P.type)!=="undefined"){this.type=P.type}else{if(!P.mass){this.type=J.STATIC}else{this.type=J.DYNAMIC}}this.boundingRadius=0;this.aabb=new K();this.aabbNeedsUpdate=true;this.allowSleep=true;this.wantsToSleep=false;this.sleepState=J.AWAKE;this.sleepSpeedLimit=0.2;this.sleepTimeLimit=1;this.gravityScale=1;this.collisionResponse=true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=P.ccdSpeedThreshold!==undefined?P.ccdSpeedThreshold:-1;this.ccdIterations=P.ccdIterations!==undefined?P.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}J.prototype=new B();J.prototype.constructor=J;J._idCounter=0;J.prototype.updateSolveMassProperties=function(){if(this.sleepState===J.SLEEPING||this.type===J.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};J.prototype.setDensity=function(P){var Q=this.getArea();this.mass=Q*P;this.updateMassProperties()};J.prototype.getArea=function(){var P=0;for(var Q=0;Q<this.shapes.length;Q++){P+=this.shapes[Q].area}return P};J.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var x=new K(),M=t.create();J.prototype.updateAABB=function(){var P=this.shapes,U=this.shapeOffsets,Q=this.shapeAngles,V=P.length,S=M,X=this.angle;for(var T=0;T!==V;T++){var W=P[T],R=Q[T]+X;t.rotate(S,U[T],X);t.add(S,S,this.position);W.computeAABB(x,S,R);if(T===0){this.aabb.copy(x)}else{this.aabb.extend(x)}}this.aabbNeedsUpdate=false};J.prototype.updateBoundingRadius=function(){var Q=this.shapes,U=this.shapeOffsets,W=Q.length,P=0;for(var S=0;S!==W;S++){var R=Q[S],V=t.length(U[S]),T=R.boundingRadius;if(V+T>P){P=V+T}}this.boundingRadius=P};J.prototype.addShape=function(P,R,Q){Q=Q||0;if(R){R=t.fromValues(R[0],R[1])}else{R=t.fromValues(0,0)}this.shapes.push(P);this.shapeOffsets.push(R);this.shapeAngles.push(Q);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};J.prototype.removeShape=function(Q){var P=this.shapes.indexOf(Q);if(P!==-1){this.shapes.splice(P,1);this.shapeOffsets.splice(P,1);this.shapeAngles.splice(P,1);this.aabbNeedsUpdate=true;return true}else{return false}};J.prototype.updateMassProperties=function(){if(this.type===J.STATIC||this.type===J.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var R=this.shapes,W=R.length,P=this.mass/W,T=0;if(!this.fixedRotation){for(var U=0;U<W;U++){var S=R[U],Q=t.squaredLength(this.shapeOffsets[U]),V=S.computeMomentOfInertia(P);T+=V+P*Q}this.inertia=T;this.invInertia=T>0?1/T:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass}};var H=t.create();J.prototype.applyForce=function(S,Q){var R=H;t.sub(R,Q,this.position);t.add(this.force,this.force,S);var P=t.crossLength(R,S);this.angularForce+=P};J.prototype.toLocalFrame=function(P,Q){t.toLocalFrame(P,Q,this.position,this.angle)};J.prototype.toWorldFrame=function(P,Q){t.toGlobalFrame(P,Q,this.position,this.angle)};J.prototype.fromPolygon=function(W,X){X=X||{};for(var R=this.shapes.length;R>=0;--R){this.removeShape(this.shapes[R])}var P=new E.Polygon();P.vertices=W;P.makeCCW();if(typeof(X.removeCollinearPoints)==="number"){P.removeCollinearPoints(X.removeCollinearPoints)}if(typeof(X.skipSimpleCheck)==="undefined"){if(!P.isSimple()){return false}}this.concavePath=P.vertices.slice(0);for(var R=0;R<this.concavePath.length;R++){var V=[0,0];t.copy(V,this.concavePath[R]);this.concavePath[R]=V}var S;if(X.optimalDecomp){S=P.decomp()}else{S=P.quickDecomp()}var U=t.create();for(var R=0;R!==S.length;R++){var T=new G(S[R].vertices);for(var Q=0;Q!==T.vertices.length;Q++){var V=T.vertices[Q];t.sub(V,V,T.centerOfMass)}t.scale(U,T.centerOfMass,1);T.updateTriangles();T.updateCenterOfMass();T.updateBoundingRadius();this.addShape(T,U)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var C=t.fromValues(0,0),A=t.fromValues(0,0),z=t.fromValues(0,0),y=t.fromValues(0,0);J.prototype.adjustCenterOfMass=function(){var V=A,T=z,P=y,Q=0;t.set(T,0,0);for(var R=0;R!==this.shapes.length;R++){var S=this.shapes[R],U=this.shapeOffsets[R];t.scale(V,U,S.area);t.add(T,T,V);Q+=S.area}t.scale(P,T,1/Q);for(var R=0;R!==this.shapes.length;R++){var S=this.shapes[R],U=this.shapeOffsets[R];if(!U){U=this.shapeOffsets[R]=t.create()}t.sub(U,U,P)}t.add(this.position,this.position,P);for(var R=0;this.concavePath&&R<this.concavePath.length;R++){t.sub(this.concavePath[R],this.concavePath[R],P)}this.updateMassProperties();this.updateBoundingRadius()};J.prototype.setZeroForce=function(){t.set(this.force,0,0);this.angularForce=0};J.prototype.resetConstraintVelocity=function(){var P=this,Q=P.vlambda;t.set(Q,0,0);P.wlambda=0};J.prototype.addConstraintVelocity=function(){var P=this,Q=P.velocity;t.add(Q,Q,P.vlambda);P.angularVelocity+=P.wlambda};J.prototype.applyDamping=function(Q){if(this.type===J.DYNAMIC){var P=this.velocity;t.scale(P,P,Math.pow(1-this.damping,Q));this.angularVelocity*=Math.pow(1-this.angularDamping,Q)}};J.prototype.wakeUp=function(){var P=this.sleepState;this.sleepState=J.AWAKE;this.idleTime=0;if(P!==J.AWAKE){this.emit(J.wakeUpEvent)}};J.prototype.sleep=function(){this.sleepState=J.SLEEPING;this.angularVelocity=0;this.angularForce=0;t.set(this.velocity,0,0);t.set(this.force,0,0);this.emit(J.sleepEvent)};J.prototype.sleepTick=function(U,Q,S){if(!this.allowSleep||this.type===J.SLEEPING){return}this.wantsToSleep=false;var R=this.sleepState,P=t.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),T=Math.pow(this.sleepSpeedLimit,2);if(P>=T){this.idleTime=0;this.sleepState=J.AWAKE}else{this.idleTime+=S;this.sleepState=J.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!Q){this.sleep()}else{this.wantsToSleep=true}}};J.prototype.getVelocityFromPosition=function(P,Q){P=P||t.create();t.sub(P,this.position,this.previousPosition);t.scale(P,P,1/Q);return P};J.prototype.getAngularVelocityFromPosition=function(P){return(this.angle-this.previousAngle)/P};J.prototype.overlaps=function(P){return this.world.overlapKeeper.bodiesAreOverlapping(this,P)};var v=t.create();var L=t.create();J.prototype.integrate=function(R){var P=this.invMass,S=this.force,T=this.position,Q=this.velocity;t.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*R}t.scale(v,S,R*P);t.add(Q,v,Q);if(!this.integrateToTimeOfImpact(R)){t.scale(L,Q,R);t.add(T,T,L);if(!this.fixedRotation){this.angle+=this.angularVelocity*R}}this.aabbNeedsUpdate=true};var N=t.create();var w=t.create();var F=t.create();var I=t.create();J.prototype.integrateToTimeOfImpact=function(T){if(this.ccdSpeedThreshold<0||t.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}t.normalize(N,this.velocity);t.scale(w,this.velocity,T);t.add(w,w,this.position);t.sub(F,w,this.position);var Z=this.angularVelocity*T;var Y=t.length(F);var R=1;var P;var X=this;this.world.raycastAll(this.position,w,{},function(ab){if(ab.body===X){return}P=ab.body;t.copy(w,ab.hitPointWorld);t.sub(F,ab.hitPointWorld,X.position);R=t.length(F)/Y;ab.abort()});if(!P){return false}var U=this.angle;t.copy(I,this.position);var aa=0;var Q=0;var W=0;var V=R;while(V>=Q&&aa<this.ccdIterations){aa++;W=(V-Q)/2;t.scale(L,F,R);t.add(this.position,I,L);this.angle=U+Z*R;this.updateAABB();var S=this.aabb.overlaps(P.aabb)&&this.world.narrowphase.bodiesOverlap(this,P);if(S){Q=W}else{V=W}}R=W;t.copy(this.position,I);this.angle=U;t.scale(L,F,R);t.add(this.position,this.position,L);if(!this.fixedRotation){this.angle+=Z*R}return true};J.sleepyEvent={type:"sleepy"};J.sleepEvent={type:"sleep"};J.wakeUpEvent={type:"wakeup"};J.DYNAMIC=1;J.STATIC=2;J.KINEMATIC=4;J.AWAKE=0;J.SLEEPY=1;J.SLEEPING=2},{"../collision/AABB":7,"../events/EventEmitter":27,"../math/vec2":31,"../shapes/Convex":39,"poly-decomp":5}],33:[function(w,v,z){var B=w("../math/vec2");var t=w("./Spring");var D=w("../utils/Utils");v.exports=u;function u(O,N,K){K=K||{};t.call(this,O,N,K);this.localAnchorA=B.fromValues(0,0);this.localAnchorB=B.fromValues(0,0);if(K.localAnchorA){B.copy(this.localAnchorA,K.localAnchorA)}if(K.localAnchorB){B.copy(this.localAnchorB,K.localAnchorB)}if(K.worldAnchorA){this.setWorldAnchorA(K.worldAnchorA)}if(K.worldAnchorB){this.setWorldAnchorB(K.worldAnchorB)}var L=B.create();var J=B.create();this.getWorldAnchorA(L);this.getWorldAnchorB(J);var M=B.distance(L,J);this.restLength=typeof(K.restLength)==="number"?K.restLength:M}u.prototype=new t();u.prototype.constructor=u;u.prototype.setWorldAnchorA=function(J){this.bodyA.toLocalFrame(this.localAnchorA,J)};u.prototype.setWorldAnchorB=function(J){this.bodyB.toLocalFrame(this.localAnchorB,J)};u.prototype.getWorldAnchorA=function(J){this.bodyA.toWorldFrame(J,this.localAnchorA)};u.prototype.getWorldAnchorB=function(J){this.bodyB.toWorldFrame(J,this.localAnchorB)};var I=B.create(),y=B.create(),G=B.create(),x=B.create(),H=B.create(),F=B.create(),E=B.create(),C=B.create(),A=B.create();u.prototype.applyForce=function(){var N=this.stiffness,T=this.damping,L=this.restLength,M=this.bodyA,K=this.bodyB,J=I,P=y,Z=G,R=x,O=A;var Y=H,W=F,V=E,U=C;this.getWorldAnchorA(Y);this.getWorldAnchorB(W);B.sub(V,Y,M.position);B.sub(U,W,K.position);B.sub(J,W,Y);var X=B.len(J);B.normalize(P,J);B.sub(Z,K.velocity,M.velocity);B.crossZV(O,K.angularVelocity,U);B.add(Z,Z,O);B.crossZV(O,M.angularVelocity,V);B.sub(Z,Z,O);B.scale(R,P,-N*(X-L)-T*B.dot(Z,P));B.sub(M.force,M.force,R);B.add(K.force,K.force,R);var S=B.crossLength(V,R);var Q=B.crossLength(U,R);M.angularForce-=S;K.angularForce+=Q}},{"../math/vec2":31,"../utils/Utils":50,"./Spring":35}],34:[function(w,x,v){var y=w("../math/vec2");var u=w("./Spring");x.exports=t;function t(B,A,z){z=z||{};u.call(this,B,A,z);this.restAngle=typeof(z.restAngle)==="number"?z.restAngle:A.angle-B.angle}t.prototype=new u();t.prototype.constructor=t;t.prototype.applyForce=function(){var C=this.stiffness,G=this.damping,B=this.restAngle,F=this.bodyA,E=this.bodyB,A=E.angle-F.angle,D=E.angularVelocity-F.angularVelocity;var z=-C*(A-B)-G*D*0;F.angularForce-=z;E.angularForce+=z}},{"../math/vec2":31,"./Spring":35}],35:[function(v,w,u){var x=v("../math/vec2");var y=v("../utils/Utils");w.exports=t;function t(B,A,z){z=y.defaults(z,{stiffness:100,damping:1,});this.stiffness=z.stiffness;this.damping=z.damping;this.bodyA=B;this.bodyB=A}t.prototype.applyForce=function(){}},{"../math/vec2":31,"../utils/Utils":50}],36:[function(u,v,t){v.exports={AABB:u("./collision/AABB"),AngleLockEquation:u("./equations/AngleLockEquation"),Body:u("./objects/Body"),Broadphase:u("./collision/Broadphase"),Capsule:u("./shapes/Capsule"),Circle:u("./shapes/Circle"),Constraint:u("./constraints/Constraint"),ContactEquation:u("./equations/ContactEquation"),ContactMaterial:u("./material/ContactMaterial"),Convex:u("./shapes/Convex"),DistanceConstraint:u("./constraints/DistanceConstraint"),Equation:u("./equations/Equation"),EventEmitter:u("./events/EventEmitter"),FrictionEquation:u("./equations/FrictionEquation"),GearConstraint:u("./constraints/GearConstraint"),GridBroadphase:u("./collision/GridBroadphase"),GSSolver:u("./solver/GSSolver"),Heightfield:u("./shapes/Heightfield"),Line:u("./shapes/Line"),LockConstraint:u("./constraints/LockConstraint"),Material:u("./material/Material"),Narrowphase:u("./collision/Narrowphase"),NaiveBroadphase:u("./collision/NaiveBroadphase"),Particle:u("./shapes/Particle"),Plane:u("./shapes/Plane"),RevoluteConstraint:u("./constraints/RevoluteConstraint"),PrismaticConstraint:u("./constraints/PrismaticConstraint"),Ray:u("./collision/Ray"),RaycastResult:u("./collision/RaycastResult"),Rectangle:u("./shapes/Rectangle"),RotationalVelocityEquation:u("./equations/RotationalVelocityEquation"),SAPBroadphase:u("./collision/SAPBroadphase"),Shape:u("./shapes/Shape"),Solver:u("./solver/Solver"),Spring:u("./objects/Spring"),LinearSpring:u("./objects/LinearSpring"),RotationalSpring:u("./objects/RotationalSpring"),Utils:u("./utils/Utils"),World:u("./world/World"),vec2:u("./math/vec2"),version:u("../package.json").version,}},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/GridBroadphase":9,"./collision/NaiveBroadphase":10,"./collision/Narrowphase":11,"./collision/Ray":12,"./collision/RaycastResult":13,"./collision/SAPBroadphase":14,"./constraints/Constraint":15,"./constraints/DistanceConstraint":16,"./constraints/GearConstraint":17,"./constraints/LockConstraint":18,"./constraints/PrismaticConstraint":19,"./constraints/RevoluteConstraint":20,"./equations/AngleLockEquation":21,"./equations/ContactEquation":22,"./equations/Equation":23,"./equations/FrictionEquation":24,"./equations/RotationalVelocityEquation":26,"./events/EventEmitter":27,"./material/ContactMaterial":28,"./material/Material":29,"./math/vec2":31,"./objects/Body":32,"./objects/LinearSpring":33,"./objects/RotationalSpring":34,"./objects/Spring":35,"./shapes/Capsule":37,"./shapes/Circle":38,"./shapes/Convex":39,"./shapes/Heightfield":40,"./shapes/Line":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Rectangle":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/Utils":50,"./world/World":54}],37:[function(v,w,u){var z=v("./Shape"),x=v("../math/vec2");w.exports=t;function t(B,A){this.length=B||1;this.radius=A||1;z.call(this,z.CAPSULE)}t.prototype=new z();t.prototype.constructor=t;t.prototype.computeMomentOfInertia=function(B){var D=this.radius,A=this.length+D,C=D*2;return B*(C*C+A*A)/12};t.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};t.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var y=x.create();t.prototype.computeAABB=function(C,B,D){var A=this.radius;x.set(y,this.length/2,0);if(D!==0){x.rotate(y,y,D)}x.set(C.upperBound,Math.max(y[0]+A,-y[0]+A),Math.max(y[1]+A,-y[1]+A));x.set(C.lowerBound,Math.min(y[0]-A,-y[0]-A),Math.min(y[1]-A,-y[1]-A));x.add(C.lowerBound,C.lowerBound,B);x.add(C.upperBound,C.upperBound,B)}},{"../math/vec2":31,"./Shape":45}],38:[function(u,v,t){var y=u("./Shape"),x=u("../math/vec2");v.exports=w;function w(z){this.radius=z||1;y.call(this,y.CIRCLE)}w.prototype=new y();w.prototype.constructor=w;w.prototype.computeMomentOfInertia=function(z){var A=this.radius;return z*A*A/2};w.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};w.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};w.prototype.computeAABB=function(A,z,C){var B=this.radius;x.set(A.upperBound,B,B);x.set(A.lowerBound,-B,-B);if(z){x.add(A.lowerBound,A.lowerBound,z);x.add(A.upperBound,A.upperBound,z)}}},{"../math/vec2":31,"./Shape":45}],39:[function(B,v,K){var A=B("./Shape"),u=B("../math/vec2"),y=B("../math/polyk"),C=B("poly-decomp");v.exports=E;function E(N,T){this.vertices=[];this.axes=[];for(var O=0;O<N.length;O++){var M=u.create();u.copy(M,N[O]);this.vertices.push(M)}if(T){for(var O=0;O<T.length;O++){var Q=u.create();u.copy(Q,T[O]);this.axes.push(Q)}}else{for(var O=0;O<N.length;O++){var R=N[O];var P=N[(O+1)%N.length];var S=u.create();u.sub(S,P,R);u.rotate90cw(S,S);u.normalize(S,S);this.axes.push(S)}}this.centerOfMass=u.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;A.call(this,A.CONVEX);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}E.prototype=new A();E.prototype.constructor=E;var z=u.create();var x=u.create();E.prototype.projectOntoLocalAxis=function(S,N){var M=null,R=null,O,T,S=z;for(var Q=0;Q<this.vertices.length;Q++){O=this.vertices[Q];T=u.dot(O,S);if(M===null||T>M){M=T}if(R===null||T<R){R=T}}if(R>M){var P=R;R=M;M=P}u.set(N,R,M)};E.prototype.projectOntoWorldAxis=function(P,O,R,M){var N=x;this.projectOntoLocalAxis(P,M);if(R!==0){u.rotate(N,P,R)}else{N=P}var Q=u.dot(O,N);u.set(M,M[0]+Q,M[1]+Q)};E.prototype.updateTriangles=function(){this.triangles.length=0;var S=[];for(var P=0;P<this.vertices.length;P++){var M=this.vertices[P];S.push(M[0],M[1])}var R=y.Triangulate(S);for(var P=0;P<R.length;P+=3){var Q=R[P],O=R[P+1],N=R[P+2];this.triangles.push([Q,O,N])}};var D=u.create(),w=u.create(),L=u.create(),J=u.create(),I=u.create(),t=u.create(),H=u.create(),G=u.create(),F=u.create();E.prototype.updateCenterOfMass=function(){var Q=this.triangles,X=this.vertices,Y=this.centerOfMass,M=D,N=F,W=L,V=J,U=I,ab=t,R=H,P=G,T=w;u.set(Y,0,0);var aa=0;for(var S=0;S!==Q.length;S++){var Z=Q[S],W=X[Z[0]],V=X[Z[1]],U=X[Z[2]];u.centroid(M,W,V,U);var O=E.triangleArea(W,V,U);aa+=O;u.scale(T,M,O);u.add(Y,Y,T)}u.scale(Y,Y,1/aa)};E.prototype.computeMomentOfInertia=function(S){var Q=0,P=0,R=this.vertices.length;for(var M=R-1,O=0;O<R;M=O,O++){var W=this.vertices[M];var V=this.vertices[O];var U=Math.abs(u.crossLength(W,V));var T=u.dot(V,V)+u.dot(V,W)+u.dot(W,W);Q+=U*T;P+=U}return(S/6)*(Q/P)};E.prototype.updateBoundingRadius=function(){var P=this.vertices,N=0;for(var O=0;O!==P.length;O++){var M=u.squaredLength(P[O]);if(M>N){N=M}}this.boundingRadius=Math.sqrt(N)};E.triangleArea=function(N,M,O){return(((M[0]-N[0])*(O[1]-N[1]))-((O[0]-N[0])*(M[1]-N[1])))*0.5};E.prototype.updateArea=function(){this.updateTriangles();this.area=0;var R=this.triangles,T=this.vertices;for(var Q=0;Q!==R.length;Q++){var P=R[Q],O=T[P[0]],N=T[P[1]],S=T[P[2]];var M=E.triangleArea(O,N,S);this.area+=M}};E.prototype.computeAABB=function(N,M,O){N.setFromPoints(this.vertices,M,O,0)}},{"../math/polyk":30,"../math/vec2":31,"./Shape":45,"poly-decomp":5}],40:[function(u,w,t){var z=u("./Shape"),x=u("../math/vec2"),y=u("../utils/Utils");w.exports=v;function v(D,B){B=y.defaults(B,{maxValue:null,minValue:null,elementWidth:0.1});if(B.minValue===null||B.maxValue===null){B.maxValue=D[0];B.minValue=D[0];for(var C=0;C!==D.length;C++){var A=D[C];if(A>B.maxValue){B.maxValue=A}if(A<B.minValue){B.minValue=A}}}this.data=D;this.maxValue=B.maxValue;this.minValue=B.minValue;this.elementWidth=B.elementWidth;z.call(this,z.HEIGHTFIELD)}v.prototype=new z();v.prototype.constructor=v;v.prototype.computeMomentOfInertia=function(A){return Number.MAX_VALUE};v.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};v.prototype.updateArea=function(){var C=this.data,B=0;for(var A=0;A<C.length-1;A++){B+=(C[A]+C[A+1])/2*this.elementWidth}this.area=B};v.prototype.computeAABB=function(B,A,C){B.upperBound[0]=this.elementWidth*this.data.length+A[0];B.upperBound[1]=this.maxValue+A[1];B.lowerBound[0]=A[0];B.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],41:[function(u,v,t){var y=u("./Shape"),x=u("../math/vec2");v.exports=z;function z(A){this.length=A||1;y.call(this,y.LINE)}z.prototype=new y();z.prototype.constructor=z;z.prototype.computeMomentOfInertia=function(A){return A*Math.pow(this.length,2)/12};z.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var w=[x.create(),x.create()];z.prototype.computeAABB=function(C,B,D){var A=this.length/2;x.set(w[0],-A,0);x.set(w[1],A,0);C.setFromPoints(w,B,D,0)}},{"../math/vec2":31,"./Shape":45}],42:[function(v,w,u){var y=v("./Shape"),x=v("../math/vec2");w.exports=t;function t(){y.call(this,y.PARTICLE)}t.prototype=new y();t.prototype.constructor=t;t.prototype.computeMomentOfInertia=function(z){return 0};t.prototype.updateBoundingRadius=function(){this.boundingRadius=0};t.prototype.computeAABB=function(A,z,B){x.copy(A.lowerBound,z);x.copy(A.upperBound,z)}},{"../math/vec2":31,"./Shape":45}],43:[function(u,v,t){var z=u("./Shape"),w=u("../math/vec2"),y=u("../utils/Utils");v.exports=x;function x(){z.call(this,z.PLANE)}x.prototype=new z();x.prototype.constructor=x;x.prototype.computeMomentOfInertia=function(A){return 0};x.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};x.prototype.computeAABB=function(C,A,D){var B=0,E=w.set;if(typeof(D)==="number"){B=D%(2*Math.PI)}if(B===0){E(C.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);E(C.upperBound,Number.MAX_VALUE,0)}else{if(B===Math.PI/2){E(C.lowerBound,0,-Number.MAX_VALUE);E(C.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(B===Math.PI){E(C.lowerBound,-Number.MAX_VALUE,0);E(C.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(B===3*Math.PI/2){E(C.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);E(C.upperBound,0,Number.MAX_VALUE)}else{E(C.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);E(C.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}}}}w.add(C.lowerBound,C.lowerBound,A);w.add(C.upperBound,C.upperBound,A)};x.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45}],44:[function(w,t,B){var C=w("../math/vec2"),A=w("./Shape"),y=w("./Convex");t.exports=D;function D(F,E){this.width=F||1;this.height=E||1;var H=[C.fromValues(-F/2,-E/2),C.fromValues(F/2,-E/2),C.fromValues(F/2,E/2),C.fromValues(-F/2,E/2)];var G=[C.fromValues(1,0),C.fromValues(0,1)];y.call(this,H,G);this.type=A.RECTANGLE}D.prototype=new y([]);D.prototype.constructor=D;D.prototype.computeMomentOfInertia=function(F){var E=this.width,G=this.height;return F*(G*G+E*E)/12};D.prototype.updateBoundingRadius=function(){var E=this.width,F=this.height;this.boundingRadius=Math.sqrt(E*E+F*F)/2};var z=C.create(),x=C.create(),v=C.create(),u=C.create();D.prototype.computeAABB=function(F,E,G){F.setFromPoints(this.vertices,E,G,0)};D.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":31,"./Convex":39,"./Shape":45}],45:[function(u,v,t){v.exports=w;function w(x){this.type=x;this.id=w.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionResponse=true;this.collisionMask=1;if(x){this.updateBoundingRadius()}this.material=null;this.area=0;this.sensor=false;this.updateArea()}w.idCounter=0;w.CIRCLE=1;w.PARTICLE=2;w.PLANE=4;w.CONVEX=8;w.LINE=16;w.RECTANGLE=32;w.CAPSULE=64;w.HEIGHTFIELD=128;w.prototype.computeMomentOfInertia=function(x){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")};w.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")};w.prototype.updateArea=function(){};w.prototype.computeAABB=function(y,x,z){}},{}],46:[function(v,t,w){var y=v("../math/vec2"),u=v("./Solver"),z=v("../utils/Utils"),B=v("../equations/FrictionEquation");t.exports=x;function x(C){u.call(this,C,u.GS);C=C||{};this.iterations=C.iterations||10;this.tolerance=C.tolerance||1e-10;this.arrayStep=30;this.lambda=new z.ARRAY_TYPE(this.arrayStep);this.Bs=new z.ARRAY_TYPE(this.arrayStep);this.invCs=new z.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}x.prototype=new u();x.prototype.constructor=x;function A(D){var C=D.length;while(C--){D[C]=+0}}x.prototype.solve=function(X,P){this.sortEquations();var U=0,F=this.iterations,M=this.frictionIterations,I=this.equations,E=I.length,T=Math.pow(this.tolerance*E,2),H=P.bodies,G=P.bodies.length,L=y.add,K=y.set,D=this.useZeroRHS,J=this.lambda;this.usedIterations=0;if(E){for(var V=0;V!==G;V++){var ab=H[V];ab.updateSolveMassProperties()}}if(J.length<E){J=this.lambda=new z.ARRAY_TYPE(E+this.arrayStep);this.Bs=new z.ARRAY_TYPE(E+this.arrayStep);this.invCs=new z.ARRAY_TYPE(E+this.arrayStep)}A(J);var Y=this.invCs,C=this.Bs,J=this.lambda;for(var V=0;V!==I.length;V++){var aa=I[V];if(aa.timeStep!==X||aa.needsUpdate){aa.timeStep=X;aa.update()}C[V]=aa.computeB(aa.a,aa.b,X);Y[V]=aa.computeInvC(aa.epsilon)}var O,N,aa,W,V,S;if(E!==0){for(V=0;V!==G;V++){var ab=H[V];ab.resetConstraintVelocity()}if(M){for(U=0;U!==M;U++){W=0;for(S=0;S!==E;S++){aa=I[S];var R=x.iterateEquation(S,aa,aa.epsilon,C,Y,J,D,X,U);W+=Math.abs(R)}this.usedIterations++;if(W*W<=T){break}}x.updateMultipliers(I,J,1/X);for(S=0;S!==E;S++){var ac=I[S];if(ac instanceof B){var Z=0;for(var Q=0;Q!==ac.contactEquations.length;Q++){Z+=ac.contactEquations[Q].multiplier}Z*=ac.frictionCoefficient/ac.contactEquations.length;ac.maxForce=Z;ac.minForce=-Z}}}for(U=0;U!==F;U++){W=0;for(S=0;S!==E;S++){aa=I[S];var R=x.iterateEquation(S,aa,aa.epsilon,C,Y,J,D,X,U);W+=Math.abs(R)}this.usedIterations++;if(W*W<=T){break}}for(V=0;V!==G;V++){H[V].addConstraintVelocity()}x.updateMultipliers(I,J,1/X)}};x.updateMultipliers=function(C,F,E){var D=C.length;while(D--){C[D].multiplier=F[D]*E}};x.iterateEquation=function(I,R,S,C,J,M,Q,G,N){var F=C[I],L=J[I],K=M[I],E=R.computeGWlambda();var P=R.maxForce,D=R.minForce;if(Q){F=0}var H=L*(F-E-S*K);var O=K+H;if(O<D*G){H=D*G-K}else{if(O>P*G){H=P*G-K}}M[I]+=H;R.addToWlambda(H);return H}},{"../equations/FrictionEquation":24,"../math/vec2":31,"../utils/Utils":50,"./Solver":47}],47:[function(u,v,t){var y=u("../utils/Utils"),x=u("../events/EventEmitter");v.exports=z;function z(A,B){A=A||{};x.call(this);this.type=B;this.equations=[];this.equationSortFunction=A.equationSortFunction||false}z.prototype=new x();z.prototype.constructor=z;z.prototype.solve=function(A,B){throw new Error("Solver.solve should be implemented by subclasses!")};var w={bodies:[]};z.prototype.solveIsland=function(B,A){this.removeAllEquations();if(A.equations.length){this.addEquations(A.equations);w.bodies.length=0;A.getBodies(w.bodies);if(w.bodies.length){this.solve(B,w)}}};z.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};z.prototype.addEquation=function(A){if(A.enabled){this.equations.push(A)}};z.prototype.addEquations=function(B){for(var C=0,D=B.length;C!==D;C++){var A=B[C];if(A.enabled){this.equations.push(A)}}};z.prototype.removeEquation=function(A){var B=this.equations.indexOf(A);if(B!==-1){this.equations.splice(B,1)}};z.prototype.removeAllEquations=function(){this.equations.length=0};z.GS=1;z.ISLAND=2},{"../events/EventEmitter":27,"../utils/Utils":50}],48:[function(v,w,t){var x=v("./TupleDictionary");var y=v("./Utils");w.exports=u;function u(){this.overlappingShapesLastState=new x();this.overlappingShapesCurrentState=new x();this.recordPool=[];this.tmpDict=new x();this.tmpArray1=[]}u.prototype.tick=function(){var D=this.overlappingShapesLastState;var E=this.overlappingShapesCurrentState;var B=D.keys.length;while(B--){var C=D.keys[B];var F=D.getByKey(C);var A=E.getByKey(C);if(F&&!A){this.recordPool.push(F)}}D.reset();D.copy(E);E.reset()};u.prototype.setOverlapping=function(G,D,F,B){var A=this.overlappingShapesLastState;var E=this.overlappingShapesCurrentState;if(!E.get(D.id,B.id)){var C;if(this.recordPool.length){C=this.recordPool.pop();C.set(G,D,F,B)}else{C=new z(G,D,F,B)}E.set(D.id,B.id,C)}};u.prototype.getNewOverlaps=function(A){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,A)};u.prototype.getEndOverlaps=function(A){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,A)};u.prototype.bodiesAreOverlapping=function(F,E){var D=this.overlappingShapesCurrentState;var A=D.keys.length;while(A--){var B=D.keys[A];var C=D.data[B];if((C.bodyA===F&&C.bodyB===E)||C.bodyA===E&&C.bodyB===F){return true}}return false};u.prototype.getDiff=function(C,A,I){var I=I||[];var G=C;var F=A;I.length=0;var D=F.keys.length;while(D--){var H=F.keys[D];var E=F.data[H];if(!E){throw new Error("Key "+H+" had no data!")}var B=G.data[H];if(!B){I.push(E)}}return I};u.prototype.isNewOverlap=function(D,C){var A=D.id|0,F=C.id|0;var B=this.overlappingShapesLastState;var E=this.overlappingShapesCurrentState;return !!!B.get(A,F)&&!!E.get(A,F)};u.prototype.getNewBodyOverlaps=function(A){this.tmpArray1.length=0;var B=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(B,A)};u.prototype.getEndBodyOverlaps=function(A){this.tmpArray1.length=0;var B=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(B,A)};u.prototype.getBodyDiff=function(E,A){A=A||[];var C=this.tmpDict;var B=E.length;while(B--){var D=E[B];C.set(D.bodyA.id|0,D.bodyB.id|0,D)}B=C.keys.length;while(B--){var D=C.getByKey(C.keys[B]);if(D){A.push(D.bodyA,D.bodyB)}}C.reset();return A};function z(D,B,C,A){this.shapeA=B;this.shapeB=A;this.bodyA=D;this.bodyB=C}z.prototype.set=function(D,B,C,A){z.call(this,D,B,C,A)}},{"./TupleDictionary":49,"./Utils":50}],49:[function(u,v,t){var x=u("./Utils");v.exports=w;function w(){this.data={};this.keys=[]}w.prototype.getKey=function(z,y){z=z|0;y=y|0;if((z|0)===(y|0)){return -1}return((z|0)>(y|0)?(z<<16)|(y&65535):(y<<16)|(z&65535))|0};w.prototype.getByKey=function(y){y=y|0;return this.data[y]};w.prototype.get=function(z,y){return this.data[this.getKey(z,y)]};w.prototype.set=function(A,y,B){if(!B){throw new Error("No data!")}var z=this.getKey(A,y);if(!this.data[z]){this.keys.push(z)}this.data[z]=B;return z};w.prototype.reset=function(){var A=this.data,z=this.keys;var y=z.length;while(y--){delete A[z[y]]}z.length=0};w.prototype.copy=function(A){this.reset();x.appendArray(this.keys,A.keys);var y=A.keys.length;while(y--){var z=A.keys[y];this.data[z]=A.data[z]}}},{"./Utils":50}],50:[function(u,v,t){v.exports=w;function w(){}w.appendArray=function(z,y){if(y.length<150000){z.push.apply(z,y)}else{for(var A=0,x=y.length;A!==x;++A){z.push(y[A])}}};w.splice=function(B,y,A){A=A||1;for(var z=y,x=B.length-A;z<x;z++){B[z]=B[z+A]}B.length=x};w.ARRAY_TYPE=window.Float32Array||Array;w.extend=function(y,x){for(var z in x){y[z]=x[z]}};w.defaults=function(x,z){x=x||{};for(var y in z){if(!(y in x)){x[y]=z[y]}}return x}},{}],51:[function(v,x,u){var y=v("../objects/Body");x.exports=w;function w(){this.equations=[];this.bodies=[]}w.prototype.reset=function(){this.equations.length=this.bodies.length=0};var t=[];w.prototype.getBodies=function(A){var B=A||[],C=this.equations;t.length=0;for(var D=0;D!==C.length;D++){var z=C[D];if(t.indexOf(z.bodyA.id)===-1){B.push(z.bodyA);t.push(z.bodyA.id)}if(t.indexOf(z.bodyB.id)===-1){B.push(z.bodyB);t.push(z.bodyB.id)}}return B};w.prototype.wantsToSleep=function(){for(var A=0;A<this.bodies.length;A++){var z=this.bodies[A];if(z.type===y.DYNAMIC&&!z.wantsToSleep){return false}}return true};w.prototype.sleep=function(){for(var A=0;A<this.bodies.length;A++){var z=this.bodies[A];z.sleep()}return true}},{"../objects/Body":32}],52:[function(u,w,t){var z=u("../math/vec2"),v=u("./Island"),y=u("./IslandNode"),A=u("../objects/Body");w.exports=x;function x(B){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}x.getUnvisitedNode=function(B){var C=B.length;for(var D=0;D!==C;D++){var E=B[D];if(!E.visited&&E.body.type===A.DYNAMIC){return E}}return false};x.prototype.visit=function(G,D,E){D.push(G.body);var C=G.equations.length;for(var F=0;F!==C;F++){var B=G.equations[F];if(E.indexOf(B)===-1){E.push(B)}}};x.prototype.bfs=function(D,C,E){var B=this.queue;B.length=0;B.push(D);D.visited=true;this.visit(D,C,E);while(B.length){var F=B.pop();var G;while((G=x.getUnvisitedNode(F.neighbors))){G.visited=true;this.visit(G,C,E);if(G.body.type===A.DYNAMIC){B.push(G)}}}};x.prototype.split=function(N){var B=N.bodies,D=this.nodes,C=this.equations;while(D.length){this._nodePool.push(D.pop())}for(var K=0;K!==B.length;K++){if(this._nodePool.length){var H=this._nodePool.pop();H.reset();H.body=B[K];D.push(H)}else{D.push(new y(B[K]))}}for(var I=0;I!==C.length;I++){var O=C[I],K=B.indexOf(O.bodyA),J=B.indexOf(O.bodyB),G=D[K],E=D[J];G.neighbors.push(E);E.neighbors.push(G);G.equations.push(O);E.equations.push(O)}var M=this.islands;while(M.length){var L=M.pop();L.reset();this._islandPool.push(L)}var F;while((F=x.getUnvisitedNode(D))){var L=this._islandPool.length?this._islandPool.pop():new v();this.bfs(F,L.bodies,L.equations);M.push(L)}return M}},{"../math/vec2":31,"../objects/Body":32,"./Island":51,"./IslandNode":53}],53:[function(u,v,t){v.exports=w;function w(x){this.body=x;this.neighbors=[];this.equations=[];this.visited=false}w.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],54:[function(C,A,al){var af=C("../solver/GSSolver"),aw=C("../solver/Solver"),aj=C("../collision/NaiveBroadphase"),Z=C("../collision/Ray"),ar=C("../math/vec2"),ao=C("../shapes/Circle"),T=C("../shapes/Rectangle"),W=C("../shapes/Convex"),B=C("../shapes/Line"),K=C("../shapes/Plane"),av=C("../shapes/Capsule"),at=C("../shapes/Particle"),S=C("../events/EventEmitter"),R=C("../objects/Body"),E=C("../shapes/Shape"),V=C("../objects/LinearSpring"),U=C("../material/Material"),J=C("../material/ContactMaterial"),ae=C("../constraints/DistanceConstraint"),Q=C("../constraints/Constraint"),ad=C("../constraints/LockConstraint"),Y=C("../constraints/RevoluteConstraint"),I=C("../constraints/PrismaticConstraint"),au=C("../constraints/GearConstraint"),y=C("../../package.json"),x=C("../collision/Broadphase"),G=C("../collision/SAPBroadphase"),ac=C("../collision/Narrowphase"),ag=C("../utils/Utils"),t=C("../utils/OverlapKeeper"),u=C("./IslandManager"),L=C("../objects/RotationalSpring");A.exports=O;if(typeof performance==="undefined"){performance={}}if(!performance.now){var z=Date.now();if(performance.timing&&performance.timing.navigationStart){z=performance.timing.navigationStart}performance.now=function(){return Date.now()-z}}function O(ay){S.apply(this);ay=ay||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=ay.solver||new af();this.narrowphase=new ac(this);this.islandManager=new u();this.gravity=ar.fromValues(0,-9.78);if(ay.gravity){ar.copy(this.gravity,ay.gravity)}this.frictionGravity=ar.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.doProfiling=ay.doProfiling||false;this.lastStepTime=0;this.broadphase=ay.broadphase||new G();this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new U();this.defaultContactMaterial=new J(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.stepping=false;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit=typeof(ay.islandSplit)!=="undefined"?!!ay.islandSplit:false;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep",};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null,};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null,};this.postBroadphaseEvent={type:"postBroadphase",pairs:null,};this.sleepMode=O.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[],};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null,};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new t()}O.prototype=new Object(S.prototype);O.prototype.constructor=O;O.NO_SLEEPING=1;O.BODY_SLEEPING=2;O.ISLAND_SLEEPING=4;O.prototype.addConstraint=function(ay){this.constraints.push(ay)};O.prototype.addContactMaterial=function(ay){this.contactMaterials.push(ay)};O.prototype.removeContactMaterial=function(az){var ay=this.contactMaterials.indexOf(az);if(ay!==-1){ag.splice(this.contactMaterials,ay,1)}};O.prototype.getContactMaterial=function(aC,aB){var aA=this.contactMaterials;for(var az=0,aD=aA.length;az!==aD;az++){var ay=aA[az];if((ay.materialA.id===aC.id)&&(ay.materialB.id===aB.id)||(ay.materialA.id===aB.id)&&(ay.materialB.id===aC.id)){return ay}}return false};O.prototype.removeConstraint=function(az){var ay=this.constraints.indexOf(az);if(ay!==-1){ag.splice(this.constraints,ay,1)}};var aq=ar.create(),D=ar.create(),ap=ar.create(),w=ar.create(),ak=ar.create(),H=ar.create(),an=ar.create(),ab=ar.fromValues(0,0),N=ar.fromValues(0,0),v=ar.fromValues(0,0),X=ar.fromValues(0,0);O.prototype.step=function(ay,aF,az){az=az||10;aF=aF||0;if(aF===0){this.internalStep(ay);this.time+=ay}else{var aH=Math.floor((this.time+aF)/ay)-Math.floor(this.time/ay);aH=Math.min(aH,az);var aD=performance.now();for(var aB=0;aB!==aH;aB++){this.internalStep(ay);if(performance.now()-aD>ay*1000){break}}this.time+=aF;var aC=this.time%ay;var aE=aC/ay;for(var aA=0;aA!==this.bodies.length;aA++){var aG=this.bodies[aA];if(aG.type!==R.STATIC&&aG.sleepState!==R.SLEEPING){ar.sub(X,aG.position,aG.previousPosition);ar.scale(X,X,aE);ar.add(aG.interpolatedPosition,aG.position,X);aG.interpolatedAngle=aG.angle+(aG.angle-aG.previousAngle)*aE}else{ar.copy(aG.interpolatedPosition,aG.position);aG.interpolatedAngle=aG.angle}}}};var P=[];O.prototype.internalStep=function(aE){this.stepping=true;var a1=this,aC=this.doProfiling,aV=this.springs.length,aO=this.springs,bl=this.bodies,bg=this.gravity,aR=this.solver,aD=this.bodies.length,a0=this.broadphase,bm=this.narrowphase,aA=this.constraints,aZ,aY,aS=ak,bc=H,aK=an,aX=ar.scale,aB=ar.add,bk=ar.rotate,aP=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=aE;if(aC){aZ=performance.now()}if(this.useWorldGravityAsFrictionGravity){var ay=ar.length(this.gravity);if(!(ay===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=ay}}if(this.applyGravity){for(var be=0;be!==aD;be++){var bq=bl[be],aW=bq.force;if(bq.type!==R.DYNAMIC||bq.sleepState===R.SLEEPING){continue}ar.scale(aK,bg,bq.mass*bq.gravityScale);aB(aW,aW,aK)}}if(this.applySpringForces){for(var be=0;be!==aV;be++){var a4=aO[be];a4.applyForce()}}if(this.applyDamping){for(var be=0;be!==aD;be++){var bq=bl[be];if(bq.type===R.DYNAMIC){bq.applyDamping(aE)}}}var aN=a0.getCollisionPairs(this);var a7=this.disabledBodyCollisionPairs;for(var be=a7.length-2;be>=0;be-=2){for(var bd=aN.length-2;bd>=0;bd-=2){if((a7[be]===aN[bd]&&a7[be+1]===aN[bd+1])||(a7[be+1]===aN[bd]&&a7[be]===aN[bd+1])){aN.splice(bd,2)}}}var az=aA.length;for(be=0;be!==az;be++){var bp=aA[be];if(!bp.collideConnected){for(var bd=aN.length-2;bd>=0;bd-=2){if((bp.bodyA===aN[bd]&&bp.bodyB===aN[bd+1])||(bp.bodyB===aN[bd]&&bp.bodyA===aN[bd+1])){aN.splice(bd,2)}}}}this.postBroadphaseEvent.pairs=aN;this.emit(this.postBroadphaseEvent);bm.reset(this);for(var be=0,aT=aN.length;be!==aT;be+=2){var bh=aN[be],bf=aN[be+1];for(var bb=0,aH=bh.shapes.length;bb!==aH;bb++){var aM=bh.shapes[bb],a3=bh.shapeOffsets[bb],aJ=bh.shapeAngles[bb];for(var a9=0,aG=bf.shapes.length;a9!==aG;a9++){var aL=bf.shapes[a9],a2=bf.shapeOffsets[a9],aI=bf.shapeAngles[a9];var aU=this.defaultContactMaterial;if(aM.material&&aL.material){var a6=this.getContactMaterial(aM.material,aL.material);if(a6){aU=a6}}this.runNarrowphase(bm,bh,aM,a3,aJ,bf,aL,a2,aI,aU,this.frictionGravity)}}}for(var be=0;be!==aD;be++){var aQ=bl[be];if(aQ._wakeUpAfterNarrowphase){aQ.wakeUp();aQ._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(P);var bn=this.endContactEvent;var a9=P.length;while(a9--){var bo=P[a9];bn.shapeA=bo.shapeA;bn.shapeB=bo.shapeB;bn.bodyA=bo.bodyA;bn.bodyB=bo.bodyB;this.emit(bn)}}var aF=this.preSolveEvent;aF.contactEquations=bm.contactEquations;aF.frictionEquations=bm.frictionEquations;this.emit(aF);var az=aA.length;for(be=0;be!==az;be++){aA[be].update()}if(bm.contactEquations.length||bm.frictionEquations.length||aA.length){if(this.islandSplit){aP.equations.length=0;ag.appendArray(aP.equations,bm.contactEquations);ag.appendArray(aP.equations,bm.frictionEquations);for(be=0;be!==az;be++){ag.appendArray(aP.equations,aA[be].equations)}aP.split(this);for(var be=0;be!==aP.islands.length;be++){var ba=aP.islands[be];if(ba.equations.length){aR.solveIsland(aE,ba)}}}else{aR.addEquations(bm.contactEquations);aR.addEquations(bm.frictionEquations);for(be=0;be!==az;be++){aR.addEquations(aA[be].equations)}if(this.solveConstraints){aR.solve(aE,this)}aR.removeAllEquations()}}for(var be=0;be!==aD;be++){var aQ=bl[be];if(aQ.sleepState!==R.SLEEPING&&aQ.type!==R.STATIC){aQ.integrate(aE)}}for(var be=0;be!==aD;be++){bl[be].setZeroForce()}if(aC){aY=performance.now();a1.lastStepTime=aY-aZ}if(this.emitImpactEvent&&this.has("impact")){var a5=this.impactEvent;for(var be=0;be!==bm.contactEquations.length;be++){var a8=bm.contactEquations[be];if(a8.firstImpact){a5.bodyA=a8.bodyA;a5.bodyB=a8.bodyB;a5.shapeA=a8.shapeA;a5.shapeB=a8.shapeB;a5.contactEquation=a8;this.emit(a5)}}}if(this.sleepMode===O.BODY_SLEEPING){for(be=0;be!==aD;be++){bl[be].sleepTick(this.time,false,aE)}}else{if(this.sleepMode===O.ISLAND_SLEEPING&&this.islandSplit){for(be=0;be!==aD;be++){bl[be].sleepTick(this.time,true,aE)}for(var be=0;be<this.islandManager.islands.length;be++){var ba=this.islandManager.islands[be];if(ba.wantsToSleep()){ba.sleep()}}}}this.stepping=false;if(this.bodiesToBeRemoved.length){for(var be=0;be!==this.bodiesToBeRemoved.length;be++){this.removeBody(this.bodiesToBeRemoved[be])}this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};O.prototype.runNarrowphase=function(ay,aB,aV,aL,aO,az,aU,aK,aN,aG,aA){if(!((aV.collisionGroup&aU.collisionMask)!==0&&(aU.collisionGroup&aV.collisionMask)!==0)){return}ar.rotate(ab,aL,aB.angle);ar.rotate(N,aK,az.angle);ar.add(ab,ab,aB.position);ar.add(N,N,az.position);var aT=aO+aB.angle;var aD=aN+az.angle;ay.enableFriction=aG.friction>0;ay.frictionCoefficient=aG.friction;var aC;if(aB.type===R.STATIC||aB.type===R.KINEMATIC){aC=az.mass}else{if(az.type===R.STATIC||az.type===R.KINEMATIC){aC=aB.mass}else{aC=(aB.mass*az.mass)/(aB.mass+az.mass)}}ay.slipForce=aG.friction*aA*aC;ay.restitution=aG.restitution;ay.surfaceVelocity=aG.surfaceVelocity;ay.frictionStiffness=aG.frictionStiffness;ay.frictionRelaxation=aG.frictionRelaxation;ay.stiffness=aG.stiffness;ay.relaxation=aG.relaxation;ay.contactSkinSize=aG.contactSkinSize;ay.enabledEquations=aB.collisionResponse&&az.collisionResponse&&aV.collisionResponse&&aU.collisionResponse;var aE=ay[aV.type|aU.type],aX=0;if(aE){var aP=aV.sensor||aU.sensor;var aS=ay.frictionEquations.length;if(aV.type<aU.type){aX=aE.call(ay,aB,aV,ab,aT,az,aU,N,aD,aP)}else{aX=aE.call(ay,az,aU,N,aD,aB,aV,ab,aT,aP)}var aW=ay.frictionEquations.length-aS;if(aX){if(aB.allowSleep&&aB.type===R.DYNAMIC&&aB.sleepState===R.SLEEPING&&az.sleepState===R.AWAKE&&az.type!==R.STATIC){var aF=ar.squaredLength(az.velocity)+Math.pow(az.angularVelocity,2);var aI=Math.pow(az.sleepSpeedLimit,2);if(aF>=aI*2){aB._wakeUpAfterNarrowphase=true}}if(az.allowSleep&&az.type===R.DYNAMIC&&az.sleepState===R.SLEEPING&&aB.sleepState===R.AWAKE&&aB.type!==R.STATIC){var aH=ar.squaredLength(aB.velocity)+Math.pow(aB.angularVelocity,2);var aJ=Math.pow(aB.sleepSpeedLimit,2);if(aH>=aJ*2){az._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(aB,aV,az,aU);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(aV,aU)){var aR=this.beginContactEvent;aR.shapeA=aV;aR.shapeB=aU;aR.bodyA=aB;aR.bodyB=az;aR.contactEquations.length=0;if(typeof(aX)==="number"){for(var aM=ay.contactEquations.length-aX;aM<ay.contactEquations.length;aM++){aR.contactEquations.push(ay.contactEquations[aM])}}this.emit(aR)}if(typeof(aX)==="number"&&aW>1){for(var aM=ay.frictionEquations.length-aW;aM<ay.frictionEquations.length;aM++){var aQ=ay.frictionEquations[aM];aQ.setSlipForce(aQ.getSlipForce()/aW)}}}}};O.prototype.addSpring=function(ay){this.springs.push(ay);this.addSpringEvent.spring=ay;this.emit(this.addSpringEvent)};O.prototype.removeSpring=function(az){var ay=this.springs.indexOf(az);if(ay!==-1){ag.splice(this.springs,ay,1)}};O.prototype.addBody=function(ay){if(this.bodies.indexOf(ay)===-1){this.bodies.push(ay);ay.world=this;this.addBodyEvent.body=ay;this.emit(this.addBodyEvent)}};O.prototype.removeBody=function(az){if(this.stepping){this.bodiesToBeRemoved.push(az)}else{az.world=null;var ay=this.bodies.indexOf(az);if(ay!==-1){ag.splice(this.bodies,ay,1);this.removeBodyEvent.body=az;az.resetConstraintVelocity();this.emit(this.removeBodyEvent)}}};O.prototype.getBodyById=function(aB){var az=this.bodies;for(var aA=0;aA<az.length;aA++){var ay=az[aA];if(ay.id===aB){return ay}}return false};O.prototype.disableBodyCollision=function(az,ay){this.disabledBodyCollisionPairs.push(az,ay)};O.prototype.enableBodyCollision=function(aB,aA){var az=this.disabledBodyCollisionPairs;for(var ay=0;ay<az.length;ay+=2){if((az[ay]===aB&&az[ay+1]===aA)||(az[ay+1]===aB&&az[ay]===aA)){az.splice(ay,2);return}}};function ax(ay){if(!ay){return ay}return[ay[0],ay[1]]}function M(az,ay){for(var aA in ay){az[aA]=ay[aA]}}function F(ay){return{id:ay.id,materialA:ay.materialA.id,materialB:ay.materialB.id,friction:ay.friction,restitution:ay.restitution,stiffness:ay.stiffness,relaxation:ay.relaxation,frictionStiffness:ay.frictionStiffness,frictionRelaxation:ay.frictionRelaxation,}}O.prototype.clear=function(){this.time=0;this.fixedStepTime=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var aC=this.constraints;for(var aB=aC.length-1;aB>=0;aB--){this.removeConstraint(aC[aB])}var ay=this.bodies;for(var aB=ay.length-1;aB>=0;aB--){this.removeBody(ay[aB])}var aA=this.springs;for(var aB=aA.length-1;aB>=0;aB--){this.removeSpring(aA[aB])}var az=this.contactMaterials;for(var aB=az.length-1;aB>=0;aB--){this.removeContactMaterial(az[aB])}O.apply(this)};O.prototype.clone=function(){var ay=new O();ay.fromJSON(this.toJSON());return ay};var ai=ar.create(),am=ar.fromValues(0,0),ah=ar.fromValues(0,0);O.prototype.hitTest=function(aA,aD,aO){aO=aO||0;var ay=new R({position:aA}),aK=new at(),aI=aA,az=0,aE=ai,aG=am,aQ=ah;ay.addShape(aK);var aJ=this.narrowphase,aF=[];for(var aM=0,aC=aD.length;aM!==aC;aM++){var aR=aD[aM];for(var aL=0,aN=aR.shapes.length;aL!==aN;aL++){var aH=aR.shapes[aL],aB=aR.shapeOffsets[aL]||aG,aP=aR.shapeAngles[aL]||0;ar.rotate(aE,aB,aR.angle);ar.add(aE,aE,aR.position);var aS=aP+aR.angle;if((aH instanceof ao&&aJ.circleParticle(aR,aH,aE,aS,ay,aK,aI,az,true))||(aH instanceof W&&aJ.particleConvex(ay,aK,aI,az,aR,aH,aE,aS,true))||(aH instanceof K&&aJ.particlePlane(ay,aK,aI,az,aR,aH,aE,aS,true))||(aH instanceof av&&aJ.particleCapsule(ay,aK,aI,az,aR,aH,aE,aS,true))||(aH instanceof at&&ar.squaredLength(ar.sub(aQ,aE,aA))<aO*aO)){aF.push(aR)}}}return aF};O.prototype.setGlobalEquationParameters=function(aB){aB=aB||{};for(var aA=0;aA!==this.constraints.length;aA++){var aC=this.constraints[aA];for(var az=0;az!==aC.equations.length;az++){var ay=aC.equations[az];if(typeof(aB.stiffness)!=="undefined"){ay.stiffness=aB.stiffness}if(typeof(aB.relaxation)!=="undefined"){ay.relaxation=aB.relaxation}ay.needsUpdate=true}}for(var aA=0;aA!==this.contactMaterials.length;aA++){var aC=this.contactMaterials[aA];if(typeof(aB.stiffness)!=="undefined"){aC.stiffness=aB.stiffness;aC.frictionStiffness=aB.stiffness}if(typeof(aB.relaxation)!=="undefined"){aC.relaxation=aB.relaxation;aC.frictionRelaxation=aB.relaxation}}var aC=this.defaultContactMaterial;if(typeof(aB.stiffness)!=="undefined"){aC.stiffness=aB.stiffness;aC.frictionStiffness=aB.stiffness}if(typeof(aB.relaxation)!=="undefined"){aC.relaxation=aB.relaxation;aC.frictionRelaxation=aB.relaxation}};O.prototype.setGlobalStiffness=function(ay){this.setGlobalEquationParameters({stiffness:ay})};O.prototype.setGlobalRelaxation=function(ay){this.setGlobalEquationParameters({relaxation:ay})};var aa=new Z();O.prototype.raycastAll=function(aB,aA,ay,az){ay.mode=Z.ALL;ay.from=aB;ay.to=aA;ay.callback=az;return aa.intersectWorld(this,ay)};O.prototype.raycastAny=function(aB,aA,az,ay){az.mode=Z.ANY;az.from=aB;az.to=aA;az.result=ay;return aa.intersectWorld(this,az)};O.prototype.raycastClosest=function(aB,aA,az,ay){az.mode=Z.CLOSEST;az.from=aB;az.to=aA;az.result=ay;return aa.intersectWorld(this,az)}},{"../../package.json":6,"../collision/Broadphase":8,"../collision/NaiveBroadphase":10,"../collision/Narrowphase":11,"../collision/Ray":12,"../collision/SAPBroadphase":14,"../constraints/Constraint":15,"../constraints/DistanceConstraint":16,"../constraints/GearConstraint":17,"../constraints/LockConstraint":18,"../constraints/PrismaticConstraint":19,"../constraints/RevoluteConstraint":20,"../events/EventEmitter":27,"../material/ContactMaterial":28,"../material/Material":29,"../math/vec2":31,"../objects/Body":32,"../objects/LinearSpring":33,"../objects/RotationalSpring":34,"../shapes/Capsule":37,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Line":41,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Rectangle":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":48,"../utils/Utils":50,"./IslandManager":52}]},{},[36])(36)});p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;g.Physics.P2=function(p,q){this.game=p;if(typeof q==="undefined"){q={gravity:[0,0],broadphase:new p2.SAPBroadphase()}}else{if(!q.hasOwnProperty("gravity")){q.gravity=[0,0]}if(!q.hasOwnProperty("broadphase")){q.broadphase=new p2.SAPBroadphase()}}this.config=q;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new g.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new g.Signal();this.onBodyRemoved=new g.Signal();this.onSpringAdded=new g.Signal();this.onSpringRemoved=new g.Signal();this.onConstraintAdded=new g.Signal();this.onConstraintRemoved=new g.Signal();this.onContactMaterialAdded=new g.Signal();this.onContactMaterialRemoved=new g.Signal();this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new g.Signal();this.onEndContact=new g.Signal();if(q.hasOwnProperty("mpx")&&q.hasOwnProperty("pxm")&&q.hasOwnProperty("mpxi")&&q.hasOwnProperty("pxmi")){this.mpx=q.mpx;this.mpxi=q.mpxi;this.pxm=q.pxm;this.pxmi=q.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new g.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new g.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new g.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=true;this._boundsRight=true;this._boundsTop=true;this._boundsBottom=true;this._boundsOwnGroup=false;this.setBoundsToWorld(true,true,true,true,false)};g.Physics.P2.prototype={removeBodyNextStep:function(p){this._toRemove.push(p)},preUpdate:function(){var p=this._toRemove.length;while(p--){this.removeBody(this._toRemove[p])}this._toRemove.length=0},enable:function(q,p,s){if(typeof p==="undefined"){p=false}if(typeof s==="undefined"){s=true}var r=1;if(Array.isArray(q)){r=q.length;while(r--){if(q[r] instanceof g.Group){this.enable(q[r].children,p,s)}else{this.enableBody(q[r],p);if(s&&q[r].hasOwnProperty("children")&&q[r].children.length>0){this.enable(q[r],p,true)}}}}else{if(q instanceof g.Group){this.enable(q.children,p,s)}else{this.enableBody(q,p);if(s&&q.hasOwnProperty("children")&&q.children.length>0){this.enable(q.children,p,true)}}}},enableBody:function(q,p){if(q.hasOwnProperty("body")&&q.body===null){q.body=new g.Physics.P2.Body(this.game,q,q.x,q.y,1);q.body.debug=p;q.anchor.set(0.5)}},setImpactEvents:function(p){if(p){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(q,p){this.postBroadphaseCallback=q;this.callbackContext=p;if(q!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(q){if(!this.postBroadphaseCallback||q.pairs.length===0){return}for(var p=q.pairs.length-2;p>=0;p-=2){if(q.pairs[p].parent&&q.pairs[p+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,q.pairs[p].parent,q.pairs[p+1].parent)){q.pairs.splice(p,2)}}},impactHandler:function(r){if(r.bodyA.parent&&r.bodyB.parent){var q=r.bodyA.parent;var p=r.bodyB.parent;if(q._bodyCallbacks[r.bodyB.id]){q._bodyCallbacks[r.bodyB.id].call(q._bodyCallbackContext[r.bodyB.id],q,p,r.shapeA,r.shapeB)}if(p._bodyCallbacks[r.bodyA.id]){p._bodyCallbacks[r.bodyA.id].call(p._bodyCallbackContext[r.bodyA.id],p,q,r.shapeB,r.shapeA)}if(q._groupCallbacks[r.shapeB.collisionGroup]){q._groupCallbacks[r.shapeB.collisionGroup].call(q._groupCallbackContext[r.shapeB.collisionGroup],q,p,r.shapeA,r.shapeB)}if(p._groupCallbacks[r.shapeA.collisionGroup]){p._groupCallbacks[r.shapeA.collisionGroup].call(p._groupCallbackContext[r.shapeA.collisionGroup],p,q,r.shapeB,r.shapeA)}}},beginContactHandler:function(p){this.onBeginContact.dispatch(p.bodyA,p.bodyB,p.shapeA,p.shapeB,p.contactEquations);if(p.bodyA.parent){p.bodyA.parent.onBeginContact.dispatch(p.bodyB.parent,p.shapeA,p.shapeB,p.contactEquations)}if(p.bodyB.parent){p.bodyB.parent.onBeginContact.dispatch(p.bodyA.parent,p.shapeB,p.shapeA,p.contactEquations)}},endContactHandler:function(p){this.onEndContact.dispatch(p.bodyA,p.bodyB,p.shapeA,p.shapeB);if(p.bodyA.parent){p.bodyA.parent.onEndContact.dispatch(p.bodyB.parent,p.shapeA,p.shapeB)}if(p.bodyB.parent){p.bodyB.parent.onEndContact.dispatch(p.bodyA.parent,p.shapeB,p.shapeA)}},setBoundsToWorld:function(t,q,s,p,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,q,s,p,r)},setWorldMaterial:function(r,t,q,s,p){if(typeof t==="undefined"){t=true}if(typeof q==="undefined"){q=true}if(typeof s==="undefined"){s=true}if(typeof p==="undefined"){p=true}if(t&&this.walls.left){this.walls.left.shapes[0].material=r}if(q&&this.walls.right){this.walls.right.shapes[0].material=r}if(s&&this.walls.top){this.walls.top.shapes[0].material=r}if(p&&this.walls.bottom){this.walls.bottom.shapes[0].material=r}},updateBoundsCollisionGroup:function(q){var p=this.everythingCollisionGroup.mask;if(typeof q==="undefined"){p=this.boundsCollisionGroup.mask}if(this.walls.left){this.walls.left.shapes[0].collisionGroup=p}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=p}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=p}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=p}},setBounds:function(v,t,q,z,r,w,u,p,s){if(typeof r==="undefined"){r=this._boundsLeft}if(typeof w==="undefined"){w=this._boundsRight}if(typeof u==="undefined"){u=this._boundsTop}if(typeof p==="undefined"){p=this._boundsBottom}if(typeof s==="undefined"){s=this._boundsOwnGroup}if(this.walls.left){this.world.removeBody(this.walls.left)}if(this.walls.right){this.world.removeBody(this.walls.right)}if(this.walls.top){this.world.removeBody(this.walls.top)}if(this.walls.bottom){this.world.removeBody(this.walls.bottom)}if(r){this.walls.left=new p2.Body({mass:0,position:[this.pxmi(v),this.pxmi(t)],angle:1.5707963267948966});this.walls.left.addShape(new p2.Plane());if(s){this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.left)}if(w){this.walls.right=new p2.Body({mass:0,position:[this.pxmi(v+q),this.pxmi(t)],angle:-1.5707963267948966});this.walls.right.addShape(new p2.Plane());if(s){this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.right)}if(u){this.walls.top=new p2.Body({mass:0,position:[this.pxmi(v),this.pxmi(t)],angle:-3.141592653589793});this.walls.top.addShape(new p2.Plane());if(s){this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.top)}if(p){this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(v),this.pxmi(t+z)]});this.walls.bottom.addShape(new p2.Plane());if(s){this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.bottom)}this._boundsLeft=r;this._boundsRight=w;this._boundsTop=u;this._boundsBottom=p;this._boundsOwnGroup=s},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new g.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new g.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new g.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;if(this.world.solver&&this.world.solver.equations.length){this.world.solver.removeAllEquations()}var t=this.world.constraints;for(var s=t.length-1;s>=0;s--){this.world.removeConstraint(t[s])}var p=this.world.bodies;for(var s=p.length-1;s>=0;s--){this.world.removeBody(p[s])}var r=this.world.springs;for(var s=r.length-1;s>=0;s--){this.world.removeSpring(r[s])}var q=this.world.contactMaterials;for(var s=q.length-1;s>=0;s--){this.world.removeContactMaterial(q[s])}this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(p){if(p.data.world){return false}else{this.world.addBody(p.data);this.onBodyAdded.dispatch(p);return true}},removeBody:function(p){if(p.data.world==this.world){this.world.removeBody(p.data);this.onBodyRemoved.dispatch(p)}return p},addSpring:function(p){if(p instanceof g.Physics.P2.Spring||p instanceof g.Physics.P2.RotationalSpring){this.world.addSpring(p.data)}else{this.world.addSpring(p)}this.onSpringAdded.dispatch(p);return p},removeSpring:function(p){if(p instanceof g.Physics.P2.Spring||p instanceof g.Physics.P2.RotationalSpring){this.world.removeSpring(p.data)}else{this.world.removeSpring(p)}this.onSpringRemoved.dispatch(p);return p},createDistanceConstraint:function(t,s,u,q,p,r){t=this.getBody(t);s=this.getBody(s);if(!t||!s){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.DistanceConstraint(this,t,s,u,q,p,r))}},createGearConstraint:function(s,q,r,p){s=this.getBody(s);q=this.getBody(q);if(!s||!q){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.GearConstraint(this,s,q,r,p))}},createRevoluteConstraint:function(u,t,s,r,q,p){u=this.getBody(u);s=this.getBody(s);if(!u||!s){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.RevoluteConstraint(this,u,t,s,r,q,p))}},createLockConstraint:function(t,q,s,r,p){t=this.getBody(t);q=this.getBody(q);if(!t||!q){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.LockConstraint(this,t,q,s,r,p))}},createPrismaticConstraint:function(v,u,r,q,p,s,t){v=this.getBody(v);u=this.getBody(u);if(!v||!u){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.PrismaticConstraint(this,v,u,r,q,p,s,t))}},addConstraint:function(p){this.world.addConstraint(p);this.onConstraintAdded.dispatch(p);return p},removeConstraint:function(p){this.world.removeConstraint(p);this.onConstraintRemoved.dispatch(p);return p},addContactMaterial:function(p){this.world.addContactMaterial(p);this.onContactMaterialAdded.dispatch(p);return p},removeContactMaterial:function(p){this.world.removeContactMaterial(p);this.onContactMaterialRemoved.dispatch(p);return p},getContactMaterial:function(q,p){return this.world.getContactMaterial(q,p)},setMaterial:function(r,p){var q=p.length;while(q--){p[q].setMaterial(r)}},createMaterial:function(q,p){q=q||"";var r=new g.Physics.P2.Material(q);this.materials.push(r);if(typeof p!=="undefined"){p.setMaterial(r)}return r},createContactMaterial:function(s,r,q){if(typeof s==="undefined"){s=this.createMaterial()}if(typeof r==="undefined"){r=this.createMaterial()}var p=new g.Physics.P2.ContactMaterial(s,r,q);return this.addContactMaterial(p)},getBodies:function(){var p=[];var q=this.world.bodies.length;while(q--){p.push(this.world.bodies[q].parent)}return p},getBody:function(p){if(p instanceof p2.Body){return p}else{if(p instanceof g.Physics.P2.Body){return p.data}else{if(p.body&&p.body.type===g.Physics.P2JS){return p.body.data}}}return null},getSprings:function(){var p=[];var q=this.world.springs.length;while(q--){p.push(this.world.springs[q].parent)}return p},getConstraints:function(){var p=[];var q=this.world.constraints.length;while(q--){p.push(this.world.constraints[q].parent)}return p},hitTest:function(t,r,q,v){if(typeof r==="undefined"){r=this.world.bodies}if(typeof q==="undefined"){q=5}if(typeof v==="undefined"){v=false}var p=[this.pxmi(t.x),this.pxmi(t.y)];var u=[];var s=r.length;while(s--){if(r[s] instanceof g.Physics.P2.Body&&!(v&&r[s].data.type===p2.Body.STATIC)){u.push(r[s].data)}else{if(r[s] instanceof p2.Body&&r[s].parent&&!(v&&r[s].type===p2.Body.STATIC)){u.push(r[s])}else{if(r[s] instanceof g.Sprite&&r[s].hasOwnProperty("body")&&!(v&&r[s].body.data.type===p2.Body.STATIC)){u.push(r[s].body.data)}}}}return this.world.hitTest(p,u,q)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(q){var p=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|p}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|p}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|p}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|p}this._collisionGroupID++;var r=new g.Physics.P2.CollisionGroup(p);this.collisionGroups.push(r);if(q){this.setCollisionGroup(q,r)}return r},setCollisionGroup:function(p,r){if(p instanceof g.Group){for(var q=0;q<p.total;q++){if(p.children[q]["body"]&&p.children[q]["body"].type===g.Physics.P2JS){p.children[q].body.setCollisionGroup(r)}}}else{p.body.setCollisionGroup(r)}},createSpring:function(s,r,p,v,t,x,w,u,q){s=this.getBody(s);r=this.getBody(r);if(!s||!r){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new g.Physics.P2.Spring(this,s,r,p,v,t,x,w,u,q))}},createRotationalSpring:function(t,s,q,p,r){t=this.getBody(t);s=this.getBody(s);if(!t||!s){console.warn("Cannot create Rotational Spring, invalid body objects given")}else{return this.addSpring(new g.Physics.P2.RotationalSpring(this,t,s,q,p,r))}},createBody:function(r,w,t,u,s,v){if(typeof u==="undefined"){u=false}var q=new g.Physics.P2.Body(this.game,null,r,w,t);if(v){var p=q.addPolygon(s,v);if(!p){return false}}if(u){this.world.addBody(q.data)}return q},createParticle:function(r,w,t,u,s,v){if(typeof u==="undefined"){u=false}var q=new g.Physics.P2.Body(this.game,null,r,w,t);if(v){var p=q.addPolygon(s,v);if(!p){return false}}if(u){this.world.addBody(q.data)}return q},convertCollisionObjects:function(w,u,v){if(typeof v==="undefined"){v=true}var r=[];for(var t=0,q=w.collision[u].length;t<q;t++){var s=w.collision[u][t];var p=this.createBody(s.x,s.y,0,v,{},s.polyline);if(p){r.push(p)}}return r},clearTilemapLayerBodies:function(r,q){q=r.getLayer(q);var p=r.layers[q].bodies.length;while(p--){r.layers[q].bodies[p].destroy()}r.layers[q].bodies.length=0},convertTilemap:function(p,u,r,A){u=p.getLayer(u);if(typeof r==="undefined"){r=true}if(typeof A==="undefined"){A=true}this.clearTilemapLayerBodies(p,u);var q=0;var D=0;var B=0;for(var z=0,s=p.layers[u].height;z<s;z++){q=0;for(var C=0,E=p.layers[u].width;C<E;C++){var v=p.layers[u].data[z][C];if(v&&v.index>-1&&v.collides){if(A){var F=p.getTileRight(u,C,z);if(q===0){D=v.x*v.width;B=v.y*v.height;q=v.width}if(F&&F.collides){q+=v.width}else{var t=this.createBody(D,B,0,false);t.addRectangle(q,v.height,q/2,v.height/2,0);if(r){this.addBody(t)}p.layers[u].bodies.push(t);q=0}}else{var t=this.createBody(v.x*v.width,v.y*v.height,0,false);t.addRectangle(v.width,v.height,v.width/2,v.height/2,0);if(r){this.addBody(t)}p.layers[u].bodies.push(t)}}}}return p.layers[u].bodies},mpx:function(p){return p*=20},pxm:function(p){return p*0.05},mpxi:function(p){return p*=-20},pxmi:function(p){return p*-0.05}};Object.defineProperty(g.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(p){this.world.defaultContactMaterial.friction=p}});Object.defineProperty(g.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(p){this.world.defaultContactMaterial.restitution=p}});Object.defineProperty(g.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(p){this.world.defaultContactMaterial=p}});Object.defineProperty(g.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(p){this.world.applySpringForces=p}});Object.defineProperty(g.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(p){this.world.applyDamping=p}});Object.defineProperty(g.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(p){this.world.applyGravity=p}});Object.defineProperty(g.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(p){this.world.solveConstraints=p}});Object.defineProperty(g.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(g.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(p){this.world.emitImpactEvent=p}});Object.defineProperty(g.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(p){this.world.sleepMode=p}});Object.defineProperty(g.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});g.Physics.P2.FixtureList=function(p){if(!Array.isArray(p)){p=[p]}this.rawList=p;this.init();this.parse(this.rawList)};g.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(q,p){var r=function(s){s.collisionGroup=q};this.getFixtures(p).forEach(r)},setMask:function(q,p){var r=function(s){s.collisionMask=q};this.getFixtures(p).forEach(r)},setSensor:function(q,p){var r=function(s){s.sensor=q};this.getFixtures(p).forEach(r)},setMaterial:function(q,p){var r=function(s){s.material=q};this.getFixtures(p).forEach(r)},getFixtures:function(r){var q=[];if(r){if(!(r instanceof Array)){r=[r]}var p=this;r.forEach(function(s){if(p.namedFixtures[s]){q.push(p.namedFixtures[s])}});return this.flatten(q)}else{return this.allFixtures}},getFixtureByKey:function(p){return this.namedFixtures[p]},getGroup:function(p){return this.groupedFixtures[p]},parse:function(){var q,s,r,p;r=this.rawList;p=[];for(q in r){s=r[q];if(!isNaN(q-0)){this.groupedFixtures[q]=this.groupedFixtures[q]||[];this.groupedFixtures[q]=this.groupedFixtures[q].concat(s)}else{this.namedFixtures[q]=this.flatten(s)}p.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(r){var p,q;p=[];q=arguments.callee;r.forEach(function(s){return Array.prototype.push.apply(p,(Array.isArray(s)?q(s):[s]))});return p}};g.Physics.P2.PointProxy=function(q,p){this.world=q;this.destination=p};g.Physics.P2.PointProxy.prototype.constructor=g.Physics.P2.PointProxy;Object.defineProperty(g.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(p){this.destination[0]=this.world.pxm(p)}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(p){this.destination[1]=this.world.pxm(p)}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(p){this.destination[0]=p}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(p){this.destination[1]=p}});g.Physics.P2.InversePointProxy=function(q,p){this.world=q;this.destination=p};g.Physics.P2.InversePointProxy.prototype.constructor=g.Physics.P2.InversePointProxy;Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(p){this.destination[0]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(p){this.destination[1]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(p){this.destination[0]=-p}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(p){this.destination[1]=-p}});g.Physics.P2.Body=function(q,s,p,t,r){s=s||null;p=p||0;t=t||0;if(typeof r==="undefined"){r=1}this.game=q;this.world=q.physics.p2;this.sprite=s;this.type=g.Physics.P2JS;this.offset=new g.Point();this.data=new p2.Body({position:[this.world.pxmi(p),this.world.pxmi(t)],mass:r});this.data.parent=this;this.velocity=new g.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new g.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new g.Point();this.onBeginContact=new g.Signal();this.onEndContact=new g.Signal();this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this.dirty=false;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=false;if(s){this.setRectangleFromSprite(s);if(s.exists){this.game.physics.p2.addBody(this)}}};g.Physics.P2.Body.prototype={createBodyCallback:function(q,s,p){var r=-1;if(q.id){r=q.id}else{if(q.body){r=q.body.id}}if(r>-1){if(s===null){delete (this._bodyCallbacks[r]);delete (this._bodyCallbackContext[r])}else{this._bodyCallbacks[r]=s;this._bodyCallbackContext[r]=p}}},createGroupCallback:function(q,r,p){if(r===null){delete (this._groupCallbacks[q.mask]);delete (this._groupCallbacksContext[q.mask])}else{this._groupCallbacks[q.mask]=r;this._groupCallbackContext[q.mask]=p}},getCollisionMask:function(){var p=0;if(this._collideWorldBounds){p=this.game.physics.p2.boundsCollisionGroup.mask}for(var q=0;q<this.collidesWith.length;q++){p=p|this.collidesWith[q].mask}return p},updateCollisionMask:function(q){var p=this.getCollisionMask();if(typeof q==="undefined"){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionMask=p}}else{q.collisionMask=p}},setCollisionGroup:function(s,q){var p=this.getCollisionMask();if(typeof q==="undefined"){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionGroup=s.mask;this.data.shapes[r].collisionMask=p}}else{q.collisionGroup=s.mask;q.collisionMask=p}},clearCollision:function(q,s,p){if(typeof q==="undefined"){q=true}if(typeof s==="undefined"){s=true}if(typeof p==="undefined"){for(var r=this.data.shapes.length-1;r>=0;r--){if(q){this.data.shapes[r].collisionGroup=null}if(s){this.data.shapes[r].collisionMask=null}}}else{if(q){p.collisionGroup=null}if(s){p.collisionMask=null}}if(q){this.collidesWith.length=0}},collides:function(t,u,r,q){if(Array.isArray(t)){for(var s=0;s<t.length;s++){if(this.collidesWith.indexOf(t[s])===-1){this.collidesWith.push(t[s]);if(u){this.createGroupCallback(t[s],u,r)}}}}else{if(this.collidesWith.indexOf(t)===-1){this.collidesWith.push(t);if(u){this.createGroupCallback(t,u,r)}}}var p=this.getCollisionMask();if(typeof q==="undefined"){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionMask=p}}else{q.collisionMask=p}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},applyDamping:function(p){this.data.applyDamping(p)},applyForce:function(r,q,p){this.data.applyForce(r,[this.world.pxmi(q),this.world.pxmi(p)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(p,q){return this.data.toLocalFrame(p,q)},toWorldFrame:function(p,q){return this.data.toWorldFrame(p,q)},rotateLeft:function(p){this.data.angularVelocity=this.world.pxm(-p)},rotateRight:function(p){this.data.angularVelocity=this.world.pxm(p)},moveForward:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.velocity[0]=p*Math.cos(r);this.data.velocity[1]=p*Math.sin(r)},moveBackward:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.velocity[0]=-(p*Math.cos(r));this.data.velocity[1]=-(p*Math.sin(r))},thrust:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.force[0]+=p*Math.cos(r);this.data.force[1]+=p*Math.sin(r)},reverse:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.force[0]-=p*Math.cos(r);this.data.force[1]-=p*Math.sin(r)},moveLeft:function(p){this.data.velocity[0]=this.world.pxmi(-p)},moveRight:function(p){this.data.velocity[0]=this.world.pxmi(p)},moveUp:function(p){this.data.velocity[1]=this.world.pxmi(-p)},moveDown:function(p){this.data.velocity[1]=this.world.pxmi(p)},preUpdate:function(){this.dirty=true;if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);if(!this.fixedRotation){this.sprite.rotation=this.data.angle}if(this.debugBody){this.debugBody.updateSpriteTransform()}this.dirty=false},reset:function(p,s,r,q){if(typeof r==="undefined"){r=false}if(typeof q==="undefined"){q=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(r){this.setZeroDamping()}if(q){this.mass=1}this.x=p;this.y=s},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var p=0;p<this.game.physics.p2._toRemove.length;p++){if(this.game.physics.p2._toRemove[p]===this){this.game.physics.p2._toRemove.splice(p,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy(true,true)}this.debugBody=null;this.sprite.body=null;this.sprite=null},clearShapes:function(){var p=this.data.shapes.length;while(p--){this.data.removeShape(this.data.shapes[p])}this.shapeChanged()},addShape:function(q,p,s,r){if(typeof p==="undefined"){p=0}if(typeof s==="undefined"){s=0}if(typeof r==="undefined"){r=0}this.data.addShape(q,[this.world.pxmi(p),this.world.pxmi(s)],r);this.shapeChanged();return q},addCircle:function(q,p,t,s){var r=new p2.Circle(this.world.pxm(q));return this.addShape(r,p,t,s)},addRectangle:function(t,q,p,u,s){var r=new p2.Rectangle(this.world.pxm(t),this.world.pxm(q));return this.addShape(r,p,u,s)},addPlane:function(p,s,r){var q=new p2.Plane();return this.addShape(q,p,s,r)},addParticle:function(p,s,r){var q=new p2.Particle();return this.addShape(q,p,s,r)},addLine:function(s,p,t,r){var q=new p2.Line(this.world.pxm(s));return this.addShape(q,p,t,r)},addCapsule:function(t,q,p,u,s){var r=new p2.Capsule(this.world.pxm(t),this.world.pxm(q));return this.addShape(r,p,u,s)},addPolygon:function(t,v){t=t||{};if(!Array.isArray(v)){v=Array.prototype.slice.call(arguments,1)}var x=[];if(v.length===1&&Array.isArray(v[0])){x=v[0].slice(0)}else{if(Array.isArray(v[0])){x=v.slice()}else{if(typeof v[0]==="number"){for(var u=0,s=v.length;u<s;u+=2){x.push([v[u],v[u+1]])}}}}var r=x.length-1;if(x[r][0]===x[0][0]&&x[r][1]===x[0][1]){x.pop()}for(var w=0;w<x.length;w++){x[w][0]=this.world.pxmi(x[w][0]);x[w][1]=this.world.pxmi(x[w][1])}var q=this.data.fromPolygon(x,t);this.shapeChanged();return q},removeShape:function(q){var p=this.data.removeShape(q);this.shapeChanged();return p},setCircle:function(q,p,s,r){this.clearShapes();return this.addCircle(q,p,s,r)},setRectangle:function(s,q,p,t,r){if(typeof s==="undefined"){s=16}if(typeof q==="undefined"){q=16}this.clearShapes();return this.addRectangle(s,q,p,t,r)},setRectangleFromSprite:function(p){if(typeof p==="undefined"){p=this.sprite}this.clearShapes();return this.addRectangle(p.width,p.height,0,0,p.rotation)},setMaterial:function(r,p){if(typeof p==="undefined"){for(var q=this.data.shapes.length-1;q>=0;q--){this.data.shapes[q].material=r}}else{p.material=r}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(s,q){var u=this.game.cache.getPhysicsData(s,q);var v=[];for(var r=0;r<u.length;r++){var t=u[r];var p=this.addFixture(t);v[t.filter.group]=v[t.filter.group]||[];v[t.filter.group]=v[t.filter.group].concat(p);if(t.fixtureKey){v[t.fixtureKey]=p}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return v},addFixture:function(p){var u=[];if(p.circle){var y=new p2.Circle(this.world.pxm(p.circle.radius));y.collisionGroup=p.filter.categoryBits;y.collisionMask=p.filter.maskBits;y.sensor=p.isSensor;var t=p2.vec2.create();t[0]=this.world.pxmi(p.circle.position[0]-this.sprite.width/2);t[1]=this.world.pxmi(p.circle.position[1]-this.sprite.height/2);this.data.addShape(y,t);u.push(y)}else{var z=p.polygons;var A=p2.vec2.create();for(var w=0;w<z.length;w++){var q=z[w];var x=[];for(var C=0;C<q.length;C+=2){x.push([this.world.pxmi(q[C]),this.world.pxmi(q[C+1])])}var y=new p2.Convex(x);for(var r=0;r!==y.vertices.length;r++){var B=y.vertices[r];p2.vec2.sub(B,B,y.centerOfMass)}p2.vec2.scale(A,y.centerOfMass,1);A[0]-=this.world.pxmi(this.sprite.width/2);A[1]-=this.world.pxmi(this.sprite.height/2);y.updateTriangles();y.updateCenterOfMass();y.updateBoundingRadius();y.collisionGroup=p.filter.categoryBits;y.collisionMask=p.filter.maskBits;y.sensor=p.isSensor;this.data.addShape(y,A);u.push(y)}}return u},loadPolygon:function(z,p){var r=this.game.cache.getPhysicsData(z,p);var x=p2.vec2.create();for(var t=0;t<r.length;t++){var u=[];for(var A=0;A<r[t].shape.length;A+=2){u.push([this.world.pxmi(r[t].shape[A]),this.world.pxmi(r[t].shape[A+1])])}var w=new p2.Convex(u);for(var q=0;q!==w.vertices.length;q++){var y=w.vertices[q];p2.vec2.sub(y,y,w.centerOfMass)}p2.vec2.scale(x,w.centerOfMass,1);x[0]-=this.world.pxmi(this.sprite.width/2);x[1]-=this.world.pxmi(this.sprite.height/2);w.updateTriangles();w.updateCenterOfMass();w.updateBoundingRadius();this.data.addShape(w,x)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true}};g.Physics.P2.Body.prototype.constructor=g.Physics.P2.Body;g.Physics.P2.Body.DYNAMIC=1;g.Physics.P2.Body.STATIC=2;g.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(g.Physics.P2.Body.prototype,"static",{get:function(){return(this.data.type===g.Physics.P2.Body.STATIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.STATIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}else{if(!p&&this.data.type===g.Physics.P2.Body.STATIC){this.data.type=g.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"dynamic",{get:function(){return(this.data.type===g.Physics.P2.Body.DYNAMIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.DYNAMIC){this.data.type=g.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}else{if(!p&&this.data.type===g.Physics.P2.Body.DYNAMIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"kinematic",{get:function(){return(this.data.type===g.Physics.P2.Body.KINEMATIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.KINEMATIC){this.data.type=g.Physics.P2.Body.KINEMATIC;this.mass=4}else{if(!p&&this.data.type===g.Physics.P2.Body.KINEMATIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(p){if(p!==this.data.allowSleep){this.data.allowSleep=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"angle",{get:function(){return g.Math.wrapAngle(g.Math.radToDeg(this.data.angle))},set:function(p){this.data.angle=g.Math.degToRad(g.Math.wrapAngle(p))}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(p){this.data.angularDamping=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(p){this.data.angularForce=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(p){this.data.angularVelocity=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(p){this.data.damping=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(p){if(p!==this.data.fixedRotation){this.data.fixedRotation=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(p){this.data.inertia=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(p){if(p!==this.data.mass){this.data.mass=p;this.data.updateMassProperties()}}});Object.defineProperty(g.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(p){if(p!==this.data.type){this.data.type=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(p){this.data.angle=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(p){this.data.sleepSpeedLimit=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(p){this.data.position[0]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(p){this.data.position[1]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(g.Physics.P2.Body.prototype,"debug",{get:function(){return(this.debugBody!==null)},set:function(p){if(p&&!this.debugBody){this.debugBody=new g.Physics.P2.BodyDebug(this.game,this.data)}else{if(!p&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(p){if(p&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else{if(!p&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}}});g.Physics.P2.BodyDebug=function(q,p,s){g.Group.call(this,q);var r={pixelsPerLengthUnit:20,debugPolygons:false,lineWidth:1,alpha:0.5};this.settings=g.Utils.extend(r,s);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=p;this.canvas=new g.Graphics(q);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};g.Physics.P2.BodyDebug.prototype=Object.create(g.Group.prototype);g.Physics.P2.BodyDebug.prototype.constructor=g.Physics.P2.BodyDebug;g.Utils.extend(g.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var s,p,x,B,z,C,q,A,y,F,E,D,w,u,t;A=this.body;F=this.canvas;F.clear();x=parseInt(this.randomPastelHex(),16);C=16711680;q=this.lineWidth;if(A instanceof p2.Body&&A.shapes.length){var r=A.shapes.length;B=0;while(B!==r){p=A.shapes[B];y=A.shapeOffsets[B];s=A.shapeAngles[B];y=y||0;s=s||0;if(p instanceof p2.Circle){this.drawCircle(F,y[0]*this.ppu,y[1]*this.ppu,s,p.radius*this.ppu,x,q)}else{if(p instanceof p2.Capsule){this.drawCapsule(F,y[0]*this.ppu,y[1]*this.ppu,s,p.length*this.ppu,p.radius*this.ppu,C,x,q)}else{if(p instanceof p2.Plane){this.drawPlane(F,y[0]*this.ppu,-y[1]*this.ppu,x,C,q*5,q*10,q*10,this.ppu*100,s)}else{if(p instanceof p2.Line){this.drawLine(F,p.length*this.ppu,C,q)}else{if(p instanceof p2.Rectangle){this.drawRectangle(F,y[0]*this.ppu,y[1]*this.ppu,s,p.width*this.ppu,p.height*this.ppu,C,x,q)}else{if(p instanceof p2.Convex){D=[];w=p2.vec2.create();for(z=u=0,t=p.vertices.length;0<=t?u<t:u>t;z=0<=t?++u:--u){E=p.vertices[z];p2.vec2.rotate(w,E,s);D.push([(w[0]+y[0])*this.ppu,-(w[1]+y[1])*this.ppu])}this.drawConvex(F,D,p.triangles,C,x,q,this.settings.debugPolygons,[y[0]*this.ppu,-y[1]*this.ppu])}}}}}}B++}}},drawRectangle:function(u,z,v,q,A,s,r,p,t){if(typeof t==="undefined"){t=1}if(typeof r==="undefined"){r=0}u.lineStyle(t,r,1);u.beginFill(p);u.drawRect(z-A/2,v-s/2,A,s)},drawCircle:function(t,r,v,u,q,s,p){if(typeof p==="undefined"){p=1}if(typeof s==="undefined"){s=16777215}t.lineStyle(p,0,1);t.beginFill(s,1);t.drawCircle(r,v,-q*2);t.endFill();t.moveTo(r,v);t.lineTo(r+q*Math.cos(-u),v+q*Math.sin(-u))},drawLine:function(s,q,r,p){if(typeof p==="undefined"){p=1}if(typeof r==="undefined"){r=0}s.lineStyle(p*5,r,1);s.moveTo(-q/2,0);s.lineTo(q/2,0)},drawConvex:function(H,K,E,F,u,p,D,w){var A,G,C,s,q,B,J,I,z,t,r;if(typeof p==="undefined"){p=1}if(typeof F==="undefined"){F=0}if(!D){H.lineStyle(p,F,1);H.beginFill(u);G=0;while(G!==K.length){C=K[G];B=C[0];z=C[1];if(G===0){H.moveTo(B,-z)}else{H.lineTo(B,-z)}G++}H.endFill();if(K.length>2){H.moveTo(K[K.length-1][0],-K[K.length-1][1]);return H.lineTo(K[0][0],-K[0][1])}}else{A=[16711680,65280,255];G=0;while(G!==K.length+1){s=K[G%K.length];q=K[(G+1)%K.length];J=s[0];t=s[1];I=q[0];r=q[1];H.lineStyle(p,A[G%A.length],1);H.moveTo(J,-t);H.lineTo(I,-r);H.drawCircle(J,-t,p*2);G++}H.lineStyle(p,0,1);return H.drawCircle(w[0],w[1],p*2)}},drawPath:function(I,B,E,s,p){var J,G,D,C,r,q,w,t,H,F,A,z,u;if(typeof p==="undefined"){p=1}if(typeof E==="undefined"){E=0}I.lineStyle(p,E,1);if(typeof s==="number"){I.beginFill(s)}D=null;C=null;G=0;while(G<B.length){A=B[G];z=A[0];u=A[1];if(z!==D||u!==C){if(G===0){I.moveTo(z,u)}else{r=D;q=C;w=z;t=u;H=B[(G+1)%B.length][0];F=B[(G+1)%B.length][1];J=((w-r)*(F-q))-((H-r)*(t-q));if(J!==0){I.lineTo(z,u)}}D=z;C=u}G++}if(typeof s==="number"){I.endFill()}if(B.length>2&&typeof s==="number"){I.moveTo(B[B.length-1][0],B[B.length-1][1]);I.lineTo(B[0][0],B[0][1])}},drawPlane:function(w,s,r,u,A,x,v,p,q,t){var z,B,y;if(typeof x==="undefined"){x=1}if(typeof u==="undefined"){u=16777215}w.lineStyle(x,A,11);w.beginFill(u);z=q;w.moveTo(s,-r);B=s+Math.cos(t)*this.game.width;y=r+Math.sin(t)*this.game.height;w.lineTo(B,-y);w.moveTo(s,-r);B=s+Math.cos(t)*-this.game.width;y=r+Math.sin(t)*-this.game.height;w.lineTo(B,-y)},drawCapsule:function(u,B,A,q,v,w,r,p,t){if(typeof t==="undefined"){t=1}if(typeof r==="undefined"){r=0}u.lineStyle(t,r,1);var z=Math.cos(q);var C=Math.sin(q);u.beginFill(p,1);u.drawCircle(-v/2*z+B,-v/2*C+A,-w*2);u.drawCircle(v/2*z+B,v/2*C+A,-w*2);u.endFill();u.lineStyle(t,r,0);u.beginFill(p,1);u.moveTo(-v/2*z+w*C+B,-v/2*C+w*z+A);u.lineTo(v/2*z+w*C+B,v/2*C+w*z+A);u.lineTo(v/2*z-w*C+B,v/2*C-w*z+A);u.lineTo(-v/2*z-w*C+B,-v/2*C-w*z+A);u.endFill();u.lineStyle(t,r,1);u.moveTo(-v/2*z+w*C+B,-v/2*C+w*z+A);u.lineTo(v/2*z+w*C+B,v/2*C+w*z+A);u.moveTo(-v/2*z-w*C+B,-v/2*C-w*z+A);u.lineTo(v/2*z-w*C+B,v/2*C-w*z+A)},randomPastelHex:function(){var p,r,q,s;q=[255,255,255];s=Math.floor(Math.random()*256);r=Math.floor(Math.random()*256);p=Math.floor(Math.random()*256);s=Math.floor((s+3*q[0])/4);r=Math.floor((r+3*q[1])/4);p=Math.floor((p+3*q[2])/4);return this.rgbToHex(s,r,p)},rgbToHex:function(s,q,p){return this.componentToHex(s)+this.componentToHex(q)+this.componentToHex(p)},componentToHex:function(q){var p;p=q.toString(16);if(p.len===2){return p}else{return p+"0"}}});g.Physics.P2.Spring=function(v,t,r,p,w,u,y,x,s,q){this.game=v.game;this.world=v;if(typeof p==="undefined"){p=1}if(typeof w==="undefined"){w=100}if(typeof u==="undefined"){u=1}p=v.pxm(p);var z={restLength:p,stiffness:w,damping:u};if(typeof y!=="undefined"&&y!==null){z.worldAnchorA=[v.pxm(y[0]),v.pxm(y[1])]}if(typeof x!=="undefined"&&x!==null){z.worldAnchorB=[v.pxm(x[0]),v.pxm(x[1])]}if(typeof s!=="undefined"&&s!==null){z.localAnchorA=[v.pxm(s[0]),v.pxm(s[1])]}if(typeof q!=="undefined"&&q!==null){z.localAnchorB=[v.pxm(q[0]),v.pxm(q[1])]}this.data=new p2.LinearSpring(t,r,z);this.data.parent=this};g.Physics.P2.Spring.prototype.constructor=g.Physics.P2.Spring;g.Physics.P2.RotationalSpring=function(t,v,u,q,p,s){this.game=t.game;this.world=t;if(typeof q==="undefined"){q=null}if(typeof p==="undefined"){p=100}if(typeof s==="undefined"){s=1}if(q){q=t.pxm(q)}var r={restAngle:q,stiffness:p,damping:s};this.data=new p2.RotationalSpring(v,u,r);this.data.parent=this};g.Physics.P2.Spring.prototype.constructor=g.Physics.P2.Spring;g.Physics.P2.Material=function(p){this.name=p;p2.Material.call(this)};g.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);g.Physics.P2.Material.prototype.constructor=g.Physics.P2.Material;g.Physics.P2.ContactMaterial=function(r,q,p){p2.ContactMaterial.call(this,r,q,p)};g.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);g.Physics.P2.ContactMaterial.prototype.constructor=g.Physics.P2.ContactMaterial;g.Physics.P2.CollisionGroup=function(p){this.mask=p};g.Physics.P2.DistanceConstraint=function(s,v,u,w,r,q,t){if(typeof w==="undefined"){w=100}if(typeof r==="undefined"){r=[0,0]}if(typeof q==="undefined"){q=[0,0]}if(typeof t==="undefined"){t=Number.MAX_VALUE}this.game=s.game;this.world=s;w=s.pxm(w);r=[s.pxmi(r[0]),s.pxmi(r[1])];q=[s.pxmi(q[0]),s.pxmi(q[1])];var p={distance:w,localAnchorA:r,localAnchorB:q,maxForce:t};p2.DistanceConstraint.call(this,v,u,p)};g.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);g.Physics.P2.DistanceConstraint.prototype.constructor=g.Physics.P2.DistanceConstraint;g.Physics.P2.GearConstraint=function(r,u,s,t,q){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=1}this.game=r.game;this.world=r;var p={angle:t,ratio:q};p2.GearConstraint.call(this,u,s,p)};g.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);g.Physics.P2.GearConstraint.prototype.constructor=g.Physics.P2.GearConstraint;g.Physics.P2.LockConstraint=function(q,v,s,u,t,r){if(typeof u==="undefined"){u=[0,0]}if(typeof t==="undefined"){t=0}if(typeof r==="undefined"){r=Number.MAX_VALUE}this.game=q.game;this.world=q;u=[q.pxm(u[0]),q.pxm(u[1])];var p={localOffsetB:u,localAngleB:t,maxForce:r};p2.LockConstraint.call(this,v,s,p)};g.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);g.Physics.P2.LockConstraint.prototype.constructor=g.Physics.P2.LockConstraint;g.Physics.P2.PrismaticConstraint=function(v,t,s,u,r,p,q,w){if(typeof u==="undefined"){u=true}if(typeof r==="undefined"){r=[0,0]}if(typeof p==="undefined"){p=[0,0]}if(typeof q==="undefined"){q=[0,0]}if(typeof w==="undefined"){w=Number.MAX_VALUE}this.game=v.game;this.world=v;r=[v.pxmi(r[0]),v.pxmi(r[1])];p=[v.pxmi(p[0]),v.pxmi(p[1])];var x={localAnchorA:r,localAnchorB:p,localAxisA:q,maxForce:w,disableRotationalLock:!u};p2.PrismaticConstraint.call(this,t,s,x)};g.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);g.Physics.P2.PrismaticConstraint.prototype.constructor=g.Physics.P2.PrismaticConstraint;g.Physics.P2.RevoluteConstraint=function(r,w,v,u,t,s,q){if(typeof s==="undefined"){s=Number.MAX_VALUE}if(typeof q==="undefined"){q=null}this.game=r.game;this.world=r;v=[r.pxmi(v[0]),r.pxmi(v[1])];t=[r.pxmi(t[0]),r.pxmi(t[1])];if(q){q=[r.pxmi(q[0]),r.pxmi(q[1])]}var p={worldPivot:q,localPivotA:v,localPivotB:t,maxForce:s};p2.RevoluteConstraint.call(this,w,u,p)};g.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);g.Physics.P2.RevoluteConstraint.prototype.constructor=g.Physics.P2.RevoluteConstraint;g.Tile=function(s,r,q,u,t,p){this.layer=s;this.index=r;this.x=q;this.y=u;this.rotation=0;this.flipped=false;this.worldX=q*t;this.worldY=u*p;this.width=t;this.height=p;this.centerX=Math.abs(t/2);this.centerY=Math.abs(p/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};g.Tile.prototype={containsPoint:function(p,q){return !(p<this.worldX||q<this.worldY||p>this.right||q>this.bottom)},intersects:function(p,s,r,q){if(r<=this.worldX){return false}if(q<=this.worldY){return false}if(p>=this.worldX+this.width){return false}if(s>=this.worldY+this.height){return false}return true},setCollisionCallback:function(q,p){this.collisionCallback=q;this.collisionCallbackContext=p},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(r,q,p,s){this.collideLeft=r;this.collideRight=q;this.collideUp=p;this.collideDown=s;this.faceLeft=r;this.faceRight=q;this.faceTop=p;this.faceBottom=s},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(q,p){if(q&&p){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else{if(q){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else{if(p){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}}}return false},copy:function(p){this.index=p.index;this.alpha=p.alpha;this.properties=p.properties;this.collideUp=p.collideUp;this.collideDown=p.collideDown;this.collideLeft=p.collideLeft;this.collideRight=p.collideRight;this.collisionCallback=p.collisionCallback;this.collisionCallbackContext=p.collisionCallbackContext}};g.Tile.prototype.constructor=g.Tile;Object.defineProperty(g.Tile.prototype,"collides",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(g.Tile.prototype,"canCollide",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(g.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(g.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(g.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(g.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});g.Tilemap=function(r,s,v,q,t,p){this.game=r;this.key=s;var u=g.TilemapParser.parse(this.game,s,v,q,t,p);if(u===null){return}this.width=u.width;this.height=u.height;this.tileWidth=u.tileWidth;this.tileHeight=u.tileHeight;this.orientation=u.orientation;this.format=u.format;this.version=u.version;this.properties=u.properties;this.widthInPixels=u.widthInPixels;this.heightInPixels=u.heightInPixels;this.layers=u.layers;this.tilesets=u.tilesets;this.tiles=u.tiles;this.objects=u.objects;this.collideIndexes=[];this.collision=u.collision;this.images=u.images;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};g.Tilemap.CSV=0;g.Tilemap.TILED_JSON=1;g.Tilemap.NORTH=0;g.Tilemap.EAST=1;g.Tilemap.SOUTH=2;g.Tilemap.WEST=3;g.Tilemap.prototype={create:function(r,s,p,u,q,t){if(typeof t==="undefined"){t=this.game.world}this.width=s;this.height=p;this.setTileSize(u,q);this.layers.length=0;return this.createBlankLayer(r,s,p,u,q,t)},setTileSize:function(q,p){this.tileWidth=q;this.tileHeight=p;this.widthInPixels=this.width*q;this.heightInPixels=this.height*p},addTilesetImage:function(p,C,A,u,G,v,r){if(typeof A==="undefined"){A=this.tileWidth}if(typeof u==="undefined"){u=this.tileHeight}if(typeof G==="undefined"){G=0}if(typeof v==="undefined"){v=0}if(typeof r==="undefined"){r=0}if(A===0){A=32}if(u===0){u=32}if(typeof C==="undefined"){if(typeof p==="string"){C=p;if(!this.game.cache.checkImageKey(C)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+C+'"');return null}}else{return null}}if(typeof p==="string"){p=this.getTilesetIndex(p);if(p===null&&this.format===g.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+C+'"');return null}}if(this.tilesets[p]){this.tilesets[p].setImage(this.game.cache.getImage(C));return this.tilesets[p]}else{var B=new g.Tileset(C,r,A,u,G,v,{});B.setImage(this.game.cache.getImage(C));this.tilesets.push(B);var q=this.tilesets.length-1;var z=G;var w=G;var s=0;var F=0;var D=0;for(var E=r;E<r+B.total;E++){this.tiles[E]=[z,w,q];z+=A+v;s++;if(s===B.total){break}F++;if(F===B.columns){z=G;w+=u+v;F=0;D++;if(D===B.rows){break}}}return B}return null},createFromObjects:function(q,u,B,r,x,w,A,p,s){if(typeof x==="undefined"){x=true}if(typeof w==="undefined"){w=false}if(typeof A==="undefined"){A=this.game.world}if(typeof p==="undefined"){p=g.Sprite}if(typeof s==="undefined"){s=true}if(!this.objects[q]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+q);return}var z;for(var t=0,v=this.objects[q].length;t<v;t++){if(this.objects[q][t].gid===u){z=new p(this.game,this.objects[q][t].x,this.objects[q][t].y,B,r);z.name=this.objects[q][t].name;z.visible=this.objects[q][t].visible;z.autoCull=w;z.exists=x;if(this.objects[q][t].rotation){z.angle=this.objects[q][t].rotation}if(s){z.y-=z.height}A.add(z);for(var y in this.objects[q][t].properties){A.set(z,y,this.objects[q][t].properties[y],false,false,0,true)}}}},createFromTiles:function(A,q,z,s,y,u){if(typeof A==="number"){A=[A]}if(typeof q==="undefined"||q===null){q=[]}else{if(typeof q==="number"){q=[q]}}s=this.getLayer(s);if(typeof y==="undefined"){y=this.game.world}if(typeof u==="undefined"){u={}}if(u.customClass===undefined){u.customClass=g.Sprite}if(u.adjustY===undefined){u.adjustY=true}var p=this.layers[s].width;var B=this.layers[s].height;this.copy(0,0,p,B,s);if(this._results.length<2){return 0}var v=0;var x;for(var r=1,t=this._results.length;r<t;r++){if(A.indexOf(this._results[r].index)!==-1){x=new u.customClass(this.game,this._results[r].worldX,this._results[r].worldY,z);for(var w in u){x[w]=u[w]}y.add(x);v++}}if(q.length===1){for(r=0;r<A.length;r++){this.replace(A[r],q[0],0,0,p,B,s)}}else{if(q.length>1){for(r=0;r<A.length;r++){this.replace(A[r],q[r],0,0,p,B,s)}}}return v},createLayer:function(r,s,p,t){if(typeof s==="undefined"){s=this.game.width}if(typeof p==="undefined"){p=this.game.height}if(typeof t==="undefined"){t=this.game.world}var q=r;if(typeof r==="string"){q=this.getLayerIndex(r)}if(q===null||q>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+q);return}return t.add(new g.TilemapLayer(this.game,this,q,s,p))},createBlankLayer:function(p,q,D,A,u,C){if(typeof C==="undefined"){C=this.game.world}if(this.getLayerIndex(p)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}var t={name:p,x:0,y:0,width:q,height:D,widthInPixels:q*A,heightInPixels:D*u,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var E;var r=[];for(var v=0;v<D;v++){E=[];for(var z=0;z<q;z++){E.push(new g.Tile(t,-1,z,v,A,u))}r.push(E)}t.data=r;this.layers.push(t);this.currentLayer=this.layers.length-1;var B=t.widthInPixels;var s=t.heightInPixels;if(B>this.game.width){B=this.game.width}if(s>this.game.height){s=this.game.height}var r=new g.TilemapLayer(this.game,this,this.layers.length-1,B,s);r.name=p;return C.add(r)},getIndex:function(p,q){for(var r=0;r<p.length;r++){if(p[r].name===q){return r}}return null},getLayerIndex:function(p){return this.getIndex(this.layers,p)},getTilesetIndex:function(p){return this.getIndex(this.tilesets,p)},getImageIndex:function(p){return this.getIndex(this.images,p)},getObjectIndex:function(p){return this.getIndex(this.objects,p)},setTileIndexCallback:function(r,u,q,t){t=this.getLayer(t);if(typeof r==="number"){this.layers[t].callbacks[r]={callback:u,callbackContext:q}}else{for(var s=0,p=r.length;s<p;s++){this.layers[t].callbacks[r[s]]={callback:u,callbackContext:q}}}},setTileLocationCallback:function(q,w,u,p,v,r,t){t=this.getLayer(t);this.copy(q,w,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){this._results[s].setCollisionCallback(v,r)}},setCollision:function(r,p,t,q){if(typeof p==="undefined"){p=true}if(typeof q==="undefined"){q=true}t=this.getLayer(t);if(typeof r==="number"){return this.setCollisionByIndex(r,p,t,true)}else{if(Array.isArray(r)){for(var s=0;s<r.length;s++){this.setCollisionByIndex(r[s],p,t,false)}if(q){this.calculateFaces(t)}}}},setCollisionBetween:function(u,t,p,s,r){if(typeof p==="undefined"){p=true}if(typeof r==="undefined"){r=true}s=this.getLayer(s);if(u>t){return}for(var q=u;q<=t;q++){this.setCollisionByIndex(q,p,s,false)}if(r){this.calculateFaces(s)}},setCollisionByExclusion:function(s,q,u,r){if(typeof q==="undefined"){q=true}if(typeof r==="undefined"){r=true}u=this.getLayer(u);for(var t=0,p=this.tiles.length;t<p;t++){if(s.indexOf(t)===-1){this.setCollisionByIndex(t,q,u,false)}}if(r){this.calculateFaces(u)}},setCollisionByIndex:function(s,q,u,r){if(typeof q==="undefined"){q=true}if(typeof u==="undefined"){u=this.currentLayer}if(typeof r==="undefined"){r=true}if(q){this.collideIndexes.push(s)}else{var t=this.collideIndexes.indexOf(s);if(t>-1){this.collideIndexes.splice(t,1)}}for(var w=0;w<this.layers[u].height;w++){for(var p=0;p<this.layers[u].width;p++){var v=this.layers[u].data[w][p];if(v&&v.index===s){if(q){v.setCollision(true,true,true,true)}else{v.resetCollision()}v.faceTop=q;v.faceBottom=q;v.faceLeft=q;v.faceRight=q}}}if(r){this.calculateFaces(u)}return u},getLayer:function(p){if(typeof p==="undefined"){p=this.currentLayer}else{if(typeof p==="string"){p=this.getLayerIndex(p)}else{if(p instanceof g.TilemapLayer){p=p.index}}}return p},setPreventRecalculate:function(q){if(q===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(q===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var p in this.needToRecalculate){this.calculateFaces(p)}this.needToRecalculate=false}},calculateFaces:function(r){if(this.preventingRecalculate){this.needToRecalculate[r]=true;return}var t=null;var A=null;var p=null;var B=null;for(var u=0,q=this.layers[r].height;u<q;u++){for(var v=0,z=this.layers[r].width;v<z;v++){var s=this.layers[r].data[u][v];if(s){t=this.getTileAbove(r,v,u);A=this.getTileBelow(r,v,u);p=this.getTileLeft(r,v,u);B=this.getTileRight(r,v,u);if(s.collides){s.faceTop=true;s.faceBottom=true;s.faceLeft=true;s.faceRight=true}if(t&&t.collides){s.faceTop=false}if(A&&A.collides){s.faceBottom=false}if(p&&p.collides){s.faceLeft=false}if(B&&B.collides){s.faceRight=false}}}}},getTileAbove:function(q,p,r){if(r>0){return this.layers[q].data[r-1][p]}return null},getTileBelow:function(q,p,r){if(r<this.layers[q].height-1){return this.layers[q].data[r+1][p]}return null},getTileLeft:function(q,p,r){if(p>0){return this.layers[q].data[r][p-1]}return null},getTileRight:function(q,p,r){if(p<this.layers[q].width-1){return this.layers[q].data[r][p+1]}return null},setLayer:function(p){p=this.getLayer(p);if(this.layers[p]){this.currentLayer=p}},hasTile:function(p,r,q){q=this.getLayer(q);return(this.layers[q].data[r][p].index>-1)},removeTile:function(p,s,q){q=this.getLayer(q);if(p>=0&&p<this.layers[q].width&&s>=0&&s<this.layers[q].height){if(this.hasTile(p,s,q)){var r=this.layers[q].data[s][p];this.layers[q].data[s][p]=new g.Tile(this.layers[q],-1,p,s,this.tileWidth,this.tileHeight);this.layers[q].dirty=true;this.calculateFaces(q);return r}}},removeTileWorldXY:function(p,t,s,q,r){r=this.getLayer(r);p=this.game.math.snapToFloor(p,s)/s;t=this.game.math.snapToFloor(t,q)/q;return this.removeTile(p,t,r)},putTile:function(s,p,t,r){if(s===null){return this.removeTile(p,t,r)}r=this.getLayer(r);if(p>=0&&p<this.layers[r].width&&t>=0&&t<this.layers[r].height){var q;if(s instanceof g.Tile){q=s.index;if(this.hasTile(p,t,r)){this.layers[r].data[t][p].copy(s)}else{this.layers[r].data[t][p]=new g.Tile(r,q,p,t,s.width,s.height)}}else{q=s;if(this.hasTile(p,t,r)){this.layers[r].data[t][p].index=q}else{this.layers[r].data[t][p]=new g.Tile(this.layers[r],q,p,t,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(q)>-1){this.layers[r].data[t][p].setCollision(true,true,true,true)}else{this.layers[r].data[t][p].resetCollision()}this.layers[r].dirty=true;this.calculateFaces(r);return this.layers[r].data[t][p]}return null},putTileWorldXY:function(s,p,u,t,q,r){r=this.getLayer(r);p=this.game.math.snapToFloor(p,t)/t;u=this.game.math.snapToFloor(u,q)/q;return this.putTile(s,p,u,r)},searchTileIndex:function(r,t,q,s){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=false}s=this.getLayer(s);var v=0;if(q){for(var u=this.layers[s].height-1;u>=0;u--){for(var p=this.layers[s].width-1;p>=0;p--){if(this.layers[s].data[u][p].index===r){if(v===t){return this.layers[s].data[u][p]}else{v++}}}}}else{for(var u=0;u<this.layers[s].height;u++){for(var p=0;p<this.layers[s].width;p++){if(this.layers[s].data[u][p].index===r){if(v===t){return this.layers[s].data[u][p]}else{v++}}}}}return null},getTile:function(p,s,r,q){if(typeof q==="undefined"){q=false}r=this.getLayer(r);if(p>=0&&p<this.layers[r].width&&s>=0&&s<this.layers[r].height){if(this.layers[r].data[s][p].index===-1){if(q){return this.layers[r].data[s][p]}else{return null}}else{return this.layers[r].data[s][p]}}else{return null}},getTileWorldXY:function(p,t,s,q,r){if(typeof s==="undefined"){s=this.tileWidth}if(typeof q==="undefined"){q=this.tileHeight}r=this.getLayer(r);p=this.game.math.snapToFloor(p,s)/s;t=this.game.math.snapToFloor(t,q)/q;return this.getTile(p,t,r)},copy:function(r,v,u,q,t){t=this.getLayer(t);if(!this.layers[t]){this._results.length=0;return}if(typeof r==="undefined"){r=0}if(typeof v==="undefined"){v=0}if(typeof u==="undefined"){u=this.layers[t].width}if(typeof q==="undefined"){q=this.layers[t].height}if(r<0){r=0}if(v<0){v=0}if(u>this.layers[t].width){u=this.layers[t].width}if(q>this.layers[t].height){q=this.layers[t].height}this._results.length=0;this._results.push({x:r,y:v,width:u,height:q,layer:t});for(var p=v;p<v+q;p++){for(var s=r;s<r+u;s++){this._results.push(this.layers[t].data[p][s])}}return this._results},paste:function(p,v,u,t){if(typeof p==="undefined"){p=0}if(typeof v==="undefined"){v=0}t=this.getLayer(t);if(!u||u.length<2){return}var r=p-u[1].x;var q=v-u[1].y;for(var s=1;s<u.length;s++){this.layers[t].data[q+u[s].y][r+u[s].x].copy(u[s])}this.layers[t].dirty=true;this.calculateFaces(t)},swap:function(u,t,q,v,s,p,r){r=this.getLayer(r);this.copy(q,v,s,p,r);if(this._results.length<2){return}this._tempA=u;this._tempB=t;this._results.forEach(this.swapHandler,this);this.paste(q,v,this._results,r)},swapHandler:function(p){if(p.index===this._tempA){p.index=this._tempB}else{if(p.index===this._tempB){p.index=this._tempA}}},forEach:function(v,s,q,u,t,p,r){r=this.getLayer(r);this.copy(q,u,t,p,r);if(this._results.length<2){return}this._results.forEach(v,s);this.paste(q,u,this._results,r)},replace:function(v,r,q,w,u,p,t){t=this.getLayer(t);this.copy(q,w,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){if(this._results[s].index===v){this._results[s].index=r}}this.paste(q,w,this._results,t)},random:function(v,u,p,z,r){r=this.getLayer(r);this.copy(v,u,p,z,r);if(this._results.length<2){return}var s=[];for(var A=1;A<this._results.length;A++){if(this._results[A].index){var w=this._results[A].index;if(s.indexOf(w)===-1){s.push(w)}}}for(var q=1;q<this._results.length;q++){this._results[q].index=this.game.rnd.pick(s)}this.paste(v,u,this._results,r)},shuffle:function(q,z,w,p,v){v=this.getLayer(v);this.copy(q,z,w,p,v);if(this._results.length<2){return}var r=[];for(var u=1;u<this._results.length;u++){if(this._results[u].index){r.push(this._results[u].index)}}g.Utils.shuffle(r);for(var s=1;s<this._results.length;s++){this._results[s].index=r[s-1]}this.paste(q,z,this._results,v)},fill:function(r,q,v,u,p,t){t=this.getLayer(t);this.copy(q,v,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){this._results[s].index=r}this.paste(q,v,this._results,t)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var q="";var r=[""];for(var s=0;s<this.layers[this.currentLayer].height;s++){for(var p=0;p<this.layers[this.currentLayer].width;p++){q+="%c  ";if(this.layers[this.currentLayer].data[s][p]>1){if(this.debugMap[this.layers[this.currentLayer].data[s][p]]){r.push("background: "+this.debugMap[this.layers[this.currentLayer].data[s][p]])}else{r.push("background: #ffffff")}}else{r.push("background: rgb(0, 0, 0)")}}q+="\n"}r[0]=q;console.log.apply(console,r)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};g.Tilemap.prototype.constructor=g.Tilemap;Object.defineProperty(g.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(p){if(p!==this.currentLayer){this.setLayer(p)}}});g.TilemapLayer=function(q,t,r,s,p){s|=0;p|=0;PIXI.Sprite.call(this,PIXI.TextureCache.__default);g.Component.Core.init.call(this,q,0,0,null,null);this.map=t;this.index=r;this.layer=t.layers[r];this.canvas=g.Canvas.create(s,p);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new g.Frame(0,0,0,s,p,"tilemapLayer",q.rnd.uuid());this.type=g.TILEMAPLAYER;this.physicsType=g.TILEMAPLAYER;this.renderSettings={enableScrollDelta:true,overdrawRatio:0.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:0.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:t.tileWidth,tileHeight:t.tileHeight,cw:t.tileWidth,ch:t.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];if(!q.device.canvasBitBltShift){this.renderSettings.copyCanvas=g.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};g.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype);g.TilemapLayer.prototype.constructor=g.TilemapLayer;var h=["Bounds","Destroy","FixedToCamera","Reset","Smoothed"];g.Component.Core.install.call(g.TilemapLayer.prototype,h);g.TilemapLayer.sharedCopyCanvas=null;g.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=g.Canvas.create(2,2)}return this.sharedCopyCanvas};g.TilemapLayer.prototype.preUpdate=function(){g.Component.Core.preUpdate.call(this);return true};g.TilemapLayer.prototype.postUpdate=function(){g.Component.Core.prototype.postUpdate.call(this);var p=this.game.camera;this.scrollX=p.x*this.scrollFactorX/this.scale.x;this.scrollY=p.y*this.scrollFactorY/this.scale.y;this.render()};g.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};g.TilemapLayer.prototype._fixX=function(p){if(p<0){p=0}if(this.scrollFactorX===1){return p}return this._scrollX+(p-(this._scrollX/this.scrollFactorX))};g.TilemapLayer.prototype._unfixX=function(p){if(this.scrollFactorX===1){return p}return(this._scrollX/this.scrollFactorX)+(p-this._scrollX)};g.TilemapLayer.prototype._fixY=function(p){if(p<0){p=0}if(this.scrollFactorY===1){return p}return this._scrollY+(p-(this._scrollY/this.scrollFactorY))};g.TilemapLayer.prototype._unfixY=function(p){if(this.scrollFactorY===1){return p}return(this._scrollY/this.scrollFactorY)+(p-this._scrollY)};g.TilemapLayer.prototype.getTileX=function(p){return Math.floor(this._fixX(p)/this._mc.tileWidth)};g.TilemapLayer.prototype.getTileY=function(p){return Math.floor(this._fixY(p)/this._mc.tileHeight)};g.TilemapLayer.prototype.getTileXY=function(q,r,p){p.x=this.getTileX(q);p.y=this.getTileY(r);return p};g.TilemapLayer.prototype.getRayCastTiles=function(A,s,p,x){if(!s){s=this.rayStepRate}if(typeof p==="undefined"){p=false}if(typeof x==="undefined"){x=false}var y=this.getTiles(A.x,A.y,A.width,A.height,p,x);if(y.length===0){return[]}var w=A.coordinatesOnLine(s);var q=[];for(var r=0;r<y.length;r++){for(var z=0;z<w.length;z++){var v=y[r];var u=w[z];if(v.containsPoint(u[0],u[1])){q.push(v);break}}}return q};g.TilemapLayer.prototype.getTiles=function(B,A,q,D,t,C){if(typeof t==="undefined"){t=false}if(typeof C==="undefined"){C=false}var r=!(t||C);B=this._fixX(B);A=this._fixY(A);var w=Math.floor(B/(this._mc.cw*this.scale.x));var v=Math.floor(A/(this._mc.ch*this.scale.y));var z=Math.ceil((B+q)/(this._mc.cw*this.scale.x))-w;var p=Math.ceil((A+D)/(this._mc.ch*this.scale.y))-v;while(this._results.length){this._results.pop()}for(var s=v;s<v+p;s++){for(var u=w;u<w+z;u++){var E=this.layer.data[s];if(E&&E[u]){if(r||E[u].isInteresting(t,C)){this._results.push(E[u])}}}}return this._results.slice()};Object.defineProperty(g.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(p){this.debugSettings.missingImageFill=p}});Object.defineProperty(g.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(p){this._wrap=p;this.dirty=true}});g.TilemapLayer.prototype.resolveTileset=function(s){var p=this._mc.tilesets;if(s<2000){while(p.length<s){p.push(undefined)}}var q=this.map.tiles[s]&&this.map.tiles[s][2];if(q!=null){var r=this.map.tilesets[q];if(r&&r.containsTileIndex(s)){return(p[s]=r)}}return(p[s]=null)};g.TilemapLayer.prototype.resetTilesetCache=function(){var p=this._mc.tilesets;while(p.length){p.pop()}};g.TilemapLayer.prototype.setScale=function(s,r){s=s||1;r=r||s;for(var u=0;u<this.layer.data.length;u++){var t=this.layer.data[u];for(var p=0;p<t.length;p++){var q=t[p];q.width=this.map.tileWidth*s;q.height=this.map.tileHeight*r;q.worldX=q.x*q.width;q.worldY=q.y*q.height}}this.scale.setTo(s,r)};g.TilemapLayer.prototype.shiftCanvas=function(p,z,v){var q=p.canvas;var A=q.width-Math.abs(z);var t=q.height-Math.abs(v);var C=0;var B=0;var w=z;var u=v;if(z<0){C=-z;w=0}if(v<0){B=-v;u=0}var s=this.renderSettings.copyCanvas;if(s){if(s.width<A||s.height<t){s.width=A;s.height=t}var r=s.getContext("2d");r.clearRect(0,0,A,t);r.drawImage(q,C,B,A,t,0,0,A,t);p.clearRect(w,u,A,t);p.drawImage(s,0,0,A,t,w,u,A,t)}else{p.save();p.globalCompositeOperation="copy";p.drawImage(q,C,B,A,t,w,u,A,t);p.restore()}};g.TilemapLayer.prototype.renderRegion=function(J,I,s,E,N,w){var r=this.context;var H=this.layer.width;var F=this.layer.height;var Q=this._mc.tileWidth;var t=this._mc.tileHeight;var L=this._mc.tilesets;var K=NaN;if(!this._wrap){if(s<=N){s=Math.max(0,s);N=Math.min(H-1,N)}if(E<=w){E=Math.max(0,E);w=Math.min(F-1,w)}}var q=(s*Q)-J;var p=(E*t)-I;var D=(s+((1<<20)*H))%H;var B=(E+((1<<20)*F))%F;var P,O,A,z,G,M;r.fillStyle=this.tileColor;for(z=B,M=w-E,O=p;M>=0;z++,M--,O+=t){if(z>=F){z-=F}var v=this.layer.data[z];for(A=D,G=N-s,P=q;G>=0;A++,G--,P+=Q){if(A>=H){A-=H}var R=v[A];if(!R||R.index<0){continue}var u=R.index;var C=L[u];if(C===undefined){C=this.resolveTileset(u)}if(R.alpha!==K&&!this.debug){r.globalAlpha=R.alpha;K=R.alpha}if(C){if(R.rotation||R.flipped){r.save();r.translate(P+R.centerX,O+R.centerY);r.rotate(R.rotation);if(R.flipped){r.scale(-1,1)}C.draw(r,-R.centerX,-R.centerY,u);r.restore()}else{C.draw(r,P,O,u)}}else{if(this.debugSettings.missingImageFill){r.fillStyle=this.debugSettings.missingImageFill;r.fillRect(P,O,Q,t)}}if(R.debug&&this.debugSettings.debuggedTileOverfill){r.fillStyle=this.debugSettings.debuggedTileOverfill;r.fillRect(P,O,Q,t)}}}};g.TilemapLayer.prototype.renderDeltaScroll=function(B,A){var E=this._mc.scrollX;var C=this._mc.scrollY;var x=this.canvas.width;var u=this.canvas.height;var v=this._mc.tileWidth;var r=this._mc.tileHeight;var t=0;var D=-v;var y=0;var q=-r;if(B<0){t=x+B;D=x-1}else{if(B>0){D=B}}if(A<0){y=u+A;q=u-1}else{if(A>0){q=A}}this.shiftCanvas(this.context,B,A);t=Math.floor((t+E)/v);D=Math.floor((D+E)/v);y=Math.floor((y+C)/r);q=Math.floor((q+C)/r);if(t<=D){this.context.clearRect(((t*v)-E),0,(D-t+1)*v,u);var s=Math.floor((0+C)/r);var p=Math.floor((u-1+C)/r);this.renderRegion(E,C,t,s,D,p)}if(y<=q){this.context.clearRect(0,((y*r)-C),x,(q-y+1)*r);var w=Math.floor((0+E)/v);var z=Math.floor((x-1+E)/v);this.renderRegion(E,C,w,y,z,q)}};g.TilemapLayer.prototype.renderFull=function(){var x=this._mc.scrollX;var w=this._mc.scrollY;var u=this.canvas.width;var s=this.canvas.height;var t=this._mc.tileWidth;var q=this._mc.tileHeight;var r=Math.floor(x/t);var y=Math.floor((u-1+x)/t);var v=Math.floor(w/q);var p=Math.floor((s-1+w)/q);this.context.clearRect(0,0,u,s);this.renderRegion(x,w,r,v,y,p)};g.TilemapLayer.prototype.render=function(){var p=false;if(!this.visible){return}this.context.save();if(this.dirty||this.layer.dirty){this.layer.dirty=false;p=true}var q=this.canvas.width;var w=this.canvas.height;var v=this._scrollX|0;var u=this._scrollY|0;var t=this._mc;var s=t.scrollX-v;var r=t.scrollY-u;if(!p&&s===0&&r===0&&t.renderWidth===q&&t.renderHeight===w){return}t.scrollX=v;t.scrollY=u;if(t.renderWidth!==q||t.renderHeight!==w){t.renderWidth=q;t.renderHeight=w}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){p=true}}if(!p&&this.renderSettings.enableScrollDelta&&(Math.abs(s)+Math.abs(r))<Math.min(q,w)){this.renderDeltaScroll(s,r)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.baseTexture.dirty();this.dirty=false;this.context.restore();return true};g.TilemapLayer.prototype.renderDebug=function(){var J=this._mc.scrollX;var I=this._mc.scrollY;var s=this.context;var r=this.canvas.width;var z=this.canvas.height;var H=this.layer.width;var F=this.layer.height;var O=this._mc.tileWidth;var u=this._mc.tileHeight;var t=Math.floor(J/O);var L=Math.floor((r-1+J)/O);var E=Math.floor(I/u);var w=Math.floor((z-1+I)/u);var q=(t*O)-J;var p=(E*u)-I;var D=(t+((1<<20)*H))%H;var C=(E+((1<<20)*F))%F;var N,M,B,A,G,K;s.strokeStyle=this.debugSettings.facingEdgeStroke;for(A=C,K=w-E,M=p;K>=0;A++,K--,M+=u){if(A>=F){A-=F}var v=this.layer.data[A];for(B=D,G=L-t,N=q;G>=0;B++,G--,N+=O){if(B>=H){B-=H}var P=v[B];if(!P||P.index<0||!P.collides){continue}if(this.debugSettings.collidingTileOverfill){s.fillStyle=this.debugSettings.collidingTileOverfill;s.fillRect(N,M,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){s.beginPath();if(P.faceTop){s.moveTo(N,M);s.lineTo(N+this._mc.cw,M)}if(P.faceBottom){s.moveTo(N,M+this._mc.ch);s.lineTo(N+this._mc.cw,M+this._mc.ch)}if(P.faceLeft){s.moveTo(N,M);s.lineTo(N,M+this._mc.ch)}if(P.faceRight){s.moveTo(N+this._mc.cw,M);s.lineTo(N+this._mc.cw,M+this._mc.ch)}s.stroke()}}}};Object.defineProperty(g.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(p){this._scrollX=p}});Object.defineProperty(g.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(p){this._scrollY=p}});Object.defineProperty(g.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(p){this._mc.cw=p|0;this.dirty=true}});Object.defineProperty(g.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(p){this._mc.ch=p|0;this.dirty=true}});g.TilemapParser={parse:function(r,s,v,q,t,p){if(typeof v==="undefined"){v=32}if(typeof q==="undefined"){q=32}if(typeof t==="undefined"){t=10}if(typeof p==="undefined"){p=10}if(typeof s==="undefined"){return this.getEmptyData()}if(s===null){return this.getEmptyData(v,q,t,p)}var u=r.cache.getTilemapData(s);if(u){if(u.format===g.Tilemap.CSV){return this.parseCSV(s,u.data,v,q)}else{if(!u.format||u.format===g.Tilemap.TILED_JSON){return this.parseTiledJSON(u.data)}}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+s)}},parseCSV:function(A,t,z,u){var p=this.getEmptyData();t=t.trim();var r=[];var C=t.split("\n");var B=C.length;var q=0;for(var v=0;v<C.length;v++){r[v]=[];var s=C[v].split(",");for(var w=0;w<s.length;w++){r[v][w]=new g.Tile(p.layers[0],parseInt(s[w],10),w,v,z,u)}if(q===0){q=s.length}}p.format=g.Tilemap.CSV;p.name=A;p.width=q;p.height=B;p.tileWidth=z;p.tileHeight=u;p.widthInPixels=q*z;p.heightInPixels=B*u;p.layers[0].width=q;p.layers[0].height=B;p.layers[0].widthInPixels=p.widthInPixels;p.layers[0].heightInPixels=p.heightInPixels;p.layers[0].data=r;return p},getEmptyData:function(v,q,s,p){var u={};u.width=0;u.height=0;u.tileWidth=0;u.tileHeight=0;if(typeof v!=="undefined"&&v!==null){u.tileWidth=v}if(typeof q!=="undefined"&&q!==null){u.tileHeight=q}if(typeof s!=="undefined"&&s!==null){u.width=s}if(typeof p!=="undefined"&&p!==null){u.height=p}u.orientation="orthogonal";u.version="1";u.properties={};u.widthInPixels=0;u.heightInPixels=0;var t=[];var r={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]};t.push(r);u.layers=t;u.images=[];u.objects={};u.collision={};u.tilesets=[];u.tiles=[];return u},parseTiledJSON:function(W){if(W.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var X={};X.width=W.width;X.height=W.height;X.tileWidth=W.tilewidth;X.tileHeight=W.tileheight;X.orientation=W.orientation;X.format=g.Tilemap.TILED_JSON;X.version=W.version;X.properties=W.properties;X.widthInPixels=X.width*X.tileWidth;X.heightInPixels=X.height*X.tileHeight;var B=[];for(var U=0;U<W.layers.length;U++){if(W.layers[U].type!=="tilelayer"){continue}var aa={name:W.layers[U].name,x:W.layers[U].x,y:W.layers[U].y,width:W.layers[U].width,height:W.layers[U].height,widthInPixels:W.layers[U].width*W.tilewidth,heightInPixels:W.layers[U].height*W.tileheight,alpha:W.layers[U].opacity,visible:W.layers[U].visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(W.layers[U].properties){aa.properties=W.layers[U].properties}var G=0;var z=[];var D=[];var Q,A,r,M;for(var L=0,V=W.layers[U].data.length;L<V;L++){Q=0;A=false;M=W.layers[U].data[L];if(M>536870912){r=0;if(M>2147483648){M-=2147483648;r+=4}if(M>1073741824){M-=1073741824;r+=2}if(M>536870912){M-=536870912;r+=1}switch(r){case 5:Q=Math.PI/2;break;case 6:Q=Math.PI;break;case 3:Q=3*Math.PI/2;break;case 4:Q=0;A=true;break;case 7:Q=Math.PI/2;A=true;break;case 2:Q=Math.PI;A=true;break;case 1:Q=3*Math.PI/2;A=true;break}}if(M>0){z.push(new g.Tile(aa,M,G,D.length,W.tilewidth,W.tileheight));z[z.length-1].rotation=Q;z[z.length-1].flipped=A}else{z.push(new g.Tile(aa,-1,G,D.length,W.tilewidth,W.tileheight))}G++;if(G===W.layers[U].width){D.push(z);G=0;z=[]}}aa.data=D;B.push(aa)}X.layers=B;var I=[];for(var U=0;U<W.layers.length;U++){if(W.layers[U].type!=="imagelayer"){continue}var N={name:W.layers[U].name,image:W.layers[U].image,x:W.layers[U].x,y:W.layers[U].y,alpha:W.layers[U].opacity,visible:W.layers[U].visible,properties:{}};if(W.layers[U].properties){N.properties=W.layers[U].properties}I.push(N)}X.images=I;var S=[];for(var U=0;U<W.tilesets.length;U++){var K=W.tilesets[U];if(K.image){var C=new g.Tileset(K.name,K.firstgid,K.tilewidth,K.tileheight,K.margin,K.spacing,K.properties);if(K.tileproperties){C.tileProperties=K.tileproperties}C.updateTileData(K.imagewidth,K.imageheight);S.push(C)}else{console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support")}}X.tilesets=S;var q={};var u={};function P(y,p){var v={};for(var t in p){var x=p[t];if(y[x]){v[x]=y[x]}}return v}for(var U=0;U<W.layers.length;U++){if(W.layers[U].type!=="objectgroup"){continue}q[W.layers[U].name]=[];u[W.layers[U].name]=[];for(var J=0,V=W.layers[U].objects.length;J<V;J++){if(W.layers[U].objects[J].gid){var Z={gid:W.layers[U].objects[J].gid,name:W.layers[U].objects[J].name,type:W.layers[U].objects[J].hasOwnProperty("type")?W.layers[U].objects[J].type:"",x:W.layers[U].objects[J].x,y:W.layers[U].objects[J].y,visible:W.layers[U].objects[J].visible,properties:W.layers[U].objects[J].properties};if(W.layers[U].objects[J].rotation){Z.rotation=W.layers[U].objects[J].rotation}q[W.layers[U].name].push(Z)}else{if(W.layers[U].objects[J].polyline){var Z={name:W.layers[U].objects[J].name,type:W.layers[U].objects[J].type,x:W.layers[U].objects[J].x,y:W.layers[U].objects[J].y,width:W.layers[U].objects[J].width,height:W.layers[U].objects[J].height,visible:W.layers[U].objects[J].visible,properties:W.layers[U].objects[J].properties};if(W.layers[U].objects[J].rotation){Z.rotation=W.layers[U].objects[J].rotation}Z.polyline=[];for(var O=0;O<W.layers[U].objects[J].polyline.length;O++){Z.polyline.push([W.layers[U].objects[J].polyline[O].x,W.layers[U].objects[J].polyline[O].y])}u[W.layers[U].name].push(Z);q[W.layers[U].name].push(Z)}else{if(W.layers[U].objects[J].polygon){var Z=P(W.layers[U].objects[J],["name","type","x","y","visible","rotation","properties"]);Z.polygon=[];for(var O=0;O<W.layers[U].objects[J].polygon.length;O++){Z.polygon.push([W.layers[U].objects[J].polygon[O].x,W.layers[U].objects[J].polygon[O].y])}q[W.layers[U].name].push(Z)}else{if(W.layers[U].objects[J].ellipse){var Z=P(W.layers[U].objects[J],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);q[W.layers[U].name].push(Z)}else{var Z=P(W.layers[U].objects[J],["name","type","x","y","width","height","visible","rotation","properties"]);Z.rectangle=true;q[W.layers[U].name].push(Z)}}}}}}X.objects=q;X.collision=u;X.tiles=[];for(var U=0;U<X.tilesets.length;U++){var K=X.tilesets[U];var G=K.tileMargin;var E=K.tileMargin;var w=0;var H=0;var F=0;for(var L=K.firstgid;L<K.firstgid+K.total;L++){X.tiles[L]=[G,E,U];G+=K.tileWidth+K.tileSpacing;w++;if(w===K.total){break}H++;if(H===K.columns){G=K.tileMargin;E+=K.tileHeight+K.tileSpacing;H=0;F++;if(F===K.rows){break}}}}var aa;var Y;var s;var K;for(var U=0;U<X.layers.length;U++){aa=X.layers[U];for(var T=0;T<aa.data.length;T++){z=aa.data[T];for(var R=0;R<z.length;R++){Y=z[R];if(Y.index<0){continue}s=X.tiles[Y.index][2];K=X.tilesets[s];if(K.tileProperties&&K.tileProperties[Y.index-K.firstgid]){Y.properties=g.Utils.mixin(K.tileProperties[Y.index-K.firstgid],Y.properties)}}}}return X}};g.Tileset=function(q,u,s,p,t,v,r){if(typeof s==="undefined"||s<=0){s=32}if(typeof p==="undefined"||p<=0){p=32}if(typeof t==="undefined"){t=0}if(typeof v==="undefined"){v=0}this.name=q;this.firstgid=u|0;this.tileWidth=s|0;this.tileHeight=p|0;this.tileMargin=t|0;this.tileSpacing=v|0;this.properties=r||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};g.Tileset.prototype={draw:function(r,p,t,q){var s=(q-this.firstgid)<<1;if(s>=0&&(s+1)<this.drawCoords.length){r.drawImage(this.image,this.drawCoords[s],this.drawCoords[s+1],this.tileWidth,this.tileHeight,p,t,this.tileWidth,this.tileHeight)}},containsTileIndex:function(p){return(p>=this.firstgid&&p<(this.firstgid+this.total))},setImage:function(p){this.image=p;this.updateTileData(p.width,p.height)},setSpacing:function(p,q){this.tileMargin=p|0;this.tileSpacing=q|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(u,r){var t=(r-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var v=(u-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(t%1!==0||v%1!==0){console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size")}t=Math.floor(t);v=Math.floor(v);if((this.rows&&this.rows!==t)||(this.columns&&this.columns!==v)){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=t;this.columns=v;this.total=t*v;this.drawCoords.length=0;var s=this.tileMargin;var q=this.tileMargin;for(var w=0;w<this.rows;w++){for(var p=0;p<this.columns;p++){this.drawCoords.push(s);this.drawCoords.push(q);s+=this.tileWidth+this.tileSpacing}s=this.tileMargin;q+=this.tileHeight+this.tileSpacing}}};g.Tileset.prototype.constructor=g.Tileset;g.Particles=function(p){this.game=p;this.emitters={};this.ID=0};g.Particles.prototype={add:function(p){this.emitters[p.name]=p;return p},remove:function(p){delete this.emitters[p.name]},update:function(){for(var p in this.emitters){if(this.emitters[p].exists){this.emitters[p].update()}}}};g.Particles.prototype.constructor=g.Particles;g.Particles.Arcade={};g.Particles.Arcade.Emitter=function(q,p,s,r){this.maxParticles=r||50;g.Group.call(this,q);this.name="emitter"+this.game.particles.ID++;this.type=g.EMITTER;this.physicsType=g.GROUP;this.area=new g.Rectangle(p,s,1,1);this.minParticleSpeed=new g.Point(-100,-100);this.maxParticleSpeed=new g.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=g.Particle;this.particleDrag=new g.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new g.Point();this.on=false;this.particleAnchor=new g.Point(0.5,0.5);this.blendMode=g.blendModes.NORMAL;this.emitX=p;this.emitY=s;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new g.Point(1,1);this._maxParticleScale=new g.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};g.Particles.Arcade.Emitter.prototype=Object.create(g.Group.prototype);g.Particles.Arcade.Emitter.prototype.constructor=g.Particles.Arcade.Emitter;g.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var p=0;p<this._flowQuantity;p++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else{if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}}else{if(this.emitParticle()){this._counter++;if(this._quantity>0&&this._counter>=this._quantity){this.on=false}}}}var p=this.children.length;while(p--){if(this.children[p].exists){this.children[p].update()}}};g.Particles.Arcade.Emitter.prototype.makeParticles=function(w,t,q,v,x){if(typeof t==="undefined"){t=0}if(typeof q==="undefined"){q=this.maxParticles}if(typeof v==="undefined"){v=false}if(typeof x==="undefined"){x=false}var s;var r=0;var p=w;var u=t;this._frames=t;if(q>this.maxParticles){this.maxParticles=q}while(r<q){if(Array.isArray(w)){p=this.game.rnd.pick(w)}if(Array.isArray(t)){u=this.game.rnd.pick(t)}s=new this.particleClass(this.game,0,0,p,u);this.game.physics.arcade.enable(s,false);if(v){s.body.checkCollision.any=true;s.body.checkCollision.none=false}else{s.body.checkCollision.none=true}s.body.collideWorldBounds=x;s.body.skipQuadTree=true;s.exists=false;s.visible=false;s.anchor.copyFrom(this.particleAnchor);this.add(s);r++}return this};g.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false};g.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true};g.Particles.Arcade.Emitter.prototype.explode=function(q,p){this._flowTotal=0;this.start(true,q,0,p,false)};g.Particles.Arcade.Emitter.prototype.flow=function(t,s,r,q,p){if(typeof r==="undefined"||r===0){r=1}if(typeof q==="undefined"){q=-1}if(typeof p==="undefined"){p=true}if(r>this.maxParticles){r=this.maxParticles}this._counter=0;this._flowQuantity=r;this._flowTotal=q;if(p){this.start(true,t,s,r);this._counter+=r;this.on=true;this._timer=this.game.time.time+s*this.game.time.slowMotion}else{this.start(false,t,s,r)}};g.Particles.Arcade.Emitter.prototype.start=function(r,u,t,s,p){if(typeof r==="undefined"){r=true}if(typeof u==="undefined"){u=0}if(typeof t==="undefined"||t===null){t=250}if(typeof s==="undefined"){s=0}if(typeof p==="undefined"){p=false}if(s>this.maxParticles){s=this.maxParticles}this.revive();this.visible=true;this.lifespan=u;this.frequency=t;if(r||p){for(var q=0;q<s;q++){this.emitParticle()}}else{this.on=true;this._quantity+=s;this._counter=0;this._timer=this.game.time.time+t*this.game.time.slowMotion}};g.Particles.Arcade.Emitter.prototype.emitParticle=function(){var p=this.getFirstExists(false);if(p===null){return false}if(this.width>1||this.height>1){p.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom))}else{p.reset(this.emitX,this.emitY)}p.angle=0;p.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(p)}else{if(this.particleSendToBack){this.sendToBack(p)}}if(this.autoScale){p.setScaleData(this.scaleData)}else{if(this.minParticleScale!==1||this.maxParticleScale!==1){p.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale))}else{if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){p.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}}}if(Array.isArray(this._frames==="object")){p.frame=this.game.rnd.pick(this._frames)}else{p.frame=this._frames}if(this.autoAlpha){p.setAlphaData(this.alphaData)}else{p.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}p.blendMode=this.blendMode;p.body.updateBounds();p.body.bounce.setTo(this.bounce.x,this.bounce.y);p.body.velocity.x=this.game.rnd.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);p.body.velocity.y=this.game.rnd.between(this.minParticleSpeed.y,this.maxParticleSpeed.y);p.body.angularVelocity=this.game.rnd.between(this.minRotation,this.maxRotation);p.body.gravity.y=this.gravity;p.body.drag.x=this.particleDrag.x;p.body.drag.y=this.particleDrag.y;p.body.angularDrag=this.angularDrag;p.onEmit();return true};g.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);g.Group.prototype.destroy.call(this,true,false)};g.Particles.Arcade.Emitter.prototype.setSize=function(q,p){this.area.width=q;this.area.height=p};g.Particles.Arcade.Emitter.prototype.setXSpeed=function(q,p){q=q||0;p=p||0;this.minParticleSpeed.x=q;this.maxParticleSpeed.x=p};g.Particles.Arcade.Emitter.prototype.setYSpeed=function(q,p){q=q||0;p=p||0;this.minParticleSpeed.y=q;this.maxParticleSpeed.y=p};g.Particles.Arcade.Emitter.prototype.setRotation=function(q,p){q=q||0;p=p||0;this.minRotation=q;this.maxRotation=p};g.Particles.Arcade.Emitter.prototype.setAlpha=function(s,p,u,v,t){if(typeof s==="undefined"){s=1}if(typeof p==="undefined"){p=1}if(typeof u==="undefined"){u=0}if(typeof v==="undefined"){v=g.Easing.Linear.None}if(typeof t==="undefined"){t=false}this.minParticleAlpha=s;this.maxParticleAlpha=p;this.autoAlpha=false;if(u>0&&s!==p){var q={v:s};var r=this.game.make.tween(q).to({v:p},u,v);r.yoyo(t);this.alphaData=r.generateData(60);this.alphaData.reverse();this.autoAlpha=true}};g.Particles.Arcade.Emitter.prototype.setScale=function(s,q,r,p,u,t,v){if(typeof s==="undefined"){s=1}if(typeof q==="undefined"){q=1}if(typeof r==="undefined"){r=1}if(typeof p==="undefined"){p=1}if(typeof u==="undefined"){u=0}if(typeof t==="undefined"){t=g.Easing.Linear.None}if(typeof v==="undefined"){v=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(s,r);this._maxParticleScale.set(q,p);this.autoScale=false;if(u>0&&((s!==q)||(r!==p))){var x={x:s,y:r};var w=this.game.make.tween(x).to({x:q,y:p},u,t);w.yoyo(v);this.scaleData=w.generateData(60);this.scaleData.reverse();this.autoScale=true}};g.Particles.Arcade.Emitter.prototype.at=function(p){if(p.center){this.emitX=p.center.x;this.emitY=p.center.y}else{this.emitX=p.world.x+(p.anchor.x*p.width);this.emitY=p.world.y+(p.anchor.y*p.height)}};Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(p){this.area.width=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(p){this.area.height=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(p){this.emitX=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(p){this.emitY=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-(this.area.width/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+(this.area.width/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-(this.area.height/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+(this.area.height/2))}});if(PIXI.blendModes===undefined){PIXI.blendModes=g.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=g.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix()}if(PIXI.RenderTexture.tempMatrix===undefined){PIXI.RenderTexture.tempMatrix=new PIXI.Matrix()}if(PIXI.Graphics.POLY===undefined){PIXI.Graphics.POLY=g.POLYGON;PIXI.Graphics.RECT=g.RECTANGLE;PIXI.Graphics.CIRC=g.CIRCLE;PIXI.Graphics.ELIP=g.ELLIPSE;PIXI.Graphics.RREC=g.ROUNDEDRECTANGLE}if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=g}exports.Phaser=g}else{if(typeof define!=="undefined"&&define.amd){define("Phaser",(function(){return l.Phaser=g})())}else{l.Phaser=g}}}).call(this);
=======
/* Phaser v2.0.6 - http://phaser.io - @photonstorm - (c) 2014 Photon Storm Ltd. */  (function(){var a=this,b=b||{};b.WEBGL_RENDERER=0,b.CANVAS_RENDERER=1,b.VERSION="v1.6",b.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},b.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},b._UID=0,b.Float32Array=Float32Array||Array,b.Uint16Array=Uint16Array||Array,b.INTERACTION_FREQUENCY=30,b.AUTO_PREVENT_DEFAULT=!0,b.RAD_TO_DEG=180/Math.PI,b.DEG_TO_RAD=Math.PI/180,b.dontSayHello=!1,b.sayHello=function(a){if(!b.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var c=["%c %c %c Pixi.js "+b.VERSION+" - "+a+"  %c  %c  http://pixijs.com  %c %c â™¥%câ™¥%câ™¥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,c)}else window.console&&console.log("Pixi.js "+b.VERSION+" - http://pixjs.com");b.dontSayHello=!0}},b.Point=function(a,b){this.x=a||0,this.y=b||0},b.Point.prototype.clone=function(){return new b.Point(this.x,this.y)},b.Point.prototype.set=function(a,b){this.x=a||0,this.y=b||(0!==b?this.x:0)},b.Point.prototype.constructor=b.Point,b.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},b.Rectangle.prototype.clone=function(){return new b.Rectangle(this.x,this.y,this.width,this.height)},b.Rectangle.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this.width){var d=this.y;if(b>=d&&b<=d+this.height)return!0}return!1},b.Rectangle.prototype.constructor=b.Rectangle,b.EmptyRectangle=new b.Rectangle(0,0,0,0),b.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],d=0,e=a.length;e>d;d+=2)c.push(new b.Point(a[d],a[d+1]));a=c}this.points=a},b.Polygon.prototype.clone=function(){for(var a=[],c=0;c<this.points.length;c++)a.push(this.points[c].clone());return new b.Polygon(a)},b.Polygon.prototype.contains=function(a,b){for(var c=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var f=this.points[d].x,g=this.points[d].y,h=this.points[e].x,i=this.points[e].y,j=g>b!=i>b&&(h-f)*(b-g)/(i-g)+f>a;j&&(c=!c)}return c},b.Polygon.prototype.constructor=b.Polygon,b.Circle=function(a,b,c){this.x=a||0,this.y=b||0,this.radius=c||0},b.Circle.prototype.clone=function(){return new b.Circle(this.x,this.y,this.radius)},b.Circle.prototype.contains=function(a,b){if(this.radius<=0)return!1;var c=this.x-a,d=this.y-b,e=this.radius*this.radius;return c*=c,d*=d,e>=c+d},b.Circle.prototype.getBounds=function(){return new b.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)},b.Circle.prototype.constructor=b.Circle,b.Ellipse=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},b.Ellipse.prototype.clone=function(){return new b.Ellipse(this.x,this.y,this.width,this.height)},b.Ellipse.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,1>=c+d},b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},b.Ellipse.prototype.constructor=b.Ellipse,b.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},b.Matrix.prototype.fromArray=function(a){this.a=a[0],this.b=a[1],this.c=a[3],this.d=a[4],this.tx=a[2],this.ty=a[5]},b.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var b=this.array;return a?(b[0]=this.a,b[1]=this.c,b[2]=0,b[3]=this.b,b[4]=this.d,b[5]=0,b[6]=this.tx,b[7]=this.ty,b[8]=1):(b[0]=this.a,b[1]=this.b,b[2]=this.tx,b[3]=this.c,b[4]=this.d,b[5]=this.ty,b[6]=0,b[7]=0,b[8]=1),b},b.identityMatrix=new b.Matrix,b.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},b.Matrix2=b.determineMatrixArrayType(),b.DisplayObject=function(){this.position=new b.Point,this.scale=new b.Point(1,1),this.pivot=new b.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new b.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new b.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},b.DisplayObject.prototype.constructor=b.DisplayObject,b.DisplayObject.prototype.setInteractive=function(a){this.interactive=a},Object.defineProperty(b.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}}),Object.defineProperty(b.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1),this._mask=a,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,e=0;e<d.length;e++)b.push(d[e]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}}),Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}}),b.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,b=this.worldTransform,c=this.pivot.x,d=this.pivot.y,e=this._cr*this.scale.x,f=-this._sr*this.scale.y,g=this._sr*this.scale.x,h=this._cr*this.scale.y,i=this.position.x-e*c-d*f,j=this.position.y-h*d-c*g,k=a.a,l=a.b,m=a.c,n=a.d;b.a=k*e+l*g,b.b=k*f+l*h,b.tx=k*i+l*j+a.tx,b.c=m*e+n*g,b.d=m*f+n*h,b.ty=m*i+n*j+a.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},b.DisplayObject.prototype.getBounds=function(a){return a=a,b.EmptyRectangle},b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)},b.DisplayObject.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0)},b.DisplayObject.prototype.generateTexture=function(a){var c=this.getLocalBounds(),d=new b.RenderTexture(0|c.width,0|c.height,a);return d.render(this,new b.Point(-c.x,-c.y)),d},b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},b.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha,a.gl?b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):b.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)},b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var c=new b.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new b.Sprite(c),this._cachedSprite.worldTransform=this.worldTransform}var d=this._filters;this._filters=null,this._cachedSprite.filters=d,this._cachedSprite.texture.render(this,new b.Point(-a.x,-a.y)),this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._filters=d,this._cacheAsBitmap=!0},b.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},b.DisplayObject.prototype._renderWebGL=function(a){a=a},b.DisplayObject.prototype._renderCanvas=function(a){a=a},Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),b.DisplayObjectContainer=function(){b.DisplayObject.call(this),this.children=[]},b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype),b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer,Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){this.scale.x=a/(this.getLocalBounds().width/this.scale.x),this._width=a}}),Object.defineProperty(b.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){this.scale.y=a/(this.getLocalBounds().height/this.scale.y),this._height=a}}),b.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)},b.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage),a;throw new Error(a+" The index "+b+" supplied is out of bounds "+this.children.length)},b.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.children.indexOf(a),d=this.children.indexOf(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a}},b.DisplayObjectContainer.prototype.getChildAt=function(a){if(a>=0&&a<this.children.length)return this.children[a];throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller")},b.DisplayObjectContainer.prototype.removeChild=function(a){return this.removeChildAt(this.children.indexOf(a))},b.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.stage&&b.removeStageReference(),b.parent=void 0,this.children.splice(a,1),b},b.DisplayObjectContainer.prototype.removeChildren=function(a,b){var c=a||0,d="number"==typeof b?b:this.children.length,e=d-c;if(e>0&&d>=e){for(var f=this.children.splice(c,e),g=0;g<f.length;g++){var h=f[g];this.stage&&h.removeStageReference(),h.parent=void 0}return f}throw new Error("Range Error, numeric values are outside the acceptable range")},b.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(b.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,c=this.children.length;c>a;a++)this.children[a].updateTransform()},b.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return b.EmptyRectangle;if(a){var c=this.worldTransform;this.worldTransform=a,this.updateTransform(),this.worldTransform=c}for(var d,e,f,g=1/0,h=1/0,i=-1/0,j=-1/0,k=!1,l=0,m=this.children.length;m>l;l++){var n=this.children[l];n.visible&&(k=!0,d=this.children[l].getBounds(a),g=g<d.x?g:d.x,h=h<d.y?h:d.y,e=d.width+d.x,f=d.height+d.y,i=i>e?i:e,j=j>f?j:f)}if(!k)return b.EmptyRectangle;var o=this._bounds;return o.x=g,o.y=h,o.width=i-g,o.height=j-h,o},b.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=b.identityMatrix;for(var c=0,d=this.children.length;d>c;c++)this.children[c].updateTransform();var e=this.getBounds();return this.worldTransform=a,e},b.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d.setStageReference(a)}},b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;b>a;a++){var c=this.children[a];c.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},b.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b,c;if(this._mask||this._filters){for(this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),a.spriteBatch.start()}else for(b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},b.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d._renderCanvas(a)}this._mask&&a.maskManager.popMask(a.context)}},b.Sprite=function(a){b.DisplayObjectContainer.call(this),this.anchor=new b.Point,this.texture=a,this._width=0,this._height=0,this.tint=16777215,this.blendMode=b.blendModes.NORMAL,a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Sprite.prototype.constructor=b.Sprite,Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),b.Sprite.prototype.setTexture=function(a){this.texture.baseTexture!==a.baseTexture?(this.textureChange=!0,this.texture=a):this.texture=a,this.cachedTint=16777215},b.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},b.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),e=b*-this.anchor.x,f=c*(1-this.anchor.y),g=c*-this.anchor.y,h=a||this.worldTransform,i=h.a,j=h.c,k=h.b,l=h.d,m=h.tx,n=h.ty,o=i*e+k*g+m,p=l*g+j*e+n,q=i*d+k*g+m,r=l*g+j*d+n,s=i*d+k*f+m,t=l*f+j*d+n,u=i*e+k*f+m,v=l*f+j*e+n,w=-1/0,x=-1/0,y=1/0,z=1/0;y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,z=z>p?p:z,z=z>r?r:z,z=z>t?t:z,z=z>v?v:z,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,x=p>x?p:x,x=r>x?r:x,x=t>x?t:x,x=v>x?v:x;var A=this._bounds;return A.x=y,A.width=w-y,A.y=z,A.height=x-z,this._currentBounds=A,A},b.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),d.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);d.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},b.Sprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),this.texture.valid){a.context.globalAlpha=this.worldAlpha,a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty),a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===b.scaleModes.LINEAR);var c=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,d=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,c,d,this.texture.crop.width,this.texture.crop.height)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c,d,this.texture.crop.width,this.texture.crop.height)}for(var e=0,f=this.children.length;f>e;e++)this.children[e]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}},b.Sprite.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw new Error('The frameId "'+a+'" does not exist in the texture cache'+this);return new b.Sprite(c)},b.Sprite.fromImage=function(a,c,d){var e=b.Texture.fromImage(a,c,d);return new b.Sprite(e)},b.SpriteBatch=function(a){b.DisplayObjectContainer.call(this),this.textureThing=a,this.ready=!1},b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype),b.SpriteBatch.constructor=b.SpriteBatch,b.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(a),this.ready=!0},b.SpriteBatch.prototype.updateTransform=function(){b.DisplayObject.prototype.updateTransform.call(this)},b.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())},b.SpriteBatch.prototype._renderCanvas=function(a){var c=a.context;c.globalAlpha=this.worldAlpha,b.DisplayObject.prototype.updateTransform.call(this);for(var d=this.worldTransform,e=!0,f=0;f<this.children.length;f++){var g=this.children[f];if(g.visible){var h=g.texture,i=h.frame;if(c.globalAlpha=this.worldAlpha*g.alpha,g.rotation%(2*Math.PI)===0)e&&(c.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty),e=!1),c.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width*g.scale.x+g.position.x+.5|0,g.anchor.y*-i.height*g.scale.y+g.position.y+.5|0,i.width*g.scale.x,i.height*g.scale.y);else{e||(e=!0),b.DisplayObject.prototype.updateTransform.call(g);var j=g.worldTransform;a.roundPixels?c.setTransform(j.a,j.c,j.b,j.d,0|j.tx,0|j.ty):c.setTransform(j.a,j.c,j.b,j.d,j.tx,j.ty),c.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width+.5|0,g.anchor.y*-i.height+.5|0,i.width,i.height)}}}},b.AbstractFilter=function(a,b){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=b||{},this.fragmentSrc=a||[]},b.FilterBlock=function(){this.visible=!0,this.renderable=!0},b.Text=function(a,c){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),b.Sprite.call(this,b.Texture.fromCanvas(this.canvas)),this.setText(a),this.setStyle(c),this.updateText(),this.dirty=!1},b.Text.prototype=Object.create(b.Sprite.prototype),b.Text.prototype.constructor=b.Text,b.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,a.wordWrapWidth=a.wordWrapWidth||100,a.dropShadow=a.dropShadow||!1,a.dropShadowAngle=a.dropShadowAngle||Math.PI/6,a.dropShadowDistance=a.dropShadowDistance||4,a.dropShadowColor=a.dropShadowColor||"black",this.style=a,this.dirty=!0},b.Text.prototype.setText=function(a){this.text=a.toString()||" ",this.dirty=!0},b.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],d=0,e=0;e<b.length;e++){var f=this.context.measureText(b[e]).width;c[e]=f,d=Math.max(d,f)}var g=d+this.style.strokeThickness;this.style.dropShadow&&(g+=this.style.dropShadowDistance),this.canvas.width=g+this.context.lineWidth;var h=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,i=h*b.length;this.style.dropShadow&&(i+=this.style.dropShadowDistance),this.canvas.height=i,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top";var j,k;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var l=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,m=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(e=0;e<b.length;e++)j=this.style.strokeThickness/2,k=this.style.strokeThickness/2+e*h,"right"===this.style.align?j+=d-c[e]:"center"===this.style.align&&(j+=(d-c[e])/2),this.style.fill&&this.context.fillText(b[e],j+l,k+m)}for(this.context.fillStyle=this.style.fill,e=0;e<b.length;e++)j=this.style.strokeThickness/2,k=this.style.strokeThickness/2+e*h,"right"===this.style.align?j+=d-c[e]:"center"===this.style.align&&(j+=(d-c[e])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[e],j,k),this.style.fill&&this.context.fillText(b[e],j,k);this.updateTexture()},b.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},b.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,b.updateWebGLTexture(this.texture.baseTexture,a.gl)),b.Sprite.prototype._renderWebGL.call(this,a)},b.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),b.Sprite.prototype.updateTransform.call(this)},b.Text.prototype.determineFontHeight=function(a){var c=b.Text.heightCache[a];if(!c){var d=document.getElementsByTagName("body")[0],e=document.createElement("div"),f=document.createTextNode("M");e.appendChild(f),e.setAttribute("style",a+";position:absolute;top:0;left:0"),d.appendChild(e),c=e.offsetHeight,b.Text.heightCache[a]=c,d.removeChild(e)}return c},b.Text.prototype.wordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;0===g||i>e?(g>0&&(b+="\n"),b+=f[g],e=this.style.wordWrapWidth-h):(e-=i,b+=" "+f[g])}d<c.length-1&&(b+="\n")}return b},b.Text.prototype.destroy=function(a){this.context=null,this.canvas=null,this.texture.destroy(void 0===a?!0:a)},b.Text.heightCache={},b.BitmapText=function(a,c){b.DisplayObjectContainer.call(this),this._pool=[],this.setText(a),this.setStyle(c),this.updateText(),this.dirty=!1},b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype),b.BitmapText.prototype.constructor=b.BitmapText,b.BitmapText.prototype.setText=function(a){this.text=a||" ",this.dirty=!0},b.BitmapText.prototype.setStyle=function(a){a=a||{},a.align=a.align||"left",this.style=a;var c=a.font.split(" ");this.fontName=c[c.length-1],this.fontSize=c.length>=2?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=a.tint},b.BitmapText.prototype.updateText=function(){for(var a=b.BitmapText.fonts[this.fontName],c=new b.Point,d=null,e=[],f=0,g=[],h=0,i=this.fontSize/a.size,j=0;j<this.text.length;j++){var k=this.text.charCodeAt(j);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(j)))g.push(c.x),f=Math.max(f,c.x),h++,c.x=0,c.y+=a.lineHeight,d=null;else{var l=a.chars[k];l&&(d&&l[d]&&(c.x+=l.kerning[d]),e.push({texture:l.texture,line:h,charCode:k,position:new b.Point(c.x+l.xOffset,c.y+l.yOffset)}),c.x+=l.xAdvance,d=k)}}g.push(c.x),f=Math.max(f,c.x);var m=[];for(j=0;h>=j;j++){var n=0;"right"===this.style.align?n=f-g[j]:"center"===this.style.align&&(n=(f-g[j])/2),m.push(n)}var o=this.children.length,p=e.length,q=this.tint||16777215;for(j=0;p>j;j++){var r=o>j?this.children[j]:this._pool.pop();r?r.setTexture(e[j].texture):r=new b.Sprite(e[j].texture),r.position.x=(e[j].position.x+m[e[j].line])*i,r.position.y=e[j].position.y*i,r.scale.x=r.scale.y=i,r.tint=q,r.parent||this.addChild(r)}for(;this.children.length>p;){var s=this.getChildAt(this.children.length-1);this._pool.push(s),this.removeChild(s)}this.textWidth=f*i,this.textHeight=(c.y+a.lineHeight)*i},b.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),b.DisplayObjectContainer.prototype.updateTransform.call(this)},b.BitmapText.fonts={},b.Stage=function(a){b.DisplayObjectContainer.call(this),this.worldTransform=new b.Matrix,this.interactive=!0,this.interactionManager=new b.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new b.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(a)},b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Stage.prototype.constructor=b.Stage,b.Stage.prototype.setInteractionDelegate=function(a){this.interactionManager.setTargetDomElement(a)},b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},b.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0,this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);var c=this.backgroundColor.toString(16);c="000000".substr(0,6-c.length)+c,this.backgroundColorString="#"+c},b.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var c=0,d=["ms","moz","webkit","o"],e=0;e<d.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[d[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[e]+"CancelAnimationFrame"]||window[d[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),d=Math.max(0,16-(b-c)),e=window.setTimeout(function(){a(b+d)},d);return c=b+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),window.requestAnimFrame=window.requestAnimationFrame,b.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},b.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}()),b.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}},b.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1,a.height=1;var b=a.getContext("2d");return b.fillStyle="#000",b.fillRect(0,0,1,1),b.globalCompositeOperation="multiply",b.fillStyle="#fff",b.fillRect(0,0,1,1),0===b.getImageData(0,0,1,1).data[0]},b.getNextPowerOfTwo=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b},b.EventTarget=function(){var a={};this.addEventListener=this.on=function(b,c){void 0===a[b]&&(a[b]=[]),-1===a[b].indexOf(c)&&a[b].unshift(c)},this.dispatchEvent=this.emit=function(b){if(a[b.type]&&a[b.type].length)for(var c=a[b.type].length-1;c>=0;c--)a[b.type][c](b)},this.removeEventListener=this.off=function(b,c){if(void 0!==a[b]){var d=a[b].indexOf(c);-1!==d&&a[b].splice(d,1)}},this.removeAllEventListeners=function(b){var c=a[b];c&&(c.length=0)}},b.PolyK={},b.PolyK.Triangulate=function(a){var c=!0,d=a.length>>1;if(3>d)return[];for(var e=[],f=[],g=0;d>g;g++)f.push(g);g=0;for(var h=d;h>3;){var i=f[(g+0)%h],j=f[(g+1)%h],k=f[(g+2)%h],l=a[2*i],m=a[2*i+1],n=a[2*j],o=a[2*j+1],p=a[2*k],q=a[2*k+1],r=!1;if(b.PolyK._convex(l,m,n,o,p,q,c)){r=!0;for(var s=0;h>s;s++){var t=f[s];if(t!==i&&t!==j&&t!==k&&b.PolyK._PointInTriangle(a[2*t],a[2*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)e.push(i,j,k),f.splice((g+1)%h,1),h--,g=0;else if(g++>3*h){if(!c)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(e=[],f=[],g=0;d>g;g++)f.push(g);g=0,h=d,c=!1}}return e.push(f[0],f[1],f[2]),e},b.PolyK._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},b.PolyK._convex=function(a,b,c,d,e,f,g){return(b-d)*(e-c)+(c-a)*(f-d)>=0===g},b.initDefaultShaders=function(){},b.CompileVertexShader=function(a,c){return b._CompileShader(a,c,a.VERTEX_SHADER)},b.CompileFragmentShader=function(a,c){return b._CompileShader(a,c,a.FRAGMENT_SHADER)},b._CompileShader=function(a,b,c){var d=b.join("\n"),e=a.createShader(c);return a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)?e:(window.console.log(a.getShaderInfoLog(e)),null)},b.compileProgram=function(a,c,d){var e=b.CompileFragmentShader(a,d),f=b.CompileVertexShader(a,c),g=a.createProgram();return a.attachShader(g,f),a.attachShader(g,e),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),g},b.PixiShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},b.PixiShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.dimensions=a.getUniformLocation(c,"dimensions"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(c,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var d in this.uniforms)this.uniforms[d].uniformLocation=a.getUniformLocation(c,d);this.initUniforms(),this.program=c},b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms){a=this.uniforms[c];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=b.uniformMatrix2fv:"mat3"===d?a.glFunc=b.uniformMatrix3fv:"mat4"===d&&(a.glFunc=b.uniformMatrix4fv)):(a.glFunc=b["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}},b.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,e=c.minFilter?c.minFilter:b.LINEAR,f=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?c.wrapT:b.CLAMP_TO_EDGE,h=c.luminance?b.LUMINANCE:b.RGBA; if(c.repeat&&(f=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width){var i=c.width?c.width:512,j=c.height?c.height:2,k=c.border?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount),a._init=!0,this.textureCount++}},b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,c=this.gl;for(var d in this.uniforms)a=this.uniforms[d],1===a.glValueLength?a.glMatrix===!0?a.glFunc.call(c,a.uniformLocation,a.transpose,a.value):a.glFunc.call(c,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(c.activeTexture(c["TEXTURE"+this.textureCount]),c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]||b.createWebGLTexture(a.value.baseTexture,c)),c.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))},b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],b.PixiFastShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},b.PixiFastShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.dimensions=a.getUniformLocation(c,"dimensions"),this.uMatrix=a.getUniformLocation(c,"uMatrix"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(c,"aPositionCoord"),this.aScale=a.getAttribLocation(c,"aScale"),this.aRotation=a.getAttribLocation(c,"aRotation"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(c,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=c},b.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.StripShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},b.StripShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.PrimitiveShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},b.PrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.tintColor=a.getUniformLocation(c,"tint"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},b.ComplexPrimitiveShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},b.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.tintColor=a.getUniformLocation(c,"tint"),this.color=a.getUniformLocation(c,"color"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},b.WebGLGraphics=function(){},b.WebGLGraphics.renderGraphics=function(a,c){var d,e=c.gl,f=c.projection,g=c.offset,h=c.shaderManager.primitiveShader;a.dirty&&b.WebGLGraphics.updateGraphics(a,e);for(var i=a._webGL[e.id],j=0;j<i.data.length;j++)1===i.data[j].mode?(d=i.data[j],c.stencilManager.pushStencil(a,d,c),e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,2*(d.indices.length-4)),c.stencilManager.popStencil(a,d,c),this.last=d.mode):(d=i.data[j],c.shaderManager.setShader(h),h=c.shaderManager.primitiveShader,e.uniformMatrix3fv(h.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(h.projectionVector,f.x,-f.y),e.uniform2f(h.offsetVector,-g.x,-g.y),e.uniform3fv(h.tintColor,b.hex2rgb(a.tint)),e.uniform1f(h.alpha,a.worldAlpha),e.bindBuffer(e.ARRAY_BUFFER,d.buffer),e.vertexAttribPointer(h.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(h.colorAttribute,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d.indexBuffer),e.drawElements(e.TRIANGLE_STRIP,d.indices.length,e.UNSIGNED_SHORT,0))},b.WebGLGraphics.updateGraphics=function(a,c){var d=a._webGL[c.id];d||(d=a._webGL[c.id]={lastIndex:0,data:[],gl:c}),a.dirty=!1;var e;if(a.clearDirty){for(a.clearDirty=!1,e=0;e<d.data.length;e++){var f=d.data[e];f.reset(),b.WebGLGraphics.graphicsDataPool.push(f)}d.data=[],d.lastIndex=0}var g;for(e=d.lastIndex;e<a.graphicsData.length;e++){var h=a.graphicsData[e];h.type===b.Graphics.POLY?(h.fill&&h.points.length>6&&(h.points.length>10?(g=b.WebGLGraphics.switchMode(d,1),b.WebGLGraphics.buildComplexPoly(h,g)):(g=b.WebGLGraphics.switchMode(d,0),b.WebGLGraphics.buildPoly(h,g))),h.lineWidth>0&&(g=b.WebGLGraphics.switchMode(d,0),b.WebGLGraphics.buildLine(h,g))):(g=b.WebGLGraphics.switchMode(d,0),h.type===b.Graphics.RECT?b.WebGLGraphics.buildRectangle(h,g):h.type===b.Graphics.CIRC||h.type===b.Graphics.ELIP?b.WebGLGraphics.buildCircle(h,g):h.type===b.Graphics.RREC&&b.WebGLGraphics.buildRoundedRectangle(h,d)),d.lastIndex++}for(e=0;e<d.data.length;e++)g=d.data[e],g.dirty&&g.upload()},b.WebGLGraphics.switchMode=function(a,c){var d;return a.data.length?(d=a.data[a.data.length-1],(d.mode!==c||1===c)&&(d=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),d.mode=c,a.data.push(d))):(d=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),d.mode=c,a.data.push(d)),d.dirty=!0,d},b.WebGLGraphics.buildRectangle=function(a,c){var d=a.points,e=d[0],f=d[1],g=d[2],h=d[3];if(a.fill){var i=b.hex2rgb(a.fillColor),j=a.fillAlpha,k=i[0]*j,l=i[1]*j,m=i[2]*j,n=c.points,o=c.indices,p=n.length/6;n.push(e,f),n.push(k,l,m,j),n.push(e+g,f),n.push(k,l,m,j),n.push(e,f+h),n.push(k,l,m,j),n.push(e+g,f+h),n.push(k,l,m,j),o.push(p,p,p+1,p+2,p+3,p+3)}if(a.lineWidth){var q=a.points;a.points=[e,f,e+g,f,e+g,f+h,e,f+h,e,f],b.WebGLGraphics.buildLine(a,c),a.points=q}},b.WebGLGraphics.buildRoundedRectangle=function(a,c){function d(a,b,c,d,e,f){function g(a,b,c){var d=b-a;return a+d*c}for(var h,i,j,k,l,m,n=20,o=[],p=0,q=0;n>=q;q++)p=q/n,h=g(a,c,p),i=g(b,d,p),j=g(c,e,p),k=g(d,f,p),l=g(h,j,p),m=g(i,k,p),o.push(l,m);return o}var e=a.points,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=[];if(k.push(f,g+j),k=k.concat(d(f,g+i-j,f,g+i,f+j,g+i)),k=k.concat(d(f+h-j,g+i,f+h,g+i,f+h,g+i-j)),k=k.concat(d(f+h,g+j,f+h,g,f+h-j,g)),k=k.concat(d(f+j,g,f,g,f,g+j)),a.fill){var l=b.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=c.points,r=c.indices,s=q.length/6,t=b.PolyK.Triangulate(k),u=0;for(u=0;u<t.length;u+=3)r.push(t[u]+s),r.push(t[u]+s),r.push(t[u+1]+s),r.push(t[u+2]+s),r.push(t[u+2]+s);for(u=0;u<k.length;u++)q.push(k[u],k[++u],n,o,p,m)}if(a.lineWidth){var v=a.points;a.points=k,b.WebGLGraphics.buildLine(a,c),a.points=v}},b.WebGLGraphics.buildCircle=function(a,c){var d=a.points,e=d[0],f=d[1],g=d[2],h=d[3],i=40,j=2*Math.PI/i,k=0;if(a.fill){var l=b.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=c.points,r=c.indices,s=q.length/6;for(r.push(s),k=0;i+1>k;k++)q.push(e,f,n,o,p,m),q.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h,n,o,p,m),r.push(s++,s++);r.push(s-1)}if(a.lineWidth){var t=a.points;for(a.points=[],k=0;i+1>k;k++)a.points.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h);b.WebGLGraphics.buildLine(a,c),a.points=t}},b.WebGLGraphics.buildLine=function(a,c){var d=0,e=a.points;if(0!==e.length){if(a.lineWidth%2)for(d=0;d<e.length;d++)e[d]+=.5;var f=new b.Point(e[0],e[1]),g=new b.Point(e[e.length-2],e[e.length-1]);if(f.x===g.x&&f.y===g.y){e=e.slice(),e.pop(),e.pop(),g=new b.Point(e[e.length-2],e[e.length-1]);var h=g.x+.5*(f.x-g.x),i=g.y+.5*(f.y-g.y);e.unshift(h,i),e.push(h,i)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=c.points,H=c.indices,I=e.length/2,J=e.length,K=G.length/6,L=a.lineWidth/2,M=b.hex2rgb(a.lineColor),N=a.lineAlpha,O=M[0]*N,P=M[1]*N,Q=M[2]*N;for(l=e[0],m=e[1],n=e[2],o=e[3],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(l-r,m-s,O,P,Q,N),G.push(l+r,m+s,O,P,Q,N),d=1;I-1>d;d++)l=e[2*(d-1)],m=e[2*(d-1)+1],n=e[2*d],o=e[2*d+1],p=e[2*(d+1)],q=e[2*(d+1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,t=-(o-q),u=n-p,F=Math.sqrt(t*t+u*u),t/=F,u/=F,t*=L,u*=L,x=-s+m-(-s+o),y=-r+n-(-r+l),z=(-r+l)*(-s+o)-(-r+n)*(-s+m),A=-u+q-(-u+o),B=-t+n-(-t+p),C=(-t+p)*(-u+o)-(-t+n)*(-u+q),D=x*B-A*y,Math.abs(D)<.1?(D+=10.1,G.push(n-r,o-s,O,P,Q,N),G.push(n+r,o+s,O,P,Q,N)):(j=(y*C-B*z)/D,k=(A*z-x*C)/D,E=(j-n)*(j-n)+(k-o)+(k-o),E>19600?(v=r-t,w=s-u,F=Math.sqrt(v*v+w*w),v/=F,w/=F,v*=L,w*=L,G.push(n-v,o-w),G.push(O,P,Q,N),G.push(n+v,o+w),G.push(O,P,Q,N),G.push(n-v,o-w),G.push(O,P,Q,N),J++):(G.push(j,k),G.push(O,P,Q,N),G.push(n-(j-n),o-(k-o)),G.push(O,P,Q,N)));for(l=e[2*(I-2)],m=e[2*(I-2)+1],n=e[2*(I-1)],o=e[2*(I-1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(n-r,o-s),G.push(O,P,Q,N),G.push(n+r,o+s),G.push(O,P,Q,N),H.push(K),d=0;J>d;d++)H.push(K++);H.push(K-1)}},b.WebGLGraphics.buildComplexPoly=function(a,c){var d=a.points.slice();if(!(d.length<6)){var e=c.indices;c.points=d,c.alpha=a.fillAlpha,c.color=b.hex2rgb(a.fillColor);for(var f,g,h=1/0,i=-1/0,j=1/0,k=-1/0,l=0;l<d.length;l+=2)f=d[l],g=d[l+1],h=h>f?f:h,i=f>i?f:i,j=j>g?g:j,k=g>k?g:k;d.push(h,j,i,j,i,k,h,k);var m=d.length/2;for(l=0;m>l;l++)e.push(l)}},b.WebGLGraphics.buildPoly=function(a,c){var d=a.points;if(!(d.length<6)){var e=c.points,f=c.indices,g=d.length/2,h=b.hex2rgb(a.fillColor),i=a.fillAlpha,j=h[0]*i,k=h[1]*i,l=h[2]*i,m=b.PolyK.Triangulate(d),n=e.length/6,o=0;for(o=0;o<m.length;o+=3)f.push(m[o]+n),f.push(m[o]+n),f.push(m[o+1]+n),f.push(m[o+2]+n),f.push(m[o+2]+n);for(o=0;g>o;o++)e.push(d[2*o],d[2*o+1],j,k,l,i)}},b.WebGLGraphics.graphicsDataPool=[],b.WebGLGraphicsData=function(a){this.gl=a,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},b.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},b.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW),this.dirty=!1},b.glContexts=[],b.WebGLRenderer=function(a,c,d,e,f,g){b.defaultRenderer||(b.sayHello("webGL"),b.defaultRenderer=this),this.type=b.WEBGL_RENDERER,this.transparent=!!e,this.preserveDrawingBuffer=g,this.width=a||800,this.height=c||600,this.view=d||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!e,stencil:!0,preserveDrawingBuffer:g};var h=null;if(["experimental-webgl","webgl"].forEach(function(a){try{h=h||this.view.getContext(a,this.options)}catch(b){}},this),!h)throw new Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=h,this.glContextId=h.id=b.WebGLRenderer.glContextId++,b.glContexts[this.glContextId]=h,b.blendModesWebGL||(b.blendModesWebGL=[],b.blendModesWebGL[b.blendModes.NORMAL]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.ADD]=[h.SRC_ALPHA,h.DST_ALPHA],b.blendModesWebGL[b.blendModes.MULTIPLY]=[h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SCREEN]=[h.SRC_ALPHA,h.ONE],b.blendModesWebGL[b.blendModes.OVERLAY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DARKEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LIGHTEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_BURN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DIFFERENCE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.EXCLUSION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HUE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SATURATION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LUMINOSITY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA]),this.projection=new b.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new b.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new b.WebGLShaderManager(h),this.spriteBatch=new b.WebGLSpriteBatch(h),this.maskManager=new b.WebGLMaskManager(h),this.filterManager=new b.WebGLFilterManager(h,this.transparent),this.stencilManager=new b.WebGLStencilManager(h),this.blendModeManager=new b.WebGLBlendModeManager(h),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,h.useProgram(this.shaderManager.defaultShader.program),h.disable(h.DEPTH_TEST),h.disable(h.CULL_FACE),h.enable(h.BLEND),h.colorMask(!0,!0,!0,this.transparent)},b.WebGLRenderer.prototype.constructor=b.WebGLRenderer,b.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a),b.WebGLRenderer.updateTextures(),a.updateTransform(),a._interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));var c=this.gl;c.viewport(0,0,this.width,this.height),c.bindFramebuffer(c.FRAMEBUFFER,null),this.transparent?c.clearColor(0,0,0,0):c.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),c.clear(c.COLOR_BUFFER_BIT),this.renderDisplayObject(a,this.projection),a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}},b.WebGLRenderer.prototype.renderDisplayObject=function(a,c,d){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=c,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,d),a._renderWebGL(this.renderSession),this.spriteBatch.end()},b.WebGLRenderer.updateTextures=function(){var a=0;for(a=0;a<b.Texture.frameUpdates.length;a++)b.WebGLRenderer.updateTextureFrame(b.Texture.frameUpdates[a]);for(a=0;a<b.texturesToDestroy.length;a++)b.WebGLRenderer.destroyTexture(b.texturesToDestroy[a]);b.texturesToUpdate.length=0,b.texturesToDestroy.length=0,b.Texture.frameUpdates.length=0},b.WebGLRenderer.destroyTexture=function(a){for(var c=a._glTextures.length-1;c>=0;c--){var d=a._glTextures[c],e=b.glContexts[c];e&&d&&e.deleteTexture(d)}a._glTextures.length=0},b.WebGLRenderer.updateTextureFrame=function(a){a._updateWebGLuvs()},b.WebGLRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},b.createWebGLTexture=function(a,c){return a.hasLoaded&&(a._glTextures[c.id]=c.createTexture(),c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),c.bindTexture(c.TEXTURE_2D,null),a._dirty[c.id]=!1),a._glTextures[c.id]},b.updateWebGLTexture=function(a,c){a._glTextures[c.id]&&(c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),a._dirty[c.id]=!1)},b.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault(),this.contextLost=!0},b.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(c){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var d=this.gl;d.id=b.WebGLRenderer.glContextId++,this.shaderManager.setContext(d),this.spriteBatch.setContext(d),this.primitiveBatch.setContext(d),this.maskManager.setContext(d),this.filterManager.setContext(d),this.renderSession.gl=this.gl,d.disable(d.DEPTH_TEST),d.disable(d.CULL_FACE),d.enable(d.BLEND),d.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var e in b.TextureCache){var f=b.TextureCache[e].baseTexture;f._glTextures=[]}this.contextLost=!1},b.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),b.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.primitiveBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},b.WebGLRenderer.glContextId=0,b.WebGLBlendModeManager=function(a){this.gl=a,this.currentBlendMode=99999},b.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;var c=b.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(c[0],c[1]),!0},b.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},b.WebGLMaskManager=function(a){this.maskStack=[],this.maskPosition=0,this.setContext(a),this.reverse=!1,this.count=0},b.WebGLMaskManager.prototype.setContext=function(a){this.gl=a},b.WebGLMaskManager.prototype.pushMask=function(a,c){var d=c.gl;a.dirty&&b.WebGLGraphics.updateGraphics(a,d),a._webGL[d.id].data.length&&c.stencilManager.pushStencil(a,a._webGL[d.id].data[0],c)},b.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)},b.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},b.WebGLStencilManager=function(a){this.stencilStack=[],this.setContext(a),this.reverse=!0,this.count=0},b.WebGLStencilManager.prototype.setContext=function(a){this.gl=a},b.WebGLStencilManager.prototype.pushStencil=function(a,b,c){var d=this.gl;this.bindGraphics(a,b,c),0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(b);var e=this.count;d.colorMask(!1,!1,!1,!1),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),1===b.mode?(d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(e+1),255):d.stencilFunc(d.EQUAL,e+1,255),this.reverse=!this.reverse):(this.reverse?(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e+1,255):d.stencilFunc(d.EQUAL,255-(e+1),255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),this.count++},b.WebGLStencilManager.prototype.bindGraphics=function(a,c,d){this._currentGraphics=a;var e,f=this.gl,g=d.projection,h=d.offset;1===c.mode?(e=d.shaderManager.complexPrimativeShader,d.shaderManager.setShader(e),f.uniformMatrix3fv(e.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(e.projectionVector,g.x,-g.y),f.uniform2f(e.offsetVector,-h.x,-h.y),f.uniform3fv(e.tintColor,b.hex2rgb(a.tint)),f.uniform3fv(e.color,c.color),f.uniform1f(e.alpha,a.worldAlpha*c.alpha),f.bindBuffer(f.ARRAY_BUFFER,c.buffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,8,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer)):(e=d.shaderManager.primitiveShader,d.shaderManager.setShader(e),f.uniformMatrix3fv(e.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(e.projectionVector,g.x,-g.y),f.uniform2f(e.offsetVector,-h.x,-h.y),f.uniform3fv(e.tintColor,b.hex2rgb(a.tint)),f.uniform1f(e.alpha,a.worldAlpha),f.bindBuffer(f.ARRAY_BUFFER,c.buffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,24,0),f.vertexAttribPointer(e.colorAttribute,4,f.FLOAT,!1,24,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer))},b.WebGLStencilManager.prototype.popStencil=function(a,b,c){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var e=this.count;this.bindGraphics(a,b,c),d.colorMask(!1,!1,!1,!1),1===b.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)):(this.reverse?(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}},b.WebGLStencilManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},b.WebGLShaderManager=function(a){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.shaderMap=[];for(var b=0;b<this.maxAttibs;b++)this.attribState[b]=!1;this.setContext(a)},b.WebGLShaderManager.prototype.setContext=function(a){this.gl=a,this.primitiveShader=new b.PrimitiveShader(a),this.complexPrimativeShader=new b.ComplexPrimitiveShader(a),this.defaultShader=new b.PixiShader(a),this.fastShader=new b.PixiFastShader(a),this.stripShader=new b.StripShader(a),this.setShader(this.defaultShader)},b.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++){var c=a[b];this.tempAttribState[c]=!0}var d=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?d.enableVertexAttribArray(b):d.disableVertexAttribArray(b))},b.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)},b.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},b.WebGLSpriteBatch=function(a){this.vertSize=6,this.size=2e3;var b=4*this.size*this.vertSize,c=6*this.size;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(a),this.dirty=!0},b.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999},b.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},b.WebGLSpriteBatch.prototype.end=function(){this.flush()},b.WebGLSpriteBatch.prototype.render=function(a){var b=a.texture,c=this.renderSession.blendModeManager.currentBlendMode!==a.blendMode;(b.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size||c)&&(this.flush(),this.currentBaseTexture=b.baseTexture,this.renderSession.blendModeManager.setBlendMode(a.blendMode));var d=b._uvs;if(d){var e,f,g,h,i=a.worldAlpha,j=a.tint,k=this.vertices,l=a.anchor.x,m=a.anchor.y;if(b.trim){var n=b.trim;f=n.x-l*n.width,e=f+b.crop.width,h=n.y-m*n.height,g=h+b.crop.height}else e=b.frame.width*(1-l),f=b.frame.width*-l,g=b.frame.height*(1-m),h=b.frame.height*-m;var o=4*this.currentBatchSize*this.vertSize,p=a.worldTransform,q=p.a,r=p.c,s=p.b,t=p.d,u=p.tx,v=p.ty;k[o++]=q*f+s*h+u,k[o++]=t*h+r*f+v,k[o++]=d.x0,k[o++]=d.y0,k[o++]=i,k[o++]=j,k[o++]=q*e+s*h+u,k[o++]=t*h+r*e+v,k[o++]=d.x1,k[o++]=d.y1,k[o++]=i,k[o++]=j,k[o++]=q*e+s*g+u,k[o++]=t*g+r*e+v,k[o++]=d.x2,k[o++]=d.y2,k[o++]=i,k[o++]=j,k[o++]=q*f+s*g+u,k[o++]=t*g+r*f+v,k[o++]=d.x3,k[o++]=d.y3,k[o++]=i,k[o++]=j,this.currentBatchSize++ }},b.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var c=a.tilingTexture,d=this.renderSession.blendModeManager.currentBlendMode!==a.blendMode;(c.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size||d)&&(this.flush(),this.currentBaseTexture=c.baseTexture,this.renderSession.blendModeManager.setBlendMode(a.blendMode)),a._uvs||(a._uvs=new b.TextureUvs);var e=a._uvs;a.tilePosition.x%=c.baseTexture.width*a.tileScaleOffset.x,a.tilePosition.y%=c.baseTexture.height*a.tileScaleOffset.y;var f=a.tilePosition.x/(c.baseTexture.width*a.tileScaleOffset.x),g=a.tilePosition.y/(c.baseTexture.height*a.tileScaleOffset.y),h=a.width/c.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),i=a.height/c.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);e.x0=0-f,e.y0=0-g,e.x1=1*h-f,e.y1=0-g,e.x2=1*h-f,e.y2=1*i-g,e.x3=0-f,e.y3=1*i-g;var j=a.worldAlpha,k=a.tint,l=this.vertices,m=a.width,n=a.height,o=a.anchor.x,p=a.anchor.y,q=m*(1-o),r=m*-o,s=n*(1-p),t=n*-p,u=4*this.currentBatchSize*this.vertSize,v=a.worldTransform,w=v.a,x=v.c,y=v.b,z=v.d,A=v.tx,B=v.ty;l[u++]=w*r+y*t+A,l[u++]=z*t+x*r+B,l[u++]=e.x0,l[u++]=e.y0,l[u++]=j,l[u++]=k,l[u++]=w*q+y*t+A,l[u++]=z*t+x*q+B,l[u++]=e.x1,l[u++]=e.y1,l[u++]=j,l[u++]=k,l[u++]=w*q+y*s+A,l[u++]=z*s+x*q+B,l[u++]=e.x2,l[u++]=e.y2,l[u++]=j,l[u++]=k,l[u++]=w*r+y*s+A,l[u++]=z*s+x*r+B,l[u++]=e.x3,l[u++]=e.y3,l[u++]=j,l[u++]=k,this.currentBatchSize++},b.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty){this.dirty=!1,a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,c.x,c.y);var d=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,d,0),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,d,8),a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,d,16)}if(a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]||b.createWebGLTexture(this.currentBaseTexture,a)),this.currentBaseTexture._dirty[a.id]&&b.updateWebGLTexture(this.currentBaseTexture,a),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,e)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},b.WebGLSpriteBatch.prototype.stop=function(){this.flush()},b.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},b.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},b.WebGLFastSpriteBatch=function(a){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var b=4*this.size*this.vertSize,c=6*this.maxSize;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},b.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)},b.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},b.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children,c=b[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture,c.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(c.blendMode));for(var d=0,e=b.length;e>d;d++)this.renderSprite(b[d]);this.flush()}},b.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var b,c,d,e,f,g,h,i,j=this.vertices;if(b=a.texture._uvs,c=a.texture.frame.width,d=a.texture.frame.height,a.texture.trim){var k=a.texture.trim;f=k.x-a.anchor.x*k.width,e=f+a.texture.crop.width,h=k.y-a.anchor.y*k.height,g=h+a.texture.crop.height}else e=a.texture.frame.width*(1-a.anchor.x),f=a.texture.frame.width*-a.anchor.x,g=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y;i=4*this.currentBatchSize*this.vertSize,j[i++]=f,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x0,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x1,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x2,j[i++]=b.y2,j[i++]=a.alpha,j[i++]=f,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x3,j[i++]=b.y3,j[i++]=a.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},b.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||b.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,c)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},b.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,c,36)},b.WebGLFilterManager=function(a,b){this.transparent=b,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(a)},b.WebGLFilterManager.prototype.setContext=function(a){this.gl=a,this.texturePool=[],this.initShaderBuffers()},b.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x,this.height=2*-c.y,this.buffer=b},b.WebGLFilterManager.prototype.pushFilter=function(a){var c=this.gl,d=this.renderSession.projection,e=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds(),this.filterStack.push(a);var f=a.filterPasses[0];this.offsetX+=a._filterArea.x,this.offsetY+=a._filterArea.y;var g=this.texturePool.pop();g?g.resize(this.width,this.height):g=new b.FilterTexture(this.gl,this.width,this.height),c.bindTexture(c.TEXTURE_2D,g.texture);var h=a._filterArea,i=f.padding;h.x-=i,h.y-=i,h.width+=2*i,h.height+=2*i,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),c.bindFramebuffer(c.FRAMEBUFFER,g.frameBuffer),c.viewport(0,0,h.width,h.height),d.x=h.width/2,d.y=-h.height/2,e.x=-h.x,e.y=-h.y,this.renderSession.shaderManager.setShader(this.defaultShader),c.uniform2f(this.defaultShader.projectionVector,h.width/2,-h.height/2),c.uniform2f(this.defaultShader.offsetVector,-h.x,-h.y),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT),a._glFilterTexture=g},b.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,c=this.filterStack.pop(),d=c._filterArea,e=c._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(c.filterPasses.length>1){a.viewport(0,0,d.width,d.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=d.height,this.vertexArray[2]=d.width,this.vertexArray[3]=d.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=d.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=d.width/this.width,this.uvArray[5]=d.height/this.height,this.uvArray[6]=d.width/this.width,this.uvArray[7]=d.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=e,i=this.texturePool.pop();i||(i=new b.FilterTexture(this.gl,this.width,this.height)),i.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<c.filterPasses.length-1;j++){var k=c.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(k,d,d.width,d.height);var l=h;h=i,i=l}a.enable(a.BLEND),e=h,this.texturePool.push(i)}var m=c.filterPasses[c.filterPasses.length-1];this.offsetX-=d.x,this.offsetY-=d.y;var n=this.width,o=this.height,p=0,q=0,r=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var s=this.filterStack[this.filterStack.length-1];d=s._filterArea,n=d.width,o=d.height,p=d.x,q=d.y,r=s._glFilterTexture.frameBuffer}f.x=n/2,f.y=-o/2,g.x=p,g.y=q,d=c._filterArea;var t=d.x-p,u=d.y-q;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=t,this.vertexArray[1]=u+d.height,this.vertexArray[2]=t+d.width,this.vertexArray[3]=u+d.height,this.vertexArray[4]=t,this.vertexArray[5]=u,this.vertexArray[6]=t+d.width,this.vertexArray[7]=u,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=d.width/this.width,this.uvArray[5]=d.height/this.height,this.uvArray[6]=d.width/this.width,this.uvArray[7]=d.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,n,o),a.bindFramebuffer(a.FRAMEBUFFER,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,e.texture),this.applyFilterPass(m,d,n,o),this.renderSession.shaderManager.setShader(this.defaultShader),a.uniform2f(this.defaultShader.projectionVector,n/2,-o/2),a.uniform2f(this.defaultShader.offsetVector,-p,-q),this.texturePool.push(e),c._glFilterTexture=null},b.WebGLFilterManager.prototype.applyFilterPass=function(a,c,d,e){var f=this.gl,g=a.shaders[f.id];g||(g=new b.PixiShader(f),g.fragmentSrc=a.fragmentSrc,g.uniforms=a.uniforms,g.init(),a.shaders[f.id]=g),this.renderSession.shaderManager.setShader(g),f.uniform2f(g.projectionVector,d/2,-e/2),f.uniform2f(g.offsetVector,0,0),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),g.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(g.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(g.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(g.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},b.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},b.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var b=0;b<this.texturePool.length;b++)this.texturePool[b].destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)},b.FilterTexture=function(a,c,d,e){this.gl=a,this.frameBuffer=a.createFramebuffer(),this.texture=a.createTexture(),e=e||b.scaleModes.DEFAULT,a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),this.renderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer),this.resize(c,d)},b.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},b.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a,this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a,b)}},b.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer),a.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},b.CanvasMaskManager=function(){},b.CanvasMaskManager.prototype.pushMask=function(a,c){c.save();var d=a.alpha,e=a.worldTransform;c.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),b.CanvasGraphics.renderGraphicsMask(a,c),c.clip(),a.worldAlpha=d},b.CanvasMaskManager.prototype.popMask=function(a){a.restore()},b.CanvasTinter=function(){},b.CanvasTinter.getTintedTexture=function(a,c){var d=a.texture;c=b.CanvasTinter.roundColor(c);var e="#"+("00000"+(0|c).toString(16)).substr(-6);if(d.tintCache=d.tintCache||{},d.tintCache[e])return d.tintCache[e];var f=b.CanvasTinter.canvas||document.createElement("canvas");if(b.CanvasTinter.tintMethod(d,c,f),b.CanvasTinter.convertTintToImage){var g=new Image;g.src=f.toDataURL(),d.tintCache[e]=g}else d.tintCache[e]=f,b.CanvasTinter.canvas=null;return f},b.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="multiply",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},b.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},b.CanvasTinter.tintWithPerPixel=function(a,c,d){var e=d.getContext("2d"),f=a.frame;d.width=f.width,d.height=f.height,e.globalCompositeOperation="copy",e.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);for(var g=b.hex2rgb(c),h=g[0],i=g[1],j=g[2],k=e.getImageData(0,0,f.width,f.height),l=k.data,m=0;m<l.length;m+=4)l[m+0]*=h,l[m+1]*=i,l[m+2]*=j;e.putImageData(k,0,0)},b.CanvasTinter.roundColor=function(a){var c=b.CanvasTinter.cacheStepsPerColorChannel,d=b.hex2rgb(a);return d[0]=Math.min(255,d[0]/c*c),d[1]=Math.min(255,d[1]/c*c),d[2]=Math.min(255,d[2]/c*c),b.rgb2hex(d)},b.CanvasTinter.cacheStepsPerColorChannel=8,b.CanvasTinter.convertTintToImage=!1,b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes(),b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel,b.CanvasRenderer=function(a,c,d,e){b.defaultRenderer||(b.sayHello("Canvas"),b.defaultRenderer=this),this.type=b.CANVAS_RENDERER,this.clearBeforeRender=!0,this.transparent=!!e,b.blendModesCanvas||(b.blendModesCanvas=[],b.canUseNewCanvasBlendModes()?(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply",b.blendModesCanvas[b.blendModes.SCREEN]="screen",b.blendModesCanvas[b.blendModes.OVERLAY]="overlay",b.blendModesCanvas[b.blendModes.DARKEN]="darken",b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge",b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light",b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference",b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion",b.blendModesCanvas[b.blendModes.HUE]="hue",b.blendModesCanvas[b.blendModes.SATURATION]="saturation",b.blendModesCanvas[b.blendModes.COLOR]="color",b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"):(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over",b.blendModesCanvas[b.blendModes.SCREEN]="source-over",b.blendModesCanvas[b.blendModes.OVERLAY]="source-over",b.blendModesCanvas[b.blendModes.DARKEN]="source-over",b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over",b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over",b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over",b.blendModesCanvas[b.blendModes.HUE]="source-over",b.blendModesCanvas[b.blendModes.SATURATION]="source-over",b.blendModesCanvas[b.blendModes.COLOR]="source-over",b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over")),this.width=a||800,this.height=c||600,this.view=d||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new b.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")},b.CanvasRenderer.prototype.constructor=b.CanvasRenderer,b.CanvasRenderer.prototype.render=function(a){b.texturesToUpdate.length=0,b.texturesToDestroy.length=0,a.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(a),a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this))),b.Texture.frameUpdates.length>0&&(b.Texture.frameUpdates.length=0)},b.CanvasRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b},b.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context,a._renderCanvas(this.renderSession)},b.CanvasRenderer.prototype.renderStripFlat=function(a){var b=this.context,c=a.verticies,d=c.length/2;this.count++,b.beginPath();for(var e=1;d-2>e;e++){var f=2*e,g=c[f],h=c[f+2],i=c[f+4],j=c[f+1],k=c[f+3],l=c[f+5];b.moveTo(g,j),b.lineTo(h,k),b.lineTo(i,l)}b.fillStyle="#FF0000",b.fill(),b.closePath()},b.CanvasRenderer.prototype.renderStrip=function(a){var b=this.context,c=a.verticies,d=a.uvs,e=c.length/2;this.count++;for(var f=1;e-2>f;f++){var g=2*f,h=c[g],i=c[g+2],j=c[g+4],k=c[g+1],l=c[g+3],m=c[g+5],n=d[g]*a.texture.width,o=d[g+2]*a.texture.width,p=d[g+4]*a.texture.width,q=d[g+1]*a.texture.height,r=d[g+3]*a.texture.height,s=d[g+5]*a.texture.height;b.save(),b.beginPath(),b.moveTo(h,k),b.lineTo(i,l),b.lineTo(j,m),b.closePath(),b.clip();var t=n*r+q*p+o*s-r*p-q*o-n*s,u=h*r+q*j+i*s-r*j-q*i-h*s,v=n*i+h*p+o*j-i*p-h*o-n*j,w=n*r*j+q*i*p+h*o*s-h*r*p-q*o*j-n*i*s,x=k*r+q*m+l*s-r*m-q*l-k*s,y=n*l+k*p+o*m-l*p-k*o-n*m,z=n*r*m+q*l*p+k*o*s-k*r*p-q*o*m-n*l*s;b.transform(u/t,x/t,v/t,y/t,w/t,z/t),b.drawImage(a.texture.baseTexture.source,0,0),b.restore()}},b.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},b.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},b.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b},b.CanvasGraphics=function(){},b.CanvasGraphics.renderGraphics=function(a,c){for(var d=a.worldAlpha,e="",f=0;f<a.graphicsData.length;f++){var g=a.graphicsData[f],h=g.points;if(c.strokeStyle=e="#"+("00000"+(0|g.lineColor).toString(16)).substr(-6),c.lineWidth=g.lineWidth,g.type===b.Graphics.POLY){c.beginPath(),c.moveTo(h[0],h[1]);for(var i=1;i<h.length/2;i++)c.lineTo(h[2*i],h[2*i+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}else if(g.type===b.Graphics.RECT)(g.fillColor||0===g.fillColor)&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fillRect(h[0],h[1],h[2],h[3])),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.strokeRect(h[0],h[1],h[2],h[3]));else if(g.type===b.Graphics.CIRC)c.beginPath(),c.arc(h[0],h[1],h[2],0,2*Math.PI),c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke());else if(g.type===b.Graphics.ELIP){var j=g.points,k=2*j[2],l=2*j[3],m=j[0]-k/2,n=j[1]-l/2;c.beginPath();var o=.5522848,p=k/2*o,q=l/2*o,r=m+k,s=n+l,t=m+k/2,u=n+l/2;c.moveTo(m,u),c.bezierCurveTo(m,u-q,t-p,n,t,n),c.bezierCurveTo(t+p,n,r,u-q,r,u),c.bezierCurveTo(r,u+q,t+p,s,t,s),c.bezierCurveTo(t-p,s,m,u+q,m,u),c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}else if(g.type===b.Graphics.RREC){var v=h[0],w=h[1],x=h[2],y=h[3],z=h[4],A=Math.min(x,y)/2|0;z=z>A?A:z,c.beginPath(),c.moveTo(v,w+z),c.lineTo(v,w+y-z),c.quadraticCurveTo(v,w+y,v+z,w+y),c.lineTo(v+x-z,w+y),c.quadraticCurveTo(v+x,w+y,v+x,w+y-z),c.lineTo(v+x,w+z),c.quadraticCurveTo(v+x,w,v+x-z,w),c.lineTo(v+z,w),c.quadraticCurveTo(v,w,v,w+z),c.closePath(),(g.fillColor||0===g.fillColor)&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}}},b.CanvasGraphics.renderGraphicsMask=function(a,c){var d=a.graphicsData.length;if(0!==d){d>1&&(d=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var e=0;1>e;e++){var f=a.graphicsData[e],g=f.points;if(f.type===b.Graphics.POLY){c.beginPath(),c.moveTo(g[0],g[1]);for(var h=1;h<g.length/2;h++)c.lineTo(g[2*h],g[2*h+1]);g[0]===g[g.length-2]&&g[1]===g[g.length-1]&&c.closePath()}else if(f.type===b.Graphics.RECT)c.beginPath(),c.rect(g[0],g[1],g[2],g[3]),c.closePath();else if(f.type===b.Graphics.CIRC)c.beginPath(),c.arc(g[0],g[1],g[2],0,2*Math.PI),c.closePath();else if(f.type===b.Graphics.ELIP){var i=f.points,j=2*i[2],k=2*i[3],l=i[0]-j/2,m=i[1]-k/2;c.beginPath();var n=.5522848,o=j/2*n,p=k/2*n,q=l+j,r=m+k,s=l+j/2,t=m+k/2;c.moveTo(l,t),c.bezierCurveTo(l,t-p,s-o,m,s,m),c.bezierCurveTo(s+o,m,q,t-p,q,t),c.bezierCurveTo(q,t+p,s+o,r,s,r),c.bezierCurveTo(s-o,r,l,t+p,l,t),c.closePath()}else if(f.type===b.Graphics.RREC){var u=g[0],v=g[1],w=g[2],x=g[3],y=g[4],z=Math.min(w,x)/2|0;y=y>z?z:y,c.beginPath(),c.moveTo(u,v+y),c.lineTo(u,v+x-y),c.quadraticCurveTo(u,v+x,u+y,v+x),c.lineTo(u+w-y,v+x),c.quadraticCurveTo(u+w,v+x,u+w,v+x-y),c.lineTo(u+w,v+y),c.quadraticCurveTo(u+w,v,u+w-y,v),c.lineTo(u+y,v),c.quadraticCurveTo(u,v,u,v+y),c.closePath()}}}},b.Graphics=function(){b.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=b.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10,this.dirty=!0},b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Graphics.prototype.constructor=b.Graphics,Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),b.Graphics.prototype.lineStyle=function(a,c,d){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=a||0,this.lineColor=c||0,this.lineAlpha=arguments.length<3?1:d,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this},b.Graphics.prototype.moveTo=function(a,c){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.currentPath.points.push(a,c),this.graphicsData.push(this.currentPath),this},b.Graphics.prototype.lineTo=function(a,b){return this.currentPath.points.push(a,b),this.dirty=!0,this},b.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){for(var e,f,g=20,h=this.currentPath.points,i=h[h.length-2],j=h[h.length-1],k=0,l=1;g>=l;l++)k=l/g,e=i+(a-i)*k,f=j+(b-j)*k,h.push(e+(a+(c-a)*k-e)*k,f+(b+(d-b)*k-f)*k);return this.dirty=!0,this},b.Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){for(var g,h,i,j,k,l=20,m=this.currentPath.points,n=m[m.length-2],o=m[m.length-1],p=0,q=1;l>q;q++)p=q/l,g=1-p,h=g*g,i=h*g,j=p*p,k=j*p,m.push(i*n+3*h*p*a+3*g*j*c+k*e,i*o+3*h*p*b+3*g*j*d+k*f);return this.dirty=!0,this},b.Graphics.prototype.arcTo=function(a,b,c,d,e){var f=this.currentPath.points,g=f[f.length-2],h=f[f.length-1],i=h-b,j=g-a,k=d-b,l=c-a,m=Math.abs(i*l-j*k);if(1e-8>m||0===e)f.push(a,b);else{var n=i*i+j*j,o=k*k+l*l,p=i*k+j*l,q=e*Math.sqrt(n)/m,r=e*Math.sqrt(o)/m,s=q*p/n,t=r*p/o,u=q*l+r*j,v=q*k+r*i,w=j*(r+s),x=i*(r+s),y=l*(q+t),z=k*(q+t),A=Math.atan2(x-v,w-u),B=Math.atan2(z-v,y-u);this.arc(u+a,v+b,e,A,B,j*k>l*i)}return this.dirty=!0,this},b.Graphics.prototype.arc=function(a,b,c,d,e,f){var g=a+Math.cos(d)*c,h=b+Math.sin(d)*c,i=this.currentPath.points,j=i[i.length-2],k=i[i.length-1];if((j!==g||k!==h)&&i.push(g,h),d===e)return this;!f&&d>=e?e+=2*Math.PI:f&&e>=d&&(d+=2*Math.PI);var l=f?-1*(d-e):e-d,m=Math.abs(l)/(2*Math.PI)*40;if(0===l)return this;for(var n=l/(2*m),o=2*n,p=Math.cos(n),q=Math.sin(n),r=m%1/m,s=0;m>=s;s++){var t=s+r*s,u=n+d+o*t,v=Math.cos(u),w=-Math.sin(u);i.push((p*v+q*w)*c+a,(p*-w+q*v)*c+b)}return this.dirty=!0,this},b.Graphics.prototype.drawPath=function(a){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(a),this.dirty=!0,this},b.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=arguments.length<2?1:b,this},b.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},b.Graphics.prototype.drawRect=function(a,c,d,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,e],type:b.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.drawRoundedRect=function(a,c,d,e,f){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,e,f],type:b.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.drawCircle=function(a,c,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,d],type:b.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.drawEllipse=function(a,c,d,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,e],type:b.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},b.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),c=new b.CanvasBuffer(a.width,a.height),d=b.Texture.fromCanvas(c.canvas);return c.context.translate(-a.x,-a.y),b.CanvasGraphics.renderGraphics(this,c.context),d},b.Graphics.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),b.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,void b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a); if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var c=b.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(c[0],c[1])}if(b.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var d=0,e=this.children.length;e>d;d++)this.children[d]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this.mask,a),a.drawCount++,a.spriteBatch.start()}},b.Graphics.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var c=a.context,d=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),c.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty),b.CanvasGraphics.renderGraphics(this,c);for(var e=0,f=this.children.length;f>e;e++)this.children[e]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}},b.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var b=this.bounds.x,c=this.bounds.width+this.bounds.x,d=this.bounds.y,e=this.bounds.height+this.bounds.y,f=a||this.worldTransform,g=f.a,h=f.c,i=f.b,j=f.d,k=f.tx,l=f.ty,m=g*c+i*e+k,n=j*e+h*c+l,o=g*b+i*e+k,p=j*e+h*b+l,q=g*b+i*d+k,r=j*d+h*b+l,s=g*c+i*d+k,t=j*d+h*c+l,u=m,v=n,w=m,x=n;w=w>o?o:w,w=w>q?q:w,w=w>s?s:w,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,u=o>u?o:u,u=q>u?q:u,u=s>u?s:u,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v;var y=this._bounds;return y.x=w,y.width=u-w,y.y=x,y.height=v-x,y},b.Graphics.prototype.updateBounds=function(){for(var a,c,d,e,f,g=1/0,h=-1/0,i=1/0,j=-1/0,k=0;k<this.graphicsData.length;k++){var l=this.graphicsData[k],m=l.type,n=l.lineWidth;if(a=l.points,m===b.Graphics.RECT)c=a[0]-n/2,d=a[1]-n/2,e=a[2]+n,f=a[3]+n,g=g>c?c:g,h=c+e>h?c+e:h,i=i>d?c:i,j=d+f>j?d+f:j;else if(m===b.Graphics.CIRC||m===b.Graphics.ELIP)c=a[0],d=a[1],e=a[2]+n/2,f=a[3]+n/2,g=g>c-e?c-e:g,h=c+e>h?c+e:h,i=i>d-f?d-f:i,j=d+f>j?d+f:j;else for(var o=0;o<a.length;o+=2)c=a[o],d=a[o+1],g=g>c-n?c-n:g,h=c+n>h?c+n:h,i=i>d-n?d-n:i,j=d+n>j?d+n:j}var p=this.boundsPadding;this.bounds=new b.Rectangle(g-p,i-p,h-g+2*p,j-i+2*p)},b.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var c=new b.CanvasBuffer(a.width,a.height),d=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(d),this._cachedSprite.buffer=c,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._cachedSprite.buffer.context.translate(-a.x,-a.y),b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},b.Graphics.POLY=0,b.Graphics.RECT=1,b.Graphics.CIRC=2,b.Graphics.ELIP=3,b.Graphics.RREC=4,b.Strip=function(a){b.DisplayObjectContainer.call(this),this.texture=a,this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new b.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new b.Float32Array([1,1,1,1]),this.indices=new b.Uint16Array([0,1,2,3]),this.dirty=!0},b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Strip.prototype.constructor=b.Strip,b.Strip.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())},b.Strip.prototype._initWebGL=function(a){var b=a.gl;this._vertexBuffer=b.createBuffer(),this._indexBuffer=b.createBuffer(),this._uvBuffer=b.createBuffer(),this._colorBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.DYNAMIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._colorBuffer),b.bufferData(b.ARRAY_BUFFER,this.colors,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)},b.Strip.prototype._renderStrip=function(a){var c=a.gl,d=a.projection,e=a.offset,f=a.shaderManager.stripShader;c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.uniformMatrix3fv(f.translationMatrix,!1,this.worldTransform.toArray(!0)),c.uniform2f(f.projectionVector,d.x,-d.y),c.uniform2f(f.offsetVector,-e.x,-e.y),c.uniform1f(f.alpha,1),this.dirty?(this.dirty=!1,c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferData(c.ARRAY_BUFFER,this.verticies,c.STATIC_DRAW),c.vertexAttribPointer(f.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),c.bufferData(c.ARRAY_BUFFER,this.uvs,c.STATIC_DRAW),c.vertexAttribPointer(f.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW)):(c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,this.verticies),c.vertexAttribPointer(f.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),c.vertexAttribPointer(f.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),c.drawElements(c.TRIANGLE_STRIP,this.indices.length,c.UNSIGNED_SHORT,0)},b.Strip.prototype._renderCanvas=function(a){var b=a.context,c=this.worldTransform;a.roundPixels?b.setTransform(c.a,c.c,c.b,c.d,0|c.tx,0|c.ty):b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty);var d=this,e=d.verticies,f=d.uvs,g=e.length/2;this.count++;for(var h=0;g-2>h;h++){var i=2*h,j=e[i],k=e[i+2],l=e[i+4],m=e[i+1],n=e[i+3],o=e[i+5],p=(j+k+l)/3,q=(m+n+o)/3,r=j-p,s=m-q,t=Math.sqrt(r*r+s*s);j=p+r/t*(t+3),m=q+s/t*(t+3),r=k-p,s=n-q,t=Math.sqrt(r*r+s*s),k=p+r/t*(t+3),n=q+s/t*(t+3),r=l-p,s=o-q,t=Math.sqrt(r*r+s*s),l=p+r/t*(t+3),o=q+s/t*(t+3);var u=f[i]*d.texture.width,v=f[i+2]*d.texture.width,w=f[i+4]*d.texture.width,x=f[i+1]*d.texture.height,y=f[i+3]*d.texture.height,z=f[i+5]*d.texture.height;b.save(),b.beginPath(),b.moveTo(j,m),b.lineTo(k,n),b.lineTo(l,o),b.closePath(),b.clip();var A=u*y+x*w+v*z-y*w-x*v-u*z,B=j*y+x*l+k*z-y*l-x*k-j*z,C=u*k+j*w+v*l-k*w-j*v-u*l,D=u*y*l+x*k*w+j*v*z-j*y*w-x*v*l-u*k*z,E=m*y+x*o+n*z-y*o-x*n-m*z,F=u*n+m*w+v*o-n*w-m*v-u*o,G=u*y*o+x*n*w+m*v*z-m*y*w-x*v*o-u*n*z;b.transform(B/A,E/A,C/A,F/A,D/A,G/A),b.drawImage(d.texture.baseTexture.source,0,0),b.restore()}},b.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},b.Rope=function(a,c){b.Strip.call(this,a),this.points=c,this.verticies=new b.Float32Array(4*c.length),this.uvs=new b.Float32Array(4*c.length),this.colors=new b.Float32Array(2*c.length),this.indices=new b.Uint16Array(2*c.length),this.refresh()},b.Rope.prototype=Object.create(b.Strip.prototype),b.Rope.prototype.constructor=b.Rope,b.Rope.prototype.refresh=function(){var a=this.points;if(!(a.length<1)){var b=this.uvs,c=a[0],d=this.indices,e=this.colors;this.count-=.2,b[0]=0,b[1]=0,b[2]=0,b[3]=1,e[0]=1,e[1]=1,d[0]=0,d[1]=1;for(var f,g,h,i=a.length,j=1;i>j;j++)f=a[j],g=4*j,h=j/(i-1),j%2?(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1):(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1),g=2*j,e[g]=1,e[g+1]=1,g=2*j,d[g]=g,d[g+1]=g+1,c=f}},b.Rope.prototype.updateTransform=function(){var a=this.points;if(!(a.length<1)){var c,d=a[0],e={x:0,y:0};this.count-=.2;for(var f,g,h,i,j,k=this.verticies,l=a.length,m=0;l>m;m++)f=a[m],g=4*m,c=m<a.length-1?a[m+1]:f,e.y=-(c.x-d.x),e.x=c.y-d.y,h=10*(1-m/(l-1)),h>1&&(h=1),i=Math.sqrt(e.x*e.x+e.y*e.y),j=this.texture.height/2,e.x/=i,e.y/=i,e.x*=j,e.y*=j,k[g]=f.x+e.x,k[g+1]=f.y+e.y,k[g+2]=f.x-e.x,k[g+3]=f.y-e.y,d=f;b.DisplayObjectContainer.prototype.updateTransform.call(this)}},b.Rope.prototype.setTexture=function(a){this.texture=a},b.TilingSprite=function(a,c,d){b.Sprite.call(this,a),this.width=c||100,this.height=d||100,this.tileScale=new b.Point(1,1),this.tileScaleOffset=new b.Point(1,1),this.tilePosition=new b.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=b.blendModes.NORMAL},b.TilingSprite.prototype=Object.create(b.Sprite.prototype),b.TilingSprite.prototype.constructor=b.TilingSprite,Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),b.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)},b.TilingSprite.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha){var c,d;for(this.mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this.filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(b.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this),c=0,d=this.children.length;d>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop(),this.filters&&a.filterManager.popFilter(),this.mask&&a.maskManager.popMask(a),a.spriteBatch.start()}},b.TilingSprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var c=a.context;this._mask&&a.maskManager.pushMask(this._mask,c),c.globalAlpha=this.worldAlpha;var d,e,f=this.worldTransform;if(c.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=c.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);var g=this.tilePosition,h=this.tileScale;for(g.x%=this.tilingTexture.baseTexture.width,g.y%=this.tilingTexture.baseTexture.height,c.scale(h.x,h.y),c.translate(g.x,g.y),c.fillStyle=this.__tilePattern,c.fillRect(-g.x+this.anchor.x*-this._width,-g.y+this.anchor.y*-this._height,this._width/h.x,this._height/h.y),c.scale(1/h.x,1/h.y),c.translate(-g.x,-g.y),this._mask&&a.maskManager.popMask(a.context),d=0,e=this.children.length;e>d;d++)this.children[d]._renderCanvas(a)}},b.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),f=b*-this.anchor.y,g=this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=-1/0,w=-1/0,x=1/0,y=1/0;x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w;var z=this._bounds;return z.x=x,z.width=v-x,z.y=y,z.height=w-y,this._currentBounds=z,z},b.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var c,d,e=this.texture,f=e.frame,g=f.width!==e.baseTexture.width||f.height!==e.baseTexture.height,h=!1;if(a?(c=b.getNextPowerOfTwo(f.width),d=b.getNextPowerOfTwo(f.height),(f.width!==c||f.height!==d)&&(h=!0)):g&&(c=f.width,d=f.height,h=!0),h){var i;this.tilingTexture&&this.tilingTexture.isTiling?(i=this.tilingTexture.canvasBuffer,i.resize(c,d),this.tilingTexture.baseTexture.width=c,this.tilingTexture.baseTexture.height=d,this.tilingTexture.needsUpdate=!0):(i=new b.CanvasBuffer(c,d),this.tilingTexture=b.Texture.fromCanvas(i.canvas),this.tilingTexture.canvasBuffer=i,this.tilingTexture.isTiling=!0),i.context.drawImage(e.baseTexture.source,e.crop.x,e.crop.y,e.crop.width,e.crop.height,0,0,c,d),this.tileScaleOffset.x=f.width/c,this.tileScaleOffset.y=f.height/d}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=e;this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},b.BaseTextureCache={},b.texturesToUpdate=[],b.texturesToDestroy=[],b.BaseTextureCacheIdGenerator=0,b.BaseTexture=function(a,c){if(b.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=c||b.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.id=b.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,b.texturesToUpdate.push(this);else{var d=this;this.source.onload=function(){d.hasLoaded=!0,d.width=d.source.width,d.height=d.source.height;for(var a=0;a<d._glTextures.length;a++)d._dirty[a]=!0;d.dispatchEvent({type:"loaded",content:d})},this.source.onerror=function(){d.dispatchEvent({type:"error",content:d})}}this.imageUrl=null,this._powerOf2=!1}},b.BaseTexture.prototype.constructor=b.BaseTexture,b.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete b.BaseTextureCache[this.imageUrl],delete b.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete b.BaseTextureCache[this.source._pixiId],this.source=null,b.texturesToDestroy.push(this)},b.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1,this.source.src=null,this.source.src=a},b.BaseTexture.fromImage=function(a,c,d){var e=b.BaseTextureCache[a];if(void 0===c&&-1===a.indexOf("data:")&&(c=!0),!e){var f=new Image;c&&(f.crossOrigin=""),f.src=a,e=new b.BaseTexture(f,d),e.imageUrl=a,b.BaseTextureCache[a]=e}return e},b.BaseTexture.fromCanvas=function(a,c){a._pixiId||(a._pixiId="canvas_"+b.TextureCacheIdGenerator++);var d=b.BaseTextureCache[a._pixiId];return d||(d=new b.BaseTexture(a,c),b.BaseTextureCache[a._pixiId]=d),d},b.TextureCache={},b.FrameCache={},b.TextureCacheIdGenerator=0,b.Texture=function(a,c){if(b.EventTarget.call(this),this.noFrame=!1,c||(this.noFrame=!0,c=new b.Rectangle(0,0,1,1)),a instanceof b.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=c,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new b.Rectangle(0,0,1,1),a.hasLoaded)this.noFrame&&(c=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(c);else{var d=this;a.addEventListener("loaded",function(){d.onBaseTextureLoaded()})}},b.Texture.prototype.constructor=b.Texture,b.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},b.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy(),this.valid=!1},b.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&b.Texture.frameUpdates.push(this)},b.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new b.TextureUvs);var a=this.crop,c=this.baseTexture.width,d=this.baseTexture.height;this._uvs.x0=a.x/c,this._uvs.y0=a.y/d,this._uvs.x1=(a.x+a.width)/c,this._uvs.y1=a.y/d,this._uvs.x2=(a.x+a.width)/c,this._uvs.y2=(a.y+a.height)/d,this._uvs.x3=a.x/c,this._uvs.y3=(a.y+a.height)/d},b.Texture.fromImage=function(a,c,d){var e=b.TextureCache[a];return e||(e=new b.Texture(b.BaseTexture.fromImage(a,c,d)),b.TextureCache[a]=e),e},b.Texture.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw new Error('The frameId "'+a+'" does not exist in the texture cache ');return c},b.Texture.fromCanvas=function(a,c){var d=b.BaseTexture.fromCanvas(a,c);return new b.Texture(d)},b.Texture.addTextureToCache=function(a,c){b.TextureCache[c]=a},b.Texture.removeTextureFromCache=function(a){var c=b.TextureCache[a];return delete b.TextureCache[a],delete b.BaseTextureCache[a],c},b.Texture.frameUpdates=[],b.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},b.RenderTexture=function(a,c,d,e){if(b.EventTarget.call(this),this.width=a||100,this.height=c||100,this.frame=new b.Rectangle(0,0,this.width,this.height),this.crop=new b.Rectangle(0,0,1,1),this.baseTexture=new b.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=e||b.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=d||b.defaultRenderer,this.renderer.type===b.WEBGL_RENDERER){var f=this.renderer.gl;this.textureBuffer=new b.FilterTexture(f,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[f.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new b.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new b.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;b.Texture.frameUpdates.push(this)},b.RenderTexture.prototype=Object.create(b.Texture.prototype),b.RenderTexture.prototype.constructor=b.RenderTexture,b.RenderTexture.prototype.resize=function(a,c,d){(a!==this.width||c!==this.height)&&(this.width=a,this.height=c,this.frame.width=this.width,this.frame.height=this.height,d&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===b.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))},b.RenderTexture.prototype.clear=function(){this.renderer.type===b.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},b.RenderTexture.prototype.renderWebGL=function(a,c,d){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),d&&this.textureBuffer.clear();var f=a.children,g=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix,a.worldTransform.d=-1,a.worldTransform.ty=-2*this.projection.y,c&&(a.worldTransform.tx=c.x,a.worldTransform.ty-=c.y);for(var h=0,i=f.length;i>h;h++)f[h].updateTransform();b.WebGLRenderer.updateTextures(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),a.worldTransform=g,this.renderer.spriteBatch.dirty=!0},b.RenderTexture.prototype.renderCanvas=function(a,c,d){var e=a.children,f=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix,c?(a.worldTransform.tx=c.x,a.worldTransform.ty=c.y):(a.worldTransform.tx=0,a.worldTransform.ty=0);for(var g=0,h=e.length;h>g;g++)e[g].updateTransform();d&&this.textureBuffer.clear();var i=this.textureBuffer.context;this.renderer.renderDisplayObject(a,i),i.setTransform(1,0,0,1,0,0),a.worldTransform=f},b.RenderTexture.tempMatrix=new b.Matrix,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.PIXI=b):"undefined"!=typeof define&&define.amd?define(b):a.PIXI=b}).call(this),function(){var a=this,b=b||{VERSION:"2.0.6",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(PIXI.InteractionManager=PIXI.InteractionManager||function(){},PIXI.dontSayHello=!0,b.Utils={transposeArray:function(a){for(var b=new Array(a[0].length),c=0;c<a[0].length;c++){b[c]=new Array(a.length-1);for(var d=a.length-1;d>-1;d--)b[c][d]=a[d][c]}return b},rotateArray:function(a,c){if("string"!=typeof c&&(c=(c%360+360)%360),90===c||-270===c||"rotateLeft"===c)a=b.Utils.transposeArray(a),a=a.reverse();else if(-90===c||270===c||"rotateRight"===c)a=a.reverse(),a=b.Utils.transposeArray(a);else if(180===Math.abs(c)||"rotate180"===c){for(var d=0;d<a.length;d++)a[d].reverse();a=a.reverse()}return a},parseDimension:function(a,b){var c=0,d=0;return"string"==typeof a?"%"===a.substr(-1)?(c=parseInt(a,10)/100,d=0===b?window.innerWidth*c:window.innerHeight*c):d=parseInt(a,10):d=a,d},shuffle:function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},pad:function(a,b,c,d){if("undefined"==typeof b)var b=0;if("undefined"==typeof c)var c=" ";if("undefined"==typeof d)var d=3;var e=0;if(b+1>=a.length)switch(d){case 1:a=new Array(b+1-a.length).join(c)+a;break;case 3:var f=Math.ceil((e=b-a.length)/2),g=e-f;a=new Array(g+1).join(c)+a+new Array(f+1).join(c);break;default:a+=new Array(b+1-a.length).join(c)}return a},isPlainObject:function(a){if("object"!=typeof a||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!{}.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},extend:function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&(b.Utils.isPlainObject(e)||(f=Array.isArray(e)))?(f?(f=!1,g=d&&Array.isArray(d)?d:[]):g=d&&b.Utils.isPlainObject(d)?d:{},h[c]=b.Utils.extend(k,g,e)):void 0!==e&&(h[c]=e));return h},mixin:function(a,c){if(!a||"object"!=typeof a)return c;for(var d in a){var e=a[d];if(!e.childNodes&&!e.cloneNode){var f=typeof a[d];c[d]=a[d]&&"object"===f?typeof c[d]===f?b.Utils.mixin(a[d],c[d]):b.Utils.mixin(a[d],new e.constructor):a[d]}}return c}},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)}),Array.prototype.forEach||(Array.prototype.forEach=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;c>e;e++)e in b&&a.call(d,b[e],e,b)}),"function"!=typeof window.Uint32Array){var c=function(a){var b=new Array;window[a]=function(a){if("number"==typeof a){Array.call(this,a),this.length=a;for(var b=0;b<this.length;b++)this[b]=0}else{Array.call(this,a.length),this.length=a.length;for(var b=0;b<this.length;b++)this[b]=a[b]}},window[a].prototype=b,window[a].constructor=window[a]};c("Uint32Array"),c("Int16Array")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),b.Circle=function(a,b,c){a=a||0,b=b||0,c=c||0,this.x=a,this.y=b,this._diameter=c,this._radius=c>0?.5*c:0},b.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},setTo:function(a,b,c){return this.x=a,this.y=b,this._diameter=c,this._radius=.5*c,this},copyFrom:function(a){return this.setTo(a.x,a.y,a.diameter)},copyTo:function(a){return a.x=this.x,a.y=this.y,a.diameter=this._diameter,a},distance:function(a,c){return"undefined"==typeof c&&(c=!1),c?b.Math.distanceRounded(this.x,this.y,a.x,a.y):b.Math.distance(this.x,this.y,a.x,a.y)},clone:function(a){return"undefined"==typeof a?a=new b.Circle(this.x,this.y,this.diameter):a.setTo(this.x,this.y,this.diameter),a},contains:function(a,c){return b.Circle.contains(this,a,c)},circumferencePoint:function(a,c,d){return b.Circle.circumferencePoint(this,a,c,d)},offset:function(a,b){return this.x+=a,this.y+=b,this},offsetPoint:function(a){return this.offset(a.x,a.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},b.Circle.prototype.constructor=b.Circle,Object.defineProperty(b.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(a){a>0&&(this._diameter=a,this._radius=.5*a)}}),Object.defineProperty(b.Circle.prototype,"radius",{get:function(){return this._radius},set:function(a){a>0&&(this._radius=a,this._diameter=2*a)}}),Object.defineProperty(b.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(a){a>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-a}}),Object.defineProperty(b.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(a){a<this.x?(this._radius=0,this._diameter=0):this.radius=a-this.x}}),Object.defineProperty(b.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(a){a>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-a}}),Object.defineProperty(b.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(a){a<this.y?(this._radius=0,this._diameter=0):this.radius=a-this.y}}),Object.defineProperty(b.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(b.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(a){a===!0&&this.setTo(0,0,0)}}),b.Circle.contains=function(a,b,c){if(a.radius>0&&b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom){var d=(a.x-b)*(a.x-b),e=(a.y-c)*(a.y-c);return d+e<=a.radius*a.radius}return!1},b.Circle.equals=function(a,b){return a.x==b.x&&a.y==b.y&&a.diameter==b.diameter},b.Circle.intersects=function(a,c){return b.Math.distance(a.x,a.y,c.x,c.y)<=a.radius+c.radius},b.Circle.circumferencePoint=function(a,c,d,e){return"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=new b.Point),d===!0&&(c=b.Math.degToRad(c)),e.x=a.x+a.radius*Math.cos(c),e.y=a.y+a.radius*Math.sin(c),e},b.Circle.intersectsRectangle=function(a,b){var c=Math.abs(a.x-b.x-b.halfWidth),d=b.halfWidth+a.radius;if(c>d)return!1;var e=Math.abs(a.y-b.y-b.halfHeight),f=b.halfHeight+a.radius;if(e>f)return!1;if(c<=b.halfWidth||e<=b.halfHeight)return!0;var g=c-b.halfWidth,h=e-b.halfHeight,i=g*g,j=h*h,k=a.radius*a.radius;return k>=i+j},PIXI.Circle=b.Circle,b.Point=function(a,b){a=a||0,b=b||0,this.x=a,this.y=b},b.Point.prototype={copyFrom:function(a){return this.setTo(a.x,a.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(a,b){return this.x=a||0,this.y=b||(0!==b?this.x:0),this},set:function(a,b){return this.x=a||0,this.y=b||(0!==b?this.x:0),this},add:function(a,b){return this.x+=a,this.y+=b,this},subtract:function(a,b){return this.x-=a,this.y-=b,this},multiply:function(a,b){return this.x*=a,this.y*=b,this},divide:function(a,b){return this.x/=a,this.y/=b,this},clampX:function(a,c){return this.x=b.Math.clamp(this.x,a,c),this},clampY:function(a,c){return this.y=b.Math.clamp(this.y,a,c),this},clamp:function(a,c){return this.x=b.Math.clamp(this.x,a,c),this.y=b.Math.clamp(this.y,a,c),this},clone:function(a){return"undefined"==typeof a?a=new b.Point(this.x,this.y):a.setTo(this.x,this.y),a},copyTo:function(a){return a.x=this.x,a.y=this.y,a},distance:function(a,c){return b.Point.distance(this,a,c)},equals:function(a){return a.x===this.x&&a.y===this.y},angle:function(a,c){return"undefined"==typeof c&&(c=!1),c?b.Math.radToDeg(Math.atan2(a.y-this.y,a.x-this.x)):Math.atan2(a.y-this.y,a.x-this.x)},angleSq:function(a){return this.subtract(a).angle(a.subtract(this))},rotate:function(a,c,d,e,f){return b.Point.rotate(this,a,c,d,e,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(a){return this.normalize().multiply(a,a)},normalize:function(){if(!this.isZero()){var a=this.getMagnitude();this.x/=a,this.y/=a}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},b.Point.prototype.constructor=b.Point,b.Point.add=function(a,c,d){return"undefined"==typeof d&&(d=new b.Point),d.x=a.x+c.x,d.y=a.y+c.y,d},b.Point.subtract=function(a,c,d){return"undefined"==typeof d&&(d=new b.Point),d.x=a.x-c.x,d.y=a.y-c.y,d},b.Point.multiply=function(a,c,d){return"undefined"==typeof d&&(d=new b.Point),d.x=a.x*c.x,d.y=a.y*c.y,d},b.Point.divide=function(a,c,d){return"undefined"==typeof d&&(d=new b.Point),d.x=a.x/c.x,d.y=a.y/c.y,d},b.Point.equals=function(a,b){return a.x===b.x&&a.y===b.y},b.Point.angle=function(a,b){return Math.atan2(a.y-b.y,a.x-b.x)},b.Point.angleSq=function(a,b){return a.subtract(b).angle(b.subtract(a))},b.Point.negative=function(a,c){return"undefined"==typeof c&&(c=new b.Point),c.setTo(-a.x,-a.y)},b.Point.multiplyAdd=function(a,c,d,e){return"undefined"==typeof e&&(e=new b.Point),e.setTo(a.x+c.x*d,a.y+c.y*d)},b.Point.interpolate=function(a,c,d,e){return"undefined"==typeof e&&(e=new b.Point),e.setTo(a.x+(c.x-a.x)*d,a.y+(c.y-a.y)*d)},b.Point.perp=function(a,c){return"undefined"==typeof c&&(c=new b.Point),c.setTo(-a.y,a.x)},b.Point.rperp=function(a,c){return"undefined"==typeof c&&(c=new b.Point),c.setTo(a.y,-a.x)},b.Point.distance=function(a,c,d){return"undefined"==typeof d&&(d=!1),d?b.Math.distanceRounded(a.x,a.y,c.x,c.y):b.Math.distance(a.x,a.y,c.x,c.y)},b.Point.project=function(a,c,d){"undefined"==typeof d&&(d=new b.Point);var e=a.dot(c)/c.getMagnitudeSq();return 0!==e&&d.setTo(e*c.x,e*c.y),d},b.Point.projectUnit=function(a,c,d){"undefined"==typeof d&&(d=new b.Point);var e=a.dot(c);return 0!==e&&d.setTo(e*c.x,e*c.y),d},b.Point.normalRightHand=function(a,c){return"undefined"==typeof c&&(c=new b.Point),c.setTo(-1*a.y,a.x)},b.Point.normalize=function(a,c){"undefined"==typeof c&&(c=new b.Point);var d=a.getMagnitude();return 0!==d&&c.setTo(a.x/d,a.y/d),c},b.Point.rotate=function(a,c,d,e,f,g){return f=f||!1,g=g||null,f&&(e=b.Math.degToRad(e)),null===g&&(g=Math.sqrt((c-a.x)*(c-a.x)+(d-a.y)*(d-a.y))),a.setTo(c+g*Math.cos(e),d+g*Math.sin(e))},b.Point.centroid=function(a,c){if("undefined"==typeof c&&(c=new b.Point),"[object Array]"!==Object.prototype.toString.call(a))throw new Error("Phaser.Point. Parameter 'points' must be an array");var d=a.length;if(1>d)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===d)return c.copyFrom(a[0]),c;for(var e=0;d>e;e++)b.Point.add(c,a[e],c);return c.divide(d,d),c},PIXI.Point=b.Point,b.Rectangle=function(a,b,c,d){a=a||0,b=b||0,c=c||0,d=d||0,this.x=a,this.y=b,this.width=c,this.height=d},b.Rectangle.prototype={offset:function(a,b){return this.x+=a,this.y+=b,this},offsetPoint:function(a){return this.offset(a.x,a.y)},setTo:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y) },floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyTo:function(a){return a.x=this.x,a.y=this.y,a.width=this.width,a.height=this.height,a},inflate:function(a,c){return b.Rectangle.inflate(this,a,c)},size:function(a){return b.Rectangle.size(this,a)},clone:function(a){return b.Rectangle.clone(this,a)},contains:function(a,c){return b.Rectangle.contains(this,a,c)},containsRect:function(a){return b.Rectangle.containsRect(this,a)},equals:function(a){return b.Rectangle.equals(this,a)},intersection:function(a,c){return b.Rectangle.intersection(this,a,c)},intersects:function(a,c){return b.Rectangle.intersects(this,a,c)},intersectsRaw:function(a,c,d,e,f){return b.Rectangle.intersectsRaw(this,a,c,d,e,f)},union:function(a,c){return b.Rectangle.union(this,a,c)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(b.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(b.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(b.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.height=a<=this.y?0:this.y-a}}),Object.defineProperty(b.Rectangle.prototype,"bottomRight",{get:function(){return new b.Point(this.right,this.bottom)},set:function(a){this.right=a.x,this.bottom=a.y}}),Object.defineProperty(b.Rectangle.prototype,"left",{get:function(){return this.x},set:function(a){this.width=a>=this.right?0:this.right-a,this.x=a}}),Object.defineProperty(b.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(a){this.width=a<=this.x?0:a-this.x}}),Object.defineProperty(b.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(b.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(b.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(a){this.x=a-this.halfWidth}}),Object.defineProperty(b.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(a){this.y=a-this.halfHeight}}),Object.defineProperty(b.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(b.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(b.Rectangle.prototype,"top",{get:function(){return this.y},set:function(a){a>=this.bottom?(this.height=0,this.y=a):this.height=this.bottom-a}}),Object.defineProperty(b.Rectangle.prototype,"topLeft",{get:function(){return new b.Point(this.x,this.y)},set:function(a){this.x=a.x,this.y=a.y}}),Object.defineProperty(b.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(a){a===!0&&this.setTo(0,0,0,0)}}),b.Rectangle.prototype.constructor=b.Rectangle,b.Rectangle.inflate=function(a,b,c){return a.x-=b,a.width+=2*b,a.y-=c,a.height+=2*c,a},b.Rectangle.inflatePoint=function(a,c){return b.Rectangle.inflate(a,c.x,c.y)},b.Rectangle.size=function(a,c){return"undefined"==typeof c||null===c?c=new b.Point(a.width,a.height):c.setTo(a.width,a.height),c},b.Rectangle.clone=function(a,c){return"undefined"==typeof c||null===c?c=new b.Rectangle(a.x,a.y,a.width,a.height):c.setTo(a.x,a.y,a.width,a.height),c},b.Rectangle.contains=function(a,b,c){return a.width<=0||a.height<=0?!1:b>=a.x&&b<=a.right&&c>=a.y&&c<=a.bottom},b.Rectangle.containsRaw=function(a,b,c,d,e,f){return e>=a&&a+c>=e&&f>=b&&b+d>=f},b.Rectangle.containsPoint=function(a,c){return b.Rectangle.contains(a,c.x,c.y)},b.Rectangle.containsRect=function(a,b){return a.volume>b.volume?!1:a.x>=b.x&&a.y>=b.y&&a.right<=b.right&&a.bottom<=b.bottom},b.Rectangle.equals=function(a,b){return a.x==b.x&&a.y==b.y&&a.width==b.width&&a.height==b.height},b.Rectangle.intersection=function(a,c,d){return"undefined"==typeof d&&(d=new b.Rectangle),b.Rectangle.intersects(a,c)&&(d.x=Math.max(a.x,c.x),d.y=Math.max(a.y,c.y),d.width=Math.min(a.right,c.right)-d.x,d.height=Math.min(a.bottom,c.bottom)-d.y),d},b.Rectangle.intersects=function(a,b){return a.width<=0||a.height<=0||b.width<=0||b.height<=0?!1:!(a.right<b.x||a.bottom<b.y||a.x>b.right||a.y>b.bottom)},b.Rectangle.intersectsRaw=function(a,b,c,d,e,f){return"undefined"==typeof f&&(f=0),!(b>a.right+f||c<a.left-f||d>a.bottom+f||e<a.top-f)},b.Rectangle.union=function(a,c,d){return"undefined"==typeof d&&(d=new b.Rectangle),d.setTo(Math.min(a.x,c.x),Math.min(a.y,c.y),Math.max(a.right,c.right)-Math.min(a.left,c.left),Math.max(a.bottom,c.bottom)-Math.min(a.top,c.top))},PIXI.Rectangle=b.Rectangle,PIXI.EmptyRectangle=new b.Rectangle(0,0,0,0),b.Line=function(a,c,d,e){a=a||0,c=c||0,d=d||0,e=e||0,this.start=new b.Point(a,c),this.end=new b.Point(d,e)},b.Line.prototype={setTo:function(a,b,c,d){return this.start.setTo(a,b),this.end.setTo(c,d),this},fromSprite:function(a,b,c){return"undefined"==typeof c&&(c=!1),c?this.setTo(a.center.x,a.center.y,b.center.x,b.center.y):this.setTo(a.x,a.y,b.x,b.y)},intersects:function(a,c,d){return b.Line.intersectsPoints(this.start,this.end,a.start,a.end,c,d)},pointOnLine:function(a,b){return(a-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(b-this.start.y)},pointOnSegment:function(a,b){var c=Math.min(this.start.x,this.end.x),d=Math.max(this.start.x,this.end.x),e=Math.min(this.start.y,this.end.y),f=Math.max(this.start.y,this.end.y);return this.pointOnLine(a,b)&&a>=c&&d>=a&&b>=e&&f>=b},coordinatesOnLine:function(a,b){"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=[]);var c=Math.round(this.start.x),d=Math.round(this.start.y),e=Math.round(this.end.x),f=Math.round(this.end.y),g=Math.abs(e-c),h=Math.abs(f-d),i=e>c?1:-1,j=f>d?1:-1,k=g-h;b.push([c,d]);for(var l=1;c!=e||d!=f;){var m=k<<1;m>-h&&(k-=h,c+=i),g>m&&(k+=g,d+=j),l%a===0&&b.push([c,d]),l++}return b}},Object.defineProperty(b.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(b.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(b.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(b.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(b.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(b.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(b.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(b.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(b.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(b.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(b.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(b.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),b.Line.intersectsPoints=function(a,c,d,e,f,g){"undefined"==typeof f&&(f=!0),"undefined"==typeof g&&(g=new b.Point);var h=c.y-a.y,i=e.y-d.y,j=a.x-c.x,k=d.x-e.x,l=c.x*a.y-a.x*c.y,m=e.x*d.y-d.x*e.y,n=h*k-i*j;if(0===n)return null;if(g.x=(j*m-k*l)/n,g.y=(i*l-h*m)/n,f){var o=(e.y-d.y)*(c.x-a.x)-(e.x-d.x)*(c.y-a.y),p=((e.x-d.x)*(a.y-d.y)-(e.y-d.y)*(a.x-d.x))/o,q=((c.x-a.x)*(a.y-d.y)-(c.y-a.y)*(a.x-d.x))/o;return p>=0&&1>=p&&q>=0&&1>=q?g:null}return g},b.Line.intersects=function(a,c,d,e){return b.Line.intersectsPoints(a.start,a.end,c.start,c.end,d,e)},b.Ellipse=function(a,c,d,e){this.type=b.ELLIPSE,a=a||0,c=c||0,d=d||0,e=e||0,this.x=a,this.y=c,this.width=d,this.height=e},b.Ellipse.prototype={setTo:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyTo:function(a){return a.x=this.x,a.y=this.y,a.width=this.width,a.height=this.height,a},clone:function(a){return"undefined"==typeof a?a=new b.Ellipse(this.x,this.y,this.width,this.height):a.setTo(this.x,this.y,this.width,this.height),a},contains:function(a,c){return b.Ellipse.contains(this,a,c)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},b.Ellipse.prototype.constructor=b.Ellipse,Object.defineProperty(b.Ellipse.prototype,"left",{get:function(){return this.x},set:function(a){this.x=a}}),Object.defineProperty(b.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(a){this.width=a<this.x?0:this.x+a}}),Object.defineProperty(b.Ellipse.prototype,"top",{get:function(){return this.y},set:function(a){this.y=a}}),Object.defineProperty(b.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.height=a<this.y?0:this.y+a}}),Object.defineProperty(b.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(a){a===!0&&this.setTo(0,0,0,0)}}),b.Ellipse.contains=function(a,b,c){if(a.width<=0||a.height<=0)return!1;var d=(b-a.x)/a.width-.5,e=(c-a.y)/a.height-.5;return d*=d,e*=e,.25>d+e},b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Ellipse=b.Ellipse,b.Polygon=function(a){if(this.type=b.POLYGON,a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],d=0,e=a.length;e>d;d+=2)c.push(new b.Point(a[d],a[d+1]));a=c}this._points=a},b.Polygon.prototype={clone:function(){for(var a=[],c=0;c<this.points.length;c++)a.push(this.points[c].clone());return new b.Polygon(a)},contains:function(a,b){for(var c=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var f=this.points[d].x,g=this.points[d].y,h=this.points[e].x,i=this.points[e].y,j=g>b!=i>b&&(h-f)*(b-g)/(i-g)+f>a;j&&(c=!c)}return c}},b.Polygon.prototype.constructor=b.Polygon,Object.defineProperty(b.Polygon.prototype,"points",{get:function(){return this._points},set:function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],d=0,e=a.length;e>d;d+=2)c.push(new b.Point(a[d],a[d+1]));a=c}this._points=a}}),Object.defineProperty(b.Polygon.prototype,"area",{get:function(){var a,b,c,d,e,f=Number.MAX_VALUE,g=0;for(e=0;e<this.points.length;e++)this.points[e].y<f&&(f=this.points[e].y);for(e=0;e<this.points.length;e++)a=this.points[e],b=e===this.points.length-1?this.points[0]:this.points[e+1],c=(a.y-f+(b.y-f))/2,d=a.x-b.x,g+=c*d;return g}}),PIXI.Polygon=b.Polygon,b.Camera=function(a,c,d,e,f,g){this.game=a,this.world=a.world,this.id=0,this.view=new b.Rectangle(d,e,f,g),this.screenView=new b.Rectangle(d,e,f,g),this.bounds=new b.Rectangle(d,e,f,g),this.deadzone=null,this.visible=!0,this.atLimit={x:!1,y:!1},this.target=null,this._edge=0,this.displayObject=null,this.scale=null},b.Camera.FOLLOW_LOCKON=0,b.Camera.FOLLOW_PLATFORMER=1,b.Camera.FOLLOW_TOPDOWN=2,b.Camera.FOLLOW_TOPDOWN_TIGHT=3,b.Camera.prototype={follow:function(a,c){"undefined"==typeof c&&(c=b.Camera.FOLLOW_LOCKON),this.target=a;var d;switch(c){case b.Camera.FOLLOW_PLATFORMER:var e=this.width/8,f=this.height/3;this.deadzone=new b.Rectangle((this.width-e)/2,(this.height-f)/2-.25*f,e,f);break;case b.Camera.FOLLOW_TOPDOWN:d=Math.max(this.width,this.height)/4,this.deadzone=new b.Rectangle((this.width-d)/2,(this.height-d)/2,d,d);break;case b.Camera.FOLLOW_TOPDOWN_TIGHT:d=Math.max(this.width,this.height)/8,this.deadzone=new b.Rectangle((this.width-d)/2,(this.height-d)/2,d,d);break;case b.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(a){this.setPosition(Math.round(a.x-this.view.halfWidth),Math.round(a.y-this.view.halfHeight))},focusOnXY:function(a,b){this.setPosition(Math.round(a-this.view.halfWidth),Math.round(b-this.view.halfHeight))},update:function(){this.target&&this.updateTarget(),this.bounds&&this.checkBounds(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateTarget:function(){this.deadzone?(this._edge=this.target.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.target.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this.target.x-this.deadzone.right),this._edge=this.target.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.target.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this.target.y-this.deadzone.bottom)):(this.view.x=this.target.x-this.view.halfWidth,this.view.y=this.target.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x),this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width),this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top),this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height),this.view.floor()},setPosition:function(a,b){this.view.x=a,this.view.y=b,this.bounds&&this.checkBounds()},setSize:function(a,b){this.view.width=a,this.view.height=b},reset:function(){this.target=null,this.view.x=0,this.view.y=0}},b.Camera.prototype.constructor=b.Camera,Object.defineProperty(b.Camera.prototype,"x",{get:function(){return this.view.x},set:function(a){this.view.x=a,this.bounds&&this.checkBounds()}}),Object.defineProperty(b.Camera.prototype,"y",{get:function(){return this.view.y},set:function(a){this.view.y=a,this.bounds&&this.checkBounds()}}),Object.defineProperty(b.Camera.prototype,"width",{get:function(){return this.view.width},set:function(a){this.view.width=a}}),Object.defineProperty(b.Camera.prototype,"height",{get:function(){return this.view.height},set:function(a){this.view.height=a}}),b.State=function(){this.game=null,this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},b.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}},b.State.prototype.constructor=b.State,b.StateManager=function(a,b){this.game=a,this.states={},this._pendingState=null,"undefined"!=typeof b&&null!==b&&(this._pendingState=b),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},b.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),this.game.load.onLoadComplete.add(this.loadComplete,this),null!==this._pendingState&&("string"==typeof this._pendingState?this.start(this._pendingState,!1,!1):this.add("default",this._pendingState,!0))},add:function(a,c,d){"undefined"==typeof d&&(d=!1);var e;return c instanceof b.State?e=c:"object"==typeof c?(e=c,e.game=this.game):"function"==typeof c&&(e=new c(this.game)),this.states[a]=e,d&&(this.game.isBooted?this.start(a):this._pendingState=a),e},remove:function(a){this.current===a&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[a]},start:function(a,b,c){"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!1),this.checkState(a)&&(this._pendingState=a,this._clearWorld=b,this._clearCache=c,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(a,b){"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!1),this._pendingState=this.current,this._clearWorld=a,this._clearCache=b,arguments.length>2&&(this._args=Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){this._pendingState&&this.game.isBooted&&(this.current&&(this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache===!0&&this.game.cache.destroy())),this.setCurrentState(this._pendingState),this.onPreloadCallback?(this.game.load.reset(),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete(),this.current===this._pendingState&&(this._pendingState=null))},checkState:function(a){if(this.states[a]){var b=!1;return this.states[a].preload&&(b=!0),this.states[a].create&&(b=!0),this.states[a].update&&(b=!0),this.states[a].render&&(b=!0),b===!1?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+a),!1},link:function(a){this.states[a].game=this.game,this.states[a].add=this.game.add,this.states[a].make=this.game.make,this.states[a].camera=this.game.camera,this.states[a].cache=this.game.cache,this.states[a].input=this.game.input,this.states[a].load=this.game.load,this.states[a].math=this.game.math,this.states[a].sound=this.game.sound,this.states[a].scale=this.game.scale,this.states[a].state=this,this.states[a].stage=this.game.stage,this.states[a].time=this.game.time,this.states[a].tweens=this.game.tweens,this.states[a].world=this.game.world,this.states[a].particles=this.game.particles,this.states[a].rnd=this.game.rnd,this.states[a].physics=this.game.physics},setCurrentState:function(a){this.callbackContext=this.states[a],this.link(a),this.onInitCallback=this.states[a].init||this.dummy,this.onPreloadCallback=this.states[a].preload||null,this.onLoadRenderCallback=this.states[a].loadRender||null,this.onLoadUpdateCallback=this.states[a].loadUpdate||null,this.onCreateCallback=this.states[a].create||null,this.onUpdateCallback=this.states[a].update||null,this.onPreRenderCallback=this.states[a].preRender||null,this.onRenderCallback=this.states[a].render||null,this.onPausedCallback=this.states[a].paused||null,this.onResumedCallback=this.states[a].resumed||null,this.onPauseUpdateCallback=this.states[a].pauseUpdate||null,this.onShutDownCallback=this.states[a].shutdown||this.dummy,this.current=a,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),this._args=[]},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game)},render:function(){this._created&&this.onRenderCallback?(this.game.renderType===b.CANVAS&&(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0)),this.onRenderCallback.call(this.callbackContext,this.game),this.game.renderType===b.CANVAS&&this.game.context.restore()):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null}},b.StateManager.prototype.constructor=b.StateManager,b.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},b.LinkedList.prototype={add:function(a){return 0===this.total&&null===this.first&&null===this.last?(this.first=a,this.last=a,this.next=a,a.prev=this,this.total++,a):(this.last.next=a,a.prev=this.last,this.last=a,this.total++,a)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(a){return 1===this.total?(this.reset(),void(a.next=a.prev=null)):(a===this.first?this.first=this.first.next:a===this.last&&(this.last=this.last.prev),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),a.next=a.prev=null,null===this.first&&(this.last=null),void this.total--)},callAll:function(a){if(this.first&&this.last){var b=this.first;do b&&b[a]&&b[a].call(b),b=b.next;while(b!=this.last.next)}}},b.LinkedList.prototype.constructor=b.LinkedList,b.ArrayList=function(){this.total=0,this.position=0,this.list=[]},b.ArrayList.prototype={add:function(a){return this.exists(a)||(this.list.push(a),this.total++),a},getIndex:function(a){return this.list.indexOf(a)},exists:function(a){return this.list.indexOf(a)>-1},reset:function(){this.list.length=0,this.total=0},remove:function(a){var b=this.list.indexOf(a);return b>-1?(this.list.splice(b,1),this.total--,a):void 0},callAll:function(a){for(var b=Array.prototype.splice.call(arguments,1),c=this.list.length;c--;)this.list[c]&&this.list[c][a]&&this.list[c][a].apply(this.list[c],b)}},Object.defineProperty(b.ArrayList.prototype,"first",{get:function(){return this.position=0,this.total>0?this.list[0]:null}}),Object.defineProperty(b.ArrayList.prototype,"next",{get:function(){return this.position<this.total?(this.position++,this.list[this.position]):null}}),b.ArrayList.prototype.constructor=b.ArrayList,b.Signal=function(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){b.Signal.prototype.dispatch.apply(a,arguments)}},b.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e){var f,g=this._indexOfListener(a,d);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else f=new b.SignalBinding(this,a,c,d,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){return this.validateListener(a,"add"),this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){return this.validateListener(a,"addOnce"),this._registerListener(a,!0,b,c)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){"undefined"==typeof a&&(a=null);for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0},b.SignalBinding.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.Filter=function(a,c,d){this.game=a,this.type=b.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}},this.fragmentSrc=d||[]},b.Filter.prototype={init:function(){},setResolution:function(a,b){this.uniforms.resolution.value.x=a,this.uniforms.resolution.value.y=b},update:function(a){"undefined"!=typeof a&&(a.x>0&&(this.uniforms.mouse.x=a.x.toFixed(2)),a.y>0&&(this.uniforms.mouse.y=a.y.toFixed(2))),this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}},b.Filter.prototype.constructor=b.Filter,Object.defineProperty(b.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(a){this.uniforms.resolution.value.x=a}}),Object.defineProperty(b.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(a){this.uniforms.resolution.value.y=a}}),b.Plugin=function(a,b){"undefined"==typeof b&&(b=null),this.game=a,this.parent=b,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},b.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},b.Plugin.prototype.constructor=b.Plugin,b.PluginManager=function(a){this.game=a,this.plugins=[],this._len=0,this._i=0},b.PluginManager.prototype={add:function(a){var b=Array.prototype.splice.call(arguments,1),c=!1;return"function"==typeof a?a=new a(this.game,this):(a.game=this.game,a.parent=this),"function"==typeof a.preUpdate&&(a.hasPreUpdate=!0,c=!0),"function"==typeof a.update&&(a.hasUpdate=!0,c=!0),"function"==typeof a.postUpdate&&(a.hasPostUpdate=!0,c=!0),"function"==typeof a.render&&(a.hasRender=!0,c=!0),"function"==typeof a.postRender&&(a.hasPostRender=!0,c=!0),c?((a.hasPreUpdate||a.hasUpdate||a.hasPostUpdate)&&(a.active=!0),(a.hasRender||a.hasPostRender)&&(a.visible=!0),this._len=this.plugins.push(a),"function"==typeof a.init&&a.init.apply(a,b),a):null},remove:function(a){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===a)return a.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},b.PluginManager.prototype.constructor=b.PluginManager,b.Stage=function(a,c,d){this.game=a,this.offset=new b.Point,this.bounds=new b.Rectangle(0,0,c,d),PIXI.Stage.call(this,0),this.name="_stage_root",this.interactive=!1,this.disableVisibilityChange=!1,this.checkOffsetInterval=2500,this.exists=!0,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._nextOffsetCheck=0,this._backgroundColor=0,a.config&&this.parseConfig(a.config)},b.Stage.prototype=Object.create(PIXI.Stage.prototype),b.Stage.prototype.constructor=b.Stage,b.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var a=this.children.length,b=0;a>b;b++)this.children[b].preUpdate()},b.Stage.prototype.update=function(){for(var a=this.children.length;a--;)this.children[a].update()},b.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate(),this.game.world.camera.update();for(var a=this.children.length;a--;)this.children[a]!==this.game.world.camera.target&&this.children[a].postUpdate()}else{this.game.world.camera.update();for(var a=this.children.length;a--;)this.children[a].postUpdate()}this.checkOffsetInterval!==!1&&this.game.time.now>this._nextOffsetCheck&&(b.Canvas.getOffset(this.game.canvas,this.offset),this.bounds.x=this.offset.x,this.bounds.y=this.offset.y,this._nextOffsetCheck=this.game.time.now+this.checkOffsetInterval)},b.Stage.prototype.parseConfig=function(a){a.checkOffsetInterval&&(this.checkOffsetInterval=a.checkOffsetInterval),a.disableVisibilityChange&&(this.disableVisibilityChange=a.disableVisibilityChange),a.fullScreenScaleMode&&(this.fullScreenScaleMode=a.fullScreenScaleMode),a.scaleMode&&(this.scaleMode=a.scaleMode),a.backgroundColor&&(this.backgroundColor=a.backgroundColor)},b.Stage.prototype.boot=function(){b.Canvas.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.game.width,this.game.height);var a=this;this._onChange=function(b){return a.visibilityChange(b)},b.Canvas.setUserSelect(this.game.canvas,"none"),b.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},b.Stage.prototype.checkVisibility=function(){this._hiddenVar=void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.hidden?"visibilitychange":null,this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.onblur=this._onChange,window.onfocus=this._onChange },b.Stage.prototype.visibilityChange=function(a){return"pagehide"===a.type||"blur"===a.type||"pageshow"===a.type||"focus"===a.type?void("pagehide"===a.type||"blur"===a.type?this.game.focusLoss(a):("pageshow"===a.type||"focus"===a.type)&&this.game.focusGain(a)):void(this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden?this.game.gamePaused(a):this.game.gameResumed(a)))},b.Stage.prototype.setBackgroundColor=function(a){if("string"==typeof a){var c=b.Color.hexToColor(a);this._backgroundColor=b.Color.getColor(c.r,c.g,c.b)}else{var c=b.Color.getRGB(a);this._backgroundColor=a}this.backgroundColorSplit=[c.r/255,c.g/255,c.b/255],this.backgroundColorString=b.Color.RGBtoString(c.r,c.g,c.b,255,"#")},Object.defineProperty(b.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(a){this.game.transparent||this.setBackgroundColor(a)}}),Object.defineProperty(b.Stage.prototype,"smoothed",{get:function(){return!PIXI.scaleModes.LINEAR},set:function(a){PIXI.scaleModes.LINEAR=a?0:1}}),b.Group=function(a,c,d,e,f,g){"undefined"==typeof e&&(e=!1),"undefined"==typeof f&&(f=!1),"undefined"==typeof g&&(g=b.Physics.ARCADE),this.game=a,"undefined"==typeof c&&(c=a.world),this.name=d||"group",PIXI.DisplayObjectContainer.call(this),e?this.game.stage.addChild(this):c&&c.addChild(this),this.z=0,this.type=b.GROUP,this.alive=!0,this.exists=!0,this.classType=b.Sprite,this.scale=new b.Point(1,1),this.cursor=null,this.cameraOffset=new b.Point,this.enableBody=f,this.enableBodyDebug=!1,this.physicsBodyType=g,this._sortProperty="z",this._cache=[0,0,0,0,1,0,1,0,0,0]},b.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),b.Group.prototype.constructor=b.Group,b.Group.RETURN_NONE=0,b.Group.RETURN_TOTAL=1,b.Group.RETURN_CHILD=2,b.Group.SORT_ASCENDING=-1,b.Group.SORT_DESCENDING=1,b.Group.prototype.add=function(a,b){return"undefined"==typeof b&&(b=!1),a.parent!==this&&(this.enableBody&&this.game.physics.enable(a,this.physicsBodyType),this.addChild(a),a.z=this.children.length,!b&&a.events&&a.events.onAddedToGroup.dispatch(a,this),null===this.cursor&&(this.cursor=a)),a},b.Group.prototype.addAt=function(a,b,c){return"undefined"==typeof c&&(c=!1),a.parent!==this&&(this.enableBody&&this.game.physics.enable(a,this.physicsBodyType),this.addChildAt(a,b),this.updateZ(),!c&&a.events&&a.events.onAddedToGroup.dispatch(a,this),null===this.cursor&&(this.cursor=a)),a},b.Group.prototype.getAt=function(a){return 0>a||a>=this.children.length?-1:this.getChildAt(a)},b.Group.prototype.create=function(a,b,c,d,e){"undefined"==typeof e&&(e=!0);var f=new this.classType(this.game,a,b,c,d);return this.enableBody&&this.game.physics.enable(f,this.physicsBodyType),f.exists=e,f.visible=e,f.alive=e,this.addChild(f),f.z=this.children.length,f.events&&f.events.onAddedToGroup.dispatch(f,this),null===this.cursor&&(this.cursor=f),f},b.Group.prototype.createMultiple=function(a,b,c,d){"undefined"==typeof d&&(d=!1);for(var e=0;a>e;e++)this.create(0,0,b,c,d)},b.Group.prototype.updateZ=function(){for(var a=this.children.length;a--;)this.children[a].z=a},b.Group.prototype.resetCursor=function(a){return"undefined"==typeof a&&(a=0),a>this.children.length-1&&(a=0),this.cursor?(this._cache[8]=a,this.cursor=this.children[this._cache[8]],this.cursor):void 0},b.Group.prototype.next=function(){return this.cursor?(this._cache[8]>=this.children.length-1?this._cache[8]=0:this._cache[8]++,this.cursor=this.children[this._cache[8]],this.cursor):void 0},b.Group.prototype.previous=function(){return this.cursor?(0===this._cache[8]?this._cache[8]=this.children.length-1:this._cache[8]--,this.cursor=this.children[this._cache[8]],this.cursor):void 0},b.Group.prototype.swap=function(a,b){var c=this.swapChildren(a,b);return c&&this.updateZ(),c},b.Group.prototype.bringToTop=function(a){return a.parent===this&&this.getIndex(a)<this.children.length&&(this.remove(a,!1,!0),this.add(a,!0)),a},b.Group.prototype.sendToBack=function(a){return a.parent===this&&this.getIndex(a)>0&&(this.remove(a,!1,!0),this.addAt(a,0,!0)),a},b.Group.prototype.moveUp=function(a){if(a.parent===this&&this.getIndex(a)<this.children.length-1){var b=this.getIndex(a),c=this.getAt(b+1);c&&this.swap(a,c)}return a},b.Group.prototype.moveDown=function(a){if(a.parent===this&&this.getIndex(a)>0){var b=this.getIndex(a),c=this.getAt(b-1);c&&this.swap(a,c)}return a},b.Group.prototype.xy=function(a,b,c){return 0>a||a>this.children.length?-1:(this.getChildAt(a).x=b,void(this.getChildAt(a).y=c))},b.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},b.Group.prototype.getIndex=function(a){return this.children.indexOf(a)},b.Group.prototype.replace=function(a,c){var d=this.getIndex(a);if(-1!==d){void 0!==c.parent&&(c.events.onRemovedFromGroup.dispatch(c,this),c.parent.removeChild(c),c.parent instanceof b.Group&&c.parent.updateZ());var e=a;return this.remove(e),this.addAt(c,d),e}},b.Group.prototype.hasProperty=function(a,b){var c=b.length;return 1===c&&b[0]in a?!0:2===c&&b[0]in a&&b[1]in a[b[0]]?!0:3===c&&b[0]in a&&b[1]in a[b[0]]&&b[2]in a[b[0]][b[1]]?!0:4===c&&b[0]in a&&b[1]in a[b[0]]&&b[2]in a[b[0]][b[1]]&&b[3]in a[b[0]][b[1]][b[2]]?!0:!1},b.Group.prototype.setProperty=function(a,b,c,d,e){if("undefined"==typeof e&&(e=!1),d=d||0,!this.hasProperty(a,b)&&(!e||d>0))return!1;var f=b.length;return 1===f?0===d?a[b[0]]=c:1==d?a[b[0]]+=c:2==d?a[b[0]]-=c:3==d?a[b[0]]*=c:4==d&&(a[b[0]]/=c):2===f?0===d?a[b[0]][b[1]]=c:1==d?a[b[0]][b[1]]+=c:2==d?a[b[0]][b[1]]-=c:3==d?a[b[0]][b[1]]*=c:4==d&&(a[b[0]][b[1]]/=c):3===f?0===d?a[b[0]][b[1]][b[2]]=c:1==d?a[b[0]][b[1]][b[2]]+=c:2==d?a[b[0]][b[1]][b[2]]-=c:3==d?a[b[0]][b[1]][b[2]]*=c:4==d&&(a[b[0]][b[1]][b[2]]/=c):4===f&&(0===d?a[b[0]][b[1]][b[2]][b[3]]=c:1==d?a[b[0]][b[1]][b[2]][b[3]]+=c:2==d?a[b[0]][b[1]][b[2]][b[3]]-=c:3==d?a[b[0]][b[1]][b[2]][b[3]]*=c:4==d&&(a[b[0]][b[1]][b[2]][b[3]]/=c)),!0},b.Group.prototype.set=function(a,b,c,d,e,f,g){return"undefined"==typeof g&&(g=!1),b=b.split("."),"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),(d===!1||d&&a.alive)&&(e===!1||e&&a.visible)?this.setProperty(a,b,c,f,g):void 0},b.Group.prototype.setAll=function(a,b,c,d,e,f){"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=!1),"undefined"==typeof f&&(f=!1),a=a.split("."),e=e||0;for(var g=0,h=this.children.length;h>g;g++)(!c||c&&this.children[g].alive)&&(!d||d&&this.children[g].visible)&&this.setProperty(this.children[g],a,b,e,f)},b.Group.prototype.setAllChildren=function(a,c,d,e,f,g){"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),"undefined"==typeof g&&(g=!1),f=f||0;for(var h=0,i=this.children.length;i>h;h++)(!d||d&&this.children[h].alive)&&(!e||e&&this.children[h].visible)&&(this.children[h]instanceof b.Group?this.children[h].setAllChildren(a,c,d,e,f,g):this.setProperty(this.children[h],a.split("."),c,f,g))},b.Group.prototype.addAll=function(a,b,c,d){this.setAll(a,b,c,d,1)},b.Group.prototype.subAll=function(a,b,c,d){this.setAll(a,b,c,d,2)},b.Group.prototype.multiplyAll=function(a,b,c,d){this.setAll(a,b,c,d,3)},b.Group.prototype.divideAll=function(a,b,c,d){this.setAll(a,b,c,d,4)},b.Group.prototype.callAllExists=function(a,b){for(var c=Array.prototype.splice.call(arguments,2),d=0,e=this.children.length;e>d;d++)this.children[d].exists===b&&this.children[d][a]&&this.children[d][a].apply(this.children[d],c)},b.Group.prototype.callbackFromArray=function(a,b,c){if(1==c){if(a[b[0]])return a[b[0]]}else if(2==c){if(a[b[0]][b[1]])return a[b[0]][b[1]]}else if(3==c){if(a[b[0]][b[1]][b[2]])return a[b[0]][b[1]][b[2]]}else if(4==c){if(a[b[0]][b[1]][b[2]][b[3]])return a[b[0]][b[1]][b[2]][b[3]]}else if(a[b])return a[b];return!1},b.Group.prototype.callAll=function(a,b){if("undefined"!=typeof a){a=a.split(".");var c=a.length;if("undefined"==typeof b||null===b||""===b)b=null;else if("string"==typeof b){b=b.split(".");var d=b.length}for(var e=Array.prototype.splice.call(arguments,2),f=null,g=null,h=0,i=this.children.length;i>h;h++)f=this.callbackFromArray(this.children[h],a,c),b&&f?(g=this.callbackFromArray(this.children[h],b,d),f&&f.apply(g,e)):f&&f.apply(this.children[h],e)}},b.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var a=this.children.length;a--;)this.children[a].preUpdate();return!0},b.Group.prototype.update=function(){for(var a=this.children.length;a--;)this.children[a].update()},b.Group.prototype.postUpdate=function(){1===this._cache[7]&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var a=this.children.length;a--;)this.children[a].postUpdate()},b.Group.prototype.forEach=function(a,b,c){"undefined"==typeof c&&(c=!1);var d=Array.prototype.splice.call(arguments,3);d.unshift(null);for(var e=0,f=this.children.length;f>e;e++)(!c||c&&this.children[e].exists)&&(d[0]=this.children[e],a.apply(b,d))},b.Group.prototype.forEachExists=function(a,c){var d=Array.prototype.splice.call(arguments,2);d.unshift(null),this.iterate("exists",!0,b.Group.RETURN_TOTAL,a,c,d)},b.Group.prototype.forEachAlive=function(a,c){var d=Array.prototype.splice.call(arguments,2);d.unshift(null),this.iterate("alive",!0,b.Group.RETURN_TOTAL,a,c,d)},b.Group.prototype.forEachDead=function(a,c){var d=Array.prototype.splice.call(arguments,2);d.unshift(null),this.iterate("alive",!1,b.Group.RETURN_TOTAL,a,c,d)},b.Group.prototype.sort=function(a,c){this.children.length<2||("undefined"==typeof a&&(a="z"),"undefined"==typeof c&&(c=b.Group.SORT_ASCENDING),this._sortProperty=a,this.children.sort(c===b.Group.SORT_ASCENDING?this.ascendingSortHandler.bind(this):this.descendingSortHandler.bind(this)),this.updateZ())},b.Group.prototype.customSort=function(a,b){this.children.length<2||(this.children.sort(a.bind(b)),this.updateZ())},b.Group.prototype.ascendingSortHandler=function(a,b){return a[this._sortProperty]<b[this._sortProperty]?-1:a[this._sortProperty]>b[this._sortProperty]?1:a.z<b.z?-1:1},b.Group.prototype.descendingSortHandler=function(a,b){return a[this._sortProperty]<b[this._sortProperty]?1:a[this._sortProperty]>b[this._sortProperty]?-1:0},b.Group.prototype.iterate=function(a,c,d,e,f,g){if(d===b.Group.RETURN_TOTAL&&0===this.children.length)return 0;"undefined"==typeof e&&(e=!1);for(var h=0,i=0,j=this.children.length;j>i;i++)if(this.children[i][a]===c&&(h++,e&&(g[0]=this.children[i],e.apply(f,g)),d===b.Group.RETURN_CHILD))return this.children[i];return d===b.Group.RETURN_TOTAL?h:d===b.Group.RETURN_CHILD?null:void 0},b.Group.prototype.getFirstExists=function(a){return"boolean"!=typeof a&&(a=!0),this.iterate("exists",a,b.Group.RETURN_CHILD)},b.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,b.Group.RETURN_CHILD)},b.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,b.Group.RETURN_CHILD)},b.Group.prototype.getTop=function(){return this.children.length>0?this.children[this.children.length-1]:void 0},b.Group.prototype.getBottom=function(){return this.children.length>0?this.children[0]:void 0},b.Group.prototype.countLiving=function(){return this.iterate("alive",!0,b.Group.RETURN_TOTAL)},b.Group.prototype.countDead=function(){return this.iterate("alive",!1,b.Group.RETURN_TOTAL)},b.Group.prototype.getRandom=function(a,b){return 0===this.children.length?null:(a=a||0,b=b||this.children.length,this.game.math.getRandom(this.children,a,b))},b.Group.prototype.remove=function(a,b,c){if("undefined"==typeof b&&(b=!1),"undefined"==typeof c&&(c=!1),0===this.children.length||-1===this.children.indexOf(a))return!1;c||!a.events||a.destroyPhase||a.events.onRemovedFromGroup.dispatch(a,this);var d=this.removeChild(a);return this.updateZ(),this.cursor===a&&this.next(),b&&d&&d.destroy(!0),!0},b.Group.prototype.removeAll=function(a,b){if("undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=!1),0!==this.children.length){do{!b&&this.children[0].events&&this.children[0].events.onRemovedFromGroup.dispatch(this.children[0],this);var c=this.removeChild(this.children[0]);a&&c&&c.destroy(!0)}while(this.children.length>0);this.cursor=null}},b.Group.prototype.removeBetween=function(a,b,c,d){if("undefined"==typeof b&&(b=this.children.length),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=!1),0!==this.children.length){if(a>b||0>a||b>this.children.length)return!1;for(var e=b;e>=a;){!d&&this.children[e].events&&this.children[e].events.onRemovedFromGroup.dispatch(this.children[e],this);var f=this.removeChild(this.children[e]);c&&f&&f.destroy(!0),this.cursor===this.children[e]&&(this.cursor=null),e--}this.updateZ()}},b.Group.prototype.destroy=function(a,b){null!==this.game&&("undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!1),this.removeAll(a),this.cursor=null,this.filters=null,b||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(b.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,b.Group.RETURN_TOTAL)}}),Object.defineProperty(b.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(b.Group.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(a){this.rotation=b.Math.degToRad(a)}}),Object.defineProperty(b.Group.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),b.World=function(a){b.Group.call(this,a,null,"__world",!1),this.bounds=new b.Rectangle(0,0,a.width,a.height),this.camera=null},b.World.prototype=Object.create(b.Group.prototype),b.World.prototype.constructor=b.World,b.World.prototype.boot=function(){this.camera=new b.Camera(this.game,0,0,0,this.game.width,this.game.height),this.camera.displayObject=this,this.camera.scale=this.scale,this.game.camera=this.camera,this.game.stage.addChild(this)},b.World.prototype.setBounds=function(a,b,c,d){c<this.game.width&&(c=this.game.width),d<this.game.height&&(d=this.game.height),this.bounds.setTo(a,b,c,d),this.camera.bounds&&this.camera.bounds.setTo(a,b,c,d),this.game.physics.setBoundsToWorld()},b.World.prototype.shutdown=function(){this.destroy(!0,!0)},b.World.prototype.wrap=function(a,b,c,d,e){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=!0),c?(a.getBounds(),d&&a._currentBounds.right<this.bounds.x?a.x=this.bounds.right:d&&a._currentBounds.x>this.bounds.right&&(a.x=this.bounds.left),e&&a._currentBounds.bottom<this.bounds.top?a.y=this.bounds.bottom:e&&a._currentBounds.top>this.bounds.bottom&&(a.y=this.bounds.top)):(d&&a.x+b<this.bounds.x?a.x=this.bounds.right+b:d&&a.x-b>this.bounds.right&&(a.x=this.bounds.left-b),e&&a.y+b<this.bounds.top?a.y=this.bounds.bottom+b:e&&a.y-b>this.bounds.bottom&&(a.y=this.bounds.top-b))},Object.defineProperty(b.World.prototype,"width",{get:function(){return this.bounds.width},set:function(a){this.bounds.width=a}}),Object.defineProperty(b.World.prototype,"height",{get:function(){return this.bounds.height},set:function(a){this.bounds.height=a}}),Object.defineProperty(b.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(b.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(b.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}),Object.defineProperty(b.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}),b.ScaleManager=function(a,c,d){this.game=a,this.width=c,this.height=d,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this.pageAlignHorizontally=!1,this.pageAlignVertically=!1,this.maxIterations=5,this.orientationSprite=null,this.enterLandscape=new b.Signal,this.enterPortrait=new b.Signal,this.enterIncorrectOrientation=new b.Signal,this.leaveIncorrectOrientation=new b.Signal,this.hasResized=new b.Signal,this.fullScreenTarget=this.game.canvas,this.enterFullScreen=new b.Signal,this.leaveFullScreen=new b.Signal,this.orientation=0,window.orientation?this.orientation=window.orientation:window.outerWidth>window.outerHeight&&(this.orientation=90),this.scaleFactor=new b.Point(1,1),this.scaleFactorInversed=new b.Point(1,1),this.margin=new b.Point(0,0),this.bounds=new b.Rectangle(0,0,c,d),this.aspectRatio=0,this.sourceAspectRatio=c/d,this.event=null,this.scaleMode=b.ScaleManager.NO_SCALE,this.fullScreenScaleMode=b.ScaleManager.NO_SCALE,this._startHeight=0,this._width=0,this._height=0,this._check=null;var e=this;window.addEventListener("orientationchange",function(a){return e.checkOrientation(a)},!1),window.addEventListener("resize",function(a){return e.checkResize(a)},!1),this.game.device.cocoonJS||(document.addEventListener("webkitfullscreenchange",function(a){return e.fullScreenChange(a)},!1),document.addEventListener("mozfullscreenchange",function(a){return e.fullScreenChange(a)},!1),document.addEventListener("fullscreenchange",function(a){return e.fullScreenChange(a)},!1))},b.ScaleManager.EXACT_FIT=0,b.ScaleManager.NO_SCALE=1,b.ScaleManager.SHOW_ALL=2,b.ScaleManager.prototype={startFullScreen:function(a){!this.isFullScreen&&this.game.device.fullscreen&&("undefined"!=typeof a&&this.game.renderType===b.CANVAS&&(this.game.stage.smoothed=a),this._width=this.width,this._height=this.height,this.game.device.fullscreenKeyboard?this.fullScreenTarget[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):this.fullScreenTarget[this.game.device.requestFullscreen]())},stopFullScreen:function(){document[this.game.device.cancelFullscreen]()},fullScreenChange:function(a){this.event=a,this.isFullScreen?(this.fullScreenScaleMode===b.ScaleManager.EXACT_FIT?(this.fullScreenTarget.style.width="100%",this.fullScreenTarget.style.height="100%",this.width=window.outerWidth,this.height=window.outerHeight,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.checkResize()):this.fullScreenScaleMode===b.ScaleManager.SHOW_ALL&&(this.setShowAll(),this.refresh()),this.enterFullScreen.dispatch(this.width,this.height)):(this.fullScreenTarget.style.width=this.game.width+"px",this.fullScreenTarget.style.height=this.game.height+"px",this.width=this._width,this.height=this._height,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.leaveFullScreen.dispatch(this.width,this.height))},forceOrientation:function(a,c,d){"undefined"==typeof c&&(c=!1),this.forceLandscape=a,this.forcePortrait=c,"undefined"!=typeof d&&((null===d||this.game.cache.checkImageKey(d)===!1)&&(d="__default"),this.orientationSprite=new b.Image(this.game,this.game.width/2,this.game.height/2,PIXI.TextureCache[d]),this.orientationSprite.anchor.set(.5),this.checkOrientationState(),this.incorrectOrientation?(this.orientationSprite.visible=!0,this.game.world.visible=!1):(this.orientationSprite.visible=!1,this.game.world.visible=!0),this.game.stage.addChild(this.orientationSprite))},checkOrientationState:function(){this.incorrectOrientation?(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth)&&(this.incorrectOrientation=!1,this.leaveIncorrectOrientation.dispatch(),this.orientationSprite&&(this.orientationSprite.visible=!1,this.game.world.visible=!0),this.scaleMode!==b.ScaleManager.NO_SCALE&&this.refresh()):(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth)&&(this.incorrectOrientation=!0,this.enterIncorrectOrientation.dispatch(),this.orientationSprite&&this.orientationSprite.visible===!1&&(this.orientationSprite.visible=!0,this.game.world.visible=!1),this.scaleMode!==b.ScaleManager.NO_SCALE&&this.refresh())},checkOrientation:function(a){this.event=a,this.orientation=window.orientation,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.scaleMode!==b.ScaleManager.NO_SCALE&&this.refresh()},checkResize:function(a){this.event=a,this.orientation=window.outerWidth>window.outerHeight?90:0,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.scaleMode!==b.ScaleManager.NO_SCALE&&this.refresh(),this.checkOrientationState()},refresh:function(){if(this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),null===this._check&&this.maxIterations>0){this._iterations=this.maxIterations;var a=this;this._check=window.setInterval(function(){return a.setScreenSize()},10),this.setScreenSize()}},setScreenSize:function(a){"undefined"==typeof a&&(a=!1),this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),this._iterations--,(a||window.innerHeight>this._startHeight||this._iterations<0)&&(document.documentElement.style.minHeight=window.innerHeight+"px",this.incorrectOrientation?this.setMaximum():this.isFullScreen?this.fullScreenScaleMode===b.ScaleManager.EXACT_FIT?this.setExactFit():this.fullScreenScaleMode===b.ScaleManager.SHOW_ALL&&this.setShowAll():this.scaleMode===b.ScaleManager.EXACT_FIT?this.setExactFit():this.scaleMode===b.ScaleManager.SHOW_ALL&&this.setShowAll(),this.setSize(),clearInterval(this._check),this._check=null)},setSize:function(){this.incorrectOrientation||(this.maxWidth&&this.width>this.maxWidth&&(this.width=this.maxWidth),this.maxHeight&&this.height>this.maxHeight&&(this.height=this.maxHeight),this.minWidth&&this.width<this.minWidth&&(this.width=this.minWidth),this.minHeight&&this.height<this.minHeight&&(this.height=this.minHeight)),this.game.canvas.style.width=this.width+"px",this.game.canvas.style.height=this.height+"px",this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.pageAlignHorizontally&&(this.width<window.innerWidth&&!this.incorrectOrientation?(this.margin.x=Math.round((window.innerWidth-this.width)/2),this.game.canvas.style.marginLeft=this.margin.x+"px"):(this.margin.x=0,this.game.canvas.style.marginLeft="0px")),this.pageAlignVertically&&(this.height<window.innerHeight&&!this.incorrectOrientation?(this.margin.y=Math.round((window.innerHeight-this.height)/2),this.game.canvas.style.marginTop=this.margin.y+"px"):(this.margin.y=0,this.game.canvas.style.marginTop="0px")),b.Canvas.getOffset(this.game.canvas,this.game.stage.offset),this.bounds.setTo(this.game.stage.offset.x,this.game.stage.offset.y,this.width,this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.hasResized.dispatch(this.width,this.height),this.checkOrientationState()},setMaximum:function(){this.width=window.innerWidth,this.height=window.innerHeight},setShowAll:function(){var a=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*a),this.height=Math.round(this.game.height*a)},setExactFit:function(){var a=window.innerWidth,b=window.innerHeight;this.width=this.maxWidth&&a>this.maxWidth?this.maxWidth:a,this.height=this.maxHeight&&b>this.maxHeight?this.maxHeight:b}},b.ScaleManager.prototype.constructor=b.ScaleManager,Object.defineProperty(b.ScaleManager.prototype,"isFullScreen",{get:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(b.ScaleManager.prototype,"isPortrait",{get:function(){return 0===this.orientation||180===this.orientation}}),Object.defineProperty(b.ScaleManager.prototype,"isLandscape",{get:function(){return 90===this.orientation||-90===this.orientation}}),b.Game=function(a,c,d,e,f,g,h,i){this.id=b.GAMES.push(this)-1,this.config=null,this.physicsConfig=i,this.parent="",this.width=800,this.height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=b.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.rnd=null,this.device=null,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof a&&(this.width=a),"undefined"!=typeof c&&(this.height=c),"undefined"!=typeof d&&(this.renderer=d,this.renderType=d),"undefined"!=typeof e&&(this.parent=e),"undefined"!=typeof g&&(this.transparent=g),"undefined"!=typeof h&&(this.antialias=h),this.rnd=new b.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new b.StateManager(this,f));var j=this;return this._onBoot=function(){return j.boot()},"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(this._onBoot,0):(document.addEventListener("DOMContentLoaded",this._onBoot,!1),window.addEventListener("load",this._onBoot,!1)),this},b.Game.prototype={parseConfig:function(a){this.config=a,a.width&&(this.width=b.Utils.parseDimension(a.width,0)),a.height&&(this.height=b.Utils.parseDimension(a.height,1)),a.renderer&&(this.renderer=a.renderer,this.renderType=a.renderer),a.parent&&(this.parent=a.parent),a.transparent&&(this.transparent=a.transparent),a.antialias&&(this.antialias=a.antialias),a.preserveDrawingBuffer&&(this.preserveDrawingBuffer=a.preserveDrawingBuffer),a.physicsConfig&&(this.physicsConfig=a.physicsConfig);var c=[(Date.now()*Math.random()).toString()];a.seed&&(c=a.seed),this.rnd=new b.RandomDataGenerator(c);var d=null;a.state&&(d=a.state),this.state=new b.StateManager(this,d)},boot:function(){this.isBooted||(document.body?(document.removeEventListener("DOMContentLoaded",this._onBoot),window.removeEventListener("load",this._onBoot),this.onPause=new b.Signal,this.onResume=new b.Signal,this.onBlur=new b.Signal,this.onFocus=new b.Signal,this.isBooted=!0,this.device=new b.Device(this),this.math=b.Math,this.stage=new b.Stage(this,this.width,this.height),this.setUpRenderer(),this.scale=new b.ScaleManager(this,this.width,this.height),this.device.checkFullScreenSupport(),this.world=new b.World(this),this.add=new b.GameObjectFactory(this),this.make=new b.GameObjectCreator(this),this.cache=new b.Cache(this),this.load=new b.Loader(this),this.time=new b.Time(this),this.tweens=new b.TweenManager(this),this.input=new b.Input(this),this.sound=new b.SoundManager(this),this.physics=new b.Physics(this,this.physicsConfig),this.particles=new b.Particles(this),this.plugins=new b.PluginManager(this),this.net=new b.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug&&(this.debug=new b.Utils.Debug(this),this.debug.boot()),this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new b.RequestAnimationFrame(this,this.config.forceSetTimeOut):new b.RequestAnimationFrame(this,!1),this.raf.start()):window.setTimeout(this._onBoot,20))},showDebugHeader:function(){var a=b.VERSION,c="Canvas",d="HTML Audio",e=1;if(this.renderType===b.WEBGL?(c="WebGL",e++):this.renderType==b.HEADLESS&&(c="Headless"),this.device.webAudio&&(d="WebAudio",e++),this.device.chrome){for(var f=["%c %c %c Phaser v"+a+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+d+"  %c %c  http://phaser.io  %c %c â™¥%câ™¥%câ™¥ ","background: #0cf300","background: #00bc17","color: #ffffff; background: #00711f;","background: #00bc17","background: #0cf300","background: #00bc17"],g=0;3>g;g++)f.push(e>g?"color: #ff2424; background: #fff":"color: #959595; background: #fff");console.log.apply(console,f)}else window.console&&console.log("Phaser v"+a+" | Pixi.js "+PIXI.VERSION+" | "+c+" | "+d+" | http://phaser.io")},setUpRenderer:function(){if(this.device.trident&&(this.renderType=b.CANVAS),this.canvas=this.config.canvasID?b.Canvas.create(this.width,this.height,this.config.canvasID):b.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=!0),this.renderType===b.HEADLESS||this.renderType===b.CANVAS||this.renderType===b.AUTO&&this.device.webGL===!1){if(!this.device.canvas)throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType===b.AUTO&&(this.renderType=b.CANVAS),this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.canvas,this.transparent),this.context=this.renderer.context}else this.renderType=b.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias,this.preserveDrawingBuffer),this.context=null;this.renderType!==b.HEADLESS&&(this.stage.smoothed=this.antialias,b.Canvas.addToDOM(this.canvas,this.parent,!1),b.Canvas.setTouchAction(this.canvas))},update:function(a){this.time.update(a),this._paused||this.pendingStep?(this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.debug.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(),this.plugins.preUpdate(),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.renderType!=b.HEADLESS&&(this.state.preRender(),this.renderer.render(this.stage),this.plugins.render(),this.state.render(),this.plugins.postRender(),this.device.cocoonJS&&this.renderType===b.CANVAS&&1===this.stage.currentRenderOrderID&&this.context.fillRect(0,0,0,0))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.input.destroy(),this.state.destroy(),this.physics.destroy(),this.state=null,this.cache=null,this.input=null,this.load=null,this.sound=null,this.stage=null,this.time=null,this.world=null,this.isBooted=!1},gamePaused:function(a){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(a))},gameResumed:function(a){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(a))},focusLoss:function(a){this.onBlur.dispatch(a),this.stage.disableVisibilityChange||this.gamePaused(a)},focusGain:function(a){this.onFocus.dispatch(a),this.stage.disableVisibilityChange||this.gameResumed(a)}},b.Game.prototype.constructor=b.Game,Object.defineProperty(b.Game.prototype,"paused",{get:function(){return this._paused},set:function(a){a===!0?this._paused===!1&&(this._paused=!0,this._codePaused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)):this._paused&&(this._paused=!1,this._codePaused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)) }}),b.Input=function(a){this.game=a,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.moveCallback=null,this.moveCallbackContext=this,this.pollRate=0,this.disabled=!1,this.multiInputOverride=b.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=10,this.currentPointers=0,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new b.ArrayList,this._localPoint=new b.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},b.Input.MOUSE_OVERRIDES_TOUCH=0,b.Input.TOUCH_OVERRIDES_MOUSE=1,b.Input.MOUSE_TOUCH_COMBINE=2,b.Input.prototype={boot:function(){this.mousePointer=new b.Pointer(this.game,0),this.pointer1=new b.Pointer(this.game,1),this.pointer2=new b.Pointer(this.game,2),this.mouse=new b.Mouse(this.game),this.keyboard=new b.Keyboard(this.game),this.touch=new b.Touch(this.game),this.mspointer=new b.MSPointer(this.game),this.gamepad=new b.Gamepad(this.game),this.onDown=new b.Signal,this.onUp=new b.Signal,this.onTap=new b.Signal,this.onHold=new b.Signal,this.scale=new b.Point(1,1),this.speed=new b.Point,this.position=new b.Point,this._oldPosition=new b.Point,this.circle=new b.Circle(0,0,44),this.activePointer=this.mousePointer,this.currentPointers=0,this.hitCanvas=document.createElement("canvas"),this.hitCanvas.width=1,this.hitCanvas.height=1,this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.keyboard.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0},destroy:function(){this.mouse.stop(),this.keyboard.stop(),this.touch.stop(),this.mspointer.stop(),this.gamepad.stop(),this.moveCallbacks=[],this.moveCallback=null},setMoveCallback:function(a,b){this.moveCallback=a,this.moveCallbackContext=b},addMoveCallback:function(a,b){return this.moveCallbacks.push({callback:a,context:b})-1},deleteMoveCallback:function(a){this.moveCallbacks[a]&&this.moveCallbacks.splice(a,1)},addPointer:function(){for(var a=0,c=10;c>0;c--)null===this["pointer"+c]&&(a=c);return 0===a?(console.warn("You can only have 10 Pointer objects"),null):(this["pointer"+a]=new b.Pointer(this.game,a),this["pointer"+a])},update:function(){return this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate?void this._pollCounter++:(this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad.active&&this.gamepad.update(),this.pointer1.update(),this.pointer2.update(),this.pointer3&&this.pointer3.update(),this.pointer4&&this.pointer4.update(),this.pointer5&&this.pointer5.update(),this.pointer6&&this.pointer6.update(),this.pointer7&&this.pointer7.update(),this.pointer8&&this.pointer8.update(),this.pointer9&&this.pointer9.update(),this.pointer10&&this.pointer10.update(),void(this._pollCounter=0))},reset:function(a){if(this.game.isBooted&&!this.resetLocked){"undefined"==typeof a&&(a=!1),this.keyboard.reset(a),this.mousePointer.reset(),this.gamepad.reset();for(var c=1;10>=c;c++)this["pointer"+c]&&this["pointer"+c].reset();this.currentPointers=0,"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),a&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new b.Signal,this.onUp=new b.Signal,this.onTap=new b.Signal,this.onHold=new b.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(a,b){this._oldPosition.setTo(a,b),this.speed.setTo(0,0)},startPointer:function(a){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers)return null;if(this.pointer1.active===!1)return this.pointer1.start(a);if(this.pointer2.active===!1)return this.pointer2.start(a);for(var b=3;10>=b;b++)if(this["pointer"+b]&&this["pointer"+b].active===!1)return this["pointer"+b].start(a);return null},updatePointer:function(a){if(this.pointer1.active&&this.pointer1.identifier==a.identifier)return this.pointer1.move(a);if(this.pointer2.active&&this.pointer2.identifier==a.identifier)return this.pointer2.move(a);for(var b=3;10>=b;b++)if(this["pointer"+b]&&this["pointer"+b].active&&this["pointer"+b].identifier==a.identifier)return this["pointer"+b].move(a);return null},stopPointer:function(a){if(this.pointer1.active&&this.pointer1.identifier==a.identifier)return this.pointer1.stop(a);if(this.pointer2.active&&this.pointer2.identifier==a.identifier)return this.pointer2.stop(a);for(var b=3;10>=b;b++)if(this["pointer"+b]&&this["pointer"+b].active&&this["pointer"+b].identifier==a.identifier)return this["pointer"+b].stop(a);return null},getPointer:function(a){if(a=a||!1,this.pointer1.active==a)return this.pointer1;if(this.pointer2.active==a)return this.pointer2;for(var b=3;10>=b;b++)if(this["pointer"+b]&&this["pointer"+b].active==a)return this["pointer"+b];return null},getPointerFromIdentifier:function(a){if(this.pointer1.identifier===a)return this.pointer1;if(this.pointer2.identifier===a)return this.pointer2;for(var b=3;10>=b;b++)if(this["pointer"+b]&&this["pointer"+b].identifier===a)return this["pointer"+b];return null},getPointerFromId:function(a){if(this.pointer1.pointerId===a)return this.pointer1;if(this.pointer2.pointerId===a)return this.pointer2;for(var b=3;10>=b;b++)if(this["pointer"+b]&&this["pointer"+b].pointerId===a)return this["pointer"+b];return null},getLocalPosition:function(a,c,d){"undefined"==typeof d&&(d=new b.Point);var e=a.worldTransform,f=1/(e.a*e.d+e.b*-e.c);return d.setTo(e.d*f*c.x+-e.b*f*c.y+(e.ty*e.b-e.tx*e.d)*f,e.a*f*c.y+-e.c*f*c.x+(-e.ty*e.a+e.tx*e.c)*f)},hitTest:function(a,c,d){if(!a.worldVisible)return!1;if(this.getLocalPosition(a,c,this._localPoint),d.copyFrom(this._localPoint),a.hitArea&&a.hitArea.contains)return a.hitArea.contains(this._localPoint.x,this._localPoint.y)?!0:!1;if(a instanceof b.TileSprite){var e=a.width,f=a.height,g=-e*a.anchor.x;if(this._localPoint.x>g&&this._localPoint.x<g+e){var h=-f*a.anchor.y;if(this._localPoint.y>h&&this._localPoint.y<h+f)return!0}}else if(a instanceof PIXI.Sprite){var e=a.texture.frame.width,f=a.texture.frame.height,g=-e*a.anchor.x;if(this._localPoint.x>g&&this._localPoint.x<g+e){var h=-f*a.anchor.y;if(this._localPoint.y>h&&this._localPoint.y<h+f)return!0}}for(var i=0,j=a.children.length;j>i;i++)if(this.hitTest(a.children[i],c,d))return!0;return!1}},b.Input.prototype.constructor=b.Input,Object.defineProperty(b.Input.prototype,"x",{get:function(){return this._x},set:function(a){this._x=Math.floor(a)}}),Object.defineProperty(b.Input.prototype,"y",{get:function(){return this._y},set:function(a){this._y=Math.floor(a)}}),Object.defineProperty(b.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(b.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}}),Object.defineProperty(b.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var a=1;10>=a;a++)this["pointer"+a]&&this["pointer"+a].active&&this.currentPointers++;return this.currentPointers}}),Object.defineProperty(b.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(b.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),b.Key=function(a,c){this.game=a,this.enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=c,this.onDown=new b.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new b.Signal},b.Key.prototype={update:function(){this.enabled&&this.isDown&&(this.duration=this.game.time.now-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(a){this.enabled&&(this.event=a,this.isDown||(this.altKey=a.altKey,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.onDown.dispatch(this)))},processKeyUp:function(a){this.enabled&&(this.event=a,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=this.game.time.now-this.timeDown,this.onUp.dispatch(this)))},reset:function(a){"undefined"==typeof a&&(a=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=0,this.enabled=!0,a&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},justPressed:function(a){return"undefined"==typeof a&&(a=50),this.isDown&&this.duration<a},justReleased:function(a){return"undefined"==typeof a&&(a=50),!this.isDown&&this.game.time.now-this.timeUp<a}},b.Key.prototype.constructor=b.Key,b.Keyboard=function(a){this.game=a,this.disabled=!1,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},b.Keyboard.prototype={addCallbacks:function(a,b,c,d){this.callbackContext=a,"undefined"!=typeof b&&(this.onDownCallback=b),"undefined"!=typeof c&&(this.onUpCallback=c),"undefined"!=typeof d&&(this.onPressCallback=d)},addKey:function(a){return this._keys[a]||(this._keys[a]=new b.Key(this.game,a),this.addKeyCapture(a)),this._keys[a]},removeKey:function(a){this._keys[a]&&(this._keys[a]=null,this.removeKeyCapture(a))},createCursorKeys:function(){return{up:this.addKey(b.Keyboard.UP),down:this.addKey(b.Keyboard.DOWN),left:this.addKey(b.Keyboard.LEFT),right:this.addKey(b.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var a=this;this._onKeyDown=function(b){return a.processKeyDown(b)},this._onKeyUp=function(b){return a.processKeyUp(b)},this._onKeyPress=function(b){return a.processKeyPress(b)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(a){if("object"==typeof a)for(var b in a)this._capture[a[b]]=!0;else this._capture[a]=!0},removeKeyCapture:function(a){delete this._capture[a]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(a){this.event=a,this.game.input.disabled||this.disabled||(this._capture[a.keyCode]&&a.preventDefault(),this._keys[a.keyCode]||(this._keys[a.keyCode]=new b.Key(this.game,a.keyCode)),this._keys[a.keyCode].processKeyDown(a),this._k=a.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a))},processKeyPress:function(a){this.pressEvent=a,this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(a.charCode),a)},processKeyUp:function(a){this.event=a,this.game.input.disabled||this.disabled||(this._capture[a.keyCode]&&a.preventDefault(),this._keys[a.keyCode]||(this._keys[a.keyCode]=new b.Key(this.game,a.keyCode)),this._keys[a.keyCode].processKeyUp(a),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a))},reset:function(a){"undefined"==typeof a&&(a=!0),this.event=null;for(var b=this._keys.length;b--;)this._keys[b]&&this._keys[b].reset(a)},justPressed:function(a,b){return"undefined"==typeof b&&(b=50),this._keys[a]?this._keys[a].justPressed(b):!1},justReleased:function(a,b){return"undefined"==typeof b&&(b=50),this._keys[a]?this._keys[a].justReleased(b):!1},isDown:function(a){return this._keys[a]?this._keys[a].isDown:!1}},Object.defineProperty(b.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(b.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),b.Keyboard.prototype.constructor=b.Keyboard,b.Keyboard.A="A".charCodeAt(0),b.Keyboard.B="B".charCodeAt(0),b.Keyboard.C="C".charCodeAt(0),b.Keyboard.D="D".charCodeAt(0),b.Keyboard.E="E".charCodeAt(0),b.Keyboard.F="F".charCodeAt(0),b.Keyboard.G="G".charCodeAt(0),b.Keyboard.H="H".charCodeAt(0),b.Keyboard.I="I".charCodeAt(0),b.Keyboard.J="J".charCodeAt(0),b.Keyboard.K="K".charCodeAt(0),b.Keyboard.L="L".charCodeAt(0),b.Keyboard.M="M".charCodeAt(0),b.Keyboard.N="N".charCodeAt(0),b.Keyboard.O="O".charCodeAt(0),b.Keyboard.P="P".charCodeAt(0),b.Keyboard.Q="Q".charCodeAt(0),b.Keyboard.R="R".charCodeAt(0),b.Keyboard.S="S".charCodeAt(0),b.Keyboard.T="T".charCodeAt(0),b.Keyboard.U="U".charCodeAt(0),b.Keyboard.V="V".charCodeAt(0),b.Keyboard.W="W".charCodeAt(0),b.Keyboard.X="X".charCodeAt(0),b.Keyboard.Y="Y".charCodeAt(0),b.Keyboard.Z="Z".charCodeAt(0),b.Keyboard.ZERO="0".charCodeAt(0),b.Keyboard.ONE="1".charCodeAt(0),b.Keyboard.TWO="2".charCodeAt(0),b.Keyboard.THREE="3".charCodeAt(0),b.Keyboard.FOUR="4".charCodeAt(0),b.Keyboard.FIVE="5".charCodeAt(0),b.Keyboard.SIX="6".charCodeAt(0),b.Keyboard.SEVEN="7".charCodeAt(0),b.Keyboard.EIGHT="8".charCodeAt(0),b.Keyboard.NINE="9".charCodeAt(0),b.Keyboard.NUMPAD_0=96,b.Keyboard.NUMPAD_1=97,b.Keyboard.NUMPAD_2=98,b.Keyboard.NUMPAD_3=99,b.Keyboard.NUMPAD_4=100,b.Keyboard.NUMPAD_5=101,b.Keyboard.NUMPAD_6=102,b.Keyboard.NUMPAD_7=103,b.Keyboard.NUMPAD_8=104,b.Keyboard.NUMPAD_9=105,b.Keyboard.NUMPAD_MULTIPLY=106,b.Keyboard.NUMPAD_ADD=107,b.Keyboard.NUMPAD_ENTER=108,b.Keyboard.NUMPAD_SUBTRACT=109,b.Keyboard.NUMPAD_DECIMAL=110,b.Keyboard.NUMPAD_DIVIDE=111,b.Keyboard.F1=112,b.Keyboard.F2=113,b.Keyboard.F3=114,b.Keyboard.F4=115,b.Keyboard.F5=116,b.Keyboard.F6=117,b.Keyboard.F7=118,b.Keyboard.F8=119,b.Keyboard.F9=120,b.Keyboard.F10=121,b.Keyboard.F11=122,b.Keyboard.F12=123,b.Keyboard.F13=124,b.Keyboard.F14=125,b.Keyboard.F15=126,b.Keyboard.COLON=186,b.Keyboard.EQUALS=187,b.Keyboard.UNDERSCORE=189,b.Keyboard.QUESTION_MARK=191,b.Keyboard.TILDE=192,b.Keyboard.OPEN_BRACKET=219,b.Keyboard.BACKWARD_SLASH=220,b.Keyboard.CLOSED_BRACKET=221,b.Keyboard.QUOTES=222,b.Keyboard.BACKSPACE=8,b.Keyboard.TAB=9,b.Keyboard.CLEAR=12,b.Keyboard.ENTER=13,b.Keyboard.SHIFT=16,b.Keyboard.CONTROL=17,b.Keyboard.ALT=18,b.Keyboard.CAPS_LOCK=20,b.Keyboard.ESC=27,b.Keyboard.SPACEBAR=32,b.Keyboard.PAGE_UP=33,b.Keyboard.PAGE_DOWN=34,b.Keyboard.END=35,b.Keyboard.HOME=36,b.Keyboard.LEFT=37,b.Keyboard.UP=38,b.Keyboard.RIGHT=39,b.Keyboard.DOWN=40,b.Keyboard.INSERT=45,b.Keyboard.DELETE=46,b.Keyboard.HELP=47,b.Keyboard.NUM_LOCK=144,b.Mouse=function(a){this.game=a,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseMoveCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.disabled=!1,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new b.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null},b.Mouse.NO_BUTTON=-1,b.Mouse.LEFT_BUTTON=0,b.Mouse.MIDDLE_BUTTON=1,b.Mouse.RIGHT_BUTTON=2,b.Mouse.WHEEL_UP=1,b.Mouse.WHEEL_DOWN=-1,b.Mouse.prototype={start:function(){if((!this.game.device.android||this.game.device.chrome!==!1)&&null===this._onMouseDown){var a=this;this._onMouseDown=function(b){return a.onMouseDown(b)},this._onMouseMove=function(b){return a.onMouseMove(b)},this._onMouseUp=function(b){return a.onMouseUp(b)},this._onMouseOut=function(b){return a.onMouseOut(b)},this._onMouseOver=function(b){return a.onMouseOver(b)},this._onMouseWheel=function(b){return a.onMouseWheel(b)},this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0),this.game.canvas.addEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.addEventListener("DOMMouseScroll",this._onMouseWheel,!0),this.game.device.cocoonJS||(this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0))}},onMouseDown:function(a){this.event=a,this.capture&&a.preventDefault(),this.button=a.button,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,a),this.game.input.disabled||this.disabled||(a.identifier=0,this.game.input.mousePointer.start(a))},onMouseMove:function(a){this.event=a,this.capture&&a.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,a),this.game.input.disabled||this.disabled||(a.identifier=0,this.game.input.mousePointer.move(a))},onMouseUp:function(a){this.event=a,this.capture&&a.preventDefault(),this.button=b.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,a),this.game.input.disabled||this.disabled||(a.identifier=0,this.game.input.mousePointer.stop(a))},onMouseOut:function(a){this.event=a,this.capture&&a.preventDefault(),this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,a),this.game.input.disabled||this.disabled||(this.game.input.mousePointer.withinGame=!1,this.stopOnGameOut&&(a.identifier=0,this.game.input.mousePointer.stop(a)))},onMouseWheel:function(a){this.event=a,this.capture&&a.preventDefault(),this.wheelDelta=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,a)},onMouseOver:function(a){this.event=a,this.capture&&a.preventDefault(),this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,a),this.game.input.disabled||this.disabled||(this.game.input.mousePointer.withinGame=!0)},requestPointerLock:function(){if(this.game.device.pointerLock){var a=this.game.canvas;a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock();var b=this;this._pointerLockChange=function(a){return b.pointerLockChange(a)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(a){var b=this.game.canvas;document.pointerLockElement===b||document.mozPointerLockElement===b||document.webkitPointerLockElement===b?(this.locked=!0,this.pointerLock.dispatch(!0,a)):(this.locked=!1,this.pointerLock.dispatch(!1,a))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0),this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0),this.game.canvas.removeEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.removeEventListener("DOMMouseScroll",this._onMouseWheel,!0)}},b.Mouse.prototype.constructor=b.Mouse,b.MSPointer=function(a){this.game=a,this.callbackContext=this.game,this.disabled=!1,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null},b.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var a=this;this.game.device.mspointer===!0&&(this._onMSPointerDown=function(b){return a.onPointerDown(b)},this._onMSPointerMove=function(b){return a.onPointerMove(b)},this._onMSPointerUp=function(b){return a.onPointerUp(b)},this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.renderer.view.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.renderer.view.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.renderer.view.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.renderer.view.style["-ms-content-zooming"]="none",this.game.renderer.view.style["-ms-touch-action"]="none")}},onPointerDown:function(a){this.game.input.disabled||this.disabled||(a.preventDefault(),a.identifier=a.pointerId,this.game.input.startPointer(a))},onPointerMove:function(a){this.game.input.disabled||this.disabled||(a.preventDefault(),a.identifier=a.pointerId,this.game.input.updatePointer(a))},onPointerUp:function(a){this.game.input.disabled||this.disabled||(a.preventDefault(),a.identifier=a.pointerId,this.game.input.stopPointer(a))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp),this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}},b.MSPointer.prototype.constructor=b.MSPointer,b.Pointer=function(a,c){this.game=a,this.id=c,this.type=b.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.target=null,this.button=null,this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=!1,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.active=!1,this.position=new b.Point,this.positionDown=new b.Point,this.positionUp=new b.Point,this.circle=new b.Circle(0,0,44),0===c&&(this.isMouse=!0)},b.Pointer.prototype={start:function(a){return a.pointerId&&(this.pointerId=a.pointerId),this.identifier=a.identifier,this.target=a.target,"undefined"!=typeof a.button&&(this.button=a.button),this._history=[],this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.msSinceLastClick=this.game.time.now-this.timeDown,this.timeDown=this.game.time.now,this._holdSent=!1,this.move(a,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,a),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==b.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==b.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop&&(this._nextDrop=this.game.time.now+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(a,c){if(!this.game.input.pollLocked){if("undefined"==typeof c&&(c=!1),"undefined"!=typeof a.button&&(this.button=a.button),this.clientX=a.clientX,this.clientY=a.clientY,this.pageX=a.pageX,this.pageY=a.pageY,this.screenX=a.screenX,this.screenY=a.screenY,this.isMouse&&this.game.input.mouse.locked&&!c&&(this.rawMovementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.rawMovementY=a.movementY||a.mozMovementY||a.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;this.game.input.moveCallback&&this.game.input.moveCallback.call(this.game.input.moveCallbackContext,this,this.x,this.y);for(var d=this.game.input.moveCallbacks.length;d--;)this.game.input.moveCallbacks[d].callback.call(this.game.input.moveCallbacks[d].context,this,this.x,this.y);if(null!==this.targetObject&&this.targetObject.isDragged===!0)return this.targetObject.update(this)===!1&&(this.targetObject=null),this;if(this._highestRenderOrderID=Number.MAX_SAFE_INTEGER,this._highestRenderObject=null,this._highestInputPriorityID=-1,this.game.input.interactiveItems.total>0){var e=this.game.input.interactiveItems.first;do e&&e.validForInput(this._highestInputPriorityID,this._highestRenderOrderID)&&(!c&&e.checkPointerOver(this)||c&&e.checkPointerDown(this))&&(this._highestRenderOrderID=e.sprite._cache[3],this._highestInputPriorityID=e.priorityID,this._highestRenderObject=e),e=this.game.input.interactiveItems.next;while(null!==e)}return null===this._highestRenderObject?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):null===this.targetObject?(this.targetObject=this._highestRenderObject,this._highestRenderObject._pointerOverHandler(this)):this.targetObject===this._highestRenderObject?this._highestRenderObject.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=this._highestRenderObject,this.targetObject._pointerOverHandler(this)),this}},leave:function(a){this.withinGame=!1,this.move(a,!1)},stop:function(a){return this._stateReset?void a.preventDefault():(this.timeUp=this.game.time.now,(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.onUp.dispatch(this,a),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this.targetObject=null,this)},justPressed:function(a){return a=a||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+a>this.game.time.now},justReleased:function(a){return a=a||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+a>this.game.time.now},reset:function(){this.isMouse===!1&&(this.active=!1),this.pointerId=null,this.identifier=null,this.isDown=!1,this.isUp=!0,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},b.Pointer.prototype.constructor=b.Pointer,Object.defineProperty(b.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.now-this.timeDown}}),Object.defineProperty(b.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(b.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),b.Touch=function(a){this.game=a,this.disabled=!1,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},b.Touch.prototype={start:function(){if(null===this._onTouchStart){var a=this;this.game.device.touch&&(this._onTouchStart=function(b){return a.onTouchStart(b)},this._onTouchMove=function(b){return a.onTouchMove(b)},this._onTouchEnd=function(b){return a.onTouchEnd(b)},this._onTouchEnter=function(b){return a.onTouchEnter(b)},this._onTouchLeave=function(b){return a.onTouchLeave(b)},this._onTouchCancel=function(b){return a.onTouchCancel(b)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(a){a.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(a){if(this.event=a,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,a),!this.game.input.disabled&&!this.disabled){this.preventDefault&&a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)this.game.input.startPointer(a.changedTouches[b])}},onTouchCancel:function(a){if(this.event=a,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,a),!this.game.input.disabled&&!this.disabled){this.preventDefault&&a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)this.game.input.stopPointer(a.changedTouches[b])}},onTouchEnter:function(a){this.event=a,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,a),this.game.input.disabled||this.disabled||this.preventDefault&&a.preventDefault()},onTouchLeave:function(a){this.event=a,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault()},onTouchMove:function(a){this.event=a,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault();for(var b=0;b<a.changedTouches.length;b++)this.game.input.updatePointer(a.changedTouches[b])},onTouchEnd:function(a){this.event=a,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault(); for(var b=0;b<a.changedTouches.length;b++)this.game.input.stopPointer(a.changedTouches[b])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},b.Touch.prototype.constructor=b.Touch,b.Gamepad=function(a){this.game=a,this._gamepads=[new b.SinglePad(a,this),new b.SinglePad(a,this),new b.SinglePad(a,this),new b.SinglePad(a,this)],this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.disabled=!1,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null},b.Gamepad.prototype={addCallbacks:function(a,b){"undefined"!=typeof b&&(this.onConnectCallback="function"==typeof b.onConnect?b.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof b.onDisconnect?b.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof b.onDown?b.onDown:this.onDownCallback,this.onUpCallback="function"==typeof b.onUp?b.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof b.onAxis?b.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof b.onFloat?b.onFloat:this.onFloatCallback)},start:function(){if(!this._active){this._active=!0;var a=this;this._ongamepadconnected=function(b){var c=b.gamepad;a._rawPads.push(c),a._gamepads[c.index].connect(c)},window.addEventListener("gamepadconnected",this._ongamepadconnected,!1),this._ongamepaddisconnected=function(b){var c=b.gamepad;for(var d in a._rawPads)a._rawPads[d].index===c.index&&a._rawPads.splice(d,1);a._gamepads[c.index].disconnect()},window.addEventListener("gamepaddisconnected",this._ongamepaddisconnected,!1)}},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var a=navigator.getGamepads();else if(navigator.webkitGetGamepads)var a=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var a=navigator.webkitGamepads();if(a){this._rawPads=[];for(var b=!1,c=0;c<a.length&&(typeof a[c]!==this._prevRawGamepadTypes[c]&&(b=!0,this._prevRawGamepadTypes[c]=typeof a[c]),a[c]&&this._rawPads.push(a[c]),3!==c);c++);if(b){for(var d,e={rawIndices:{},padIndices:{}},f=0;f<this._gamepads.length;f++)if(d=this._gamepads[f],d.connected)for(var g=0;g<this._rawPads.length;g++)this._rawPads[g].index===d.index&&(e.rawIndices[d.index]=!0,e.padIndices[f]=!0);for(var h=0;h<this._gamepads.length;h++)if(d=this._gamepads[h],!e.padIndices[h]){this._rawPads.length<1&&d.disconnect();for(var i=0;i<this._rawPads.length&&!e.padIndices[h];i++){var j=this._rawPads[i];if(j){if(e.rawIndices[j.index]){d.disconnect();continue}d.connect(j),e.rawIndices[j.index]=!0,e.padIndices[h]=!0}else d.disconnect()}}}}},setDeadZones:function(a){for(var b=0;b<this._gamepads.length;b++)this._gamepads[b].deadZone=a},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._ongamepadconnected),window.removeEventListener("gamepaddisconnected",this._ongamepaddisconnected)},reset:function(){this.update();for(var a=0;a<this._gamepads.length;a++)this._gamepads[a].reset()},justPressed:function(a,b){for(var c=0;c<this._gamepads.length;c++)if(this._gamepads[c].justPressed(a,b)===!0)return!0;return!1},justReleased:function(a,b){for(var c=0;c<this._gamepads.length;c++)if(this._gamepads[c].justReleased(a,b)===!0)return!0;return!1},isDown:function(a){for(var b=0;b<this._gamepads.length;b++)if(this._gamepads[b].isDown(a)===!0)return!0;return!1}},b.Gamepad.prototype.constructor=b.Gamepad,Object.defineProperty(b.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(b.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(b.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(b.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(b.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(b.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(b.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),b.Gamepad.BUTTON_0=0,b.Gamepad.BUTTON_1=1,b.Gamepad.BUTTON_2=2,b.Gamepad.BUTTON_3=3,b.Gamepad.BUTTON_4=4,b.Gamepad.BUTTON_5=5,b.Gamepad.BUTTON_6=6,b.Gamepad.BUTTON_7=7,b.Gamepad.BUTTON_8=8,b.Gamepad.BUTTON_9=9,b.Gamepad.BUTTON_10=10,b.Gamepad.BUTTON_11=11,b.Gamepad.BUTTON_12=12,b.Gamepad.BUTTON_13=13,b.Gamepad.BUTTON_14=14,b.Gamepad.BUTTON_15=15,b.Gamepad.AXIS_0=0,b.Gamepad.AXIS_1=1,b.Gamepad.AXIS_2=2,b.Gamepad.AXIS_3=3,b.Gamepad.AXIS_4=4,b.Gamepad.AXIS_5=5,b.Gamepad.AXIS_6=6,b.Gamepad.AXIS_7=7,b.Gamepad.AXIS_8=8,b.Gamepad.AXIS_9=9,b.Gamepad.XBOX360_A=0,b.Gamepad.XBOX360_B=1,b.Gamepad.XBOX360_X=2,b.Gamepad.XBOX360_Y=3,b.Gamepad.XBOX360_LEFT_BUMPER=4,b.Gamepad.XBOX360_RIGHT_BUMPER=5,b.Gamepad.XBOX360_LEFT_TRIGGER=6,b.Gamepad.XBOX360_RIGHT_TRIGGER=7,b.Gamepad.XBOX360_BACK=8,b.Gamepad.XBOX360_START=9,b.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,b.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,b.Gamepad.XBOX360_DPAD_LEFT=14,b.Gamepad.XBOX360_DPAD_RIGHT=15,b.Gamepad.XBOX360_DPAD_UP=12,b.Gamepad.XBOX360_DPAD_DOWN=13,b.Gamepad.XBOX360_STICK_LEFT_X=0,b.Gamepad.XBOX360_STICK_LEFT_Y=1,b.Gamepad.XBOX360_STICK_RIGHT_X=2,b.Gamepad.XBOX360_STICK_RIGHT_Y=3,b.Gamepad.PS3XC_X=0,b.Gamepad.PS3XC_CIRCLE=1,b.Gamepad.PS3XC_SQUARE=2,b.Gamepad.PS3XC_TRIANGLE=3,b.Gamepad.PS3XC_L1=4,b.Gamepad.PS3XC_R1=5,b.Gamepad.PS3XC_L2=6,b.Gamepad.PS3XC_R2=7,b.Gamepad.PS3XC_SELECT=8,b.Gamepad.PS3XC_START=9,b.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,b.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,b.Gamepad.PS3XC_DPAD_UP=12,b.Gamepad.PS3XC_DPAD_DOWN=13,b.Gamepad.PS3XC_DPAD_LEFT=14,b.Gamepad.PS3XC_DPAD_RIGHT=15,b.Gamepad.PS3XC_STICK_LEFT_X=0,b.Gamepad.PS3XC_STICK_LEFT_Y=1,b.Gamepad.PS3XC_STICK_RIGHT_X=2,b.Gamepad.PS3XC_STICK_RIGHT_Y=3,b.SinglePad=function(a,b){this.game=a,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=b,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},b.SinglePad.prototype={addCallbacks:function(a,b){"undefined"!=typeof b&&(this.onConnectCallback="function"==typeof b.onConnect?b.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof b.onDisconnect?b.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof b.onDown?b.onDown:this.onDownCallback,this.onUpCallback="function"==typeof b.onUp?b.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof b.onAxis?b.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof b.onFloat?b.onFloat:this.onFloatCallback)},addButton:function(a){return this.getButton(a)},getButton:function(a){return this._buttons[a]?this._buttons[a]:null},pollStatus:function(){if(!(!this.connected||this.game.input.disabled||this.game.input.gamepad.disabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp)){for(var a=0;a<this._buttonsLen;a++){var b=isNaN(this._rawPad.buttons[a])?this._rawPad.buttons[a].value:this._rawPad.buttons[a];b!==this._buttons[a].value&&(1===b?this.processButtonDown(a,b):0===b?this.processButtonUp(a,b):this.processButtonFloat(a,b))}for(var c=0;c<this._axesLen;c++){var d=this._rawPad.axes[c];this.processAxisChange(d>0&&d>this.deadZone||0>d&&d<-this.deadZone?{axis:c,value:d}:{axis:c,value:0})}this._prevTimestamp=this._rawPad.timestamp}},connect:function(a){var c=!this.connected;this.connected=!0,this.index=a.index,this._rawPad=a,this._buttons=[],this._buttonsLen=a.buttons.length,this._axes=a.axes,this._axesLen=a.axes.length;for(var d in a.buttons)d=parseInt(d,10),this._buttons[d]=new b.GamepadButton(this,d);c&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),c&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var a=this.connected,b=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var c=0;c<this._buttonsLen;c++)this._buttons[c].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,a&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,b),a&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},processAxisChange:function(a){this._axes[a.axis]!==a.value&&(this._axes[a.axis]=a.value,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,a,this.index),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,a))},processButtonDown:function(a,b){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,a,b,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a,b),this._buttons[a]&&this._buttons[a].processButtonDown(b)},processButtonUp:function(a,b){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,a,b,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a,b),this._buttons[a]&&this._buttons[a].processButtonUp(b)},processButtonFloat:function(a,b){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,a,b,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,a,b),this._buttons[a]&&this._buttons[a].processButtonFloat(b)},axis:function(a){return this._axes[a]?this._axes[a]:!1},isDown:function(a){return this._buttons[a]?this._buttons[a].isDown:!1},isUp:function(a){return this._buttons[a]?this._buttons[a].isUp:!1},justReleased:function(a,b){return this._buttons[a]?this._buttons[a].justReleased(b):void 0},justPressed:function(a,b){return this._buttons[a]?this._buttons[a].justPressed(b):void 0},buttonValue:function(a){return this._buttons[a]?this._buttons[a].value:null},reset:function(){for(var a=0;a<this._axes.length;a++)this._axes[a]=0}},b.SinglePad.prototype.constructor=b.SinglePad,b.GamepadButton=function(a,c){this.pad=a,this.game=a.game,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.duration=0,this.timeUp=0,this.repeats=0,this.value=0,this.buttonCode=c,this.onDown=new b.Signal,this.onUp=new b.Signal,this.onFloat=new b.Signal},b.GamepadButton.prototype={processButtonDown:function(a){this.isDown?(this.duration=this.game.time.now-this.timeDown,this.repeats++):(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.value=a,this.onDown.dispatch(this,a))},processButtonUp:function(a){this.isDown&&(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.value=a,this.onUp.dispatch(this,a))},processButtonFloat:function(a){this.value=a,this.onFloat.dispatch(this,a)},justPressed:function(a){return"undefined"==typeof a&&(a=250),this.isDown&&this.duration<a},justReleased:function(a){return"undefined"==typeof a&&(a=250),this.isDown===!1&&this.game.time.now-this.timeUp<a},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.pad=null,this.game=null}},b.GamepadButton.prototype.constructor=b.GamepadButton,b.InputHandler=function(a){this.sprite=a,this.game=a.game,this.enabled=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.consumePointerEvent=!1,this._dragPhase=!1,this._wasEnabled=!1,this._tempPoint=new b.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},b.InputHandler.prototype={start:function(a,c){if(a=a||0,"undefined"==typeof c&&(c=!1),this.enabled===!1){this.game.input.interactiveItems.add(this),this.useHandCursor=c,this.priorityID=a;for(var d=0;10>d;d++)this._pointerData[d]={id:d,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new b.Point,this.enabled=!0,this._wasEnabled=!0,this.sprite.events&&null===this.sprite.events.onInputOver&&(this.sprite.events.onInputOver=new b.Signal,this.sprite.events.onInputOut=new b.Signal,this.sprite.events.onInputDown=new b.Signal,this.sprite.events.onInputUp=new b.Signal,this.sprite.events.onDragStart=new b.Signal,this.sprite.events.onDragStop=new b.Signal)}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var a=0;10>a;a++)this._pointerData[a]={id:a,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(a,b){return 0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID?!1:this.pixelPerfectClick||this.pixelPerfectOver?!0:this.priorityID>a||this.priorityID===a&&this.sprite._cache[3]<b?!0:!1},pointerX:function(a){return a=a||0,this._pointerData[a].x},pointerY:function(a){return a=a||0,this._pointerData[a].y},pointerDown:function(a){return a=a||0,this._pointerData[a].isDown},pointerUp:function(a){return a=a||0,this._pointerData[a].isUp},pointerTimeDown:function(a){return a=a||0,this._pointerData[a].timeDown},pointerTimeUp:function(a){return a=a||0,this._pointerData[a].timeUp},pointerOver:function(a){if(this.enabled){if("undefined"!=typeof a)return this._pointerData[a].isOver;for(var b=0;10>b;b++)if(this._pointerData[b].isOver)return!0}return!1},pointerOut:function(a){if(this.enabled){if("undefined"!=typeof a)return this._pointerData[a].isOut;for(var b=0;10>b;b++)if(this._pointerData[b].isOut)return!0}return!1},pointerTimeOver:function(a){return a=a||0,this._pointerData[a].timeOver},pointerTimeOut:function(a){return a=a||0,this._pointerData[a].timeOut},pointerDragged:function(a){return a=a||0,this._pointerData[a].isDragged},checkPointerDown:function(a){return a.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,a,this._tempPoint)?this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0:!1},checkPointerOver:function(a){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,a,this._tempPoint)?this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0:!1},checkPixel:function(a,b,c){if(this.sprite.texture.baseTexture.source){if(this.game.input.hitContext.clearRect(0,0,1,1),null===a&&null===b){this.game.input.getLocalPosition(this.sprite,c,this._tempPoint);var a=this._tempPoint.x,b=this._tempPoint.y}0!==this.sprite.anchor.x&&(a-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(b-=-this.sprite.texture.frame.height*this.sprite.anchor.y),a+=this.sprite.texture.frame.x,b+=this.sprite.texture.frame.y,this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,a,b,1,1,0,0,1,1);var d=this.game.input.hitContext.getImageData(0,0,1,1);if(d.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(a){return null!==this.sprite&&void 0!==this.sprite.parent?this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this.draggable&&this._draggedPointerID==a.id?this.updateDrag(a):this._pointerData[a.id].isOver===!0?this.checkPointerOver(a)?(this._pointerData[a.id].x=a.x-this.sprite.x,this._pointerData[a.id].y=a.y-this.sprite.y,!0):(this._pointerOutHandler(a),!1):void 0:(this._pointerOutHandler(a),!1):void 0},_pointerOverHandler:function(a){null!==this.sprite&&this._pointerData[a.id].isOver===!1&&(this._pointerData[a.id].isOver=!0,this._pointerData[a.id].isOut=!1,this._pointerData[a.id].timeOver=this.game.time.now,this._pointerData[a.id].x=a.x-this.sprite.x,this._pointerData[a.id].y=a.y-this.sprite.y,this.useHandCursor&&this._pointerData[a.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver.dispatch(this.sprite,a))},_pointerOutHandler:function(a){null!==this.sprite&&(this._pointerData[a.id].isOver=!1,this._pointerData[a.id].isOut=!0,this._pointerData[a.id].timeOut=this.game.time.now,this.useHandCursor&&this._pointerData[a.id].isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut.dispatch(this.sprite,a))},_touchedHandler:function(a){if(null!==this.sprite){if(this._pointerData[a.id].isDown===!1&&this._pointerData[a.id].isOver===!0){if(this.pixelPerfectClick&&!this.checkPixel(null,null,a))return;this._pointerData[a.id].isDown=!0,this._pointerData[a.id].isUp=!1,this._pointerData[a.id].timeDown=this.game.time.now,this.sprite&&this.sprite.events&&this.sprite.events.onInputDown.dispatch(this.sprite,a),this.draggable&&this.isDragged===!1&&this.startDrag(a),this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(a){null!==this.sprite&&this._pointerData[a.id].isDown&&a.isUp&&(this._pointerData[a.id].isDown=!1,this._pointerData[a.id].isUp=!0,this._pointerData[a.id].timeUp=this.game.time.now,this._pointerData[a.id].downDuration=this._pointerData[a.id].timeUp-this._pointerData[a.id].timeDown,this.checkPointerOver(a)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,a,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,a,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),this.draggable&&this.isDragged&&this._draggedPointerID===a.id&&this.stopDrag(a))},updateDrag:function(a){return a.isUp?(this.stopDrag(a),!1):(this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=a.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=a.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=a.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.y=a.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0)},justOver:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isOver&&this.overDuration(a)<b},justOut:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isOut&&this.game.time.now-this._pointerData[a].timeOut<b},justPressed:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isDown&&this.downDuration(a)<b},justReleased:function(a,b){return a=a||0,b=b||500,this._pointerData[a].isUp&&this.game.time.now-this._pointerData[a].timeUp<b},overDuration:function(a){return a=a||0,this._pointerData[a].isOver?this.game.time.now-this._pointerData[a].timeOver:-1},downDuration:function(a){return a=a||0,this._pointerData[a].isDown?this.game.time.now-this._pointerData[a].timeDown:-1},enableDrag:function(a,c,d,e,f,g){"undefined"==typeof a&&(a=!1),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=255),"undefined"==typeof f&&(f=null),"undefined"==typeof g&&(g=null),this._dragPoint=new b.Point,this.draggable=!0,this.bringToTop=c,this.dragOffset=new b.Point,this.dragFromCenter=a,this.pixelPerfect=d,this.pixelPerfectAlpha=e,f&&(this.boundsRect=f),g&&(this.boundsSprite=g)},disableDrag:function(){if(this._pointerData)for(var a=0;10>a;a++)this._pointerData[a].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1},startDrag:function(a){if(this.isDragged=!0,this._draggedPointerID=a.id,this._pointerData[a.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(a.x,a.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-a.x,this.sprite.cameraOffset.y-a.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-a.x,this.sprite.cameraOffset.y-a.y);else if(this.dragFromCenter){var b=this.sprite.getBounds();this.sprite.x=a.x+(this.sprite.x-b.centerX),this.sprite.y=a.y+(this.sprite.y-b.centerY),this._dragPoint.setTo(this.sprite.x-a.x,this.sprite.y-a.y)}else this._dragPoint.setTo(this.sprite.x-a.x,this.sprite.y-a.y);this.updateDrag(a),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.sprite.events.onDragStart.dispatch(this.sprite,a)},stopDrag:function(a){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[a.id].isDragged=!1,this._dragPhase=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop.dispatch(this.sprite,a),this.checkPointerOver(a)===!1&&this._pointerOutHandler(a)},setDragLock:function(a,b){"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!0),this.allowHorizontalDrag=a,this.allowVerticalDrag=b},enableSnap:function(a,b,c,d,e,f){"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),this.snapX=a,this.snapY=b,this.snapOffsetX=e,this.snapOffsetY=f,this.snapOnDrag=c,this.snapOnRelease=d},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.x<this.boundsRect.left?this.sprite.x=this.boundsRect.x:this.sprite.x+this.sprite.width>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-this.sprite.width),this.sprite.y<this.boundsRect.top?this.sprite.y=this.boundsRect.top:this.sprite.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-this.sprite.height))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.camerOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.camerOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.x<this.boundsSprite.x?this.sprite.x=this.boundsSprite.x:this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width&&(this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width),this.sprite.y<this.boundsSprite.y?this.sprite.y=this.boundsSprite.y:this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height&&(this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height))}},b.InputHandler.prototype.constructor=b.InputHandler,b.Events=function(a){this.parent=a,this.onAddedToGroup=new b.Signal,this.onRemovedFromGroup=new b.Signal,this.onKilled=new b.Signal,this.onRevived=new b.Signal,this.onOutOfBounds=new b.Signal,this.onEnterBounds=new b.Signal,this.onInputOver=null,this.onInputOut=null,this.onInputDown=null,this.onInputUp=null,this.onDragStart=null,this.onDragStop=null,this.onAnimationStart=null,this.onAnimationComplete=null,this.onAnimationLoop=null},b.Events.prototype={destroy:function(){this.parent=null,this.onAddedToGroup.dispose(),this.onRemovedFromGroup.dispose(),this.onKilled.dispose(),this.onRevived.dispose(),this.onOutOfBounds.dispose(),this.onInputOver&&(this.onInputOver.dispose(),this.onInputOut.dispose(),this.onInputDown.dispose(),this.onInputUp.dispose(),this.onDragStart.dispose(),this.onDragStop.dispose()),this.onAnimationStart&&(this.onAnimationStart.dispose(),this.onAnimationComplete.dispose(),this.onAnimationLoop.dispose())}},b.Events.prototype.constructor=b.Events,b.GameObjectFactory=function(a){this.game=a,this.world=this.game.world},b.GameObjectFactory.prototype={existing:function(a){return this.world.add(a)},image:function(a,c,d,e,f){return"undefined"==typeof f&&(f=this.world),f.add(new b.Image(this.game,a,c,d,e))},sprite:function(a,b,c,d,e){return"undefined"==typeof e&&(e=this.world),e.create(a,b,c,d)},tween:function(a){return this.game.tweens.create(a)},group:function(a,c,d,e,f){return new b.Group(this.game,a,c,d,e,f)},physicsGroup:function(a,c,d,e){return new b.Group(this.game,c,d,e,!0,a)},spriteBatch:function(a,c,d){return"undefined"==typeof c&&(c="group"),"undefined"==typeof d&&(d=!1),new b.SpriteBatch(this.game,a,c,d)},audio:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},sound:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},tileSprite:function(a,c,d,e,f,g,h){return"undefined"==typeof h&&(h=this.world),h.add(new b.TileSprite(this.game,a,c,d,e,f,g))},text:function(a,c,d,e,f){return"undefined"==typeof f&&(f=this.world),f.add(new b.Text(this.game,a,c,d,e))},button:function(a,c,d,e,f,g,h,i,j,k){return"undefined"==typeof k&&(k=this.world),k.add(new b.Button(this.game,a,c,d,e,f,g,h,i,j))},graphics:function(a,c,d){return"undefined"==typeof d&&(d=this.world),d.add(new b.Graphics(this.game,a,c))},emitter:function(a,c,d){return this.game.particles.add(new b.Particles.Arcade.Emitter(this.game,a,c,d))},retroFont:function(a,c,d,e,f,g,h,i,j){return new b.RetroFont(this.game,a,c,d,e,f,g,h,i,j)},bitmapText:function(a,c,d,e,f,g){return"undefined"==typeof g&&(g=this.world),g.add(new b.BitmapText(this.game,a,c,d,e,f))},tilemap:function(a,c,d,e,f){return new b.Tilemap(this.game,a,c,d,e,f)},renderTexture:function(a,c,d,e){("undefined"==typeof d||""===d)&&(d=this.game.rnd.uuid()),"undefined"==typeof e&&(e=!1);var f=new b.RenderTexture(this.game,a,c,d);return e&&this.game.cache.addRenderTexture(d,f),f},bitmapData:function(a,c,d,e){"undefined"==typeof e&&(e=!1),("undefined"==typeof d||""===d)&&(d=this.game.rnd.uuid());var f=new b.BitmapData(this.game,d,a,c);return e&&this.game.cache.addBitmapData(d,f),f},filter:function(a){var c=Array.prototype.splice.call(arguments,1),a=new b.Filter[a](this.game);return a.init.apply(a,c),a},plugin:function(a){return this.game.plugins.add(a)}},b.GameObjectFactory.prototype.constructor=b.GameObjectFactory,b.GameObjectCreator=function(a){this.game=a,this.world=this.game.world},b.GameObjectCreator.prototype={image:function(a,c,d,e){return new b.Image(this.game,a,c,d,e)},sprite:function(a,c,d,e){return new b.Sprite(this.game,a,c,d,e)},tween:function(a){return new b.Tween(a,this.game)},group:function(a,c,d,e,f){return new b.Group(this.game,null,c,d,e,f)},spriteBatch:function(a,c,d){return"undefined"==typeof c&&(c="group"),"undefined"==typeof d&&(d=!1),new b.SpriteBatch(this.game,a,c,d)},audio:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},sound:function(a,b,c,d){return this.game.sound.add(a,b,c,d)},tileSprite:function(a,c,d,e,f,g){return new b.TileSprite(this.game,a,c,d,e,f,g)},text:function(a,c,d,e){return new b.Text(this.game,a,c,d,e)},button:function(a,c,d,e,f,g,h,i,j){return new b.Button(this.game,a,c,d,e,f,g,h,i,j)},graphics:function(a,c){return new b.Graphics(this.game,a,c)},emitter:function(a,c,d){return new b.Particles.Arcade.Emitter(this.game,a,c,d)},retroFont:function(a,c,d,e,f,g,h,i,j){return new b.RetroFont(this.game,a,c,d,e,f,g,h,i,j)},bitmapText:function(a,c,d,e,f){return new b.BitmapText(this.game,a,c,d,e,f)},tilemap:function(a,c,d,e,f){return new b.Tilemap(this.game,a,c,d,e,f)},renderTexture:function(a,c,d,e){("undefined"==typeof d||""===d)&&(d=this.game.rnd.uuid()),"undefined"==typeof e&&(e=!1);var f=new b.RenderTexture(this.game,a,c,d);return e&&this.game.cache.addRenderTexture(d,f),f},bitmapData:function(a,c,d,e){"undefined"==typeof e&&(e=!1),("undefined"==typeof d||""===d)&&(d=this.game.rnd.uuid());var f=new b.BitmapData(this.game,d,a,c);return e&&this.game.cache.addBitmapData(d,f),f},filter:function(a){var c=Array.prototype.splice.call(arguments,1),a=new b.Filter[a](this.game);return a.init.apply(a,c),a}},b.GameObjectCreator.prototype.constructor=b.GameObjectCreator,b.BitmapData=function(a,c,d,e){"undefined"==typeof d&&(d=100),"undefined"==typeof e&&(e=100),this.game=a,this.key=c,this.width=d,this.height=e,this.canvas=b.Canvas.create(d,e,"",!0),this.context=this.canvas.getContext("2d"),this.ctx=this.context,this.imageData=this.context.getImageData(0,0,d,e),this.data=this.imageData.data,this.pixels=null,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new b.Frame(0,0,0,d,e,"bitmapData",a.rnd.uuid()),this.texture.frame=this.textureFrame,this.type=b.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this.update=this.refreshBuffer,this._tempR=0,this._tempG=0,this._tempB=0 },b.BitmapData.prototype={add:function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)a[b].loadTexture&&a[b].loadTexture(this);else a.loadTexture(this)},load:function(a){"string"==typeof a&&(a=this.game.cache.getImage(a)),this.resize(a.width,a.height),this.cls(),a instanceof b.Image||a instanceof b.Sprite?this.drawSprite(a,0,0):this.draw(a,0,0),this.update()},clear:function(){this.context.clearRect(0,0,this.width,this.height),this.dirty=!0},fill:function(a,b,c,d){"undefined"==typeof d&&(d=1),this.context.fillStyle="rgba("+a+","+b+","+c+","+d+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0},resize:function(a,b){(a!==this.width||b!==this.height)&&(this.width=a,this.height=b,this.canvas.width=a,this.canvas.height=b,this.baseTexture.width=a,this.baseTexture.height=b,this.textureFrame.width=a,this.textureFrame.height=b,this.texture.width=a,this.texture.height=b,this.refreshBuffer(),this.dirty=!0)},refreshBuffer:function(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=this.width),"undefined"==typeof d&&(d=this.height),this.imageData=this.context.getImageData(a,b,c,d),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data},processPixelRGB:function(a,c,d,e,f,g){"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=this.width),"undefined"==typeof g&&(g=this.height);for(var h=d+f,i=e+g,j=b.Color.createColor(),k={r:0,g:0,b:0,a:0},l=!1,m=e;i>m;m++)for(var n=d;h>n;n++)b.Color.unpackPixel(this.getPixel32(n,m),j),k=a.call(c,j,n,m),k!==!1&&null!==k&&void 0!==k&&(this.setPixel32(n,m,k.r,k.g,k.b,k.a,!1),l=!0);l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)},processPixel:function(a,b,c,d,e,f){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=this.width),"undefined"==typeof f&&(f=this.height);for(var g=c+e,h=d+f,i=0,j=0,k=!1,l=d;h>l;l++)for(var m=c;g>m;m++)i=this.getPixel32(m,l),j=a.call(b,i,m,l),j!==i&&(this.pixels[l*this.width+m]=j,k=!0);k&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)},replaceRGB:function(a,c,d,e,f,g,h,i,j){var k=0,l=0,m=this.width,n=this.height,o=b.Color.packPixel(a,c,d,e);void 0!==j&&j instanceof b.Rectangle&&(k=j.x,l=j.y,m=j.width,n=j.height);for(var p=0;n>p;p++)for(var q=0;m>q;q++)this.getPixel32(k+q,l+p)===o&&this.setPixel32(k+q,l+p,f,g,h,i,!1);this.context.putImageData(this.imageData,0,0),this.dirty=!0},setHSL:function(a,c,d,e){if(("undefined"==typeof a||null===a)&&(a=!1),("undefined"==typeof c||null===c)&&(c=!1),("undefined"==typeof d||null===d)&&(d=!1),a||c||d){"undefined"==typeof e&&(e=new b.Rectangle(0,0,this.width,this.height));for(var f=b.Color.createColor(),g=e.y;g<e.bottom;g++)for(var h=e.x;h<e.right;h++)b.Color.unpackPixel(this.getPixel32(h,g),f,!0),a&&(f.h=a),c&&(f.s=c),d&&(f.l=d),b.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(h,g,f.r,f.g,f.b,f.a,!1);this.context.putImageData(this.imageData,0,0),this.dirty=!0}},shiftHSL:function(a,c,d,e){if(("undefined"==typeof a||null===a)&&(a=!1),("undefined"==typeof c||null===c)&&(c=!1),("undefined"==typeof d||null===d)&&(d=!1),a||c||d){"undefined"==typeof e&&(e=new b.Rectangle(0,0,this.width,this.height));for(var f=b.Color.createColor(),g=e.y;g<e.bottom;g++)for(var h=e.x;h<e.right;h++)b.Color.unpackPixel(this.getPixel32(h,g),f,!0),a&&(f.h=this.game.math.wrap(f.h+a,0,1)),c&&(f.s=this.game.math.limitValue(f.s+c,0,1)),d&&(f.l=this.game.math.limitValue(f.l+d,0,1)),b.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(h,g,f.r,f.g,f.b,f.a,!1);this.context.putImageData(this.imageData,0,0),this.dirty=!0}},setPixel32:function(a,c,d,e,f,g,h){"undefined"==typeof h&&(h=!0),a>=0&&a<=this.width&&c>=0&&c<=this.height&&(this.pixels[c*this.width+a]=b.Device.LITTLE_ENDIAN?g<<24|f<<16|e<<8|d:d<<24|e<<16|f<<8|g,h&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0))},setPixel:function(a,b,c,d,e,f){this.setPixel32(a,b,c,d,e,255,f)},getPixel:function(a,c,d){d||(d=b.Color.createColor());var e=~~(a+c*this.width);return e*=4,d.r=this.data[e],d.g=this.data[++e],d.b=this.data[++e],d.a=this.data[++e],d},getPixel32:function(a,b){return a>=0&&a<=this.width&&b>=0&&b<=this.height?this.pixels[b*this.width+a]:void 0},getPixelRGB:function(a,c,d,e,f){return b.Color.unpackPixel(this.getPixel32(a,c),d,e,f)},getPixels:function(a){return this.context.getImageData(a.x,a.y,a.width,a.height)},addToWorld:function(a,b){return this.game.add.image(a,b,this)},copyPixels:function(a,c,d,e){"string"==typeof a&&(a=this.game.cache.getImage(a));var f=a,g=0,h=0;if(a instanceof b.Image||a instanceof b.Sprite){f=a.texture.baseTexture.source;var i=a.texture.frame;g=i.x,h=i.y}else a instanceof b.BitmapData&&(f=a.canvas);this.context.drawImage(f,g+c.x,h+c.y,c.width,c.height,d,e,c.width,c.height),this.dirty=!0},draw:function(a,c,d,e,f){"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),"string"==typeof a&&(a=this.game.cache.getImage(a));var g=a,h=0,i=0,j=0,k=0;if(a instanceof b.Image||a instanceof b.Sprite){g=a.texture.baseTexture.source;var l=a.texture.frame;h=l.x,i=l.y,j=l.width,k=l.height}else a instanceof b.BitmapData&&(g=a.canvas),j=a.width,k=a.height;"undefined"==typeof e&&(e=j),"undefined"==typeof f&&(f=k),this.context.drawImage(g,h,i,j,k,c,d,e,f),this.dirty=!0},drawSprite:function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),this.draw(a,b,c)},alphaMask:function(a,b,c,d){("undefined"==typeof b||null===b)&&(b=this);var e=this.context.globalCompositeOperation;"undefined"==typeof d||null===d?this.draw(b):this.draw(b,d.x,d.y,d.width,d.height),this.context.globalCompositeOperation="source-atop","undefined"==typeof c||null===c?this.draw(a):this.draw(a,c.x,c.y,c.width,c.height),this.context.globalCompositeOperation=e,this.update(),this.dirty=!0},extract:function(a,b,c,d,e,f,g,h,i){return"undefined"==typeof e&&(e=255),"undefined"==typeof f&&(f=!1),"undefined"==typeof g&&(g=b),"undefined"==typeof h&&(h=c),"undefined"==typeof i&&(i=d),f&&a.resize(this.width,this.height),this.processPixelRGB(function(f,j,k){return f.r===b&&f.g===c&&f.b===d&&a.setPixel32(j,k,g,h,i,e,!1),!1},this),a.context.putImageData(a.imageData,0,0),a.dirty=!0,a},rect:function(a,b,c,d,e){"undefined"!=typeof e&&(this.context.fillStyle=e),this.context.fillRect(a,b,c,d)},circle:function(a,b,c,d){"undefined"!=typeof d&&(this.context.fillStyle=d),this.context.beginPath(),this.context.arc(a,b,c,0,2*Math.PI,!1),this.context.closePath(),this.context.fill()},render:function(){!this.disableTextureUpload&&this.game.renderType===b.WEBGL&&this.dirty&&(PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl),this.dirty=!1)}},b.BitmapData.prototype.constructor=b.BitmapData,b.Sprite=function(a,c,d,e,f){c=c||0,d=d||0,e=e||null,f=f||null,this.game=a,this.name="",this.type=b.SPRITE,this.z=0,this.events=new b.Events(this),this.animations=new b.AnimationManager(this),this.key=e,PIXI.Sprite.call(this,PIXI.TextureCache.__default),this.position.set(c,d),this.world=new b.Point(c,d),this.autoCull=!1,this.input=null,this.body=null,this.alive=!0,this.health=1,this.lifespan=0,this.checkWorldBounds=!1,this.outOfBoundsKill=!1,this.debug=!1,this.cameraOffset=new b.Point,this.cropRect=null,this._cache=[0,0,0,0,1,0,1,0],this._crop=null,this._frame=null,this._bounds=new b.Rectangle,this.loadTexture(e,f)},b.Sprite.prototype=Object.create(PIXI.Sprite.prototype),b.Sprite.prototype.constructor=b.Sprite,b.Sprite.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;if(this.lifespan>0&&(this.lifespan-=this.game.time.elapsed,this.lifespan<=0))return this.kill(),!1;if((this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds)if(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds))this._cache[5]=0,this.events.onEnterBounds.dispatch(this);else if(0===this._cache[5]&&!this.game.world.bounds.intersects(this._bounds)&&(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this),this.outOfBoundsKill))return this.kill(),!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),this.body&&this.body.preUpdate();for(var a=0,b=this.children.length;b>a;a++)this.children[a].preUpdate();return!0},b.Sprite.prototype.update=function(){},b.Sprite.prototype.postUpdate=function(){this.key instanceof b.BitmapData&&this.key.render(),this.exists&&this.body&&this.body.postUpdate(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var a=0,c=this.children.length;c>a;a++)this.children[a].postUpdate()},b.Sprite.prototype.loadTexture=function(a,c){c=c||0,this.key=a;var d=!0;a instanceof b.RenderTexture?(this.key=a.key,this.setTexture(a)):a instanceof b.BitmapData?this.setTexture(a.texture):a instanceof PIXI.Texture?this.setTexture(a):null===a||"undefined"==typeof a?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof a||this.game.cache.checkImageKey(a)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[a])),this.animations&&(d=!this.animations.loadFrameData(this.game.cache.getFrameData(a),c))):(this.key="__missing",this.setTexture(PIXI.TextureCache[this.key])),d&&(this._frame=b.Rectangle.clone(this.texture.frame))},b.Sprite.prototype.setFrame=function(a){this._frame=a,this.texture.frame.x=a.x,this.texture.frame.y=a.y,this.texture.frame.width=a.width,this.texture.frame.height=a.height,this.texture.crop.x=a.x,this.texture.crop.y=a.y,this.texture.crop.width=a.width,this.texture.crop.height=a.height,a.trimmed&&(this.texture.trim?(this.texture.trim.x=a.spriteSourceSizeX,this.texture.trim.y=a.spriteSourceSizeY,this.texture.trim.width=a.sourceSizeW,this.texture.trim.height=a.sourceSizeH):this.texture.trim={x:a.spriteSourceSizeX,y:a.spriteSourceSizeY,width:a.sourceSizeW,height:a.sourceSizeH},this.texture.width=a.sourceSizeW,this.texture.height=a.sourceSizeH,this.texture.frame.width=a.sourceSizeW,this.texture.frame.height=a.sourceSizeH),this.cropRect?this.updateCrop():this.game.renderType===b.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)},b.Sprite.prototype.resetFrame=function(){this._frame&&this.setFrame(this._frame)},b.Sprite.prototype.crop=function(a,c){"undefined"==typeof c&&(c=!1),a?(c&&null!==this.cropRect?this.cropRect.setTo(a.x,a.y,a.width,a.height):this.cropRect=c&&null===this.cropRect?new b.Rectangle(a.x,a.y,a.width,a.height):a,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},b.Sprite.prototype.updateCrop=function(){if(this.cropRect){this._crop=b.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var a=Math.max(this._frame.x,this._crop.x),c=Math.max(this._frame.y,this._crop.y),d=Math.min(this._frame.right,this._crop.right)-a,e=Math.min(this._frame.bottom,this._crop.bottom)-c;this.texture.crop.x=a,this.texture.crop.y=c,this.texture.crop.width=d,this.texture.crop.height=e,this.texture.frame.width=Math.min(d,this.cropRect.width),this.texture.frame.height=Math.min(e,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.game.renderType===b.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)}},b.Sprite.prototype.revive=function(a){return"undefined"==typeof a&&(a=1),this.alive=!0,this.exists=!0,this.visible=!0,this.health=a,this.events&&this.events.onRevived.dispatch(this),this},b.Sprite.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this},b.Sprite.prototype.destroy=function(a){if(null!==this.game&&1!==this._cache[8]){"undefined"==typeof a&&(a=!0),this._cache[8]=1,this.parent&&(this.parent instanceof b.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy();var c=this.children.length;if(a)for(;c--;)this.children[c].destroy(a);else for(;c--;)this.removeChild(this.children[c]);this._crop&&(this._crop=null),this._frame&&(this._frame=null),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},b.Sprite.prototype.damage=function(a){return this.alive&&(this.health-=a,this.health<=0&&this.kill()),this},b.Sprite.prototype.reset=function(a,b,c){return"undefined"==typeof c&&(c=1),this.world.setTo(a,b),this.position.x=a,this.position.y=b,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=c,this.body&&this.body.reset(a,b,!1,!1),this._cache[4]=1,this},b.Sprite.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},b.Sprite.prototype.play=function(a,b,c,d){return this.animations?this.animations.play(a,b,c,d):void 0},b.Sprite.prototype.overlap=function(a){return b.Rectangle.intersects(this.getBounds(),a.getBounds())},Object.defineProperty(b.Sprite.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(a){this.rotation=b.Math.degToRad(b.Math.wrapAngle(a))}}),Object.defineProperty(b.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}}),Object.defineProperty(b.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}}),Object.defineProperty(b.Sprite.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}}),Object.defineProperty(b.Sprite.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}),Object.defineProperty(b.Sprite.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}}),Object.defineProperty(b.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(a){this.animations.frame=a}}),Object.defineProperty(b.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(a){this.animations.frameName=a}}),Object.defineProperty(b.Sprite.prototype,"renderOrderID",{get:function(){return this._cache[3]}}),Object.defineProperty(b.Sprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new b.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(b.Sprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(a){a?(this._cache[6]=1,this.body&&this.body.type===b.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===b.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}}),Object.defineProperty(b.Sprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(b.Sprite.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(a){a?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}),Object.defineProperty(b.Sprite.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a,this.body&&this.body.type===b.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(b.Sprite.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a,this.body&&this.body.type===b.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(b.Sprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),b.Image=function(a,c,d,e,f){c=c||0,d=d||0,e=e||null,f=f||null,this.game=a,this.exists=!0,this.name="",this.type=b.IMAGE,this.z=0,this.events=new b.Events(this),this.key=e,PIXI.Sprite.call(this,PIXI.TextureCache.__default),this.position.set(c,d),this.world=new b.Point(c,d),this.autoCull=!1,this.input=null,this.cameraOffset=new b.Point,this.cropRect=null,this._cache=[0,0,0,0,1,0,1,0,0],this._crop=null,this._frame=null,this._bounds=new b.Rectangle,this._frameName="",this.loadTexture(e,f)},b.Image.prototype=Object.create(PIXI.Sprite.prototype),b.Image.prototype.constructor=b.Image,b.Image.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var a=0,b=this.children.length;b>a;a++)this.children[a].preUpdate();return!0},b.Image.prototype.update=function(){},b.Image.prototype.postUpdate=function(){this.key instanceof b.BitmapData&&this.key.render(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var a=0,c=this.children.length;c>a;a++)this.children[a].postUpdate()},b.Image.prototype.loadTexture=function(a,c){if(c=c||0,this.key=a,a instanceof b.RenderTexture)this.key=a.key,this.setTexture(a);else if(a instanceof b.BitmapData)this.setTexture(a.texture);else if(a instanceof PIXI.Texture)this.setTexture(a);else if(null===a||"undefined"==typeof a)this.key="__default",this.setTexture(PIXI.TextureCache[this.key]);else if("string"!=typeof a||this.game.cache.checkImageKey(a))if(this.game.cache.isSpriteSheet(a)){var d=this.game.cache.getFrameData(a);this.setTexture("string"==typeof c?new PIXI.Texture(PIXI.BaseTextureCache[a],d.getFrameByName(c)):new PIXI.Texture(PIXI.BaseTextureCache[a],d.getFrame(c)))}else this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[a]));else this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]);this._frame=b.Rectangle.clone(this.texture.frame)},b.Image.prototype.resetFrame=b.Sprite.prototype.resetFrame,b.Image.prototype.setFrame=b.Sprite.prototype.setFrame,b.Image.prototype.updateCrop=b.Sprite.prototype.updateCrop,b.Image.prototype.crop=b.Sprite.prototype.crop,b.Image.prototype.revive=function(){return this.alive=!0,this.exists=!0,this.visible=!0,this.events&&this.events.onRevived.dispatch(this),this},b.Image.prototype.kill=b.Sprite.prototype.kill,b.Image.prototype.destroy=b.Sprite.prototype.destroy,b.Image.prototype.reset=function(a,b){return this.world.setTo(a,b),this.position.x=a,this.position.y=b,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this},b.Image.prototype.bringToTop=b.Sprite.prototype.bringToTop,Object.defineProperty(b.Image.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(a){this.rotation=b.Math.degToRad(b.Math.wrapAngle(a))}}),Object.defineProperty(b.Image.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}}),Object.defineProperty(b.Image.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}}),Object.defineProperty(b.Image.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}}),Object.defineProperty(b.Image.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}),Object.defineProperty(b.Image.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}}),Object.defineProperty(b.Image.prototype,"frame",{get:function(){return this._cache[9]},set:function(a){if(a!==this.frame&&this.game.cache.isSpriteSheet(this.key)){var b=this.game.cache.getFrameData(this.key);b&&a<b.total&&b.getFrame(a)&&(this._cache[9]=a,this.setFrame(b.getFrame(a)))}}}),Object.defineProperty(b.Image.prototype,"frameName",{get:function(){return this._frameName},set:function(a){if(a!==this.frameName&&this.game.cache.isSpriteSheet(this.key)){var b=this.game.cache.getFrameData(this.key);b&&b.getFrameByName(a)&&(this._frameName=a,this.setFrame(b.getFrameByName(a)))}}}),Object.defineProperty(b.Image.prototype,"renderOrderID",{get:function(){return this._cache[3]}}),Object.defineProperty(b.Image.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new b.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(b.Image.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(b.Image.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(a){a?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}),Object.defineProperty(b.Image.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),b.TileSprite=function(a,c,d,e,f,g,h){c=c||0,d=d||0,e=e||256,f=f||256,g=g||null,h=h||null,this.game=a,this.name="",this.type=b.TILESPRITE,this.z=0,this.events=new b.Events(this),this.animations=new b.AnimationManager(this),this.key=g,this._frame=0,this._frameName="",this._scroll=new b.Point,PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,e,f),this.position.set(c,d),this.input=null,this.world=new b.Point(c,d),this.autoCull=!1,this.checkWorldBounds=!1,this.cameraOffset=new b.Point,this.body=null,this._cache=[0,0,0,0,1,0,1,0,0],this.loadTexture(g,h)},b.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),b.TileSprite.prototype.constructor=b.TileSprite,b.TileSprite.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;(this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds&&(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds)?(this._cache[5]=0,this.events.onEnterBounds.dispatch(this)):0!==this._cache[5]||this.game.world.bounds.intersects(this._bounds)||(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this))),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.body&&this.body.preUpdate();for(var a=0,b=this.children.length;b>a;a++)this.children[a].preUpdate();return!0},b.TileSprite.prototype.update=function(){},b.TileSprite.prototype.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate(),1===this._cache[7]&&(this.position.x=this.game.camera.view.x+this.cameraOffset.x,this.position.y=this.game.camera.view.y+this.cameraOffset.y);for(var a=0,b=this.children.length;b>a;a++)this.children[a].postUpdate()},b.TileSprite.prototype.autoScroll=function(a,b){this._scroll.set(a,b)},b.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},b.TileSprite.prototype.loadTexture=function(a,c){c=c||0,this.key=a,a instanceof b.RenderTexture?(this.key=a.key,this.setTexture(a)):a instanceof b.BitmapData?this.setTexture(a.texture):a instanceof PIXI.Texture?this.setTexture(a):null===a||"undefined"==typeof a?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof a||this.game.cache.checkImageKey(a)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[a])),this.animations.loadFrameData(this.game.cache.getFrameData(a),c)):(this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]))},b.TileSprite.prototype.setFrame=function(a){this.texture.frame.x=a.x,this.texture.frame.y=a.y,this.texture.frame.width=a.width,this.texture.frame.height=a.height,this.texture.crop.x=a.x,this.texture.crop.y=a.y,this.texture.crop.width=a.width,this.texture.crop.height=a.height,a.trimmed&&(this.texture.trim?(this.texture.trim.x=a.spriteSourceSizeX,this.texture.trim.y=a.spriteSourceSizeY,this.texture.trim.width=a.sourceSizeW,this.texture.trim.height=a.sourceSizeH):this.texture.trim={x:a.spriteSourceSizeX,y:a.spriteSourceSizeY,width:a.sourceSizeW,height:a.sourceSizeH},this.texture.width=a.sourceSizeW,this.texture.height=a.sourceSizeH,this.texture.frame.width=a.sourceSizeW,this.texture.frame.height=a.sourceSizeH),this.game.renderType===b.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)},b.TileSprite.prototype.destroy=function(a){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof a&&(a=!0),this._cache[8]=1,this.filters&&(this.filters=null),this.parent&&(this.parent instanceof b.Group?this.parent.remove(this):this.parent.removeChild(this)),this.animations.destroy(),this.events.destroy();var c=this.children.length;if(a)for(;c--;)this.children[c].destroy(a);else for(;c--;)this.removeChild(this.children[c]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},b.TileSprite.prototype.play=function(a,b,c,d){return this.animations.play(a,b,c,d)},b.TileSprite.prototype.reset=function(a,b){return this.world.setTo(a,b),this.position.x=a,this.position.y=b,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.tilePosition.x=0,this.tilePosition.y=0,this.body&&this.body.reset(a,b,!1,!1),this._cache[4]=1,this},Object.defineProperty(b.TileSprite.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(a){this.rotation=b.Math.degToRad(b.Math.wrapAngle(a))}}),Object.defineProperty(b.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(a){a!==this.animations.frame&&(this.animations.frame=a)}}),Object.defineProperty(b.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(a){a!==this.animations.frameName&&(this.animations.frameName=a)}}),Object.defineProperty(b.TileSprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(b.TileSprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(a){a?(this._cache[6]=1,this.body&&this.body.type===b.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===b.Physics.P2JS&&(this.body.safeRemove=!0),this.visible=!1)}}),Object.defineProperty(b.TileSprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new b.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(b.TileSprite.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a,this.body&&this.body.type===b.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(b.TileSprite.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a,this.body&&this.body.type===b.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(b.TileSprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),b.Text=function(a,c,d,e,f){c=c||0,d=d||0,e=e||" ",f=f||{},e=0===e.length?" ":e.toString(),this.game=a,this.exists=!0,this.name="",this.type=b.TEXT,this.z=0,this.world=new b.Point(c,d),this._text=e,this._font="",this._fontSize=32,this._fontWeight="normal",this._lineSpacing=0,this.events=new b.Events(this),this.input=null,this.cameraOffset=new b.Point,this.setStyle(f),PIXI.Text.call(this,e,this.style),this.position.set(c,d),this._cache=[0,0,0,0,1,0,1,0,0]},b.Text.prototype=Object.create(PIXI.Text.prototype),b.Text.prototype.constructor=b.Text,b.Text.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var a=0,b=this.children.length;b>a;a++)this.children[a].preUpdate();return!0},b.Text.prototype.update=function(){},b.Text.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var a=0,b=this.children.length;b>a;a++)this.children[a].postUpdate()},b.Text.prototype.destroy=function(a){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof a&&(a=!0),this._cache[8]=1,this.parent&&(this.parent instanceof b.Group?this.parent.remove(this):this.parent.removeChild(this)),this.texture.destroy(),this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);var c=this.children.length;if(a)for(;c--;)this.children[c].destroy(a);else for(;c--;)this.removeChild(this.children[c]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},b.Text.prototype.setShadow=function(a,b,c,d){this.style.shadowOffsetX=a||0,this.style.shadowOffsetY=b||0,this.style.shadowColor=c||"rgba(0,0,0,0)",this.style.shadowBlur=d||0,this.dirty=!0},b.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,a.shadowOffsetX=a.shadowOffsetX||0,a.shadowOffsetY=a.shadowOffsetY||0,a.shadowColor=a.shadowColor||"rgba(0,0,0,0)",a.shadowBlur=a.shadowBlur||0,this.style=a,this.dirty=!0},b.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.runWordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],d=0,e=0;e<b.length;e++){var f=this.context.measureText(b[e]).width;c[e]=f,d=Math.max(d,f)}this.canvas.width=d+this.style.strokeThickness;var g=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness+this._lineSpacing+this.style.shadowOffsetY;for(this.canvas.height=g*b.length,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.textBaseline="top",this.context.lineCap="round",this.context.lineJoin="round",e=0;e<b.length;e++){var h=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+e*g); "right"===this.style.align?h.x+=d-c[e]:"center"===this.style.align&&(h.x+=(d-c[e])/2),h.y+=this._lineSpacing,this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[e],h.x,h.y),this.style.fill&&this.context.fillText(b[e],h.x,h.y)}this.updateTexture()},b.Text.prototype.runWordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;i>e?(g>0&&(b+="\n"),b+=f[g]+" ",e=this.style.wordWrapWidth-h):(e-=i,b+=f[g]+" ")}d<c.length-1&&(b+="\n")}return b},Object.defineProperty(b.Text.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(a){this.rotation=b.Math.degToRad(a)}}),Object.defineProperty(b.Text.prototype,"text",{get:function(){return this._text},set:function(a){a!==this._text&&(this._text=a.toString()||" ",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(b.Text.prototype,"font",{get:function(){return this._font},set:function(a){a!==this._font&&(this._font=a.trim(),this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(b.Text.prototype,"fontSize",{get:function(){return this._fontSize},set:function(a){a=parseInt(a,10),a!==this._fontSize&&(this._fontSize=a,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(b.Text.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(a){a!==this._fontWeight&&(this._fontWeight=a,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}}),Object.defineProperty(b.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(a){a!==this.style.fill&&(this.style.fill=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"align",{get:function(){return this.style.align},set:function(a){a!==this.style.align&&(this.style.align=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(a){a!==this.style.stroke&&(this.style.stroke=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(a){a!==this.style.strokeThickness&&(this.style.strokeThickness=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(a){a!==this.style.wordWrap&&(this.style.wordWrap=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(a){a!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(a){a!==this._lineSpacing&&(this._lineSpacing=parseFloat(a),this.dirty=!0,this.updateTransform())}}),Object.defineProperty(b.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(a){a!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(a){a!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(a){a!==this.style.shadowColor&&(this.style.shadowColor=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(a){a!==this.style.shadowBlur&&(this.style.shadowBlur=a,this.dirty=!0)}}),Object.defineProperty(b.Text.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new b.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(b.Text.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(b.Text.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),b.BitmapText=function(a,c,d,e,f,g){c=c||0,d=d||0,e=e||"",f=f||"",g=g||32,this.game=a,this.exists=!0,this.name="",this.type=b.BITMAPTEXT,this.z=0,this.world=new b.Point(c,d),this._text=f,this._font=e,this._fontSize=g,this._align="left",this._tint=16777215,this.events=new b.Events(this),this.input=null,this.cameraOffset=new b.Point,PIXI.BitmapText.call(this,f),this.position.set(c,d),this._cache=[0,0,0,0,1,0,1,0,0]},b.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype),b.BitmapText.prototype.constructor=b.BitmapText,b.BitmapText.prototype.setStyle=function(){this.style={align:this._align},this.fontName=this._font,this.fontSize=this._fontSize,this.dirty=!0},b.BitmapText.prototype.preUpdate=function(){return this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.exists&&this.parent.exists?(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0):(this.renderOrderID=-1,!1)},b.BitmapText.prototype.update=function(){},b.BitmapText.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},b.BitmapText.prototype.destroy=function(a){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof a&&(a=!0),this._cache[8]=1,this.parent&&(this.parent instanceof b.Group?this.parent.remove(this):this.parent.removeChild(this));var c=this.children.length;if(a)for(;c--;)this.children[c].destroy?this.children[c].destroy(a):this.removeChild(this.children[c]);else for(;c--;)this.removeChild(this.children[c]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},Object.defineProperty(b.BitmapText.prototype,"align",{get:function(){return this._align},set:function(a){a!==this._align&&(this._align=a,this.setStyle())}}),Object.defineProperty(b.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(a){a!==this._tint&&(this._tint=a,this.dirty=!0)}}),Object.defineProperty(b.BitmapText.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(a){this.rotation=b.Math.degToRad(a)}}),Object.defineProperty(b.BitmapText.prototype,"font",{get:function(){return this._font},set:function(a){a!==this._font&&(this._font=a.trim(),this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(b.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(a){a=parseInt(a,10),a!==this._fontSize&&(this._fontSize=a,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(b.BitmapText.prototype,"text",{get:function(){return this._text},set:function(a){a!==this._text&&(this._text=a.toString()||" ",this.dirty=!0)}}),Object.defineProperty(b.BitmapText.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(a){a?null===this.input?(this.input=new b.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(b.BitmapText.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(b.BitmapText.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),b.Button=function(a,c,d,e,f,g,h,i,j,k){c=c||0,d=d||0,e=e||null,f=f||null,g=g||this,b.Image.call(this,a,c,d,e,i),this.type=b.BUTTON,this._onOverFrameName=null,this._onOutFrameName=null,this._onDownFrameName=null,this._onUpFrameName=null,this._onOverFrameID=null,this._onOutFrameID=null,this._onDownFrameID=null,this._onUpFrameID=null,this.onOverMouseOnly=!1,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new b.Signal,this.onInputOut=new b.Signal,this.onInputDown=new b.Signal,this.onInputUp=new b.Signal,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.setFrames(h,i,j,k),null!==f&&this.onInputUp.add(f,g),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},b.Button.prototype=Object.create(b.Image.prototype),b.Button.prototype.constructor=b.Button,b.Button.prototype.clearFrames=function(){this._onOverFrameName=null,this._onOverFrameID=null,this._onOutFrameName=null,this._onOutFrameID=null,this._onDownFrameName=null,this._onDownFrameID=null,this._onUpFrameName=null,this._onUpFrameID=null},b.Button.prototype.setFrames=function(a,b,c,d){this.clearFrames(),null!==a&&("string"==typeof a?(this._onOverFrameName=a,this.input.pointerOver()&&(this.frameName=a)):(this._onOverFrameID=a,this.input.pointerOver()&&(this.frame=a))),null!==b&&("string"==typeof b?(this._onOutFrameName=b,this.input.pointerOver()===!1&&(this.frameName=b)):(this._onOutFrameID=b,this.input.pointerOver()===!1&&(this.frame=b))),null!==c&&("string"==typeof c?(this._onDownFrameName=c,this.input.pointerDown()&&(this.frameName=c)):(this._onDownFrameID=c,this.input.pointerDown()&&(this.frame=c))),null!==d&&("string"==typeof d?(this._onUpFrameName=d,this.input.pointerUp()&&(this.frameName=d)):(this._onUpFrameID=d,this.input.pointerUp()&&(this.frame=d)))},b.Button.prototype.setSounds=function(a,b,c,d,e,f,g,h){this.setOverSound(a,b),this.setOutSound(e,f),this.setDownSound(c,d),this.setUpSound(g,h)},b.Button.prototype.setOverSound=function(a,c){this.onOverSound=null,this.onOverSoundMarker="",a instanceof b.Sound&&(this.onOverSound=a),"string"==typeof c&&(this.onOverSoundMarker=c)},b.Button.prototype.setOutSound=function(a,c){this.onOutSound=null,this.onOutSoundMarker="",a instanceof b.Sound&&(this.onOutSound=a),"string"==typeof c&&(this.onOutSoundMarker=c)},b.Button.prototype.setDownSound=function(a,c){this.onDownSound=null,this.onDownSoundMarker="",a instanceof b.Sound&&(this.onDownSound=a),"string"==typeof c&&(this.onDownSoundMarker=c)},b.Button.prototype.setUpSound=function(a,c){this.onUpSound=null,this.onUpSoundMarker="",a instanceof b.Sound&&(this.onUpSound=a),"string"==typeof c&&(this.onUpSoundMarker=c)},b.Button.prototype.onInputOverHandler=function(a,b){this.freezeFrames===!1&&this.setState(1),(!this.onOverMouseOnly||b.isMouse)&&(this.onOverSound&&this.onOverSound.play(this.onOverSoundMarker),this.onInputOver&&this.onInputOver.dispatch(this,b))},b.Button.prototype.onInputOutHandler=function(a,b){this.freezeFrames===!1&&this.setState(2),this.onOutSound&&this.onOutSound.play(this.onOutSoundMarker),this.onInputOut&&this.onInputOut.dispatch(this,b)},b.Button.prototype.onInputDownHandler=function(a,b){this.freezeFrames===!1&&this.setState(3),this.onDownSound&&this.onDownSound.play(this.onDownSoundMarker),this.onInputDown&&this.onInputDown.dispatch(this,b)},b.Button.prototype.onInputUpHandler=function(a,b,c){this.onUpSound&&this.onUpSound.play(this.onUpSoundMarker),this.onInputUp&&this.onInputUp.dispatch(this,b,c),this.freezeFrames||this.setState(this.forceOut?2:null!==this._onUpFrameName||null!==this._onUpFrameID?4:c?1:2)},b.Button.prototype.setState=function(a){1===a?null!=this._onOverFrameName?this.frameName=this._onOverFrameName:null!=this._onOverFrameID&&(this.frame=this._onOverFrameID):2===a?null!=this._onOutFrameName?this.frameName=this._onOutFrameName:null!=this._onOutFrameID&&(this.frame=this._onOutFrameID):3===a?null!=this._onDownFrameName?this.frameName=this._onDownFrameName:null!=this._onDownFrameID&&(this.frame=this._onDownFrameID):4===a&&(null!=this._onUpFrameName?this.frameName=this._onUpFrameName:null!=this._onUpFrameID&&(this.frame=this._onUpFrameID))},b.Graphics=function(a,c,d){c=c||0,d=d||0,this.game=a,this.exists=!0,this.name="",this.type=b.GRAPHICS,this.z=0,this.world=new b.Point(c,d),this.cameraOffset=new b.Point,PIXI.Graphics.call(this),this.position.set(c,d),this._cache=[0,0,0,0,1,0,1,0,0]},b.Graphics.prototype=Object.create(PIXI.Graphics.prototype),b.Graphics.prototype.constructor=b.Graphics,b.Graphics.prototype.preUpdate=function(){return this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.exists&&this.parent.exists?(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0):(this.renderOrderID=-1,!1)},b.Graphics.prototype.update=function(){},b.Graphics.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},b.Graphics.prototype.destroy=function(a){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof a&&(a=!0),this._cache[8]=1,this.clear(),this.parent&&(this.parent instanceof b.Group?this.parent.remove(this):this.parent.removeChild(this));var c=this.children.length;if(a)for(;c--;)this.children[c].destroy(a);else for(;c--;)this.removeChild(this.children[c]);this.exists=!1,this.visible=!1,this.game=null,this._cache[8]=0}},b.Graphics.prototype.drawPolygon=function(a){this.moveTo(a.points[0].x,a.points[0].y);for(var b=1;b<a.points.length;b+=1)this.lineTo(a.points[b].x,a.points[b].y);this.lineTo(a.points[0].x,a.points[0].y)},b.Graphics.prototype.drawTriangle=function(a,c){"undefined"==typeof c&&(c=!1);var d=new b.Polygon(a);if(c){var e=new b.Point(this.game.camera.x-a[0].x,this.game.camera.y-a[0].y),f=new b.Point(a[1].x-a[0].x,a[1].y-a[0].y),g=new b.Point(a[1].x-a[2].x,a[1].y-a[2].y),h=g.cross(f);e.dot(h)>0&&this.drawPolygon(d)}else this.drawPolygon(d)},b.Graphics.prototype.drawTriangles=function(a,c,d){"undefined"==typeof d&&(d=!1);var e,f=new b.Point,g=new b.Point,h=new b.Point,i=[];if(c)if(a[0]instanceof b.Point)for(e=0;e<c.length/3;e++)i.push(a[c[3*e]]),i.push(a[c[3*e+1]]),i.push(a[c[3*e+2]]),3===i.length&&(this.drawTriangle(i,d),i=[]);else for(e=0;e<c.length;e++)f.x=a[2*c[e]],f.y=a[2*c[e]+1],i.push(f.copyTo({})),3===i.length&&(this.drawTriangle(i,d),i=[]);else if(a[0]instanceof b.Point)for(e=0;e<a.length/3;e++)this.drawTriangle([a[3*e],a[3*e+1],a[3*e+2]],d);else for(e=0;e<a.length/6;e++)f.x=a[6*e+0],f.y=a[6*e+1],g.x=a[6*e+2],g.y=a[6*e+3],h.x=a[6*e+4],h.y=a[6*e+5],this.drawTriangle([f,g,h],d)},Object.defineProperty(b.Graphics.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(a){this.rotation=b.Math.degToRad(a)}}),Object.defineProperty(b.Graphics.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(a){a?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(b.Graphics.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),b.RenderTexture=function(a,c,d,e,f){"undefined"==typeof e&&(e=""),"undefined"==typeof f&&(f=b.scaleModes.DEFAULT),this.game=a,this.key=e,this.type=b.RENDERTEXTURE,this._temp=new b.Point,PIXI.RenderTexture.call(this,c,d,this.game.renderer,f)},b.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),b.RenderTexture.prototype.constructor=b.RenderTexture,b.RenderTexture.prototype.renderXY=function(a,b,c,d){this._temp.set(b,c),this.render(a,this._temp,d)},b.SpriteBatch=function(a,c,d,e){PIXI.SpriteBatch.call(this),b.Group.call(this,a,c,d,e),this.type=b.SPRITEBATCH},b.SpriteBatch.prototype=b.Utils.extend(!0,b.SpriteBatch.prototype,b.Group.prototype,PIXI.SpriteBatch.prototype),b.SpriteBatch.prototype.constructor=b.SpriteBatch,b.RetroFont=function(a,c,d,e,f,g,h,i,j,k){if(!a.cache.checkImageKey(c))return!1;("undefined"==typeof g||null===g)&&(g=a.cache.getImage(c).width/d),this.characterWidth=d,this.characterHeight=e,this.characterSpacingX=h||0,this.characterSpacingY=i||0,this.characterPerRow=g,this.offsetX=j||0,this.offsetY=k||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=a.cache.getImage(c),this._text="",this.grabData=[];for(var l=this.offsetX,m=this.offsetY,n=0,o=new b.FrameData,p=0;p<f.length;p++){var q=a.rnd.uuid(),r=o.addFrame(new b.Frame(p,l,m,this.characterWidth,this.characterHeight,"",q));this.grabData[f.charCodeAt(p)]=r.index,PIXI.TextureCache[q]=new PIXI.Texture(PIXI.BaseTextureCache[c],{x:l,y:m,width:this.characterWidth,height:this.characterHeight}),n++,n==this.characterPerRow?(n=0,l=this.offsetX,m+=this.characterHeight+this.characterSpacingY):l+=this.characterWidth+this.characterSpacingX}a.cache.updateFrameData(c,o),this.stamp=new b.Image(a,0,0,c,0),b.RenderTexture.call(this,a,100,100,"",b.scaleModes.NEAREST),this.type=b.RETROFONT},b.RetroFont.prototype=Object.create(b.RenderTexture.prototype),b.RetroFont.prototype.constructor=b.RetroFont,b.RetroFont.ALIGN_LEFT="left",b.RetroFont.ALIGN_RIGHT="right",b.RetroFont.ALIGN_CENTER="center",b.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",b.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",b.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",b.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",b.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",b.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",b.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",b.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",b.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",b.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",b.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",b.RetroFont.prototype.setFixedWidth=function(a,b){"undefined"==typeof b&&(b="left"),this.fixedWidth=a,this.align=b},b.RetroFont.prototype.setText=function(a,b,c,d,e,f){this.multiLine=b||!1,this.customSpacingX=c||0,this.customSpacingY=d||0,this.align=e||"left",this.autoUpperCase=f?!1:!0,a.length>0&&(this.text=a)},b.RetroFont.prototype.buildRetroFontText=function(){var a=0,c=0;if(this.clear(),this.multiLine){var d=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,d.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),d.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var e=0;e<d.length;e++){switch(this.align){case b.RetroFont.ALIGN_LEFT:a=0;break;case b.RetroFont.ALIGN_RIGHT:a=this.width-d[e].length*(this.characterWidth+this.customSpacingX);break;case b.RetroFont.ALIGN_CENTER:a=this.width/2-d[e].length*(this.characterWidth+this.customSpacingX)/2,a+=this.customSpacingX/2}0>a&&(a=0),this.pasteLine(d[e],a,c,this.customSpacingX),c+=this.characterHeight+this.customSpacingY}}else{switch(this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),this.align){case b.RetroFont.ALIGN_LEFT:a=0;break;case b.RetroFont.ALIGN_RIGHT:a=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case b.RetroFont.ALIGN_CENTER:a=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,a+=this.customSpacingX/2}this.textureBuffer.clear(),this.pasteLine(this._text,a,0,this.customSpacingX)}},b.RetroFont.prototype.pasteLine=function(a,c,d,e){for(var f=new b.Point,g=0;g<a.length;g++)if(" "==a.charAt(g))c+=this.characterWidth+e;else if(this.grabData[a.charCodeAt(g)]>=0&&(this.stamp.frame=this.grabData[a.charCodeAt(g)],f.set(c,d),this.render(this.stamp,f,!1),c+=this.characterWidth+e,c>this.width))break},b.RetroFont.prototype.getLongestLine=function(){var a=0;if(this._text.length>0)for(var b=this._text.split("\n"),c=0;c<b.length;c++)b[c].length>a&&(a=b[c].length);return a},b.RetroFont.prototype.removeUnsupportedCharacters=function(a){for(var b="",c=0;c<this._text.length;c++){var d=this._text[c],e=d.charCodeAt(0);(this.grabData[e]>=0||!a&&"\n"===d)&&(b=b.concat(d))}return b},b.RetroFont.prototype.updateOffset=function(a,b){if(this.offsetX!==a||this.offsetY!==b){for(var c=a-this.offsetX,d=b-this.offsetY,e=this.game.cache.getFrameData(this.stamp.key).getFrames(),f=e.length;f--;)e[f].x+=c,e[f].y+=d,PIXI.TextureCache[e[f].uuid].frame.x=e[f].x,PIXI.TextureCache[e[f].uuid].frame.y=e[f].y;this.buildRetroFontText()}},Object.defineProperty(b.RetroFont.prototype,"text",{get:function(){return this._text},set:function(a){var b;b=this.autoUpperCase?a.toUpperCase():a,b!==this._text&&(this._text=b,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(b.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(a){this.stamp.smoothed=a,this.buildRetroFontText()}}),b.Particle=function(a,c,d,e,f){b.Sprite.call(this,a,c,d,e,f),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},b.Particle.prototype=Object.create(b.Sprite.prototype),b.Particle.prototype.constructor=b.Particle,b.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},b.Particle.prototype.onEmit=function(){},b.Particle.prototype.setAlphaData=function(a){this.alphaData=a,this._a=a.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},b.Particle.prototype.setScaleData=function(a){this.scaleData=a,this._s=a.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},b.Particle.prototype.reset=function(a,b,c){return"undefined"==typeof c&&(c=1),this.world.setTo(a,b),this.position.x=a,this.position.y=b,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=c,this.body&&this.body.reset(a,b,!1,!1),this._cache[4]=1,this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},b.Canvas={create:function(a,b,c,d){"undefined"==typeof d&&(d=!1),a=a||256,b=b||256;var e=document.createElement("canvas");return"string"==typeof c&&""!==c&&(e.id=c),e.width=a,e.height=b,e.style.display="block",e},getOffset:function(a,c){c=c||new b.Point;var d=a.getBoundingClientRect(),e=a.clientTop||document.body.clientTop||0,f=a.clientLeft||document.body.clientLeft||0,g=0,h=0;return"CSS1Compat"===document.compatMode?(g=window.pageYOffset||document.documentElement.scrollTop||a.scrollTop||0,h=window.pageXOffset||document.documentElement.scrollLeft||a.scrollLeft||0):(g=window.pageYOffset||document.body.scrollTop||a.scrollTop||0,h=window.pageXOffset||document.body.scrollLeft||a.scrollLeft||0),c.x=d.left+h-f,c.y=d.top+g-e,c},getAspectRatio:function(a){return a.width/a.height},setBackgroundColor:function(a,b){return b=b||"rgb(0,0,0)",a.style.backgroundColor=b,a},setTouchAction:function(a,b){return b=b||"none",a.style.msTouchAction=b,a.style["ms-touch-action"]=b,a.style["touch-action"]=b,a},setUserSelect:function(a,b){return b=b||"none",a.style["-webkit-touch-callout"]=b,a.style["-webkit-user-select"]=b,a.style["-khtml-user-select"]=b,a.style["-moz-user-select"]=b,a.style["-ms-user-select"]=b,a.style["user-select"]=b,a.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",a},addToDOM:function(a,b,c){var d;return"undefined"==typeof c&&(c=!0),b&&("string"==typeof b?d=document.getElementById(b):"object"==typeof b&&1===b.nodeType&&(d=b)),d||(d=document.body),c&&d.style&&(d.style.overflow="hidden"),d.appendChild(a),a},setTransform:function(a,b,c,d,e,f,g){return a.setTransform(d,f,g,e,b,c),a},setSmoothingEnabled:function(a,b){return a.imageSmoothingEnabled=b,a.mozImageSmoothingEnabled=b,a.oImageSmoothingEnabled=b,a.webkitImageSmoothingEnabled=b,a.msImageSmoothingEnabled=b,a},setImageRenderingCrisp:function(a){return a.style["image-rendering"]="optimizeSpeed",a.style["image-rendering"]="crisp-edges",a.style["image-rendering"]="-moz-crisp-edges",a.style["image-rendering"]="-webkit-optimize-contrast",a.style["image-rendering"]="optimize-contrast",a.style.msInterpolationMode="nearest-neighbor",a},setImageRenderingBicubic:function(a){return a.style["image-rendering"]="auto",a.style.msInterpolationMode="bicubic",a}},b.Device=function(a){this.game=a,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.webGL=!1,this.worker=!1,this.touch=!1,this.mspointer=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!1,this.quirksMode=!1,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1,this._checkOS(),this._checkAudio(),this._checkBrowser(),this._checkCSS3D(),this._checkDevice(),this._checkFeatures()},b.Device.LITTLE_ENDIAN=!1,b.Device.prototype={_checkOS:function(){var a=navigator.userAgent;/Android/.test(a)?this.android=!0:/CrOS/.test(a)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?this.iOS=!0:/Linux/.test(a)?this.linux=!0:/Mac OS/.test(a)?this.macOS=!0:/Windows/.test(a)&&(this.windows=!0,/Windows Phone/i.test(a)&&(this.windowsPhone=!0)),(this.windows||this.macOS||this.linux&&this.silk===!1)&&(this.desktop=!0),(this.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(this.desktop=!1)},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D||this.cocoonJS;try{this.localStorage=!!localStorage.getItem}catch(a){this.localStorage=!1}this.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.fileSystem=!!window.requestFileSystem,this.webGL=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),this.webGL=null===this.webGL||this.webGL===!1?!1:!0,this.worker=!!window.Worker,("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)&&(this.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(this.mspointer=!0),this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.quirksMode="CSS1Compat"===document.compatMode?!1:!0,this.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},checkFullScreenSupport:function(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=0;b<a.length;b++)if(this.game.canvas[a[b]]){this.fullscreen=!0,this.requestFullscreen=a[b];break}var c=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(this.fullscreen)for(var b=0;b<c.length;b++)if(document[c[b]]){this.cancelFullscreen=c[b];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(this.fullscreenKeyboard=!0)},_checkBrowser:function(){var a=navigator.userAgent;/Arora/.test(a)?this.arora=!0:/Chrome/.test(a)?this.chrome=!0:/Epiphany/.test(a)?this.epiphany=!0:/Firefox/.test(a)?this.firefox=!0:/AppleWebKit/.test(a)&&this.iOS?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?this.midori=!0:/Opera/.test(a)?this.opera=!0:/Safari/.test(a)?this.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(this.ie=!0,this.trident=!0,this.tridentVersion=parseInt(RegExp.$1,10),this.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(this.silk=!0),navigator.standalone&&(this.webApp=!0),navigator.isCocoonJS&&(this.cocoonJS=!0),"undefined"!=typeof window.ejecta&&(this.ejecta=!0),/Crosswalk/.test(a)&&(this.crosswalk=!0)},_checkAudio:function(){this.audioData=!!window.Audio,this.webAudio=!(!window.webkitAudioContext&&!window.AudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")&&(this.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.webm=!0))}catch(c){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.iPhone4=2==this.pixelRatio&&this.iPhone,this.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),this.typedArray="undefined"!=typeof Int8Array?!0:!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(this.littleEndian=this._checkIsLittleEndian(),b.Device.LITTLE_ENDIAN=this.littleEndian),this.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==this.littleEndian&&this._checkIsUint8ClampedImageData(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(this.vibration=!0)},_checkIsLittleEndian:function(){var a=new ArrayBuffer(4),b=new Uint8Array(a),c=new Uint32Array(a);return b[0]=161,b[1]=178,b[2]=195,b[3]=212,3569595041==c[0]?!0:2712847316==c[0]?!1:null},_checkIsUint8ClampedImageData:function(){if("undefined"==typeof Uint8ClampedArray)return!1;var a=document.createElement("canvas"),b=a.getContext("2d");if(!b)return!1;var c=b.createImageData(1,1);return c.data instanceof Uint8ClampedArray},_checkCSS3D:function(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));document.body.removeChild(b),this.css3D=void 0!==a&&a.length>0&&"none"!==a},canPlayAudio:function(a){return"mp3"==a&&this.mp3?!0:"ogg"==a&&(this.ogg||this.opus)?!0:"m4a"==a&&this.m4a?!0:"wav"==a&&this.wav?!0:"webm"==a&&this.webm?!0:!1},isConsoleOpen:function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?console.profiles.length>0:!1}},b.Device.prototype.constructor=b.Device,b.RequestAnimationFrame=function(a,b){"undefined"==typeof b&&(b=!1),this.game=a,this.isRunning=!1,this.forceSetTimeOut=b; for(var c=["ms","moz","webkit","o"],d=0;d<c.length&&!window.requestAnimationFrame;d++)window.requestAnimationFrame=window[c[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[d]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},b.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var a=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return a.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(b){return a.updateRAF(b)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(){this.game.update(Date.now()),this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},b.RequestAnimationFrame.prototype.constructor=b.RequestAnimationFrame,b.Math={PI2:2*Math.PI,fuzzyEqual:function(a,b,c){return"undefined"==typeof c&&(c=1e-4),Math.abs(a-b)<c},fuzzyLessThan:function(a,b,c){return"undefined"==typeof c&&(c=1e-4),b+c>a},fuzzyGreaterThan:function(a,b,c){return"undefined"==typeof c&&(c=1e-4),a>b-c},fuzzyCeil:function(a,b){return"undefined"==typeof b&&(b=1e-4),Math.ceil(a-b)},fuzzyFloor:function(a,b){return"undefined"==typeof b&&(b=1e-4),Math.floor(a+b)},average:function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];for(var c=0,d=0;d<a.length;d++)c+=a[d];return c/a.length},truncate:function(a){return a>0?Math.floor(a):Math.ceil(a)},shear:function(a){return a%1},snapTo:function(a,b,c){return"undefined"==typeof c&&(c=0),0===b?a:(a-=c,a=b*Math.round(a/b),c+a)},snapToFloor:function(a,b,c){return"undefined"==typeof c&&(c=0),0===b?a:(a-=c,a=b*Math.floor(a/b),c+a)},snapToCeil:function(a,b,c){return"undefined"==typeof c&&(c=0),0===b?a:(a-=c,a=b*Math.ceil(a/b),c+a)},snapToInArray:function(a,b,c){if("undefined"==typeof c&&(c=!0),c&&b.sort(),a<b[0])return b[0];for(var d=1;b[d]<a;)d++;var e=b[d-1],f=d<b.length?b[d]:Number.POSITIVE_INFINITY;return a-e>=f-a?f:e},roundTo:function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=10);var d=Math.pow(c,-b);return Math.round(a*d)/d},floorTo:function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=10);var d=Math.pow(c,-b);return Math.floor(a*d)/d},ceilTo:function(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=10);var d=Math.pow(c,-b);return Math.ceil(a*d)/d},interpolateFloat:function(a,b,c){return(b-a)*c+a},angleBetween:function(a,b,c,d){return Math.atan2(d-b,c-a)},angleBetweenPoints:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},reverseAngle:function(a){return this.normalizeAngle(a+Math.PI,!0)},normalizeAngle:function(a){return a%=2*Math.PI,a>=0?a:a+2*Math.PI},normalizeLatitude:function(a){return Math.max(-90,Math.min(90,a))},normalizeLongitude:function(a){return a%360==180?180:(a%=360,-180>a?a+360:a>180?a-360:a)},chanceRoll:function(a){return"undefined"==typeof a&&(a=50),0>=a?!1:a>=100?!0:100*Math.random()>=a?!1:!0},numberArray:function(a,b){for(var c=[],d=a;b>=d;d++)c.push(d);return c},maxAdd:function(a,b,c){return a+=b,a>c&&(a=c),a},minSub:function(a,b,c){return a-=b,c>a&&(a=c),a},wrap:function(a,b,c){var d=c-b;if(0>=d)return 0;var e=(a-b)%d;return 0>e&&(e+=d),e+b},wrapValue:function(a,b,c){var d;return a=Math.abs(a),b=Math.abs(b),c=Math.abs(c),d=(a+b)%c},limitValue:function(a,b,c){return b>a?b:a>c?c:a},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(a){return 1&a},isEven:function(a){return 1&a?!1:!0},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var a=arguments[0];else var a=arguments;for(var b=1,c=0,d=a.length;d>b;b++)a[b]<a[c]&&(c=b);return a[c]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var a=arguments[0];else var a=arguments;for(var b=1,c=0,d=a.length;d>b;b++)a[b]>a[c]&&(c=b);return a[c]},minProperty:function(a){if(2===arguments.length&&"object"==typeof arguments[1])var b=arguments[1];else var b=arguments.slice(1);for(var c=1,d=0,e=b.length;e>c;c++)b[c][a]<b[d][a]&&(d=c);return b[d][a]},maxProperty:function(a){if(2===arguments.length&&"object"==typeof arguments[1])var b=arguments[1];else var b=arguments.slice(1);for(var c=1,d=0,e=b.length;e>c;c++)b[c][a]>b[d][a]&&(d=c);return b[d][a]},wrapAngle:function(a,b){var c=b?Math.PI/180:1;return this.wrap(a,-180*c,180*c)},angleLimit:function(a,b,c){var d=a;return a>c?d=c:b>a&&(d=b),d},linearInterpolation:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d);return 0>b?this.linear(a[0],a[1],d):b>1?this.linear(a[c],a[c-1],c-d):this.linear(a[e],a[e+1>c?c:e+1],d-e)},bezierInterpolation:function(a,b){for(var c=0,d=a.length-1,e=0;d>=e;e++)c+=Math.pow(1-b,d-e)*Math.pow(b,e)*a[e]*this.bernstein(d,e);return c},catmullRomInterpolation:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d);return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),this.catmullRom(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(this.catmullRom(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(this.catmullRom(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):this.catmullRom(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},linear:function(a,b,c){return(b-a)*c+a},bernstein:function(a,b){return this.factorial(a)/this.factorial(b)/this.factorial(a-b)},factorial:function(a){if(0===a)return 1;for(var b=a;--a;)b*=a;return b},catmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b},difference:function(a,b){return Math.abs(a-b)},getRandom:function(a,b,c){if("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),null!=a){var d=c;if((0===d||d>a.length-b)&&(d=a.length-b),d>0)return a[b+Math.floor(Math.random()*d)]}return null},removeRandom:function(a,b,c){if("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),null!=a){var d=c;if((0===d||d>a.length-b)&&(d=a.length-b),d>0){var e=b+Math.floor(Math.random()*d),f=a.splice(e,1);return f[0]}}return null},floor:function(a){var b=0|a;return a>0?b:b!=a?b-1:b},ceil:function(a){var b=0|a;return a>0&&b!=a?b+1:b},sinCosGenerator:function(a,b,c,d){"undefined"==typeof b&&(b=1),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=1);for(var e=b,f=c,g=d*Math.PI/a,h=[],i=[],j=0;a>j;j++)f-=e*g,e+=f*g,h[j]=f,i[j]=e;return{sin:i,cos:h,length:a}},shift:function(a){var b=a.shift();return a.push(b),b},shuffleArray:function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},distance:function(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)},distancePow:function(a,b,c,d,e){return"undefined"==typeof e&&(e=2),Math.sqrt(Math.pow(c-a,e)+Math.pow(d-b,e))},distanceRounded:function(a,c,d,e){return Math.round(b.Math.distance(a,c,d,e))},clamp:function(a,b,c){return b>a?b:a>c?c:a},clampBottom:function(a,b){return b>a?b:a},within:function(a,b,c){return Math.abs(a-b)<=c},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){return a=Math.max(0,Math.min(1,(a-b)/(c-b))),a*a*(3-2*a)},smootherstep:function(a,b,c){return a=Math.max(0,Math.min(1,(a-b)/(c-b))),a*a*a*(a*(6*a-15)+10)},sign:function(a){return 0>a?-1:a>0?1:0},percent:function(a,b,c){return"undefined"==typeof c&&(c=0),a>b||c>b?1:c>a||c>a?0:(a-c)/b},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}()},b.RandomDataGenerator=function(a){"undefined"==typeof a&&(a=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,this.sow(a)},b.RandomDataGenerator.prototype={rnd:function(){var a=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|a,this.s0=this.s1,this.s1=this.s2,this.s2=a-this.c,this.s2},sow:function(a){"undefined"==typeof a&&(a=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1;for(var b,c=0;b=a[c++];)this.s0-=this.hash(b),this.s0+=~~(this.s0<0),this.s1-=this.hash(b),this.s1+=~~(this.s1<0),this.s2-=this.hash(b),this.s2+=~~(this.s2<0)},hash:function(a){var b,c,d;for(d=4022871197,a=a.toString(),c=0;c<a.length;c++)d+=a.charCodeAt(c),b=.02519603282416938*d,d=b>>>0,b-=d,b*=d,d=b>>>0,b-=d,d+=4294967296*b;return 2.3283064365386963e-10*(d>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(a,b){return Math.floor(this.realInRange(0,b-a+1)+a)},between:function(a,b){return this.integerInRange(a,b)},realInRange:function(a,b){return this.frac()*(b-a)+a},normal:function(){return 1-2*this.frac()},uuid:function(){var a="",b="";for(b=a="";a++<36;b+=~a%5|3*a&4?(15^a?8^this.frac()*(20^a?16:4):4).toString(16):"-");return b},pick:function(a){return a[this.integerInRange(0,a.length-1)]},weightedPick:function(a){return a[~~(Math.pow(this.frac(),2)*(a.length-1))]},timestamp:function(a,b){return this.realInRange(a||9466848e5,b||1577862e6)},angle:function(){return this.integerInRange(-180,180)}},b.RandomDataGenerator.prototype.constructor=b.RandomDataGenerator,b.QuadTree=function(a,b,c,d,e,f,g){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(a,b,c,d,e,f,g)},b.QuadTree.prototype={reset:function(a,b,c,d,e,f,g){this.maxObjects=e||10,this.maxLevels=f||4,this.level=g||0,this.bounds={x:Math.round(a),y:Math.round(b),width:c,height:d,subWidth:Math.floor(c/2),subHeight:Math.floor(d/2),right:Math.round(a)+Math.floor(c/2),bottom:Math.round(b)+Math.floor(d/2)},this.objects.length=0,this.nodes.length=0},populate:function(a){a.forEach(this.populateHandler,this,!0)},populateHandler:function(a){a.body&&a.exists&&this.insert(a.body)},split:function(){this.level++,this.nodes[0]=new b.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level),this.nodes[1]=new b.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level),this.nodes[2]=new b.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level),this.nodes[3]=new b.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level)},insert:function(a){var b,c=0;if(null!=this.nodes[0]&&(b=this.getIndex(a),-1!==b))return void this.nodes[b].insert(a);if(this.objects.push(a),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();c<this.objects.length;)b=this.getIndex(this.objects[c]),-1!==b?this.nodes[b].insert(this.objects.splice(c,1)[0]):c++},getIndex:function(a){var b=-1;return a.x<this.bounds.right&&a.right<this.bounds.right?a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?b=1:a.y>this.bounds.bottom&&(b=2):a.x>this.bounds.right&&(a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?b=0:a.y>this.bounds.bottom&&(b=3)),b},retrieve:function(a){if(a instanceof b.Rectangle)var c=this.objects,d=this.getIndex(a);else{if(!a.body)return this._empty;var c=this.objects,d=this.getIndex(a.body)}return this.nodes[0]&&(-1!==d?c=c.concat(this.nodes[d].retrieve(a)):(c=c.concat(this.nodes[0].retrieve(a)),c=c.concat(this.nodes[1].retrieve(a)),c=c.concat(this.nodes[2].retrieve(a)),c=c.concat(this.nodes[3].retrieve(a)))),c},clear:function(){this.objects.length=0;for(var a=this.nodes.length;a--;)this.nodes[a].clear(),this.nodes.splice(a,1);this.nodes.length=0}},b.QuadTree.prototype.constructor=b.QuadTree,b.Net=function(a){this.game=a},b.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(a){return-1!==window.location.hostname.indexOf(a)},updateQueryString:function(a,b,c,d){"undefined"==typeof c&&(c=!1),("undefined"==typeof d||""===d)&&(d=window.location.href);var e="",f=new RegExp("([?|&])"+a+"=.*?(&|#|$)(.*)","gi");if(f.test(d))e="undefined"!=typeof b&&null!==b?d.replace(f,"$1"+a+"="+b+"$2$3"):d.replace(f,"$1$3").replace(/(&|\?)$/,"");else if("undefined"!=typeof b&&null!==b){var g=-1!==d.indexOf("?")?"&":"?",h=d.split("#");d=h[0]+g+a+"="+b,h[1]&&(d+="#"+h[1]),e=d}else e=d;return c?void(window.location.href=e):e},getQueryString:function(a){"undefined"==typeof a&&(a="");var b={},c=location.search.substring(1).split("&");for(var d in c){var e=c[d].split("=");if(e.length>1){if(a&&a==this.decodeURI(e[0]))return this.decodeURI(e[1]);b[this.decodeURI(e[0])]=this.decodeURI(e[1])}}return b},decodeURI:function(a){return decodeURIComponent(a.replace(/\+/g," "))}},b.Net.prototype.constructor=b.Net,b.TweenManager=function(a){this.game=a,this._tweens=[],this._add=[],this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},b.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var a=0;a<this._tweens.length;a++)this._tweens[a].pendingDelete=!0;this._add=[]},add:function(a){a._manager=this,this._add.push(a)},create:function(a){return new b.Tween(a,this.game,this)},remove:function(a){var b=this._tweens.indexOf(a);-1!==b&&(this._tweens[b].pendingDelete=!0)},update:function(){if(0===this._tweens.length&&0===this._add.length)return!1;for(var a=0,b=this._tweens.length;b>a;)this._tweens[a].update(this.game.time.now)?a++:(this._tweens.splice(a,1),b--);return this._add.length>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(a){return this._tweens.some(function(b){return b._object===a})},_pauseAll:function(){for(var a=this._tweens.length-1;a>=0;a--)this._tweens[a]._pause()},_resumeAll:function(){for(var a=this._tweens.length-1;a>=0;a--)this._tweens[a]._resume()},pauseAll:function(){for(var a=this._tweens.length-1;a>=0;a--)this._tweens[a].pause()},resumeAll:function(){for(var a=this._tweens.length-1;a>=0;a--)this._tweens[a].resume(!0)}},b.TweenManager.prototype.constructor=b.TweenManager,b.Tween=function(a,c,d){this._object=a,this.game=c,this._manager=d,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=b.Easing.Linear.None,this._interpolationFunction=b.Math.linearInterpolation,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._paused=!1,this._pausedTime=0,this._codePaused=!1,this.pendingDelete=!1,this.onStart=new b.Signal,this.onLoop=new b.Signal,this.onComplete=new b.Signal,this.isRunning=!1},b.Tween.prototype={to:function(a,b,c,d,e,f,g){b=b||1e3,c=c||null,d=d||!1,e=e||0,f=f||0,g=g||!1,g&&0===f&&(f=1);var h;return this._parent?(h=this._manager.create(this._object),this._lastChild.chain(h),this._lastChild=h):(h=this,this._parent=this,this._lastChild=this),h._repeat=f,h._duration=b,h._valuesEnd=a,null!==c&&(h._easingFunction=c),e>0&&(h._delayTime=e),h._yoyo=g,d?this.start():this},from:function(a,b,c,d,e,f,g){var h={};for(var i in a)h[i]=this._object[i],this._object[i]=a[i];return this.to(h,b,c,d,e,f,g)},start:function(){if(null!==this.game&&null!==this._object){this._manager.add(this),this.isRunning=!0,this._onStartCallbackFired=!1,this._startTime=this.game.time.now+this._delayTime;for(var a in this._valuesEnd){if(Array.isArray(this._valuesEnd[a])){if(0===this._valuesEnd[a].length)continue;this._valuesEnd[a]=[this._object[a]].concat(this._valuesEnd[a])}this._valuesStart[a]=this._object[a],Array.isArray(this._valuesStart[a])||(this._valuesStart[a]*=1),this._valuesStartRepeat[a]=this._valuesStart[a]||0}return this}},generateData:function(a,b){if(null===this.game||null===this._object)return null;this._startTime=0;for(var c in this._valuesEnd){if(Array.isArray(this._valuesEnd[c])){if(0===this._valuesEnd[c].length)continue;this._valuesEnd[c]=[this._object[c]].concat(this._valuesEnd[c])}this._valuesStart[c]=this._object[c],Array.isArray(this._valuesStart[c])||(this._valuesStart[c]*=1),this._valuesStartRepeat[c]=this._valuesStart[c]||0}for(var d=0,e=Math.floor(a*(this._duration/1e3)),f=this._duration/e,g=[];e--;){var c,h=(d-this._startTime)/this._duration;h=h>1?1:h;var i=this._easingFunction(h),j={};for(c in this._valuesEnd){var k=this._valuesStart[c]||0,l=this._valuesEnd[c];l instanceof Array?j[c]=this._interpolationFunction(l,i):("string"==typeof l&&(l=k+parseFloat(l,10)),"number"==typeof l&&(j[c]=k+(l-k)*i))}g.push(j),d+=f}if(this._yoyo){var m=g.slice();m.reverse(),g=g.concat(m)}return"undefined"!=typeof b?b=b.concat(g):g},stop:function(){return this.isRunning=!1,this._onUpdateCallback=null,this._manager.remove(this),this},delay:function(a){return this._delayTime=a,this},repeat:function(a){return this._repeat=a,this},yoyo:function(a){return this._yoyo=a,a&&0===this._repeat&&(this._repeat=1),this},easing:function(a){return this._easingFunction=a,this},interpolation:function(a){return this._interpolationFunction=a,this},chain:function(){return this._chainedTweens=arguments,this},loop:function(){return this._lastChild.chain(this),this},onUpdateCallback:function(a,b){return this._onUpdateCallback=a,this._onUpdateCallbackContext=b,this},pause:function(){this._codePaused=!0,this._paused=!0,this._pausedTime=this.game.time.now},_pause:function(){this._codePaused||(this._paused=!0,this._pausedTime=this.game.time.now)},resume:function(){this._paused&&(this._paused=!1,this._codePaused=!1,this._startTime+=this.game.time.now-this._pausedTime)},_resume:function(){this._codePaused||(this._startTime+=this.game.time.pauseDuration,this._paused=!1)},update:function(a){if(this.pendingDelete)return!1;if(this._paused||a<this._startTime)return!0;var b;if(a<this._startTime)return!0;this._onStartCallbackFired===!1&&(this.onStart.dispatch(this._object),this._onStartCallbackFired=!0);var c=(a-this._startTime)/this._duration;c=c>1?1:c;var d=this._easingFunction(c);for(b in this._valuesEnd){var e=this._valuesStart[b]||0,f=this._valuesEnd[b];f instanceof Array?this._object[b]=this._interpolationFunction(f,d):("string"==typeof f&&(f=e+parseFloat(f,10)),"number"==typeof f&&(this._object[b]=e+(f-e)*d))}if(null!==this._onUpdateCallback&&(this._onUpdateCallback.call(this._onUpdateCallbackContext,this,d),!this.isRunning))return!1;if(1==c){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(b in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[b]&&(this._valuesStartRepeat[b]=this._valuesStartRepeat[b]+parseFloat(this._valuesEnd[b],10)),this._yoyo){var g=this._valuesStartRepeat[b];this._valuesStartRepeat[b]=this._valuesEnd[b],this._valuesEnd[b]=g}this._valuesStart[b]=this._valuesStartRepeat[b]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=a+this._delayTime,this.onLoop.dispatch(this._object),!0}this.isRunning=!1,this.onComplete.dispatch(this._object);for(var h=0,i=this._chainedTweens.length;i>h;h++)this._chainedTweens[h].start(a);return!1}return!0}},b.Tween.prototype.constructor=b.Tween,b.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-b.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*b.Easing.Bounce.In(2*a):.5*b.Easing.Bounce.Out(2*a-1)+.5}}},b.Time=function(a){this.game=a,this.time=0,this.now=0,this.elapsed=0,this.pausedTime=0,this.advancedTiming=!1,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.physicsElapsed=0,this.deltaCap=0,this.timeCap=1e3,this.frames=0,this.pauseDuration=0,this.timeToCall=0,this.lastTime=0,this.events=new b.Timer(this.game,!1),this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[],this._len=0,this._i=0},b.Time.prototype={boot:function(){this._started=Date.now(),this.events.start()},add:function(a){return this._timers.push(a),a},create:function(a){"undefined"==typeof a&&(a=!0);var c=new b.Timer(this.game,a);return this._timers.push(c),c},removeAll:function(){for(var a=0;a<this._timers.length;a++)this._timers[a].destroy();this._timers=[],this.events.removeAll()},update:function(a){if(this.now=a,this.timeToCall=this.game.math.max(0,16-(a-this.lastTime)),this.elapsed=this.now-this.time,this.elapsed>this.timeCap&&(this.elapsed=1/60),this.physicsElapsed=this.elapsed/1e3||1/60,this.deltaCap>0&&this.physicsElapsed>this.deltaCap&&(this.physicsElapsed=this.deltaCap),this.advancedTiming&&(this.msMin=this.game.math.min(this.msMin,this.elapsed),this.msMax=this.game.math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=this.game.math.min(this.fpsMin,this.fps),this.fpsMax=this.game.math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),this.time=this.now,this.lastTime=a+this.timeToCall,!this.game.paused)for(this.events.update(this.now),this._i=0,this._len=this._timers.length;this._i<this._len;)this._timers[this._i].update(this.now)?this._i++:(this._timers.splice(this._i,1),this._len--)},gamePaused:function(){this._pauseStarted=this.now,this.events.pause();for(var a=this._timers.length;a--;)this._timers[a]._pause()},gameResumed:function(){this.time=this.now=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var a=this._timers.length;a--;)this._timers[a]._resume()},totalElapsedSeconds:function(){return.001*(this.now-this._started)},elapsedSince:function(a){return this.now-a},elapsedSecondsSince:function(a){return.001*(this.now-a)},reset:function(){this._started=this.now,this.removeAll()}},b.Time.prototype.constructor=b.Time,b.Timer=function(a,c){"undefined"==typeof c&&(c=!0),this.game=a,this.running=!1,this.autoDestroy=c,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new b.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},b.Timer.MINUTE=6e4,b.Timer.SECOND=1e3,b.Timer.HALF=500,b.Timer.QUARTER=250,b.Timer.prototype={create:function(a,c,d,e,f,g){var h=a;h+=0===this._now?this.game.time.now:this._now;var i=new b.TimerEvent(this,a,h,d,c,e,f,g);return this.events.push(i),this.order(),this.expired=!1,i},add:function(a,b,c){return this.create(a,!1,0,b,c,Array.prototype.splice.call(arguments,3))},repeat:function(a,b,c,d){return this.create(a,!1,b,c,d,Array.prototype.splice.call(arguments,4))},loop:function(a,b,c){return this.create(a,!0,0,b,c,Array.prototype.splice.call(arguments,3))},start:function(a){if(!this.running){this._started=this.game.time.now+(a||0),this.running=!0;for(var b=0;b<this.events.length;b++)this.events[b].tick=this.events[b].delay+this._started}},stop:function(a){this.running=!1,"undefined"==typeof a&&(a=!0),a&&(this.events.length=0)},remove:function(a){for(var b=0;b<this.events.length;b++)if(this.events[b]===a)return this.events[b].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(a,b){return a.tick<b.tick?-1:a.tick>b.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(a){if(this.paused)return!0;if(this.elapsed=a-this._now,this._now=a,this.elapsed>this.timeCap&&this.adjustEvents(a-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.now,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.now,this.paused=!0)},adjustEvents:function(a){for(var b=0;b<this.events.length;b++)if(!this.events[b].pendingDelete){var c=this.events[b].tick-a;0>c&&(c=0),this.events[b].tick=this._now+c}var d=this.nextTick-a;this.nextTick=0>d?this._now:this._now+d},resume:function(){if(this.paused){var a=this.game.time.now;this._pauseTotal+=a-this._now,this._now=a,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(b.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(b.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(b.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(b.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(b.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),b.Timer.prototype.constructor=b.Timer,b.TimerEvent=function(a,b,c,d,e,f,g,h){this.timer=a,this.delay=b,this.tick=c,this.repeatCount=d-1,this.loop=e,this.callback=f,this.callbackContext=g,this.args=h,this.pendingDelete=!1},b.TimerEvent.prototype.constructor=b.TimerEvent,b.AnimationManager=function(a){this.sprite=a,this.game=a.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},b.AnimationManager.prototype={loadFrameData:function(a,b){return this._frameData=a,"undefined"==typeof b||null===b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0,this._frameData?!0:!1},add:function(a,c,d,e,f){return null===this._frameData?void console.warn("No FrameData available for Phaser.Animation "+a):(c=c||[],d=d||60,"undefined"==typeof e&&(e=!1),"undefined"==typeof f&&(f=c&&"number"==typeof c[0]?!0:!1),null===this.sprite.events.onAnimationStart&&(this.sprite.events.onAnimationStart=new b.Signal,this.sprite.events.onAnimationComplete=new b.Signal,this.sprite.events.onAnimationLoop=new b.Signal),this._outputFrames.length=0,this._frameData.getFrameIndexes(c,f,this._outputFrames),this._anims[a]=new b.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,d,e),this.currentAnim=this._anims[a],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[a])},validateFrames:function(a,b){"undefined"==typeof b&&(b=!0);for(var c=0;c<a.length;c++)if(b===!0){if(a[c]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(a[c])===!1)return!1;return!0},play:function(a,b,c,d){return this._anims[a]?this.currentAnim===this._anims[a]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(b,c,d)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[a],this.currentAnim.paused=!1,this.currentAnim.play(b,c,d)):void 0},stop:function(a,b){"undefined"==typeof b&&(b=!1),"string"==typeof a?this._anims[a]&&(this.currentAnim=this._anims[a],this.currentAnim.stop(b)):this.currentAnim&&this.currentAnim.stop(b)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()===!0?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(a){this.currentAnim&&(this.currentAnim.next(a),this.currentFrame=this.currentAnim.currentFrame)},previous:function(a){this.currentAnim&&(this.currentAnim.previous(a),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(a){return"string"==typeof a&&this._anims[a]?this._anims[a]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var a=null;for(var a in this._anims)this._anims.hasOwnProperty(a)&&this._anims[a].destroy();this._anims={},this._frameData=null,this._frameIndex=0,this.currentAnim=null,this.currentFrame=null}},b.AnimationManager.prototype.constructor=b.AnimationManager,Object.defineProperty(b.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(b.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData?this._frameData.total:-1}}),Object.defineProperty(b.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(a){this.currentAnim.paused=a}}),Object.defineProperty(b.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this._frameIndex:void 0},set:function(a){"number"==typeof a&&this._frameData&&null!==this._frameData.getFrame(a)&&(this.currentFrame=this._frameData.getFrame(a),this.currentFrame&&(this._frameIndex=a,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))) }}),Object.defineProperty(b.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(a){"string"==typeof a&&this._frameData&&null!==this._frameData.getFrameByName(a)?(this.currentFrame=this._frameData.getFrameByName(a),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+a)}}),b.Animation=function(a,c,d,e,f,g,h){this.game=a,this._parent=c,this._frameData=e,this.name=d,this._frames=[],this._frames=this._frames.concat(f),this.delay=1e3/g,this.loop=h,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new b.Signal,this.onComplete=new b.Signal,this.onLoop=new b.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},b.Animation.prototype={play:function(a,b,c){return"number"==typeof a&&(this.delay=1e3/a),"boolean"==typeof b&&(this.loop=b),"undefined"!=typeof c&&(this.killOnComplete=c),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1),this._parent.events.onAnimationStart.dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this.onStart.dispatch(this._parent,this)},setFrame:function(a,b){var c;if("undefined"==typeof b&&(b=!1),"string"==typeof a)for(var d=0;d<this._frames.length;d++)this._frameData.getFrame(this._frames[d]).name===a&&(c=d);else if("number"==typeof a)if(b)c=a;else for(var d=0;d<this._frames.length;d++)this.frames[d]===c&&(c=d);c&&(this._frameIndex=c-1,this._timeNextFrame=this.game.time.now,this.update())},stop:function(a,b){"undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,a&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),b&&(this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.now)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.now+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.now>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.now-this._timeNextFrame,this._timeLastFrame=this.game.time.now,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length&&(this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop.dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this)):this.complete()),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),!0):!1},next:function(a){"undefined"==typeof a&&(a=1);var b=this._frameIndex+a;b>=this._frames.length&&(this.loop?b%=this._frames.length:b=this._frames.length-1),b!==this._frameIndex&&(this._frameIndex=b,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)))},previous:function(a){"undefined"==typeof a&&(a=1);var b=this._frameIndex-a;0>b&&(this.loop?b=this._frames.length+b:b++),b!==this._frameIndex&&(this._frameIndex=b,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)))},destroy:function(){this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose()},complete:function(){this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},b.Animation.prototype.constructor=b.Animation,Object.defineProperty(b.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(a){this.isPaused=a,a?this._pauseStartTime=this.game.time.now:this.isPlaying&&(this._timeNextFrame=this.game.time.now+this.delay)}}),Object.defineProperty(b.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(b.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(a){this.currentFrame=this._frameData.getFrame(this._frames[a]),null!==this.currentFrame&&(this._frameIndex=a,this._parent.setFrame(this.currentFrame))}}),Object.defineProperty(b.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(a){a>=1&&(this.delay=1e3/a)}}),b.Animation.generateFrameNames=function(a,c,d,e,f){"undefined"==typeof e&&(e="");var g=[],h="";if(d>c)for(var i=c;d>=i;i++)h="number"==typeof f?b.Utils.pad(i.toString(),f,"0",1):i.toString(),h=a+h+e,g.push(h);else for(var i=c;i>=d;i--)h="number"==typeof f?b.Utils.pad(i.toString(),f,"0",1):i.toString(),h=a+h+e,g.push(h);return g},b.Frame=function(a,c,d,e,f,g,h){this.index=a,this.x=c,this.y=d,this.width=e,this.height=f,this.name=g,this.uuid=h,this.centerX=Math.floor(e/2),this.centerY=Math.floor(f/2),this.distance=b.Math.distance(0,0,e,f),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=e,this.sourceSizeH=f,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},b.Frame.prototype={setTrim:function(a,b,c,d,e,f,g){this.trimmed=a,a&&(this.sourceSizeW=b,this.sourceSizeH=c,this.centerX=Math.floor(b/2),this.centerY=Math.floor(c/2),this.spriteSourceSizeX=d,this.spriteSourceSizeY=e,this.spriteSourceSizeW=f,this.spriteSourceSizeH=g)},getRect:function(a){return"undefined"==typeof a?a=new b.Rectangle(this.x,this.y,this.width,this.height):a.setTo(this.x,this.y,this.width,this.height),a}},b.Frame.prototype.constructor=b.Frame,b.FrameData=function(){this._frames=[],this._frameNames=[]},b.FrameData.prototype={addFrame:function(a){return a.index=this._frames.length,this._frames.push(a),""!==a.name&&(this._frameNames[a.name]=a.index),a},getFrame:function(a){return a>this._frames.length&&(a=0),this._frames[a]},getFrameByName:function(a){return"number"==typeof this._frameNames[a]?this._frames[this._frameNames[a]]:null},checkFrameName:function(a){return null==this._frameNames[a]?!1:!0},getFrameRange:function(a,b,c){"undefined"==typeof c&&(c=[]);for(var d=a;b>=d;d++)c.push(this._frames[d]);return c},getFrames:function(a,b,c){if("undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=[]),"undefined"==typeof a||0===a.length)for(var d=0;d<this._frames.length;d++)c.push(this._frames[d]);else for(var d=0,e=a.length;e>d;d++)c.push(b?this.getFrame(a[d]):this.getFrameByName(a[d]));return c},getFrameIndexes:function(a,b,c){if("undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=[]),"undefined"==typeof a||0===a.length)for(var d=0,e=this._frames.length;e>d;d++)c.push(this._frames[d].index);else for(var d=0,e=a.length;e>d;d++)b?c.push(a[d]):this.getFrameByName(a[d])&&c.push(this.getFrameByName(a[d]).index);return c}},b.FrameData.prototype.constructor=b.FrameData,Object.defineProperty(b.FrameData.prototype,"total",{get:function(){return this._frames.length}}),b.AnimationParser={spriteSheet:function(a,c,d,e,f,g,h){var i=a.cache.getImage(c);if(null==i)return null;var j=i.width,k=i.height;0>=d&&(d=Math.floor(-j/Math.min(-1,d))),0>=e&&(e=Math.floor(-k/Math.min(-1,e)));var l=Math.floor((j-g)/(d+h)),m=Math.floor((k-g)/(e+h)),n=l*m;if(-1!==f&&(n=f),0===j||0===k||d>j||e>k||0===n)return console.warn("Phaser.AnimationParser.spriteSheet: width/height zero or width/height < given frameWidth/frameHeight"),null;for(var o=new b.FrameData,p=g,q=g,r=0;n>r;r++){var s=a.rnd.uuid();o.addFrame(new b.Frame(r,p,q,d,e,"",s)),p+=d+h,p+d>j&&(p=g,q+=e+h)}return o},JSONData:function(a,c){if(!c.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(c);for(var d,e=new b.FrameData,f=c.frames,g=0;g<f.length;g++){var h=a.rnd.uuid();d=e.addFrame(new b.Frame(g,f[g].frame.x,f[g].frame.y,f[g].frame.w,f[g].frame.h,f[g].filename,h)),f[g].trimmed&&d.setTrim(f[g].trimmed,f[g].sourceSize.w,f[g].sourceSize.h,f[g].spriteSourceSize.x,f[g].spriteSourceSize.y,f[g].spriteSourceSize.w,f[g].spriteSourceSize.h)}return e},JSONDataHash:function(a,c){if(!c.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(c);var d,e=new b.FrameData,f=c.frames,g=0;for(var h in f){var i=a.rnd.uuid();d=e.addFrame(new b.Frame(g,f[h].frame.x,f[h].frame.y,f[h].frame.w,f[h].frame.h,h,i)),f[h].trimmed&&d.setTrim(f[h].trimmed,f[h].sourceSize.w,f[h].sourceSize.h,f[h].spriteSourceSize.x,f[h].spriteSourceSize.y,f[h].spriteSourceSize.w,f[h].spriteSourceSize.h),g++}return e},XMLData:function(a,c){if(!c.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var d,e,f,g,h,i,j,k,l,m,n,o,p=new b.FrameData,q=c.getElementsByTagName("SubTexture"),r=0;r<q.length;r++)e=a.rnd.uuid(),g=q[r].attributes,f=g.name.nodeValue,h=parseInt(g.x.nodeValue,10),i=parseInt(g.y.nodeValue,10),j=parseInt(g.width.nodeValue,10),k=parseInt(g.height.nodeValue,10),l=null,m=null,g.frameX&&(l=Math.abs(parseInt(g.frameX.nodeValue,10)),m=Math.abs(parseInt(g.frameY.nodeValue,10)),n=parseInt(g.frameWidth.nodeValue,10),o=parseInt(g.frameHeight.nodeValue,10)),d=p.addFrame(new b.Frame(r,h,i,j,k,f,e)),(null!==l||null!==m)&&d.setTrim(!0,j,k,l,m,n,o);return p}},b.Cache=function(a){this.game=a,this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._json={},this._physics={},this._tilemaps={},this._binary={},this._bitmapDatas={},this._bitmapFont={},this.addDefaultImage(),this.addMissingImage(),this.onSoundUnlock=new b.Signal,this._cacheMap=[],this._cacheMap[b.Cache.CANVAS]=this._canvases,this._cacheMap[b.Cache.IMAGE]=this._images,this._cacheMap[b.Cache.TEXTURE]=this._textures,this._cacheMap[b.Cache.SOUND]=this._sounds,this._cacheMap[b.Cache.TEXT]=this._text,this._cacheMap[b.Cache.PHYSICS]=this._physics,this._cacheMap[b.Cache.TILEMAP]=this._tilemaps,this._cacheMap[b.Cache.BINARY]=this._binary,this._cacheMap[b.Cache.BITMAPDATA]=this._bitmapDatas,this._cacheMap[b.Cache.BITMAPFONT]=this._bitmapFont,this._cacheMap[b.Cache.JSON]=this._json},b.Cache.CANVAS=1,b.Cache.IMAGE=2,b.Cache.TEXTURE=3,b.Cache.SOUND=4,b.Cache.TEXT=5,b.Cache.PHYSICS=6,b.Cache.TILEMAP=7,b.Cache.BINARY=8,b.Cache.BITMAPDATA=9,b.Cache.BITMAPFONT=10,b.Cache.JSON=11,b.Cache.prototype={addCanvas:function(a,b,c){this._canvases[a]={canvas:b,context:c}},addBinary:function(a,b){this._binary[a]=b},addBitmapData:function(a,b){return this._bitmapDatas[a]=b,b},addRenderTexture:function(a,c){var d=new b.Frame(0,0,0,c.width,c.height,"","");this._textures[a]={texture:c,frame:d}},addSpriteSheet:function(a,c,d,e,f,g,h,i){this._images[a]={url:c,data:d,spriteSheet:!0,frameWidth:e,frameHeight:f,margin:h,spacing:i},PIXI.BaseTextureCache[a]=new PIXI.BaseTexture(d),this._images[a].frameData=b.AnimationParser.spriteSheet(this.game,a,e,f,g,h,i)},addTilemap:function(a,b,c,d){this._tilemaps[a]={url:b,data:c,format:d}},addTextureAtlas:function(a,c,d,e,f){this._images[a]={url:c,data:d,spriteSheet:!0},PIXI.BaseTextureCache[a]=new PIXI.BaseTexture(d),f==b.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[a].frameData=b.AnimationParser.JSONData(this.game,e,a):f==b.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[a].frameData=b.AnimationParser.JSONDataHash(this.game,e,a):f==b.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[a].frameData=b.AnimationParser.XMLData(this.game,e,a))},addBitmapFont:function(a,c,d,e,f,g){this._images[a]={url:c,data:d,spriteSheet:!0},PIXI.BaseTextureCache[a]=new PIXI.BaseTexture(d),b.LoaderParser.bitmapFont(this.game,e,a,f,g)},addPhysicsData:function(a,b,c,d){this._physics[a]={url:b,data:c,format:d}},addDefaultImage:function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",this._images.__default={url:null,data:a,spriteSheet:!1},this._images.__default.frame=new b.Frame(0,0,0,32,32,"",""),PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(a),PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",this._images.__missing={url:null,data:a,spriteSheet:!1},this._images.__missing.frame=new b.Frame(0,0,0,32,32,"",""),PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(a),PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(a,b,c){this._text[a]={url:b,data:c}},addJSON:function(a,b,c){this._json[a]={url:b,data:c}},addImage:function(a,c,d){this._images[a]={url:c,data:d,spriteSheet:!1},this._images[a].frame=new b.Frame(0,0,0,d.width,d.height,a,this.game.rnd.uuid()),PIXI.BaseTextureCache[a]=new PIXI.BaseTexture(d)},addSound:function(a,b,c,d,e){d=d||!0,e=e||!1;var f=!1;e&&(f=!0),this._sounds[a]={url:b,data:c,isDecoding:!1,decoded:f,webAudio:d,audioTag:e,locked:this.game.sound.touchLocked}},reloadSound:function(a){var b=this;this._sounds[a]&&(this._sounds[a].data.src=this._sounds[a].url,this._sounds[a].data.addEventListener("canplaythrough",function(){return b.reloadSoundComplete(a)},!1),this._sounds[a].data.load())},reloadSoundComplete:function(a){this._sounds[a]&&(this._sounds[a].locked=!1,this.onSoundUnlock.dispatch(a))},updateSound:function(a,b,c){this._sounds[a]&&(this._sounds[a][b]=c)},decodedSound:function(a,b){this._sounds[a].data=b,this._sounds[a].decoded=!0,this._sounds[a].isDecoding=!1},getCanvas:function(a){return this._canvases[a]?this._canvases[a].canvas:void console.warn('Phaser.Cache.getCanvas: Invalid key: "'+a+'"')},getBitmapData:function(a){return this._bitmapDatas[a]?this._bitmapDatas[a]:void console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+a+'"')},getBitmapFont:function(a){return this._bitmapFont[a]?this._bitmapFont[a]:void console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+a+'"')},getPhysicsData:function(a,b,c){if("undefined"==typeof b||null===b){if(this._physics[a])return this._physics[a].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+a+'"')}else if(this._physics[a]&&this._physics[a].data[b]){var d=this._physics[a].data[b];if(!d||!c)return d;for(var e in d)if(e=d[e],e.fixtureKey===c)return e;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+c+" in "+a+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+a+" / "+b+'"');return null},checkKey:function(a,b){return this._cacheMap[a][b]?!0:!1},checkCanvasKey:function(a){return this.checkKey(b.Cache.CANVAS,a)},checkImageKey:function(a){return this.checkKey(b.Cache.IMAGE,a)},checkTextureKey:function(a){return this.checkKey(b.Cache.TEXTURE,a)},checkSoundKey:function(a){return this.checkKey(b.Cache.SOUND,a)},checkTextKey:function(a){return this.checkKey(b.Cache.TEXT,a)},checkPhysicsKey:function(a){return this.checkKey(b.Cache.PHYSICS,a)},checkTilemapKey:function(a){return this.checkKey(b.Cache.TILEMAP,a)},checkBinaryKey:function(a){return this.checkKey(b.Cache.BINARY,a)},checkBitmapDataKey:function(a){return this.checkKey(b.Cache.BITMAPDATA,a)},checkBitmapFontKey:function(a){return this.checkKey(b.Cache.BITMAPFONT,a)},checkJSONKey:function(a){return this.checkKey(b.Cache.JSON,a)},getImage:function(a){return this._images[a]?this._images[a].data:void console.warn('Phaser.Cache.getImage: Invalid key: "'+a+'"')},getTilemapData:function(a){return this._tilemaps[a]?this._tilemaps[a]:void console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+a+'"')},getFrameData:function(a){return this._images[a]&&this._images[a].frameData?this._images[a].frameData:null},updateFrameData:function(a,b){this._images[a]&&(this._images[a].spriteSheet=!0,this._images[a].frameData=b)},getFrameByIndex:function(a,b){return this._images[a]&&this._images[a].frameData?this._images[a].frameData.getFrame(b):null},getFrameByName:function(a,b){return this._images[a]&&this._images[a].frameData?this._images[a].frameData.getFrameByName(b):null},getFrame:function(a){return this._images[a]&&this._images[a].spriteSheet===!1?this._images[a].frame:null},getTextureFrame:function(a){return this._textures[a]?this._textures[a].frame:null},getTexture:function(a){return this._textures[a]?this._textures[a]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+a+'"')},getSound:function(a){return this._sounds[a]?this._sounds[a]:void console.warn('Phaser.Cache.getSound: Invalid key: "'+a+'"')},getSoundData:function(a){return this._sounds[a]?this._sounds[a].data:void console.warn('Phaser.Cache.getSoundData: Invalid key: "'+a+'"')},isSoundDecoded:function(a){return this._sounds[a]?this._sounds[a].decoded:void 0},isSoundReady:function(a){return this._sounds[a]&&this._sounds[a].decoded&&this.game.sound.touchLocked===!1},isSpriteSheet:function(a){return this._images[a]?this._images[a].spriteSheet:!1},getText:function(a){return this._text[a]?this._text[a].data:void console.warn('Phaser.Cache.getText: Invalid key: "'+a+'"')},getJSON:function(a){return this._json[a]?this._json[a].data:void console.warn('Phaser.Cache.getJSON: Invalid key: "'+a+'"')},getBinary:function(a){return this._binary[a]?this._binary[a]:void console.warn('Phaser.Cache.getBinary: Invalid key: "'+a+'"')},getKeys:function(a){var c=null;switch(a){case b.Cache.CANVAS:c=this._canvases;break;case b.Cache.IMAGE:c=this._images;break;case b.Cache.TEXTURE:c=this._textures;break;case b.Cache.SOUND:c=this._sounds;break;case b.Cache.TEXT:c=this._text;break;case b.Cache.PHYSICS:c=this._physics;break;case b.Cache.TILEMAP:c=this._tilemaps;break;case b.Cache.BINARY:c=this._binary;break;case b.Cache.BITMAPDATA:c=this._bitmapDatas;break;case b.Cache.BITMAPFONT:c=this._bitmapFont;break;case b.Cache.JSON:c=this._json}if(c){var d=[];for(var e in c)"__default"!==e&&"__missing"!==e&&d.push(e);return d}},removeCanvas:function(a){delete this._canvases[a]},removeImage:function(a){delete this._images[a]},removeSound:function(a){delete this._sounds[a]},removeText:function(a){delete this._text[a]},removeJSON:function(a){delete this._json[a]},removePhysics:function(a){delete this._physics[a]},removeTilemap:function(a){delete this._tilemaps[a]},removeBinary:function(a){delete this._binary[a]},removeBitmapData:function(a){delete this._bitmapDatas[a]},removeBitmapFont:function(a){delete this._bitmapFont[a]},destroy:function(){for(var a in this._canvases)delete this._canvases[a];for(var a in this._images)"__default"!==a&&"__missing"!==a&&delete this._images[a];for(var a in this._sounds)delete this._sounds[a];for(var a in this._text)delete this._text[a];for(var a in this._json)delete this._json[a];for(var a in this._textures)delete this._textures[a];for(var a in this._physics)delete this._physics[a];for(var a in this._tilemaps)delete this._tilemaps[a];for(var a in this._binary)delete this._binary[a];for(var a in this._bitmapDatas)delete this._bitmapDatas[a];for(var a in this._bitmapFont)delete this._bitmapFont[a]}},b.Cache.prototype.constructor=b.Cache,b.Loader=function(a){this.game=a,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.progressFloat=0,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.onLoadStart=new b.Signal,this.onFileStart=new b.Signal,this.onFileComplete=new b.Signal,this.onFileError=new b.Signal,this.onLoadComplete=new b.Signal,this._packList=[],this._packIndex=0,this._fileList=[],this._fileIndex=0,this._progressChunk=0,this._xhr=new XMLHttpRequest,this._ajax=null},b.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,b.Loader.TEXTURE_ATLAS_JSON_HASH=1,b.Loader.TEXTURE_ATLAS_XML_STARLING=2,b.Loader.PHYSICS_LIME_CORONA_JSON=3,b.Loader.PHYSICS_PHASER_JSON=4,b.Loader.prototype={setPreloadSprite:function(a,c){c=c||0,this.preloadSprite={sprite:a,direction:c,width:a.width,height:a.height,rect:null},this.preloadSprite.rect=0===c?new b.Rectangle(0,0,1,a.height):new b.Rectangle(0,0,a.width,1),a.crop(this.preloadSprite.rect),a.visible=!0},checkKeyExists:function(a,b){if(this._fileList.length>0)for(var c=0;c<this._fileList.length;c++)if(this._fileList[c].type===a&&this._fileList[c].key===b)return!0;return!1},getAssetIndex:function(a,b){if(this._fileList.length>0)for(var c=0;c<this._fileList.length;c++)if(this._fileList[c].type===a&&this._fileList[c].key===b)return c;return-1},getAsset:function(a,b){if(this._fileList.length>0)for(var c=0;c<this._fileList.length;c++)if(this._fileList[c].type===a&&this._fileList[c].key===b)return{index:c,file:this._fileList[c]};return!1},reset:function(){this.preloadSprite=null,this.isLoading=!1,this._packList.length=0,this._packIndex=0,this._fileList.length=0,this._fileIndex=0},addToFileList:function(a,b,c,d){var e={type:a,key:b,url:c,data:null,error:!1,loaded:!1};if("undefined"!=typeof d)for(var f in d)e[f]=d[f];this.checkKeyExists(a,b)===!1&&this._fileList.push(e)},replaceInFileList:function(a,b,c,d){var e={type:a,key:b,url:c,data:null,error:!1,loaded:!1};if("undefined"!=typeof d)for(var f in d)e[f]=d[f];var g=this.getAssetIndex(a,b);-1===g?this._fileList.push(e):this._fileList[g]=e},pack:function(a,b,c,d){return"undefined"==typeof b&&(b=null),"undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=this),null===b&&null===c?(console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this):(c&&"string"==typeof c&&(c=JSON.parse(c)),this._packList.push({key:a,url:b,data:c,loaded:!1,error:!1,callbackContext:d}),this)},image:function(a,b,c){return"undefined"==typeof c&&(c=!1),c?this.replaceInFileList("image",a,b):this.addToFileList("image",a,b),this},text:function(a,b,c){return"undefined"==typeof c&&(c=!1),c?this.replaceInFileList("text",a,b):this.addToFileList("text",a,b),this},json:function(a,b,c){return"undefined"==typeof c&&(c=!1),c?this.replaceInFileList("json",a,b):this.addToFileList("json",a,b),this},script:function(a,b,c,d){return"undefined"==typeof c&&(c=!1),c!==!1&&"undefined"==typeof d&&(d=c),this.addToFileList("script",a,b,{callback:c,callbackContext:d}),this},binary:function(a,b,c,d){return"undefined"==typeof c&&(c=!1),c!==!1&&"undefined"==typeof d&&(d=c),this.addToFileList("binary",a,b,{callback:c,callbackContext:d}),this},spritesheet:function(a,b,c,d,e,f,g){return"undefined"==typeof e&&(e=-1),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=0),this.addToFileList("spritesheet",a,b,{frameWidth:c,frameHeight:d,frameMax:e,margin:f,spacing:g}),this},audio:function(a,b,c){return"undefined"==typeof c&&(c=!0),this.addToFileList("audio",a,b,{buffer:null,autoDecode:c}),this},tilemap:function(a,c,d,e){if("undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e=b.Tilemap.CSV),null==c&&null==d)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;if(d){switch(e){case b.Tilemap.CSV:break;case b.Tilemap.TILED_JSON:"string"==typeof d&&(d=JSON.parse(d))}this.game.cache.addTilemap(a,null,d,e)}else this.addToFileList("tilemap",a,c,{format:e});return this},physics:function(a,c,d,e){return"undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e=b.Physics.LIME_CORONA_JSON),null==c&&null==d?(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),this):(d?("string"==typeof d&&(d=JSON.parse(d)),this.game.cache.addPhysicsData(a,null,d,e)):this.addToFileList("physics",a,c,{format:e}),this)},bitmapFont:function(a,b,c,d,e,f){if("undefined"==typeof c&&(c=null),"undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),c)this.addToFileList("bitmapfont",a,b,{xmlURL:c,xSpacing:e,ySpacing:f});else if("string"==typeof d){var g;try{if(window.DOMParser){var h=new DOMParser;g=h.parseFromString(d,"text/xml")}else g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(d)}catch(i){g=void 0}if(!g||!g.documentElement||g.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",a,b,{xmlURL:null,xmlData:g,xSpacing:e,ySpacing:f})}return this},atlasJSONArray:function(a,c,d,e){return this.atlas(a,c,d,e,b.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(a,c,d,e){return this.atlas(a,c,d,e,b.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(a,c,d,e){return this.atlas(a,c,d,e,b.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(a,c,d,e,f){if("undefined"==typeof d&&(d=null),"undefined"==typeof e&&(e=null),"undefined"==typeof f&&(f=b.Loader.TEXTURE_ATLAS_JSON_ARRAY),d)this.addToFileList("textureatlas",a,c,{atlasURL:d,format:f});else{switch(f){case b.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof e&&(e=JSON.parse(e));break;case b.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof e){var g;try{if(window.DOMParser){var h=new DOMParser;g=h.parseFromString(e,"text/xml")}else g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(e)}catch(i){g=void 0}if(!g||!g.documentElement||g.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");e=g}}this.addToFileList("textureatlas",a,c,{atlasURL:null,atlasData:e,format:f})}return this},removeFile:function(a,b){var c=this.getAsset(a,b);c!==!1&&this._fileList.splice(c.index,1)},removeAll:function(){this._fileList.length=0},start:function(){this.isLoading||(this._packList.length>0?(this._packIndex=0,this.loadPack()):this.beginLoad())},beginLoad:function(){this.progress=0,this.progressFloat=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this._fileList.length),this._fileList.length>0?(this._fileIndex=0,this._progressChunk=100/this._fileList.length,this.loadFile()):(this.progress=100,this.progressFloat=100,this.hasLoaded=!0,this.isLoading=!1,this.onLoadComplete.dispatch())},loadPack:function(){if(!this._packList[this._packIndex])return void console.warn("Phaser.Loader loadPackList invalid index "+this._packIndex);var a=this._packList[this._packIndex];null!==a.data?this.packLoadComplete(this._packIndex,!1):this.xhrLoad(this._packIndex,this.baseURL+a.url,"text","packLoadComplete","packLoadError")},packLoadComplete:function(a,c){if("undefined"==typeof c&&(c=!0),!this._packList[a])return void console.warn("Phaser.Loader packLoadComplete invalid index "+a);var d=this._packList[a];if(d.loaded=!0,c)var e=JSON.parse(this._xhr.responseText);else var e=this._packList[a].data;if(e[d.key])for(var f,g=0;g<e[d.key].length;g++)switch(f=e[d.key][g],f.type){case"image":this.image(f.key,f.url,f.overwrite);break;case"text":this.text(f.key,f.url,f.overwrite);break;case"json":this.json(f.key,f.url,f.overwrite);break;case"script":this.script(f.key,f.url,f.callback,d.callbackContext);break;case"binary":this.binary(f.key,f.url,f.callback,d.callbackContext);break;case"spritesheet":this.spritesheet(f.key,f.url,f.frameWidth,f.frameHeight,f.frameMax,f.margin,f.spacing);break;case"audio":this.audio(f.key,f.urls,f.autoDecode);break;case"tilemap":this.tilemap(f.key,f.url,f.data,b.Tilemap[f.format]);break;case"physics":this.physics(f.key,f.url,f.data,b.Loader[f.format]);break;case"bitmapFont":this.bitmapFont(f.key,f.textureURL,f.xmlURL,f.xmlData,f.xSpacing,f.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(f.key,f.textureURL,f.atlasURL,f.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(f.key,f.textureURL,f.atlasURL,f.atlasData);break;case"atlasXML":this.atlasXML(f.key,f.textureURL,f.atlasURL,f.atlasData);break;case"atlas":this.atlas(f.key,f.textureURL,f.atlasURL,f.atlasData,b.Loader[f.format])}this.nextPack(a,!0)},packError:function(a){this._packList[a].loaded=!0,this._packList[a].error=!0,this.onFileError.dispatch(this._packList[a].key,this._packList[a]),console.warn("Phaser.Loader error loading pack file: "+this._packList[a].key+" from URL "+this._packList[a].url),this.nextPack(a,!0)},nextPack:function(a,b){this.onPackComplete.dispatch(this._packList[a].key,b,this.totalLoadedPacks(),this._packList.length),this._packIndex++,this._packIndex<this._packList.length?this.loadPack():this.beginLoad()},loadFile:function(){if(!this._fileList[this._fileIndex])return void console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);var a=this._fileList[this._fileIndex],c=this;switch(this.onFileStart.dispatch(this.progress,a.key),a.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":a.data=new Image,a.data.name=a.key,a.data.onload=function(){return c.fileComplete(c._fileIndex)},a.data.onerror=function(){return c.fileError(c._fileIndex)},this.crossOrigin&&(a.data.crossOrigin=this.crossOrigin),a.data.src=this.baseURL+a.url;break;case"audio":a.url=this.getAudioURL(a.url),null!==a.url?this.game.sound.usingWebAudio?this.xhrLoad(this._fileIndex,this.baseURL+a.url,"arraybuffer","fileComplete","fileError"):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.baseURL+a.url,this.fileComplete(this._fileIndex)):(a.data=new Audio,a.data.name=a.key,a.data.onerror=function(){return c.fileError(c._fileIndex)},a.data.preload="auto",a.data.src=this.baseURL+a.url,a.data.addEventListener("canplaythrough",b.GAMES[this.game.id].load.fileComplete(this._fileIndex),!1),a.data.load())):this.fileError(this._fileIndex);break;case"json":window.XDomainRequest?(this._ajax=new window.XDomainRequest,this._ajax.timeout=3e3,this._ajax.onerror=function(){return c.dataLoadError(c._fileIndex)},this._ajax.ontimeout=function(){return c.dataLoadError(c._fileIndex)},this._ajax.onprogress=function(){},this._ajax.onload=function(){return c.jsonLoadComplete(c._fileIndex)},this._ajax.open("GET",this.baseURL+a.url,!0),this._ajax.send()):this.xhrLoad(this._fileIndex,this.baseURL+a.url,"text","jsonLoadComplete","dataLoadError");break;case"tilemap":if(a.format===b.Tilemap.TILED_JSON)this.xhrLoad(this._fileIndex,this.baseURL+a.url,"text","jsonLoadComplete","dataLoadError");else{if(a.format!==b.Tilemap.CSV)throw new Error("Phaser.Loader. Invalid Tilemap format: "+a.format); this.xhrLoad(this._fileIndex,this.baseURL+a.url,"text","csvLoadComplete","dataLoadError")}break;case"text":case"script":case"physics":this.xhrLoad(this._fileIndex,this.baseURL+a.url,"text","fileComplete","fileError");break;case"binary":this.xhrLoad(this._fileIndex,this.baseURL+a.url,"arraybuffer","fileComplete","fileError")}},xhrLoad:function(a,b,c,d,e){this._xhr.open("GET",b,!0),this._xhr.responseType=c;var f=this;this._xhr.onload=function(){return f[d](a)},this._xhr.onerror=function(){return f[e](a)},this._xhr.send()},getAudioURL:function(a){var b;"string"==typeof a&&(a=[a]);for(var c=0;c<a.length;c++)if(b=a[c].toLowerCase(),b=b.substr((Math.max(0,b.lastIndexOf("."))||1/0)+1),this.game.device.canPlayAudio(b))return a[c];return null},fileError:function(a){this._fileList[a].loaded=!0,this._fileList[a].error=!0,this.onFileError.dispatch(this._fileList[a].key,this._fileList[a]),console.warn("Phaser.Loader error loading file: "+this._fileList[a].key+" from URL "+this._fileList[a].url),this.nextFile(a,!1)},fileComplete:function(a){if(!this._fileList[a])return void console.warn("Phaser.Loader fileComplete invalid index "+a);var c=this._fileList[a];c.loaded=!0;var d=!0;switch(c.type){case"image":this.game.cache.addImage(c.key,c.url,c.data);break;case"spritesheet":this.game.cache.addSpriteSheet(c.key,c.url,c.data,c.frameWidth,c.frameHeight,c.frameMax,c.margin,c.spacing);break;case"textureatlas":if(null==c.atlasURL)this.game.cache.addTextureAtlas(c.key,c.url,c.data,c.atlasData,c.format);else if(d=!1,c.format==b.Loader.TEXTURE_ATLAS_JSON_ARRAY||c.format==b.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(this._fileIndex,this.baseURL+c.atlasURL,"text","jsonLoadComplete","dataLoadError");else{if(c.format!=b.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+c.format);this.xhrLoad(this._fileIndex,this.baseURL+c.atlasURL,"text","xmlLoadComplete","dataLoadError")}break;case"bitmapfont":null==c.xmlURL?this.game.cache.addBitmapFont(c.key,c.url,c.data,c.xmlData,c.xSpacing,c.ySpacing):(d=!1,this.xhrLoad(this._fileIndex,this.baseURL+c.xmlURL,"text","xmlLoadComplete","dataLoadError"));break;case"audio":if(this.game.sound.usingWebAudio){if(c.data=this._xhr.response,this.game.cache.addSound(c.key,c.url,c.data,!0,!1),c.autoDecode){var e=this,f=c.key;this.game.cache.updateSound(f,"isDecoding",!0),this.game.sound.context.decodeAudioData(c.data,function(a){a&&(e.game.cache.decodedSound(f,a),e.game.sound.onSoundDecode.dispatch(f,e.game.cache.getSound(f)))})}}else c.data.removeEventListener("canplaythrough",b.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(c.key,c.url,c.data,!1,!0);break;case"text":c.data=this._xhr.responseText,this.game.cache.addText(c.key,c.url,c.data);break;case"physics":var g=JSON.parse(this._xhr.responseText);this.game.cache.addPhysicsData(c.key,c.url,g,c.format);break;case"script":c.data=document.createElement("script"),c.data.language="javascript",c.data.type="text/javascript",c.data.defer=!1,c.data.text=this._xhr.responseText,document.head.appendChild(c.data),c.callback&&(c.data=c.callback.call(c.callbackContext,c.key,this._xhr.responseText));break;case"binary":c.data=c.callback?c.callback.call(c.callbackContext,c.key,this._xhr.response):this._xhr.response,this.game.cache.addBinary(c.key,c.data)}d&&this.nextFile(a,!0)},jsonLoadComplete:function(a){if(!this._fileList[a])return void console.warn("Phaser.Loader jsonLoadComplete invalid index "+a);var b=this._fileList[a],c=JSON.parse(this._xhr.responseText);b.loaded=!0,"tilemap"===b.type?this.game.cache.addTilemap(b.key,b.url,c,b.format):"json"===b.type?this.game.cache.addJSON(b.key,b.url,c):this.game.cache.addTextureAtlas(b.key,b.url,b.data,c,b.format),this.nextFile(a,!0)},csvLoadComplete:function(a){if(!this._fileList[a])return void console.warn("Phaser.Loader csvLoadComplete invalid index "+a);var b=this._fileList[a],c=this._xhr.responseText;b.loaded=!0,this.game.cache.addTilemap(b.key,b.url,c,b.format),this.nextFile(a,!0)},dataLoadError:function(a){var b=this._fileList[a];b.loaded=!0,b.error=!0,console.warn("Phaser.Loader dataLoadError: "+b.key),this.nextFile(a,!0)},xmlLoadComplete:function(a){var b,c=this._xhr.responseText;try{if(window.DOMParser){var d=new DOMParser;b=d.parseFromString(c,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(c)}catch(e){b=void 0}if(!b||!b.documentElement||b.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");var f=this._fileList[a];f.loaded=!0,"bitmapfont"==f.type?this.game.cache.addBitmapFont(f.key,f.url,f.data,b,f.xSpacing,f.ySpacing):"textureatlas"==f.type&&this.game.cache.addTextureAtlas(f.key,f.url,f.data,b,f.format),this.nextFile(a,!0)},nextFile:function(a,b){this.progressFloat+=this._progressChunk,this.progress=Math.round(this.progressFloat),this.progress>100&&(this.progress=100),null!==this.preloadSprite&&(0===this.preloadSprite.direction?(this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress),this.preloadSprite.sprite.crop(this.preloadSprite.rect)):(this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.crop(this.preloadSprite.rect))),this.onFileComplete.dispatch(this.progress,this._fileList[a].key,b,this.totalLoadedFiles(),this._fileList.length),this.totalQueuedFiles()>0?(this._fileIndex++,this.loadFile()):(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())},totalLoadedFiles:function(){for(var a=0,b=0;b<this._fileList.length;b++)this._fileList[b].loaded&&a++;return a},totalQueuedFiles:function(){for(var a=0,b=0;b<this._fileList.length;b++)this._fileList[b].loaded===!1&&a++;return a},totalLoadedPacks:function(){for(var a=0,b=0;b<this._packList.length;b++)this._packList[b].loaded&&a++;return a},totalQueuedPacks:function(){for(var a=0,b=0;b<this._packList.length;b++)this._packList[b].loaded===!1&&a++;return a}},b.Loader.prototype.constructor=b.Loader,b.LoaderParser={bitmapFont:function(a,b,c,d,e){var f={},g=b.getElementsByTagName("info")[0],h=b.getElementsByTagName("common")[0];f.font=g.getAttribute("face"),f.size=parseInt(g.getAttribute("size"),10),f.lineHeight=parseInt(h.getAttribute("lineHeight"),10)+e,f.chars={};for(var i=b.getElementsByTagName("char"),j=0;j<i.length;j++){var k=parseInt(i[j].getAttribute("id"),10),l=new PIXI.Rectangle(parseInt(i[j].getAttribute("x"),10),parseInt(i[j].getAttribute("y"),10),parseInt(i[j].getAttribute("width"),10),parseInt(i[j].getAttribute("height"),10));f.chars[k]={xOffset:parseInt(i[j].getAttribute("xoffset"),10),yOffset:parseInt(i[j].getAttribute("yoffset"),10),xAdvance:parseInt(i[j].getAttribute("xadvance"),10)+d,kerning:{},texture:PIXI.TextureCache[c]=new PIXI.Texture(PIXI.BaseTextureCache[c],l)}}var m=b.getElementsByTagName("kerning");for(j=0;j<m.length;j++){var n=parseInt(m[j].getAttribute("first"),10),o=parseInt(m[j].getAttribute("second"),10),p=parseInt(m[j].getAttribute("amount"),10);f.chars[o].kerning[n]=p}PIXI.BitmapText.fonts[c]=f}},b.Sound=function(a,c,d,e,f){"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=!1),"undefined"==typeof f&&(f=a.sound.connectToMaster),this.game=a,this.name=c,this.key=c,this.loop=e,this.volume=d,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.pendingPlayback=!1,this.override=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=d*this.game.sound.volume,f&&this.gainNode.connect(this.masterGainNode)):this.game.cache.getSound(c)&&this.game.cache.isSoundReady(c)?(this._sound=this.game.cache.getSoundData(c),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this),this.onDecoded=new b.Signal,this.onPlay=new b.Signal,this.onPause=new b.Signal,this.onResume=new b.Signal,this.onLoop=new b.Signal,this.onStop=new b.Signal,this.onMute=new b.Signal,this.onMarkerComplete=new b.Signal,this._volume=d,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},b.Sound.prototype={soundHasUnlocked:function(a){a==this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(a,b,c,d,e){"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=!1),this.markers[a]={name:a,start:b,stop:b+c,volume:d,duration:c,durationMS:1e3*c,loop:e}},removeMarker:function(a){delete this.markers[a]},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.now-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.now):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},play:function(a,b,c,d,e){if("undefined"==typeof a&&(a=""),"undefined"==typeof e&&(e=!0),this.isPlaying===!0&&e===!1&&this.override===!1)return this;if(this.isPlaying&&this.override&&(this.usingWebAudio?"undefined"==typeof this._sound.stop?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.currentMarker=a,""!==a){if(!this.markers[a])return console.warn("Phaser.Sound.play: audio marker "+a+" doesn't exist"),this;this.position=this.markers[a].start,this.volume=this.markers[a].volume,this.loop=this.markers[a].loop,this.duration=this.markers[a].duration,this.durationMS=this.markers[a].durationMS,"undefined"!=typeof c&&(this.volume=c),"undefined"!=typeof d&&(this.loop=d),this._tempMarker=a,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else b=b||0,"undefined"==typeof c&&(c=this._volume),"undefined"==typeof d&&(d=this.loop),this.position=b,this.volume=c,this.loop=d,this.duration=0,this.durationMS=0,this._tempMarker=a,this._tempPosition=b,this._tempVolume=c,this._tempLoop=d;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null==this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this.loop&&""===a&&(this._sound.loop=!0),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(a,b,c,d){a=a||"",b=b||0,c=c||1,"undefined"==typeof d&&(d=!1),this.play(a,b,c,d,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.now,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var a=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&(this._sound.loop=!0),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,a,this.duration):this._sound.start(0,a,this.duration)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.now-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if("undefined"==typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(a){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1;var b=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",this.paused||this.onStop.dispatch(this,b)},destroy:function(a){"undefined"==typeof a&&(a=!0),this.stop(),a?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},b.Sound.prototype.constructor=b.Sound,Object.defineProperty(b.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(b.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(b.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(a){a=a||null,a?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this)}}),Object.defineProperty(b.Sound.prototype,"volume",{get:function(){return this._volume},set:function(a){this.usingWebAudio?(this._volume=a,this.gainNode.gain.value=a):this.usingAudioTag&&this._sound&&a>=0&&1>=a&&(this._volume=a,this._sound.volume=a)}}),b.SoundManager=function(a){this.game=a,this.onSoundDecode=new b.Signal,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this.context=null,this.usingWebAudio=!0,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32},b.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,void(this.noAudio=!0);if(window.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(window.AudioContext)try{this.context=new window.AudioContext}catch(a){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(a){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var a=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=a,this._unlockSource.connect(this.context.destination),this._unlockSource.noteOn(0)}},stopAll:function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].stop()},pauseAll:function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].pause()},resumeAll:function(){for(var a=0;a<this._sounds.length;a++)this._sounds[a]&&this._sounds[a].resume()},decode:function(a,b){b=b||null;var c=this.game.cache.getSoundData(a);if(c&&this.game.cache.isSoundDecoded(a)===!1){this.game.cache.updateSound(a,"isDecoding",!0);var d=this;this.context.decodeAudioData(c,function(c){d.game.cache.decodedSound(a,c),b&&d.onSoundDecode.dispatch(a,b)})}},update:function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var a=0;a<this._sounds.length;a++)this._sounds[a].update()},add:function(a,c,d,e){"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=this.connectToMaster);var f=new b.Sound(this.game,a,c,d,e);return this._sounds.push(f),f},remove:function(a){for(var b=this._sounds.length;b--;)if(this._sounds[b]===a)return this._sounds[b].destroy(!1),this._sounds.splice(b,1),!0;return!1},removeByKey:function(a){for(var b=this._sounds.length,c=0;b--;)this._sounds[b].key===a&&(this._sounds[b].destroy(!1),this._sounds.splice(b,1),c++);return c},play:function(a,b,c){var d=this.add(a,b,c);return d.play(),d},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var a=0;a<this._sounds.length;a++)this._sounds[a].usingAudioTag&&(this._sounds[a].mute=!1)}}},b.SoundManager.prototype.constructor=b.SoundManager,Object.defineProperty(b.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(a){if(a=a||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(b.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(a){if(this._volume=a,this.usingWebAudio)this.masterGain.gain.value=a;else for(var b=0;b<this._sounds.length;b++)this._sounds[b].usingAudioTag&&(this._sounds[b].volume=this._sounds[b].volume*a)}}),b.Utils.Debug=function(a){this.game=a,this.sprite=null,this.canvas=null,this.baseTexture=null,this.texture=null,this.textureFrame=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},b.Utils.Debug.prototype={boot:function(){this.game.renderType===b.CANVAS?this.context=this.game.context:(this.canvas=b.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new b.Frame(0,0,0,this.game.width,this.game.height,"debug",this.game.rnd.uuid()),this.sprite=this.game.make.image(0,0,this.texture,this.textureFrame),this.game.stage.addChild(this.sprite))},preUpdate:function(){this.dirty&&this.sprite&&(this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},start:function(a,b,c,d){"number"!=typeof a&&(a=0),"number"!=typeof b&&(b=0),c=c||"rgb(255,255,255)","undefined"==typeof d&&(d=0),this.currentX=a,this.currentY=b,this.currentColor=c,this.currentAlpha=this.context.globalAlpha,this.columnWidth=d,this.sprite&&(this.dirty=!0),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=c,this.context.fillStyle=c,this.context.font=this.font,this.context.globalAlpha=1},stop:function(){this.context.restore(),this.context.globalAlpha=this.currentAlpha,this.sprite&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)},line:function(){for(var a=this.currentX,b=0;b<arguments.length;b++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[b],a+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[b],a,this.currentY),a+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(a,b,c,d){this.start(b,c,d),this.line("Sound: "+a.key+" Locked: "+a.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(a.key)+" Pending Playback: "+a.pendingPlayback),this.line("Decoded: "+a.isDecoded+" Decoding: "+a.isDecoding),this.line("Total Duration: "+a.totalDuration+" Playing: "+a.isPlaying),this.line("Time: "+a.currentTime),this.line("Volume: "+a.volume+" Muted: "+a.mute),this.line("WebAudio: "+a.usingWebAudio+" Audio: "+a.usingAudioTag),""!==a.currentMarker&&(this.line("Marker: "+a.currentMarker+" Duration: "+a.duration+" (ms: "+a.durationMS+")"),this.line("Start: "+a.markers[a.currentMarker].start+" Stop: "+a.markers[a.currentMarker].stop),this.line("Position: "+a.position)),this.stop()},cameraInfo:function(a,b,c,d){this.start(b,c,d),this.line("Camera ("+a.width+" x "+a.height+")"),this.line("X: "+a.x+" Y: "+a.y),this.line("Bounds x: "+a.bounds.x+" Y: "+a.bounds.y+" w: "+a.bounds.width+" h: "+a.bounds.height),this.line("View x: "+a.view.x+" Y: "+a.view.y+" w: "+a.view.width+" h: "+a.view.height),this.stop()},timer:function(a,b,c,d){this.start(b,c,d),this.line("Timer (running: "+a.running+" expired: "+a.expired+")"),this.line("Next Tick: "+a.next+" Duration: "+a.duration),this.line("Paused: "+a.paused+" Length: "+a.length),this.stop()},pointer:function(a,b,c,d,e){null!=a&&("undefined"==typeof b&&(b=!1),c=c||"rgba(0,255,0,0.5)",d=d||"rgba(255,0,0,0.5)",(b!==!0||a.isUp!==!0)&&(this.start(a.x,a.y-100,e),this.context.beginPath(),this.context.arc(a.x,a.y,a.circle.radius,0,2*Math.PI),this.context.fillStyle=a.active?c:d,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(a.positionDown.x,a.positionDown.y),this.context.lineTo(a.position.x,a.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+a.id+" Active: "+a.active),this.line("World X: "+a.worldX+" World Y: "+a.worldY),this.line("Screen X: "+a.x+" Screen Y: "+a.y),this.line("Duration: "+a.duration+" ms"),this.line("is Down: "+a.isDown+" is Up: "+a.isUp),this.stop()))},spriteInputInfo:function(a,b,c,d){this.start(b,c,d),this.line("Sprite Input: ("+a.width+" x "+a.height+")"),this.line("x: "+a.input.pointerX().toFixed(1)+" y: "+a.input.pointerY().toFixed(1)),this.line("over: "+a.input.pointerOver()+" duration: "+a.input.overDuration().toFixed(0)),this.line("down: "+a.input.pointerDown()+" duration: "+a.input.downDuration().toFixed(0)),this.line("just over: "+a.input.justOver()+" just out: "+a.input.justOut()),this.stop()},key:function(a,b,c,d){this.start(b,c,d,150),this.line("Key:",a.keyCode,"isDown:",a.isDown),this.line("justPressed:",a.justPressed(),"justReleased:",a.justReleased()),this.line("Time Down:",a.timeDown.toFixed(0),"duration:",a.duration.toFixed(0)),this.stop()},inputInfo:function(a,b,c){this.start(a,b,c),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(a,b,c){var d=a.getBounds();d.x+=this.game.camera.x,d.y+=this.game.camera.y,this.rectangle(d,b,c)},spriteInfo:function(a,b,c,d){this.start(b,c,d),this.line("Sprite:  ("+a.width+" x "+a.height+") anchor: "+a.anchor.x+" x "+a.anchor.y),this.line("x: "+a.x.toFixed(1)+" y: "+a.y.toFixed(1)),this.line("angle: "+a.angle.toFixed(1)+" rotation: "+a.rotation.toFixed(1)),this.line("visible: "+a.visible+" in camera: "+a.inCamera),this.stop()},spriteCoords:function(a,b,c,d){this.start(b,c,d,100),a.name&&this.line(a.name),this.line("x:",a.x.toFixed(2),"y:",a.y.toFixed(2)),this.line("pos x:",a.position.x.toFixed(2),"pos y:",a.position.y.toFixed(2)),this.line("world x:",a.world.x.toFixed(2),"world y:",a.world.y.toFixed(2)),this.stop()},lineInfo:function(a,b,c,d){this.start(b,c,d,80),this.line("start.x:",a.start.x.toFixed(2),"start.y:",a.start.y.toFixed(2)),this.line("end.x:",a.end.x.toFixed(2),"end.y:",a.end.y.toFixed(2)),this.line("length:",a.length.toFixed(2),"angle:",a.angle),this.stop()},pixel:function(a,b,c,d){d=d||2,this.start(),this.context.fillStyle=c,this.context.fillRect(a,b,d,d),this.stop()},geom:function(a,c,d,e){"undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=0),c=c||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=c,this.context.strokeStyle=c,a instanceof b.Rectangle||1===e?d?this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height):this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height):a instanceof b.Circle||2===e?(this.context.beginPath(),this.context.arc(a.x-this.game.camera.x,a.y-this.game.camera.y,a.radius,0,2*Math.PI,!1),this.context.closePath(),d?this.context.fill():this.context.stroke()):a instanceof b.Point||3===e?this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,4,4):(a instanceof b.Line||4===e)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(a.start.x+.5-this.game.camera.x,a.start.y+.5-this.game.camera.y),this.context.lineTo(a.end.x+.5-this.game.camera.x,a.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(a,b,c){"undefined"==typeof c&&(c=!0),b=b||"rgba(0, 255, 0, 0.4)",this.start(),c?(this.context.fillStyle=b,this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)):(this.context.strokeStyle=b,this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)),this.stop()},text:function(a,b,c,d,e){d=d||"rgb(255,255,255)",e=e||"16px Courier",this.start(),this.context.font=e,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(a,b+1,c+1)),this.context.fillStyle=d,this.context.fillText(a,b,c),this.stop()},quadTree:function(a,b){b=b||"rgba(255,0,0,0.3)",this.start();var c=a.bounds;if(0===a.nodes.length){this.context.strokeStyle=b,this.context.strokeRect(c.x,c.y,c.width,c.height),this.text("size: "+a.objects.length,c.x+4,c.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var d=0;d<a.objects.length;d++)this.context.strokeRect(a.objects[d].x,a.objects[d].y,a.objects[d].width,a.objects[d].height)}else for(var d=0;d<a.nodes.length;d++)this.quadTree(a.nodes[d]);this.stop()},body:function(a,c,d){a.body&&(a.body.type===b.Physics.ARCADE?(this.start(),b.Physics.Arcade.Body.render(this.context,a.body,c,d),this.stop()):a.body.type===b.Physics.NINJA&&(this.start(),b.Physics.Ninja.Body.render(this.context,a.body,c,d),this.stop()))},bodyInfo:function(a,c,d,e){a.body&&a.body.type===b.Physics.ARCADE&&(this.start(c,d,e,210),b.Physics.Arcade.Body.renderBodyInfo(this,a.body),this.stop())}},b.Utils.Debug.prototype.constructor=b.Utils.Debug,b.Color={packPixel:function(a,c,d,e){return b.Device.LITTLE_ENDIAN?(e<<24|d<<16|c<<8|a)>>>0:(a<<24|c<<16|d<<8|e)>>>0},unpackPixel:function(a,c,d,e){return("undefined"==typeof c||null===c)&&(c=b.Color.createColor()),("undefined"==typeof d||null===d)&&(d=!1),("undefined"==typeof e||null===e)&&(e=!1),b.Device.LITTLE_ENDIAN?(c.a=(4278190080&a)>>>24,c.b=(16711680&a)>>>16,c.g=(65280&a)>>>8,c.r=255&a):(c.r=(4278190080&a)>>>24,c.g=(16711680&a)>>>16,c.b=(65280&a)>>>8,c.a=255&a),c.color=a,c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a/255+")",d&&b.Color.RGBtoHSL(c.r,c.g,c.b,c),e&&b.Color.RGBtoHSV(c.r,c.g,c.b,c),c},fromRGBA:function(a,c){return c||(c=b.Color.createColor()),c.r=(4278190080&a)>>>24,c.g=(16711680&a)>>>16,c.b=(65280&a)>>>8,c.a=255&a,c.rgba="rgba("+c.r+","+c.g+","+c.b+","+c.a+")",c},toRGBA:function(a,b,c,d){return a<<24|b<<16|c<<8|d},RGBtoHSL:function(a,c,d,e){e||(e=b.Color.createColor(a,c,d,1)),a/=255,c/=255,d/=255;var f=Math.min(a,c,d),g=Math.max(a,c,d);if(e.h=0,e.s=0,e.l=(g+f)/2,g!==f){var h=g-f;e.s=e.l>.5?h/(2-g-f):h/(g+f),g===a?e.h=(c-d)/h+(d>c?6:0):g===c?e.h=(d-a)/h+2:g===d&&(e.h=(a-c)/h+4),e.h/=6}return e},HSLtoRGB:function(a,c,d,e){if(e?(e.r=d,e.g=d,e.b=d):e=b.Color.createColor(d,d,d),0!==c){var f=.5>d?d*(1+c):d+c-d*c,g=2*d-f;e.r=b.Color.hueToColor(g,f,a+1/3),e.g=b.Color.hueToColor(g,f,a),e.b=b.Color.hueToColor(g,f,a-1/3)}return e.r=Math.floor(255*e.r|0),e.g=Math.floor(255*e.g|0),e.b=Math.floor(255*e.b|0),b.Color.updateColor(e),e},RGBtoHSV:function(a,c,d,e){e||(e=b.Color.createColor(a,c,d,255)),a/=255,c/=255,d/=255;var f=Math.min(a,c,d),g=Math.max(a,c,d),h=g-f;return e.h=0,e.s=0===g?0:h/g,e.v=g,g!==f&&(g===a?e.h=(c-d)/h+(d>c?6:0):g===c?e.h=(d-a)/h+2:g===d&&(e.h=(a-c)/h+4),e.h/=6),e},HSVtoRGB:function(a,c,d,e){"undefined"==typeof e&&(e=b.Color.createColor(0,0,0,1,a,c,0,d));var f,g,h,i=Math.floor(6*a),j=6*a-i,k=d*(1-c),l=d*(1-j*c),m=d*(1-(1-j)*c);switch(i%6){case 0:f=d,g=m,h=k;break;case 1:f=l,g=d,h=k;break;case 2:f=k,g=d,h=m;break;case 3:f=k,g=l,h=d;break;case 4:f=m,g=k,h=d;break;case 5:f=d,g=k,h=l}return e.r=Math.floor(255*f),e.g=Math.floor(255*g),e.b=Math.floor(255*h),b.Color.updateColor(e),e},hueToColor:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},createColor:function(a,b,c,d,e,f,g,h){var i={r:a||0,g:b||0,b:c||0,a:d||1,h:e||0,s:f||0,l:g||0,v:h||0,color:0};return i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",i},updateColor:function(a){return a.rgba="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",a},getColor32:function(a,b,c,d){return a<<24|b<<16|c<<8|d},getColor:function(a,b,c){return a<<16|b<<8|c},RGBtoString:function(a,c,d,e,f){return"undefined"==typeof e&&(e=255),"undefined"==typeof f&&(f="#"),"#"===f?"#"+((1<<24)+(a<<16)+(c<<8)+d).toString(16).slice(1):"0x"+b.Color.componentToHex(e)+b.Color.componentToHex(a)+b.Color.componentToHex(c)+b.Color.componentToHex(d)},hexToRGB:function(a){var c=b.Color.hexToColor(a);return c?b.Color.getColor32(c.a,c.r,c.g,c.b):void 0},hexToColor:function(a,c){c||(c=b.Color.createColor());var d=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(d,function(a,b,c,d){return b+b+c+c+d+d});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return e&&(c.r=parseInt(e[1],16),c.g=parseInt(e[2],16),c.b=parseInt(e[3],16)),c },componentToHex:function(a){var b=a.toString(16);return 1==b.length?"0"+b:b},HSVColorWheel:function(a,c){"undefined"==typeof a&&(a=1),"undefined"==typeof c&&(c=1);for(var d=[],e=0;359>=e;e++)d.push(b.Color.HSVtoRGB(e/359,a,c));return d},HSLColorWheel:function(a,c){"undefined"==typeof a&&(a=.5),"undefined"==typeof c&&(c=.5);for(var d=[],e=0;359>=e;e++)d.push(b.Color.HSLtoRGB(e/359,a,c));return d},interpolateColor:function(a,c,d,e,f){"undefined"==typeof f&&(f=255);var g=b.Color.getRGB(a),h=b.Color.getRGB(c),i=(h.red-g.red)*e/d+g.red,j=(h.green-g.green)*e/d+g.green,k=(h.blue-g.blue)*e/d+g.blue;return b.Color.getColor32(f,i,j,k)},interpolateColorWithRGB:function(a,c,d,e,f,g){var h=b.Color.getRGB(a),i=(c-h.red)*g/f+h.red,j=(d-h.green)*g/f+h.green,k=(e-h.blue)*g/f+h.blue;return b.Color.getColor(i,j,k)},interpolateRGB:function(a,c,d,e,f,g,h,i){var j=(e-a)*i/h+a,k=(f-c)*i/h+c,l=(g-d)*i/h+d;return b.Color.getColor(j,k,l)},getRandomColor:function(a,c,d){if("undefined"==typeof a&&(a=0),"undefined"==typeof c&&(c=255),"undefined"==typeof d&&(d=255),c>255||a>c)return b.Color.getColor(255,255,255);var e=a+Math.round(Math.random()*(c-a)),f=a+Math.round(Math.random()*(c-a)),g=a+Math.round(Math.random()*(c-a));return b.Color.getColor32(d,e,f,g)},getRGB:function(a){return a>16777215?{alpha:a>>>24,red:a>>16&255,green:a>>8&255,blue:255&a,a:a>>>24,r:a>>16&255,g:a>>8&255,b:255&a}:{alpha:255,red:a>>16&255,green:a>>8&255,blue:255&a,a:255,r:a>>16&255,g:a>>8&255,b:255&a}},getWebRGB:function(a){if("object"==typeof a)return"rgba("+a.r.toString()+","+a.g.toString()+","+a.b.toString()+","+(a.a/255).toString()+")";var c=b.Color.getRGB(a);return"rgba("+c.r.toString()+","+c.g.toString()+","+c.b.toString()+","+(c.a/255).toString()+")"},getAlpha:function(a){return a>>>24},getAlphaFloat:function(a){return(a>>>24)/255},getRed:function(a){return a>>16&255},getGreen:function(a){return a>>8&255},getBlue:function(a){return 255&a},getColorInfo:function(a){var c=b.Color.getRGB(a),d=b.Color.RGBtoHexstring(a)+"\n";return d=d.concat("Alpha: "+c.alpha+" Red: "+c.red+" Green: "+c.green+" Blue: "+c.blue)+"\n"},RGBtoHexstring:function(a){var c=b.Color.getRGB(a);return"0x"+b.Color.colorToHexstring(c.alpha)+b.Color.colorToHexstring(c.red)+b.Color.colorToHexstring(c.green)+b.Color.colorToHexstring(c.blue)},RGBtoWebstring:function(a){var c=b.Color.getRGB(a);return"#"+b.Color.colorToHexstring(c.red)+b.Color.colorToHexstring(c.green)+b.Color.colorToHexstring(c.blue)},colorToHexstring:function(a){var b="0123456789ABCDEF",c=a%16,d=(a-c)/16,e=b.charAt(d)+b.charAt(c);return e}},b.Physics=function(a,b){b=b||{},this.game=a,this.config=b,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.parseConfig()},b.Physics.ARCADE=0,b.Physics.P2JS=1,b.Physics.NINJA=2,b.Physics.BOX2D=3,b.Physics.CHIPMUNK=5,b.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&this.config.arcade!==!0||!b.Physics.hasOwnProperty("Arcade")||(this.arcade=new b.Physics.Arcade(this.game),this.game.time.deltaCap=.2),this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&b.Physics.hasOwnProperty("Ninja")&&(this.ninja=new b.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&this.config.p2===!0&&b.Physics.hasOwnProperty("P2")&&(this.p2=new b.Physics.P2(this.game,this.config))},startSystem:function(a){if(a===b.Physics.ARCADE?this.arcade=new b.Physics.Arcade(this.game):a===b.Physics.P2JS&&(this.p2=new b.Physics.P2(this.game,this.config)),a===b.Physics.NINJA)this.ninja=new b.Physics.Ninja(this.game);else{if(a===b.Physics.BOX2D&&null===this.box2d)throw new Error("The Box2D physics system has not been implemented yet.");if(a===b.Physics.CHIPMUNK&&null===this.chipmunk)throw new Error("The Chipmunk physics system has not been implemented yet.")}},enable:function(a,c,d){"undefined"==typeof c&&(c=b.Physics.ARCADE),"undefined"==typeof d&&(d=!1),c===b.Physics.ARCADE?this.arcade.enable(a):c===b.Physics.P2JS&&this.p2?this.p2.enable(a,d):c===b.Physics.NINJA&&this.ninja&&this.ninja.enableAABB(a)},preUpdate:function(){this.p2&&this.p2.preUpdate()},update:function(){this.p2&&this.p2.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear()},destroy:function(){this.p2&&this.p2.destroy(),this.arcade=null,this.ninja=null,this.p2=null}},b.Physics.prototype.constructor=b.Physics,b.Physics.Arcade=function(a){this.game=a,this.gravity=new b.Point,this.bounds=new b.Rectangle(0,0,a.world.width,a.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.TILE_BIAS=16,this.forceX=!1,this.quadTree=new b.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0,this._angle=0,this._dx=0,this._dy=0},b.Physics.Arcade.prototype.constructor=b.Physics.Arcade,b.Physics.Arcade.prototype={setBounds:function(a,b,c,d){this.bounds.setTo(a,b,c,d)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(a,c){"undefined"==typeof c&&(c=!0);var d=1;if(Array.isArray(a))for(d=a.length;d--;)a[d]instanceof b.Group?this.enable(a[d].children,c):(this.enableBody(a[d]),c&&a[d].hasOwnProperty("children")&&a[d].children.length>0&&this.enable(a[d],!0));else a instanceof b.Group?this.enable(a.children,c):(this.enableBody(a),c&&a.hasOwnProperty("children")&&a.children.length>0&&this.enable(a.children,!0))},enableBody:function(a){a.hasOwnProperty("body")&&null===a.body&&(a.body=new b.Physics.Arcade.Body(a))},updateMotion:function(a){this._velocityDelta=this.computeVelocity(0,a,a.angularVelocity,a.angularAcceleration,a.angularDrag,a.maxAngular)-a.angularVelocity,a.angularVelocity+=this._velocityDelta,a.rotation+=a.angularVelocity*this.game.time.physicsElapsed,a.velocity.x=this.computeVelocity(1,a,a.velocity.x,a.acceleration.x,a.drag.x,a.maxVelocity.x),a.velocity.y=this.computeVelocity(2,a,a.velocity.y,a.acceleration.y,a.drag.y,a.maxVelocity.y)},computeVelocity:function(a,b,c,d,e,f){return f=f||1e4,1==a&&b.allowGravity?c+=(this.gravity.x+b.gravity.x)*this.game.time.physicsElapsed:2==a&&b.allowGravity&&(c+=(this.gravity.y+b.gravity.y)*this.game.time.physicsElapsed),d?c+=d*this.game.time.physicsElapsed:e&&(this._drag=e*this.game.time.physicsElapsed,c-this._drag>0?c-=this._drag:c+this._drag<0?c+=this._drag:c=0),c>f?c=f:-f>c&&(c=-f),c},overlap:function(a,b,c,d,e){if(c=c||null,d=d||null,e=e||c,this._result=!1,this._total=0,Array.isArray(b))for(var f=0,g=b.length;g>f;f++)this.collideHandler(a,b[f],c,d,e,!0);else this.collideHandler(a,b,c,d,e,!0);return this._total>0},collide:function(a,b,c,d,e){if(c=c||null,d=d||null,e=e||c,this._result=!1,this._total=0,Array.isArray(b))for(var f=0,g=b.length;g>f;f++)this.collideHandler(a,b[f],c,d,e,!1);else this.collideHandler(a,b,c,d,e,!1);return this._total>0},collideHandler:function(a,c,d,e,f,g){return"undefined"!=typeof c||a.type!==b.GROUP&&a.type!==b.EMITTER?void(a&&c&&a.exists&&c.exists&&(a.type==b.SPRITE||a.type==b.TILESPRITE?c.type==b.SPRITE||c.type==b.TILESPRITE?this.collideSpriteVsSprite(a,c,d,e,f,g):c.type==b.GROUP||c.type==b.EMITTER?this.collideSpriteVsGroup(a,c,d,e,f,g):c.type==b.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(a,c,d,e,f):a.type==b.GROUP?c.type==b.SPRITE||c.type==b.TILESPRITE?this.collideSpriteVsGroup(c,a,d,e,f,g):c.type==b.GROUP||c.type==b.EMITTER?this.collideGroupVsGroup(a,c,d,e,f,g):c.type==b.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,c,d,e,f):a.type==b.TILEMAPLAYER?c.type==b.SPRITE||c.type==b.TILESPRITE?this.collideSpriteVsTilemapLayer(c,a,d,e,f):(c.type==b.GROUP||c.type==b.EMITTER)&&this.collideGroupVsTilemapLayer(c,a,d,e,f):a.type==b.EMITTER&&(c.type==b.SPRITE||c.type==b.TILESPRITE?this.collideSpriteVsGroup(c,a,d,e,f,g):c.type==b.GROUP||c.type==b.EMITTER?this.collideGroupVsGroup(a,c,d,e,f,g):c.type==b.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,c,d,e,f)))):void this.collideGroupVsSelf(a,d,e,f,g)},collideSpriteVsSprite:function(a,b,c,d,e,f){return a.body&&b.body?(this.separate(a.body,b.body,d,e,f)&&(c&&c.call(e,a,b),this._total++),!0):!1},collideSpriteVsGroup:function(a,b,c,d,e,f){if(0!==b.length&&a.body){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(b),this._potentials=this.quadTree.retrieve(a);for(var g=0,h=this._potentials.length;h>g;g++)this.separate(a.body,this._potentials[g],d,e,f)&&(c&&c.call(e,a,this._potentials[g].sprite),this._total++)}},collideGroupVsSelf:function(a,b,c,d,e){if(0!==a.length)for(var f=a.children.length,g=0;f>g;g++)for(var h=g+1;f>=h;h++)a.children[g]&&a.children[h]&&a.children[g].exists&&a.children[h].exists&&this.collideSpriteVsSprite(a.children[g],a.children[h],b,c,d,e)},collideGroupVsGroup:function(a,b,c,d,e,f){if(0!==a.length&&0!==b.length)for(var g=0,h=a.children.length;h>g;g++)a.children[g].exists&&this.collideSpriteVsGroup(a.children[g],b,c,d,e,f)},collideSpriteVsTilemapLayer:function(a,b,c,d,e){if(a.body&&(this._mapData=b.getTiles(a.body.position.x-a.body.tilePadding.x,a.body.position.y-a.body.tilePadding.y,a.body.width+a.body.tilePadding.x,a.body.height+a.body.tilePadding.y,!1,!1),0!==this._mapData.length))for(var f=0;f<this._mapData.length;f++)d?d.call(e,a,this._mapData[f])&&this.separateTile(f,a.body,this._mapData[f])&&(this._total++,c&&c.call(e,a,this._mapData[f])):this.separateTile(f,a.body,this._mapData[f])&&(this._total++,c&&c.call(e,a,this._mapData[f]))},collideGroupVsTilemapLayer:function(a,b,c,d,e){if(0!==a.length)for(var f=0,g=a.children.length;g>f;f++)a.children[f].exists&&this.collideSpriteVsTilemapLayer(a.children[f],b,c,d,e)},separate:function(a,b,c,d,e){return a.enable&&b.enable&&this.intersects(a,b)?c&&c.call(d,a.sprite,b.sprite)===!1?!1:e?!0:(this._result=this.forceX||Math.abs(this.gravity.y+a.gravity.y)<Math.abs(this.gravity.x+a.gravity.x)?this.separateX(a,b,e)||this.separateY(a,b,e):this.separateY(a,b,e)||this.separateX(a,b,e),this._result):!1},intersects:function(a,b){return a.right<=b.position.x?!1:a.bottom<=b.position.y?!1:a.position.x>=b.right?!1:a.position.y>=b.bottom?!1:!0},separateX:function(a,b,c){return a.immovable&&b.immovable?!1:(this._overlap=0,this.intersects(a,b)&&(this._maxOverlap=a.deltaAbsX()+b.deltaAbsX()+this.OVERLAP_BIAS,0===a.deltaX()&&0===b.deltaX()?(a.embedded=!0,b.embedded=!0):a.deltaX()>b.deltaX()?(this._overlap=a.right-b.x,this._overlap>this._maxOverlap||a.checkCollision.right===!1||b.checkCollision.left===!1?this._overlap=0:(a.touching.none=!1,a.touching.right=!0,b.touching.none=!1,b.touching.left=!0)):a.deltaX()<b.deltaX()&&(this._overlap=a.x-b.width-b.x,-this._overlap>this._maxOverlap||a.checkCollision.left===!1||b.checkCollision.right===!1?this._overlap=0:(a.touching.none=!1,a.touching.left=!0,b.touching.none=!1,b.touching.right=!0)),0!==this._overlap)?(a.overlapX=this._overlap,b.overlapX=this._overlap,c||a.customSeparateX||b.customSeparateX?!0:(this._velocity1=a.velocity.x,this._velocity2=b.velocity.x,a.immovable||b.immovable?a.immovable?b.immovable||(b.x+=this._overlap,b.velocity.x=this._velocity1-this._velocity2*b.bounce.x):(a.x=a.x-this._overlap,a.velocity.x=this._velocity2-this._velocity1*a.bounce.x):(this._overlap*=.5,a.x=a.x-this._overlap,b.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*b.mass/a.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*a.mass/b.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,a.velocity.x=this._average+this._newVelocity1*a.bounce.x,b.velocity.x=this._average+this._newVelocity2*b.bounce.x),!0)):!1)},separateY:function(a,b,c){return a.immovable&&b.immovable?!1:(this._overlap=0,this.intersects(a,b)&&(this._maxOverlap=a.deltaAbsY()+b.deltaAbsY()+this.OVERLAP_BIAS,0===a.deltaY()&&0===b.deltaY()?(a.embedded=!0,b.embedded=!0):a.deltaY()>b.deltaY()?(this._overlap=a.bottom-b.y,this._overlap>this._maxOverlap||a.checkCollision.down===!1||b.checkCollision.up===!1?this._overlap=0:(a.touching.none=!1,a.touching.down=!0,b.touching.none=!1,b.touching.up=!0)):a.deltaY()<b.deltaY()&&(this._overlap=a.y-b.bottom,-this._overlap>this._maxOverlap||a.checkCollision.up===!1||b.checkCollision.down===!1?this._overlap=0:(a.touching.none=!1,a.touching.up=!0,b.touching.none=!1,b.touching.down=!0)),0!==this._overlap)?(a.overlapY=this._overlap,b.overlapY=this._overlap,c||a.customSeparateY||b.customSeparateY?!0:(this._velocity1=a.velocity.y,this._velocity2=b.velocity.y,a.immovable||b.immovable?a.immovable?b.immovable||(b.y+=this._overlap,b.velocity.y=this._velocity1-this._velocity2*b.bounce.y,a.moves&&(b.x+=a.x-a.prev.x)):(a.y=a.y-this._overlap,a.velocity.y=this._velocity2-this._velocity1*a.bounce.y,b.moves&&(a.x+=b.x-b.prev.x)):(this._overlap*=.5,a.y=a.y-this._overlap,b.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*b.mass/a.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*a.mass/b.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,a.velocity.y=this._average+this._newVelocity1*a.bounce.y,b.velocity.y=this._average+this._newVelocity2*b.bounce.y),!0)):!1)},separateTile:function(a,b,c){if(!b.enable||!c.intersects(b.position.x,b.position.y,b.right,b.bottom))return!1;if(c.collisionCallback&&!c.collisionCallback.call(c.collisionCallbackContext,b.sprite,c))return!1;if(c.layer.callbacks[c.index]&&!c.layer.callbacks[c.index].callback.call(c.layer.callbacks[c.index].callbackContext,b.sprite,c))return!1;if(!(c.faceLeft||c.faceRight||c.faceTop||c.faceBottom))return!1;var d=0,e=0,f=0,g=1;if(b.deltaAbsX()>b.deltaAbsY()?f=-1:b.deltaAbsX()<b.deltaAbsY()&&(g=-1),0!==b.deltaX()&&0!==b.deltaY()&&(c.faceLeft||c.faceRight)&&(c.faceTop||c.faceBottom)&&(f=Math.min(Math.abs(b.position.x-c.right),Math.abs(b.right-c.left)),g=Math.min(Math.abs(b.position.y-c.bottom),Math.abs(b.bottom-c.top))),g>f){if((c.faceLeft||c.faceRight)&&(d=this.tileCheckX(b,c),0!==d&&!c.intersects(b.position.x,b.position.y,b.right,b.bottom)))return!0;(c.faceTop||c.faceBottom)&&(e=this.tileCheckY(b,c))}else{if((c.faceTop||c.faceBottom)&&(e=this.tileCheckY(b,c),0!==e&&!c.intersects(b.position.x,b.position.y,b.right,b.bottom)))return!0;(c.faceLeft||c.faceRight)&&(d=this.tileCheckX(b,c))}return 0!==d||0!==e},tileCheckX:function(a,b){var c=0;return a.deltaX()<0&&!a.blocked.left&&b.collideRight&&a.checkCollision.left?b.faceRight&&a.x<b.right&&(c=a.x-b.right,c<-this.TILE_BIAS&&(c=0)):a.deltaX()>0&&!a.blocked.right&&b.collideLeft&&a.checkCollision.right&&b.faceLeft&&a.right>b.left&&(c=a.right-b.left,c>this.TILE_BIAS&&(c=0)),0!==c&&this.processTileSeparationX(a,c),c},tileCheckY:function(a,b){var c=0;return a.deltaY()<0&&!a.blocked.up&&b.collideDown&&a.checkCollision.up?b.faceBottom&&a.y<b.bottom&&(c=a.y-b.bottom,c<-this.TILE_BIAS&&(c=0)):a.deltaY()>0&&!a.blocked.down&&b.collideUp&&a.checkCollision.down&&b.faceTop&&a.bottom>b.top&&(c=a.bottom-b.top,c>this.TILE_BIAS&&(c=0)),0!==c&&this.processTileSeparationY(a,c),c},processTileSeparationX:function(a,b){0>b?a.blocked.left=!0:b>0&&(a.blocked.right=!0),a.position.x-=b,a.velocity.x=0===a.bounce.x?0:-a.velocity.x*a.bounce.x},processTileSeparationY:function(a,b){0>b?a.blocked.up=!0:b>0&&(a.blocked.down=!0),a.position.y-=b,a.velocity.y=0===a.bounce.y?0:-a.velocity.y*a.bounce.y},getObjectsUnderPointer:function(a,c,d,e){if(0!==c.length&&a.exists){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(c);var f=new b.Rectangle(a.x,a.y,1,1),g=[];this._potentials=this.quadTree.retrieve(f);for(var h=0,i=this._potentials.length;i>h;h++)this._potentials[h].hitTest(a.x,a.y)&&(d&&d.call(e,a,this._potentials[h].sprite),g.push(this._potentials[h].sprite));return g}},moveToObject:function(a,b,c,d){return"undefined"==typeof c&&(c=60),"undefined"==typeof d&&(d=0),this._angle=Math.atan2(b.y-a.y,b.x-a.x),d>0&&(c=this.distanceBetween(a,b)/(d/1e3)),a.body.velocity.x=Math.cos(this._angle)*c,a.body.velocity.y=Math.sin(this._angle)*c,this._angle},moveToPointer:function(a,b,c,d){return"undefined"==typeof b&&(b=60),c=c||this.game.input.activePointer,"undefined"==typeof d&&(d=0),this._angle=this.angleToPointer(a,c),d>0&&(b=this.distanceToPointer(a,c)/(d/1e3)),a.body.velocity.x=Math.cos(this._angle)*b,a.body.velocity.y=Math.sin(this._angle)*b,this._angle},moveToXY:function(a,b,c,d,e){return"undefined"==typeof d&&(d=60),"undefined"==typeof e&&(e=0),this._angle=Math.atan2(c-a.y,b-a.x),e>0&&(d=this.distanceToXY(a,b,c)/(e/1e3)),a.body.velocity.x=Math.cos(this._angle)*d,a.body.velocity.y=Math.sin(this._angle)*d,this._angle},velocityFromAngle:function(a,c,d){return"undefined"==typeof c&&(c=60),d=d||new b.Point,d.setTo(Math.cos(this.game.math.degToRad(a))*c,Math.sin(this.game.math.degToRad(a))*c)},velocityFromRotation:function(a,c,d){return"undefined"==typeof c&&(c=60),d=d||new b.Point,d.setTo(Math.cos(a)*c,Math.sin(a)*c)},accelerationFromRotation:function(a,c,d){return"undefined"==typeof c&&(c=60),d=d||new b.Point,d.setTo(Math.cos(a)*c,Math.sin(a)*c)},accelerateToObject:function(a,b,c,d,e){return"undefined"==typeof c&&(c=60),"undefined"==typeof d&&(d=1e3),"undefined"==typeof e&&(e=1e3),this._angle=this.angleBetween(a,b),a.body.acceleration.setTo(Math.cos(this._angle)*c,Math.sin(this._angle)*c),a.body.maxVelocity.setTo(d,e),this._angle},accelerateToPointer:function(a,b,c,d,e){return"undefined"==typeof c&&(c=60),"undefined"==typeof b&&(b=this.game.input.activePointer),"undefined"==typeof d&&(d=1e3),"undefined"==typeof e&&(e=1e3),this._angle=this.angleToPointer(a,b),a.body.acceleration.setTo(Math.cos(this._angle)*c,Math.sin(this._angle)*c),a.body.maxVelocity.setTo(d,e),this._angle},accelerateToXY:function(a,b,c,d,e,f){return"undefined"==typeof d&&(d=60),"undefined"==typeof e&&(e=1e3),"undefined"==typeof f&&(f=1e3),this._angle=this.angleToXY(a,b,c),a.body.acceleration.setTo(Math.cos(this._angle)*d,Math.sin(this._angle)*d),a.body.maxVelocity.setTo(e,f),this._angle},distanceBetween:function(a,b){return this._dx=a.x-b.x,this._dy=a.y-b.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(a,b,c){return this._dx=a.x-b,this._dy=a.y-c,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(a,b){return b=b||this.game.input.activePointer,this._dx=a.x-b.x,this._dy=a.y-b.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(a,b){return this._dx=b.x-a.x,this._dy=b.y-a.y,Math.atan2(this._dy,this._dx)},angleToXY:function(a,b,c){return this._dx=b-a.x,this._dy=c-a.y,Math.atan2(this._dy,this._dx)},angleToPointer:function(a,b){return b=b||this.game.input.activePointer,this._dx=b.worldX-a.x,this._dy=b.worldY-a.y,Math.atan2(this._dy,this._dx)}},b.Physics.Arcade.Body=function(a){this.sprite=a,this.game=a.game,this.type=b.Physics.ARCADE,this.enable=!0,this.offset=new b.Point,this.position=new b.Point(a.x,a.y),this.prev=new b.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=a.rotation,this.preRotation=a.rotation,this.sourceWidth=a.texture.frame.width,this.sourceHeight=a.texture.frame.height,this.width=a.width,this.height=a.height,this.halfWidth=Math.abs(a.width/2),this.halfHeight=Math.abs(a.height/2),this.center=new b.Point(a.x+this.halfWidth,a.y+this.halfHeight),this.velocity=new b.Point,this.newVelocity=new b.Point(0,0),this.deltaMax=new b.Point(0,0),this.acceleration=new b.Point,this.drag=new b.Point,this.allowGravity=!0,this.gravity=new b.Point(0,0),this.bounce=new b.Point,this.maxVelocity=new b.Point(1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=b.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new b.Point,this.phase=0,this._reset=!0,this._sx=a.scale.x,this._sy=a.scale.y,this._dx=0,this._dy=0},b.Physics.Arcade.Body.prototype={updateBounds:function(){var a=Math.abs(this.sprite.scale.x),b=Math.abs(this.sprite.scale.y);(a!==this._sx||b!==this._sy)&&(this.width=this.sourceWidth*a,this.height=this.sourceHeight*b,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=a,this._sy=b,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||1===this.sprite._cache[4])&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&2!==this.phase&&(this.phase=2,this.deltaX()<0?this.facing=b.LEFT:this.deltaX()>0&&(this.facing=b.RIGHT),this.deltaY()<0?this.facing=b.UP:this.deltaY()>0&&(this.facing=b.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.x+=this._dx,this.sprite.y+=this._dy),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0),this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(a,b,c,d){"undefined"==typeof c&&(c=this.offset.x),"undefined"==typeof d&&(d=this.offset.y),this.sourceWidth=a,this.sourceHeight=b,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(c,d),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(a,b){this.velocity.set(0),this.acceleration.set(0),this.angularVelocity=0,this.angularAcceleration=0,this.position.x=a-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=b-this.sprite.anchor.y*this.height+this.offset.y,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(a,c){return b.Rectangle.contains(this,a,c)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}},Object.defineProperty(b.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(b.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(b.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(b.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),b.Physics.Arcade.Body.render=function(a,b,c,d){"undefined"==typeof d&&(d=!0),c=c||"rgba(0,255,0,0.4)",d?(a.fillStyle=c,a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)):(a.strokeStyle=c,a.strokeRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height))},b.Physics.Arcade.Body.renderBodyInfo=function(a,b){a.line("x: "+b.x.toFixed(2),"y: "+b.y.toFixed(2),"width: "+b.width,"height: "+b.height),a.line("velocity x: "+b.velocity.x.toFixed(2),"y: "+b.velocity.y.toFixed(2),"deltaX: "+b._dx.toFixed(2),"deltaY: "+b._dy.toFixed(2)),a.line("acceleration x: "+b.acceleration.x.toFixed(2),"y: "+b.acceleration.y.toFixed(2),"speed: "+b.speed.toFixed(2),"angle: "+b.angle.toFixed(2)),a.line("gravity x: "+b.gravity.x,"y: "+b.gravity.y,"bounce x: "+b.bounce.x.toFixed(2),"y: "+b.bounce.y.toFixed(2)),a.line("touching left: "+b.touching.left,"right: "+b.touching.right,"up: "+b.touching.up,"down: "+b.touching.down),a.line("blocked left: "+b.blocked.left,"right: "+b.blocked.right,"up: "+b.blocked.up,"down: "+b.blocked.down)},b.Physics.Arcade.Body.prototype.constructor=b.Physics.Arcade.Body,b.Particles=function(a){this.game=a,this.emitters={},this.ID=0},b.Particles.prototype={add:function(a){return this.emitters[a.name]=a,a},remove:function(a){delete this.emitters[a.name]},update:function(){for(var a in this.emitters)this.emitters[a].exists&&this.emitters[a].update()}},b.Particles.prototype.constructor=b.Particles,b.Particles.Arcade={},b.Particles.Arcade.Emitter=function(a,c,d,e){this.maxParticles=e||50,b.Group.call(this,a),this.name="emitter"+this.game.particles.ID++,this.type=b.EMITTER,this.area=new b.Rectangle(c,d,1,1),this.minParticleSpeed=new b.Point(-100,-100),this.maxParticleSpeed=new b.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=b.Particle,this.particleDrag=new b.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new b.Point,this.on=!1,this.particleAnchor=new b.Point(.5,.5),this.blendMode=b.blendModes.NORMAL,this.emitX=c,this.emitY=d,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new b.Point(1,1),this._maxParticleScale=new b.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._explode=!0,this._frames=null},b.Particles.Arcade.Emitter.prototype=Object.create(b.Group.prototype),b.Particles.Arcade.Emitter.prototype.constructor=b.Particles.Arcade.Emitter,b.Particles.Arcade.Emitter.prototype.update=function(){if(this.on)if(this._explode){this._counter=0;do this.emitParticle(),this._counter++;while(this._counter<this._quantity);this.on=!1}else this.game.time.now>=this._timer&&(this.emitParticle(),this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1),this._timer=this.game.time.now+this.frequency);for(var a=this.children.length;a--;)this.children[a].exists&&this.children[a].update()},b.Particles.Arcade.Emitter.prototype.makeParticles=function(a,b,c,d,e){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=this.maxParticles),"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1);var f,g=0,h=a,i=b;for(this._frames=b;c>g;)Array.isArray(a)&&(h=this.game.rnd.pick(a)),Array.isArray(b)&&(i=this.game.rnd.pick(b)),f=new this.particleClass(this.game,0,0,h,i),this.game.physics.arcade.enable(f,!1),d?(f.body.checkCollision.any=!0,f.body.checkCollision.none=!1):f.body.checkCollision.none=!0,f.body.collideWorldBounds=e,f.exists=!1,f.visible=!1,f.anchor.copyFrom(this.particleAnchor),this.add(f),g++;return this},b.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1,this.alive=!1,this.exists=!1},b.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0,this.exists=!0},b.Particles.Arcade.Emitter.prototype.explode=function(a,b){this.start(!0,a,0,b,!1)},b.Particles.Arcade.Emitter.prototype.flow=function(a,b,c){this.start(!1,a,b,c,!0)},b.Particles.Arcade.Emitter.prototype.start=function(a,b,c,d,e){"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=0),("undefined"==typeof c||null===c)&&(c=250),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=!1),this.revive(),this.visible=!0,this.on=!0,this._explode=a,this.lifespan=b,this.frequency=c,a||e?this._quantity=d:this._quantity+=d,this._counter=0,this._timer=this.game.time.now+c},b.Particles.Arcade.Emitter.prototype.emitParticle=function(){var a=this.getFirstExists(!1);null!==a&&(this.width>1||this.height>1?a.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):a.reset(this.emitX,this.emitY),a.angle=0,a.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(a):this.particleSendToBack&&this.sendToBack(a),this.autoScale?a.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?a.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&a.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),a.frame=Array.isArray("object"===this._frames)?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?a.setAlphaData(this.alphaData):a.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),a.blendMode=this.blendMode,a.body.updateBounds(),a.body.bounce.setTo(this.bounce.x,this.bounce.y),a.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x),a.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y),a.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation),a.body.gravity.y=this.gravity,a.body.drag.x=this.particleDrag.x,a.body.drag.y=this.particleDrag.y,a.body.angularDrag=this.angularDrag,a.onEmit()) },b.Particles.Arcade.Emitter.prototype.setSize=function(a,b){this.area.width=a,this.area.height=b},b.Particles.Arcade.Emitter.prototype.setXSpeed=function(a,b){a=a||0,b=b||0,this.minParticleSpeed.x=a,this.maxParticleSpeed.x=b},b.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,b){a=a||0,b=b||0,this.minParticleSpeed.y=a,this.maxParticleSpeed.y=b},b.Particles.Arcade.Emitter.prototype.setRotation=function(a,b){a=a||0,b=b||0,this.minRotation=a,this.maxRotation=b},b.Particles.Arcade.Emitter.prototype.setAlpha=function(a,c,d,e,f){if("undefined"==typeof a&&(a=1),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=b.Easing.Linear.None),"undefined"==typeof f&&(f=!1),this.minParticleAlpha=a,this.maxParticleAlpha=c,this.autoAlpha=!1,d>0&&a!==c){var g={v:a},h=this.game.make.tween(g).to({v:c},d,e);h.yoyo(f),this.alphaData=h.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}},b.Particles.Arcade.Emitter.prototype.setScale=function(a,c,d,e,f,g,h){if("undefined"==typeof a&&(a=1),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=1),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=b.Easing.Linear.None),"undefined"==typeof h&&(h=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(a,d),this._maxParticleScale.set(c,e),this.autoScale=!1,f>0&&a!==c||d!==e){var i={x:a,y:d},j=this.game.make.tween(i).to({x:c,y:e},f,g);j.yoyo(h),this.scaleData=j.generateData(60),this.scaleData.reverse(),this.autoScale=!0}},b.Particles.Arcade.Emitter.prototype.at=function(a){a.center?(this.emitX=a.center.x,this.emitY=a.center.y):(this.emitX=a.world.x+a.anchor.x*a.width,this.emitY=a.world.y+a.anchor.y*a.height)},Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(a){this.area.width=a}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(a){this.area.height=a}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(a){this.emitX=a}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(a){this.emitY=a}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),b.Tile=function(a,b,c,d,e,f){this.layer=a,this.index=b,this.x=c,this.y=d,this.worldX=c*e,this.worldY=d*f,this.width=e,this.height=f,this.centerX=Math.abs(e/2),this.centerY=Math.abs(f/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},b.Tile.prototype={containsPoint:function(a,b){return!(a<this.worldX||b<this.worldY||a>this.right||b>this.bottom)},intersects:function(a,b,c,d){return c<=this.worldX?!1:d<=this.worldY?!1:a>=this.worldX+this.width?!1:b>=this.worldY+this.height?!1:!0},setCollisionCallback:function(a,b){this.collisionCallback=a,this.collisionCallbackContext=b},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(a,b,c,d){this.collideLeft=a,this.collideRight=b,this.collideUp=c,this.collideDown=d},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(a,b){return a&&b?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:a?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:b?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(a){this.index=a.index,this.alpha=a.alpha,this.properties=a.properties,this.collideUp=a.collideUp,this.collideDown=a.collideDown,this.collideLeft=a.collideLeft,this.collideRight=a.collideRight,this.collisionCallback=a.collisionCallback,this.collisionCallbackContext=a.collisionCallbackContext}},b.Tile.prototype.constructor=b.Tile,Object.defineProperty(b.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(b.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(b.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(b.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(b.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(b.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),b.Tilemap=function(a,c,d,e,f,g){this.game=a,this.key=c;var h=b.TilemapParser.parse(this.game,c,d,e,f,g);null!==h&&(this.width=h.width,this.height=h.height,this.tileWidth=h.tileWidth,this.tileHeight=h.tileHeight,this.orientation=h.orientation,this.format=h.format,this.version=h.version,this.properties=h.properties,this.widthInPixels=h.widthInPixels,this.heightInPixels=h.heightInPixels,this.layers=h.layers,this.tilesets=h.tilesets,this.tiles=h.tiles,this.objects=h.objects,this.collideIndexes=[],this.collision=h.collision,this.images=h.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},b.Tilemap.CSV=0,b.Tilemap.TILED_JSON=1,b.Tilemap.NORTH=0,b.Tilemap.EAST=1,b.Tilemap.SOUTH=2,b.Tilemap.WEST=3,b.Tilemap.prototype={create:function(a,b,c,d,e,f){return"undefined"==typeof f&&(f=this.game.world),this.width=b,this.height=c,this.setTileSize(d,e),this.layers.length=0,this.createBlankLayer(a,b,c,d,e,f)},setTileSize:function(a,b){this.tileWidth=a,this.tileHeight=b,this.widthInPixels=this.width*a,this.heightInPixels=this.height*b},addTilesetImage:function(a,c,d,e,f,g,h){if("undefined"==typeof d&&(d=this.tileWidth),"undefined"==typeof e&&(e=this.tileHeight),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=0),"undefined"==typeof h&&(h=0),0===d&&(d=32),0===e&&(e=32),"undefined"==typeof c){if("string"!=typeof a)return null;if(c=a,!this.game.cache.checkImageKey(c))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+c+'"'),null}if("string"==typeof a&&(a=this.getTilesetIndex(a),null===a&&this.format===b.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+c+'"'),null;if(this.tilesets[a])return this.tilesets[a].setImage(this.game.cache.getImage(c)),this.tilesets[a];var i=new b.Tileset(c,h,d,e,f,g,{});i.setImage(this.game.cache.getImage(c)),this.tilesets.push(i);for(var j=this.tilesets.length-1,k=f,l=f,m=0,n=0,o=0,p=h;p<h+i.total&&(this.tiles[p]=[k,l,j],k+=d+g,m++,m!==i.total)&&(n++,n!==i.columns||(k=f,l+=e+g,n=0,o++,o!==i.rows));p++);return i},createFromObjects:function(a,c,d,e,f,g,h,i,j){if("undefined"==typeof f&&(f=!0),"undefined"==typeof g&&(g=!1),"undefined"==typeof h&&(h=this.game.world),"undefined"==typeof i&&(i=b.Sprite),"undefined"==typeof j&&(j=!0),!this.objects[a])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+a);for(var k,l=0,m=this.objects[a].length;m>l;l++)if(this.objects[a][l].gid===c){k=new i(this.game,this.objects[a][l].x,this.objects[a][l].y,d,e),k.name=this.objects[a][l].name,k.visible=this.objects[a][l].visible,k.autoCull=g,k.exists=f,j&&(k.y-=k.height),h.add(k);for(var n in this.objects[a][l].properties)h.set(k,n,this.objects[a][l].properties[n],!1,!1,0,!0)}},createLayer:function(a,c,d,e){"undefined"==typeof c&&(c=this.game.width),"undefined"==typeof d&&(d=this.game.height),"undefined"==typeof e&&(e=this.game.world);var f=a;return"string"==typeof a&&(f=this.getLayerIndex(a)),null===f||f>this.layers.length?void console.warn("Tilemap.createLayer: Invalid layer ID given: "+f):e.add(new b.TilemapLayer(this.game,this,f,c,d))},createBlankLayer:function(a,c,d,e,f,g){if("undefined"==typeof g&&(g=this.game.world),null!==this.getLayerIndex(a))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");for(var h,i={name:a,x:0,y:0,width:c,height:d,widthInPixels:c*e,heightInPixels:d*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},j=[],k=0;d>k;k++){h=[];for(var l=0;c>l;l++)h.push(new b.Tile(i,-1,l,k,e,f));j.push(h)}i.data=j,this.layers.push(i),this.currentLayer=this.layers.length-1;var m=i.widthInPixels,n=i.heightInPixels;m>this.game.width&&(m=this.game.width),n>this.game.height&&(n=this.game.height);var j=new b.TilemapLayer(this.game,this,this.layers.length-1,m,n);return j.name=a,g.add(j)},getIndex:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return c;return null},getLayerIndex:function(a){return this.getIndex(this.layers,a)},getTilesetIndex:function(a){return this.getIndex(this.tilesets,a)},getImageIndex:function(a){return this.getIndex(this.images,a)},getObjectIndex:function(a){return this.getIndex(this.objects,a)},setTileIndexCallback:function(a,b,c,d){if(d=this.getLayer(d),"number"==typeof a)this.layers[d].callbacks[a]={callback:b,callbackContext:c};else for(var e=0,f=a.length;f>e;e++)this.layers[d].callbacks[a[e]]={callback:b,callbackContext:c}},setTileLocationCallback:function(a,b,c,d,e,f,g){if(g=this.getLayer(g),this.copy(a,b,c,d,g),!(this._results.length<2))for(var h=1;h<this._results.length;h++)this._results[h].setCollisionCallback(e,f)},setCollision:function(a,b,c,d){if("undefined"==typeof b&&(b=!0),"undefined"==typeof d&&(d=!0),c=this.getLayer(c),"number"==typeof a)return this.setCollisionByIndex(a,b,c,!0);for(var e=0,f=a.length;f>e;e++)this.setCollisionByIndex(a[e],b,c,!1);d&&this.calculateFaces(c)},setCollisionBetween:function(a,b,c,d,e){if("undefined"==typeof c&&(c=!0),"undefined"==typeof e&&(e=!0),d=this.getLayer(d),!(a>b)){for(var f=a;b>=f;f++)this.setCollisionByIndex(f,c,d,!1);e&&this.calculateFaces(d)}},setCollisionByExclusion:function(a,b,c,d){"undefined"==typeof b&&(b=!0),"undefined"==typeof d&&(d=!0),c=this.getLayer(c);for(var e=0,f=this.tiles.length;f>e;e++)-1===a.indexOf(e)&&this.setCollisionByIndex(e,b,c,!1);d&&this.calculateFaces(c)},setCollisionByIndex:function(a,b,c,d){if("undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=this.currentLayer),"undefined"==typeof d&&(d=!0),b)this.collideIndexes.push(a);else{var e=this.collideIndexes.indexOf(a);e>-1&&this.collideIndexes.splice(e,1)}for(var f=0;f<this.layers[c].height;f++)for(var g=0;g<this.layers[c].width;g++){var h=this.layers[c].data[f][g];h&&h.index===a&&(b?h.setCollision(!0,!0,!0,!0):h.resetCollision(),h.faceTop=b,h.faceBottom=b,h.faceLeft=b,h.faceRight=b)}return d&&this.calculateFaces(c),c},getLayer:function(a){return"undefined"==typeof a?a=this.currentLayer:"string"==typeof a?a=this.getLayerIndex(a):a instanceof b.TilemapLayer&&(a=a.index),a},setPreventRecalculate:function(a){if(a===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),a===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var b in this.needToRecalculate)this.calculateFaces(b);this.needToRecalculate=!1}},calculateFaces:function(a){if(this.preventingRecalculate===!0)return void(this.needToRecalculate[a]=!0);for(var b=null,c=null,d=null,e=null,f=0,g=this.layers[a].height;g>f;f++)for(var h=0,i=this.layers[a].width;i>h;h++){var j=this.layers[a].data[f][h];j&&(b=this.getTileAbove(a,h,f),c=this.getTileBelow(a,h,f),d=this.getTileLeft(a,h,f),e=this.getTileRight(a,h,f),j.collides&&(j.faceTop=!0,j.faceBottom=!0,j.faceLeft=!0,j.faceRight=!0),b&&b.collides&&(j.faceTop=!1),c&&c.collides&&(j.faceBottom=!1),d&&d.collides&&(j.faceLeft=!1),e&&e.collides&&(j.faceRight=!1))}},getTileAbove:function(a,b,c){return c>0?this.layers[a].data[c-1][b]:null},getTileBelow:function(a,b,c){return c<this.layers[a].height-1?this.layers[a].data[c+1][b]:null},getTileLeft:function(a,b,c){return b>0?this.layers[a].data[c][b-1]:null},getTileRight:function(a,b,c){return b<this.layers[a].width-1?this.layers[a].data[c][b+1]:null},setLayer:function(a){a=this.getLayer(a),this.layers[a]&&(this.currentLayer=a)},hasTile:function(a,b,c){return c=this.getLayer(c),null!==this.layers[c].data[b]&&null!==this.layers[c].data[b][a]},removeTile:function(a,c,d){if(d=this.getLayer(d),a>=0&&a<this.layers[d].width&&c>=0&&c<this.layers[d].height&&this.hasTile(a,c,d)){var e=this.layers[d].data[c][a];return this.layers[d].data[c][a]=new b.Tile(this.layers[d],-1,a,c,this.tileWidth,this.tileHeight),this.layers[d].dirty=!0,this.calculateFaces(d),e}},removeTileWorldXY:function(a,b,c,d,e){return e=this.getLayer(e),a=this.game.math.snapToFloor(a,c)/c,b=this.game.math.snapToFloor(b,d)/d,this.removeTile(a,b,e)},putTile:function(a,c,d,e){if(null===a)return this.removeTile(c,d,e);if(e=this.getLayer(e),c>=0&&c<this.layers[e].width&&d>=0&&d<this.layers[e].height){var f;return a instanceof b.Tile?(f=a.index,this.hasTile(c,d,e)?this.layers[e].data[d][c].copy(a):this.layers[e].data[d][c]=new b.Tile(e,f,c,d,a.width,a.height)):(f=a,this.hasTile(c,d,e)?this.layers[e].data[d][c].index=f:this.layers[e].data[d][c]=new b.Tile(this.layers[e],f,c,d,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(f)>-1?this.layers[e].data[d][c].setCollision(!0,!0,!0,!0):this.layers[e].data[d][c].resetCollision(),this.layers[e].dirty=!0,this.calculateFaces(e),this.layers[e].data[d][c]}return null},putTileWorldXY:function(a,b,c,d,e,f){return f=this.getLayer(f),b=this.game.math.snapToFloor(b,d)/d,c=this.game.math.snapToFloor(c,e)/e,this.putTile(a,b,c,f)},searchTileIndex:function(a,b,c,d){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=!1),d=this.getLayer(d);var e=0;if(c){for(var f=this.layers[d].height-1;f>=0;f--)for(var g=this.layers[d].width-1;g>=0;g--)if(this.layers[d].data[f][g].index===a){if(e===b)return this.layers[d].data[f][g];e++}}else for(var f=0;f<this.layers[d].height;f++)for(var g=0;g<this.layers[d].width;g++)if(this.layers[d].data[f][g].index===a){if(e===b)return this.layers[d].data[f][g];e++}return null},getTile:function(a,b,c,d){return"undefined"==typeof d&&(d=!1),c=this.getLayer(c),a>=0&&a<this.layers[c].width&&b>=0&&b<this.layers[c].height?-1===this.layers[c].data[b][a].index?d?this.layers[c].data[b][a]:null:this.layers[c].data[b][a]:null},getTileWorldXY:function(a,b,c,d,e){return"undefined"==typeof c&&(c=this.tileWidth),"undefined"==typeof d&&(d=this.tileHeight),e=this.getLayer(e),a=this.game.math.snapToFloor(a,c)/c,b=this.game.math.snapToFloor(b,d)/d,this.getTile(a,b,e)},copy:function(a,b,c,d,e){if(e=this.getLayer(e),!this.layers[e])return void(this._results.length=0);"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=this.layers[e].width),"undefined"==typeof d&&(d=this.layers[e].height),0>a&&(a=0),0>b&&(b=0),c>this.layers[e].width&&(c=this.layers[e].width),d>this.layers[e].height&&(d=this.layers[e].height),this._results.length=0,this._results.push({x:a,y:b,width:c,height:d,layer:e});for(var f=b;b+d>f;f++)for(var g=a;a+c>g;g++)this._results.push(this.layers[e].data[f][g]);return this._results},paste:function(a,b,c,d){if("undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),d=this.getLayer(d),c&&!(c.length<2)){for(var e=c[1].x-a,f=c[1].y-b,g=1;g<c.length;g++)this.layers[d].data[f+c[g].y][e+c[g].x].copy(c[g]);this.layers[d].dirty=!0,this.calculateFaces(d)}},swap:function(a,b,c,d,e,f,g){g=this.getLayer(g),this.copy(c,d,e,f,g),this._results.length<2||(this._tempA=a,this._tempB=b,this._results.forEach(this.swapHandler,this),this.paste(c,d,this._results,g))},swapHandler:function(a,b){a.index===this._tempA&&(this._results[b].index=this._tempB),a.index===this._tempB&&(this._results[b].index=this._tempA)},forEach:function(a,b,c,d,e,f,g){g=this.getLayer(g),this.copy(c,d,e,f,g),this._results.length<2||(this._results.forEach(a,b),this.paste(c,d,this._results,g))},replace:function(a,b,c,d,e,f,g){if(g=this.getLayer(g),this.copy(c,d,e,f,g),!(this._results.length<2)){for(var h=1;h<this._results.length;h++)this._results[h].index===a&&(this._results[h].index=b);this.paste(c,d,this._results,g)}},random:function(a,b,c,d,e){if(e=this.getLayer(e),this.copy(a,b,c,d,e),!(this._results.length<2)){for(var f=[],g=1;g<this._results.length;g++)if(this._results[g].index){var h=this._results[g].index;-1===f.indexOf(h)&&f.push(h)}for(var i=1;i<this._results.length;i++)this._results[i].index=this.game.rnd.pick(f);this.paste(a,b,this._results,e)}},shuffle:function(a,c,d,e,f){if(f=this.getLayer(f),this.copy(a,c,d,e,f),!(this._results.length<2)){for(var g=[],h=1;h<this._results.length;h++)this._results[h].index&&g.push(this._results[h].index);b.Utils.shuffle(g);for(var i=1;i<this._results.length;i++)this._results[i].index=g[i-1];this.paste(a,c,this._results,f)}},fill:function(a,b,c,d,e,f){if(f=this.getLayer(f),this.copy(b,c,d,e,f),!(this._results.length<2)){for(var g=1;g<this._results.length;g++)this._results[g].index=a;this.paste(b,c,this._results,f)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var a="",b=[""],c=0;c<this.layers[this.currentLayer].height;c++){for(var d=0;d<this.layers[this.currentLayer].width;d++)a+="%c  ",b.push(this.layers[this.currentLayer].data[c][d]>1?this.debugMap[this.layers[this.currentLayer].data[c][d]]?"background: "+this.debugMap[this.layers[this.currentLayer].data[c][d]]:"background: #ffffff":"background: rgb(0, 0, 0)");a+="\n"}b[0]=a,console.log.apply(console,b)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},b.Tilemap.prototype.constructor=b.Tilemap,Object.defineProperty(b.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(a){a!==this.currentLayer&&this.setLayer(a)}}),b.TilemapLayer=function(a,c,d,e,f){this.game=a,this.map=c,this.index=d,this.layer=c.layers[d],this.canvas=b.Canvas.create(e,f,"",!0),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new b.Frame(0,0,0,e,f,"tilemapLayer",a.rnd.uuid()),b.Image.call(this,this.game,0,0,this.texture,this.textureFrame),this.name="",this.type=b.TILEMAPLAYER,this.fixedToCamera=!0,this.cameraOffset=new b.Point(0,0),this.tileColor="rgb(255, 255, 255)",this.debug=!1,this.debugAlpha=.5,this.debugColor="rgba(0, 255, 0, 1)",this.debugFill=!1,this.debugFillColor="rgba(0, 255, 0, 0.2)",this.debugCallbackColor="rgba(255, 0, 0, 1)",this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this.wrap=!1,this._mc={cw:c.tileWidth,ch:c.tileHeight,ga:1,dx:0,dy:0,dw:0,dh:0,tx:0,ty:0,tw:0,th:0,tl:0,maxX:0,maxY:0,startX:0,startY:0,x:0,y:0,prevX:0,prevY:0},this._results=[],this.updateMax()},b.TilemapLayer.prototype=Object.create(b.Image.prototype),b.TilemapLayer.prototype.constructor=b.TilemapLayer,b.TilemapLayer.prototype.postUpdate=function(){b.Image.prototype.postUpdate.call(this),this.scrollX=this.game.camera.x*this.scrollFactorX,this.scrollY=this.game.camera.y*this.scrollFactorY,this.render(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},b.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)},b.TilemapLayer.prototype._fixX=function(a){return 0>a&&(a=0),1===this.scrollFactorX?a:this._mc.x+(a-this._mc.x/this.scrollFactorX)},b.TilemapLayer.prototype._unfixX=function(a){return 1===this.scrollFactorX?a:this._mc.x/this.scrollFactorX+(a-this._mc.x)},b.TilemapLayer.prototype._fixY=function(a){return 0>a&&(a=0),1===this.scrollFactorY?a:this._mc.y+(a-this._mc.y/this.scrollFactorY)},b.TilemapLayer.prototype._unfixY=function(a){return 1===this.scrollFactorY?a:this._mc.y/this.scrollFactorY+(a-this._mc.y)},b.TilemapLayer.prototype.getTileX=function(a){return this.game.math.snapToFloor(this._fixX(a),this.map.tileWidth)/this.map.tileWidth},b.TilemapLayer.prototype.getTileY=function(a){return this.game.math.snapToFloor(this._fixY(a),this.map.tileHeight)/this.map.tileHeight},b.TilemapLayer.prototype.getTileXY=function(a,b,c){return c.x=this.getTileX(a),c.y=this.getTileY(b),c},b.TilemapLayer.prototype.getRayCastTiles=function(a,b,c,d){("undefined"==typeof b||null===b)&&(b=this.rayStepRate),"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=!1);var e=this.getTiles(a.x,a.y,a.width,a.height,c,d);if(0===e.length)return[];for(var f=a.coordinatesOnLine(b),g=f.length,h=[],i=0;i<e.length;i++)for(var j=0;g>j;j++)if(e[i].containsPoint(f[j][0],f[j][1])){h.push(e[i]);break}return h},b.TilemapLayer.prototype.getTiles=function(a,b,c,d,e,f){"undefined"==typeof e&&(e=!1),"undefined"==typeof f&&(f=!1),a=this._fixX(a),b=this._fixY(b),c>this.layer.widthInPixels&&(c=this.layer.widthInPixels),d>this.layer.heightInPixels&&(d=this.layer.heightInPixels),this._mc.tx=this.game.math.snapToFloor(a,this._mc.cw)/this._mc.cw,this._mc.ty=this.game.math.snapToFloor(b,this._mc.ch)/this._mc.ch,this._mc.tw=(this.game.math.snapToCeil(c,this._mc.cw)+this._mc.cw)/this._mc.cw,this._mc.th=(this.game.math.snapToCeil(d,this._mc.ch)+this._mc.ch)/this._mc.ch,this._results.length=0;for(var g=this._mc.ty;g<this._mc.ty+this._mc.th;g++)for(var h=this._mc.tx;h<this._mc.tx+this._mc.tw;h++)this.layer.data[g]&&this.layer.data[g][h]&&(!e&&!f||this.layer.data[g][h].isInteresting(e,f))&&this._results.push(this.layer.data[g][h]);return this._results},b.TilemapLayer.prototype.updateMax=function(){this._mc.maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1,this._mc.maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1,this.dirty=!0},b.TilemapLayer.prototype.render=function(){if(this.layer.dirty&&(this.dirty=!0),this.dirty&&this.visible){this._mc.prevX=this._mc.dx,this._mc.prevY=this._mc.dy,this._mc.dx=-(this._mc.x-this._mc.startX*this.map.tileWidth),this._mc.dy=-(this._mc.y-this._mc.startY*this.map.tileHeight),this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.tileColor;var a,c;this.debug&&(this.context.globalAlpha=this.debugAlpha);for(var d=this._mc.startY,e=this._mc.startY+this._mc.maxY;e>d;d++){if(this._column=null,0>d&&this.wrap?this._column=this.layer.data[d+this.map.height]:d>=this.map.height&&this.wrap?this._column=this.layer.data[d-this.map.height]:this.layer.data[d]&&(this._column=this.layer.data[d]),this._column)for(var f=this._mc.startX,g=this._mc.startX+this._mc.maxX;g>f;f++){var a=null;0>f&&this.wrap?a=this._column[f+this.map.width]:f>=this.map.width&&this.wrap?a=this._column[f-this.map.width]:this._column[f]&&(a=this._column[f]),a&&a.index>-1&&(c=this.map.tilesets[this.map.tiles[a.index][2]],this.debug===!1&&a.alpha!==this.context.globalAlpha&&(this.context.globalAlpha=a.alpha),c.draw(this.context,Math.floor(this._mc.tx),Math.floor(this._mc.ty),a.index),a.debug&&(this.context.fillStyle="rgba(0, 255, 0, 0.4)",this.context.fillRect(Math.floor(this._mc.tx),Math.floor(this._mc.ty),this.map.tileWidth,this.map.tileHeight))),this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx,this._mc.ty+=this.map.tileHeight}return this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.game.renderType===b.WEBGL&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl),this.dirty=!1,this.layer.dirty=!1,!0}},b.TilemapLayer.prototype.renderDebug=function(){this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.strokeStyle=this.debugColor,this.context.fillStyle=this.debugFillColor;for(var a=this._mc.startY,b=this._mc.startY+this._mc.maxY;b>a;a++){if(this._column=null,0>a&&this.wrap?this._column=this.layer.data[a+this.map.height]:a>=this.map.height&&this.wrap?this._column=this.layer.data[a-this.map.height]:this.layer.data[a]&&(this._column=this.layer.data[a]),this._column)for(var c=this._mc.startX,d=this._mc.startX+this._mc.maxX;d>c;c++){var e=null;0>c&&this.wrap?e=this._column[c+this.map.width]:c>=this.map.width&&this.wrap?e=this._column[c-this.map.width]:this._column[c]&&(e=this._column[c]),e&&(e.faceTop||e.faceBottom||e.faceLeft||e.faceRight)&&(this._mc.tx=Math.floor(this._mc.tx),this.debugFill&&this.context.fillRect(this._mc.tx,this._mc.ty,this._mc.cw,this._mc.ch),this.context.beginPath(),e.faceTop&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty)),e.faceBottom&&(this.context.moveTo(this._mc.tx,this._mc.ty+this._mc.ch),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),e.faceLeft&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx,this._mc.ty+this._mc.ch)),e.faceRight&&(this.context.moveTo(this._mc.tx+this._mc.cw,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),this.context.stroke()),this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx,this._mc.ty+=this.map.tileHeight}},Object.defineProperty(b.TilemapLayer.prototype,"scrollX",{get:function(){return this._mc.x},set:function(a){a!==this._mc.x&&(this._mc.x=a,this._mc.startX=this.game.math.floor(this._mc.x/this.map.tileWidth),this.dirty=!0)}}),Object.defineProperty(b.TilemapLayer.prototype,"scrollY",{get:function(){return this._mc.y},set:function(a){a!==this._mc.y&&(this._mc.y=a,this._mc.startY=this.game.math.floor(this._mc.y/this.map.tileHeight),this.dirty=!0)}}),Object.defineProperty(b.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(a){this._mc.cw=a,this.dirty=!0}}),Object.defineProperty(b.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(a){this._mc.ch=a,this.dirty=!0}}),b.TilemapParser={parse:function(a,c,d,e,f,g){if("undefined"==typeof d&&(d=32),"undefined"==typeof e&&(e=32),"undefined"==typeof f&&(f=10),"undefined"==typeof g&&(g=10),"undefined"==typeof c)return this.getEmptyData();if(null===c)return this.getEmptyData(d,e,f,g);var h=a.cache.getTilemapData(c);if(h){if(h.format===b.Tilemap.CSV)return this.parseCSV(c,h.data,d,e);if(!h.format||h.format===b.Tilemap.TILED_JSON)return this.parseTiledJSON(h.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+c)},parseCSV:function(a,c,d,e){var f=this.getEmptyData();c=c.trim();for(var g=[],h=c.split("\n"),i=h.length,j=0,k=0;k<h.length;k++){g[k]=[];for(var l=h[k].split(","),m=0;m<l.length;m++)g[k][m]=new b.Tile(f.layers[0],parseInt(l[m],10),m,k,d,e);0===j&&(j=l.length)}return f.format=b.Tilemap.CSV,f.name=a,f.width=j,f.height=i,f.tileWidth=d,f.tileHeight=e,f.widthInPixels=j*d,f.heightInPixels=i*e,f.layers[0].width=j,f.layers[0].height=i,f.layers[0].widthInPixels=f.widthInPixels,f.layers[0].heightInPixels=f.heightInPixels,f.layers[0].data=g,f},getEmptyData:function(a,b,c,d){var e={};e.width=0,e.height=0,e.tileWidth=0,e.tileHeight=0,"undefined"!=typeof a&&null!==a&&(e.tileWidth=a),"undefined"!=typeof b&&null!==b&&(e.tileHeight=b),"undefined"!=typeof c&&null!==c&&(e.width=c),"undefined"!=typeof d&&null!==d&&(e.height=d),e.orientation="orthogonal",e.version="1",e.properties={},e.widthInPixels=0,e.heightInPixels=0;var f=[],g={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],data:[]};return f.push(g),e.layers=f,e.images=[],e.objects={},e.collision={},e.tilesets=[],e.tiles=[],e},parseTiledJSON:function(a){function c(a,b){var c={};for(var d in b){var e=b[d];c[e]=a[e]}return c}if("orthogonal"!==a.orientation)return console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser"),null;var d={};d.width=a.width,d.height=a.height,d.tileWidth=a.tilewidth,d.tileHeight=a.tileheight,d.orientation=a.orientation,d.format=b.Tilemap.TILED_JSON,d.version=a.version,d.properties=a.properties,d.widthInPixels=d.width*d.tileWidth,d.heightInPixels=d.height*d.tileHeight;for(var e=[],f=0;f<a.layers.length;f++)if("tilelayer"===a.layers[f].type){var g={name:a.layers[f].name,x:a.layers[f].x,y:a.layers[f].y,width:a.layers[f].width,height:a.layers[f].height,widthInPixels:a.layers[f].width*a.tilewidth,heightInPixels:a.layers[f].height*a.tileheight,alpha:a.layers[f].opacity,visible:a.layers[f].visible,properties:{},indexes:[],callbacks:[],bodies:[]};a.layers[f].properties&&(g.properties=a.layers[f].properties);for(var h=0,i=[],j=[],k=0,l=a.layers[f].data.length;l>k;k++)i.push(a.layers[f].data[k]>0?new b.Tile(g,a.layers[f].data[k],h,j.length,a.tilewidth,a.tileheight):new b.Tile(g,-1,h,j.length,a.tilewidth,a.tileheight)),h++,h===a.layers[f].width&&(j.push(i),h=0,i=[]);g.data=j,e.push(g)}d.layers=e;for(var m=[],f=0;f<a.layers.length;f++)if("imagelayer"===a.layers[f].type){var n={name:a.layers[f].name,image:a.layers[f].image,x:a.layers[f].x,y:a.layers[f].y,alpha:a.layers[f].opacity,visible:a.layers[f].visible,properties:{}};a.layers[f].properties&&(n.properties=a.layers[f].properties),m.push(n)}d.images=m;for(var o=[],f=0;f<a.tilesets.length;f++){var p=a.tilesets[f],q=new b.Tileset(p.name,p.firstgid,p.tilewidth,p.tileheight,p.margin,p.spacing,p.properties);p.tileproperties&&(q.tileProperties=p.tileproperties),q.rows=Math.round((p.imageheight-p.margin)/(p.tileheight+p.spacing)),q.columns=Math.round((p.imagewidth-p.margin)/(p.tilewidth+p.spacing)),q.total=q.rows*q.columns,q.rows%1!==0||q.columns%1!==0?console.warn("TileSet image dimensions do not match expected dimensions. Tileset width/height must be evenly divisible by Tilemap tile width/height."):o.push(q)}d.tilesets=o;for(var r={},s={},f=0;f<a.layers.length;f++)if("objectgroup"===a.layers[f].type){r[a.layers[f].name]=[],s[a.layers[f].name]=[];for(var t=0,l=a.layers[f].objects.length;l>t;t++)if(a.layers[f].objects[t].gid){var u={gid:a.layers[f].objects[t].gid,name:a.layers[f].objects[t].name,x:a.layers[f].objects[t].x,y:a.layers[f].objects[t].y,visible:a.layers[f].objects[t].visible,properties:a.layers[f].objects[t].properties};r[a.layers[f].name].push(u)}else if(a.layers[f].objects[t].polyline){var u={name:a.layers[f].objects[t].name,x:a.layers[f].objects[t].x,y:a.layers[f].objects[t].y,width:a.layers[f].objects[t].width,height:a.layers[f].objects[t].height,visible:a.layers[f].objects[t].visible,properties:a.layers[f].objects[t].properties};u.polyline=[];for(var v=0;v<a.layers[f].objects[t].polyline.length;v++)u.polyline.push([a.layers[f].objects[t].polyline[v].x,a.layers[f].objects[t].polyline[v].y]);s[a.layers[f].name].push(u)}else if(a.layers[f].objects[t].polygon){var u=c(a.layers[f].objects[t],["name","x","y","visible","properties"]);u.polygon=[];for(var v=0;v<a.layers[f].objects[t].polygon.length;v++)u.polygon.push([a.layers[f].objects[t].polygon[v].x,a.layers[f].objects[t].polygon[v].y]);r[a.layers[f].name].push(u)}else if(a.layers[f].objects[t].ellipse){var u=c(a.layers[f].objects[t],["name","ellipse","x","y","width","height","visible","properties"]);r[a.layers[f].name].push(u)}else{var u=c(a.layers[f].objects[t],["name","x","y","width","height","visible","properties"]);u.rectangle=!0,r[a.layers[f].name].push(u)}}d.objects=r,d.collision=s,d.tiles=[];for(var f=0;f<d.tilesets.length;f++)for(var p=d.tilesets[f],h=p.tileMargin,w=p.tileMargin,x=0,y=0,z=0,k=p.firstgid;k<p.firstgid+p.total&&(d.tiles[k]=[h,w,f],h+=p.tileWidth+p.tileSpacing,x++,x!==p.total)&&(y++,y!==p.columns||(h=p.tileMargin,w+=p.tileHeight+p.tileSpacing,y=0,z++,z!==p.rows));k++);return d}},b.Tileset=function(a,b,c,d,e,f,g){("undefined"==typeof c||0>=c)&&(c=32),("undefined"==typeof d||0>=d)&&(d=32),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=0),this.name=a,this.firstgid=b,this.tileWidth=c,this.tileHeight=d,this.tileMargin=e,this.tileSpacing=f,this.properties=g,this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[] },b.Tileset.prototype={draw:function(a,b,c,d){this.image&&this.drawCoords[d]&&a.drawImage(this.image,this.drawCoords[d][0],this.drawCoords[d][1],this.tileWidth,this.tileHeight,b,c,this.tileWidth,this.tileHeight)},setImage:function(a){this.image=a,this.rows=Math.round((a.height-this.tileMargin)/(this.tileHeight+this.tileSpacing)),this.columns=Math.round((a.width-this.tileMargin)/(this.tileWidth+this.tileSpacing)),this.total=this.rows*this.columns,this.drawCoords.length=0;for(var b=this.tileMargin,c=this.tileMargin,d=this.firstgid,e=0;e<this.rows;e++){for(var f=0;f<this.columns;f++)this.drawCoords[d]=[b,c],b+=this.tileWidth+this.tileSpacing,d++;b=this.tileMargin,c+=this.tileHeight+this.tileSpacing}},setSpacing:function(a,b){this.tileMargin=a,this.tileSpacing=b,this.setImage(this.image)}},b.Tileset.prototype.constructor=b.Tileset,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Phaser=b):"undefined"!=typeof define&&define.amd?define("Phaser",function(){return a.Phaser=b}()):a.Phaser=b}.call(this),Phaser.Physics.Ninja=function(a){this.game=a,this.time=this.game.time,this.gravity=.2,this.bounds=new Phaser.Rectangle(0,0,a.world.width,a.world.height),this.maxObjects=10,this.maxLevels=4,this.quadTree=new Phaser.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels)},Phaser.Physics.Ninja.prototype.constructor=Phaser.Physics.Ninja,Phaser.Physics.Ninja.prototype={enableAABB:function(a,b){this.enable(a,1,0,0,b)},enableCircle:function(a,b,c){this.enable(a,2,0,b,c)},enableTile:function(a,b,c){this.enable(a,3,b,0,c)},enable:function(a,b,c,d,e){if("undefined"==typeof b&&(b=1),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=!0),Array.isArray(a))for(var f=a.length;f--;)a[f]instanceof Phaser.Group?this.enable(a[f].children,b,c,d,e):(this.enableBody(a[f],b,c,d),e&&a[f].hasOwnProperty("children")&&a[f].children.length>0&&this.enable(a[f],b,c,d,!0));else a instanceof Phaser.Group?this.enable(a.children,b,c,d,e):(this.enableBody(a,b,c,d),e&&a.hasOwnProperty("children")&&a.children.length>0&&this.enable(a.children,b,c,d,!0))},enableBody:function(a,b,c,d){a.hasOwnProperty("body")&&null===a.body&&(a.body=new Phaser.Physics.Ninja.Body(this,a,b,c,d),a.anchor.set(.5))},setBounds:function(a,b,c,d){this.bounds.setTo(a,b,c,d)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},clearTilemapLayerBodies:function(a,b){b=a.getLayer(b);for(var c=a.layers[b].bodies.length;c--;)a.layers[b].bodies[c].destroy();a.layers[b].bodies.length=[]},convertTilemap:function(a,b,c){b=a.getLayer(b),this.clearTilemapLayerBodies(a,b);for(var d=0,e=a.layers[b].height;e>d;d++)for(var f=0,g=a.layers[b].width;g>f;f++){var h=a.layers[b].data[d][f];if(h&&c.hasOwnProperty(h.index)){var i=new Phaser.Physics.Ninja.Body(this,null,3,c[h.index],0,h.worldX+h.centerX,h.worldY+h.centerY,h.width,h.height);a.layers[b].bodies.push(i)}}return a.layers[b].bodies},overlap:function(a,b,c,d,e){if(c=c||null,d=d||null,e=e||c,this._result=!1,this._total=0,Array.isArray(b))for(var f=0,g=b.length;g>f;f++)this.collideHandler(a,b[f],c,d,e,!0);else this.collideHandler(a,b,c,d,e,!0);return this._total>0},collide:function(a,b,c,d,e){if(c=c||null,d=d||null,e=e||c,this._result=!1,this._total=0,Array.isArray(b))for(var f=0,g=b.length;g>f;f++)this.collideHandler(a,b[f],c,d,e,!1);else this.collideHandler(a,b,c,d,e,!1);return this._total>0},collideHandler:function(a,b,c,d,e,f){return"undefined"!=typeof b||a.type!==Phaser.GROUP&&a.type!==Phaser.EMITTER?void(a&&b&&a.exists&&b.exists&&(a.type==Phaser.SPRITE||a.type==Phaser.TILESPRITE?b.type==Phaser.SPRITE||b.type==Phaser.TILESPRITE?this.collideSpriteVsSprite(a,b,c,d,e,f):b.type==Phaser.GROUP||b.type==Phaser.EMITTER?this.collideSpriteVsGroup(a,b,c,d,e,f):b.type==Phaser.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(a,b,c,d,e):a.type==Phaser.GROUP?b.type==Phaser.SPRITE||b.type==Phaser.TILESPRITE?this.collideSpriteVsGroup(b,a,c,d,e,f):b.type==Phaser.GROUP||b.type==Phaser.EMITTER?this.collideGroupVsGroup(a,b,c,d,e,f):b.type==Phaser.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,b,c,d,e):a.type==Phaser.TILEMAPLAYER?b.type==Phaser.SPRITE||b.type==Phaser.TILESPRITE?this.collideSpriteVsTilemapLayer(b,a,c,d,e):(b.type==Phaser.GROUP||b.type==Phaser.EMITTER)&&this.collideGroupVsTilemapLayer(b,a,c,d,e):a.type==Phaser.EMITTER&&(b.type==Phaser.SPRITE||b.type==Phaser.TILESPRITE?this.collideSpriteVsGroup(b,a,c,d,e,f):b.type==Phaser.GROUP||b.type==Phaser.EMITTER?this.collideGroupVsGroup(a,b,c,d,e,f):b.type==Phaser.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,b,c,d,e)))):void this.collideGroupVsSelf(a,c,d,e,f)},collideSpriteVsSprite:function(a,b,c,d,e,f){this.separate(a.body,b.body,d,e,f)&&(c&&c.call(e,a,b),this._total++)},collideSpriteVsGroup:function(a,b,c,d,e,f){if(0!==b.length)for(var g=0,h=b.children.length;h>g;g++)b.children[g].exists&&b.children[g].body&&this.separate(a.body,b.children[g].body,d,e,f)&&(c&&c.call(e,a,b.children[g]),this._total++)},collideGroupVsSelf:function(a,b,c,d,e){if(0!==a.length)for(var f=a.children.length,g=0;f>g;g++)for(var h=g+1;f>=h;h++)a.children[g]&&a.children[h]&&a.children[g].exists&&a.children[h].exists&&this.collideSpriteVsSprite(a.children[g],a.children[h],b,c,d,e)},collideGroupVsGroup:function(a,b,c,d,e,f){if(0!==a.length&&0!==b.length)for(var g=0,h=a.children.length;h>g;g++)a.children[g].exists&&this.collideSpriteVsGroup(a.children[g],b,c,d,e,f)},separate:function(a,b){return a.type!==Phaser.Physics.NINJA||b.type!==Phaser.Physics.NINJA?!1:a.aabb&&b.aabb?a.aabb.collideAABBVsAABB(b.aabb):a.aabb&&b.tile?a.aabb.collideAABBVsTile(b.tile):a.tile&&b.aabb?b.aabb.collideAABBVsTile(a.tile):a.circle&&b.tile?a.circle.collideCircleVsTile(b.tile):a.tile&&b.circle?b.circle.collideCircleVsTile(a.tile):void 0}},Phaser.Physics.Ninja.Body=function(a,b,c,d,e,f,g,h,i){b=b||null,"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=16),this.sprite=b,this.game=a.game,this.type=Phaser.Physics.NINJA,this.system=a,this.aabb=null,this.tile=null,this.circle=null,this.shape=null,this.drag=1,this.friction=.05,this.gravityScale=1,this.bounce=.3,this.velocity=new Phaser.Point,this.facing=Phaser.NONE,this.immovable=!1,this.collideWorldBounds=!0,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.maxSpeed=8,b&&(f=b.x,g=b.y,h=b.width,i=b.height,0===b.anchor.x&&(f+=.5*b.width),0===b.anchor.y&&(g+=.5*b.height)),1===c?(this.aabb=new Phaser.Physics.Ninja.AABB(this,f,g,h,i),this.shape=this.aabb):2===c?(this.circle=new Phaser.Physics.Ninja.Circle(this,f,g,e),this.shape=this.circle):3===c&&(this.tile=new Phaser.Physics.Ninja.Tile(this,f,g,h,i,d),this.shape=this.tile)},Phaser.Physics.Ninja.Body.prototype={preUpdate:function(){this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.shape.integrate(),this.collideWorldBounds&&this.shape.collideWorldBounds()},postUpdate:function(){this.sprite&&(this.sprite.type===Phaser.TILESPRITE?(this.sprite.x=this.shape.pos.x-this.shape.xw,this.sprite.y=this.shape.pos.y-this.shape.yw):(this.sprite.x=this.shape.pos.x,this.sprite.y=this.shape.pos.y)),this.velocity.x<0?this.facing=Phaser.LEFT:this.velocity.x>0&&(this.facing=Phaser.RIGHT),this.velocity.y<0?this.facing=Phaser.UP:this.velocity.y>0&&(this.facing=Phaser.DOWN)},setZeroVelocity:function(){this.shape.oldpos.x=this.shape.pos.x,this.shape.oldpos.y=this.shape.pos.y},moveTo:function(a,b){var c=a*this.game.time.physicsElapsed,b=this.game.math.degToRad(b);this.shape.pos.x=this.shape.oldpos.x+c*Math.cos(b),this.shape.pos.y=this.shape.oldpos.y+c*Math.sin(b)},moveFrom:function(a,b){var c=-a*this.game.time.physicsElapsed,b=this.game.math.degToRad(b);this.shape.pos.x=this.shape.oldpos.x+c*Math.cos(b),this.shape.pos.y=this.shape.oldpos.y+c*Math.sin(b)},moveLeft:function(a){var b=-a*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+b))},moveRight:function(a){var b=a*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+b))},moveUp:function(a){var b=-a*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+b))},moveDown:function(a){var b=a*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+b))},reset:function(){this.velocity.set(0),this.shape.pos.x=this.sprite.x,this.shape.pos.y=this.sprite.y,this.shape.oldpos.copyFrom(this.shape.pos)},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.shape.pos.x-this.shape.oldpos.x},deltaY:function(){return this.shape.pos.y-this.shape.oldpos.y},destroy:function(){this.sprite=null,this.system=null,this.aabb=null,this.tile=null,this.circle=null,this.shape.destroy(),this.shape=null}},Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"x",{get:function(){return this.shape.pos.x},set:function(a){this.shape.pos.x=a}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"y",{get:function(){return this.shape.pos.y},set:function(a){this.shape.pos.y=a}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"width",{get:function(){return this.shape.width}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"height",{get:function(){return this.shape.height}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"bottom",{get:function(){return this.shape.pos.y+this.shape.yw}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"right",{get:function(){return this.shape.pos.x+this.shape.xw}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"speed",{get:function(){return Math.sqrt(this.shape.velocity.x*this.shape.velocity.x+this.shape.velocity.y*this.shape.velocity.y)}}),Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"angle",{get:function(){return Math.atan2(this.shape.velocity.y,this.shape.velocity.x)}}),Phaser.Physics.Ninja.Body.render=function(a,b,c,d){c=c||"rgba(0,255,0,0.4)","undefined"==typeof d&&(d=!0),(b.aabb||b.circle)&&b.shape.render(a,b.game.camera.x,b.game.camera.y,c,d)},Phaser.Physics.Ninja.AABB=function(a,b,c,d,e){this.body=a,this.system=a.system,this.pos=new Phaser.Point(b,c),this.oldpos=new Phaser.Point(b,c),this.xw=Math.abs(d/2),this.yw=Math.abs(e/2),this.width=d,this.height=e,this.oH=0,this.oV=0,this.velocity=new Phaser.Point,this.aabbTileProjections={},this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projAABB_Full,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projAABB_45Deg,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projAABB_Concave,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projAABB_Convex,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projAABB_22DegS,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projAABB_22DegB,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projAABB_67DegS,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projAABB_67DegB,this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projAABB_Half},Phaser.Physics.Ninja.AABB.prototype.constructor=Phaser.Physics.Ninja.AABB,Phaser.Physics.Ninja.AABB.COL_NONE=0,Phaser.Physics.Ninja.AABB.COL_AXIS=1,Phaser.Physics.Ninja.AABB.COL_OTHER=2,Phaser.Physics.Ninja.AABB.prototype={integrate:function(){var a=this.pos.x,b=this.pos.y;this.pos.x+=this.body.drag*this.pos.x-this.body.drag*this.oldpos.x,this.pos.y+=this.body.drag*this.pos.y-this.body.drag*this.oldpos.y+this.system.gravity*this.body.gravityScale,this.velocity.set(this.pos.x-a,this.pos.y-b),this.oldpos.set(a,b)},reportCollisionVsWorld:function(a,b,c,d){var e,f,g,h,i,j=this.pos,k=this.oldpos,l=j.x-k.x,m=j.y-k.y,n=l*c+m*d,o=n*c,p=n*d,q=l-o,r=m-p;0>n?(h=q*this.body.friction,i=r*this.body.friction,e=1+this.body.bounce,f=o*e,g=p*e,1===c?this.body.touching.left=!0:-1===c&&(this.body.touching.right=!0),1===d?this.body.touching.up=!0:-1===d&&(this.body.touching.down=!0)):f=g=h=i=0,j.x+=a,j.y+=b,k.x+=a+f+h,k.y+=b+g+i},reverse:function(){var a=this.pos.x-this.oldpos.x,b=this.pos.y-this.oldpos.y;this.oldpos.x<this.pos.x?this.oldpos.x=this.pos.x+a:this.oldpos.x>this.pos.x&&(this.oldpos.x=this.pos.x-a),this.oldpos.y<this.pos.y?this.oldpos.y=this.pos.y+b:this.oldpos.y>this.pos.y&&(this.oldpos.y=this.pos.y-b)},reportCollisionVsBody:function(a,b,c,d,e){var f=this.pos.x-this.oldpos.x,g=this.pos.y-this.oldpos.y,h=f*c+g*d;return this.body.immovable&&e.body.immovable?(a*=.5,b*=.5,this.pos.add(a,b),this.oldpos.set(this.pos.x,this.pos.y),e.pos.subtract(a,b),void e.oldpos.set(e.pos.x,e.pos.y)):void(this.body.immovable||e.body.immovable?this.body.immovable?e.body.immovable||(e.pos.subtract(a,b),0>h&&e.reverse()):(this.pos.subtract(a,b),0>h&&this.reverse()):(a*=.5,b*=.5,this.pos.add(a,b),e.pos.subtract(a,b),0>h&&(this.reverse(),e.reverse())))},collideWorldBounds:function(){var a=this.system.bounds.x-(this.pos.x-this.xw);a>0?this.reportCollisionVsWorld(a,0,1,0,null):(a=this.pos.x+this.xw-this.system.bounds.right,a>0&&this.reportCollisionVsWorld(-a,0,-1,0,null));var b=this.system.bounds.y-(this.pos.y-this.yw);b>0?this.reportCollisionVsWorld(0,b,0,1,null):(b=this.pos.y+this.yw-this.system.bounds.bottom,b>0&&this.reportCollisionVsWorld(0,-b,0,-1,null))},collideAABBVsAABB:function(a){var b=this.pos,c=a,d=c.pos.x,e=c.pos.y,f=c.xw,g=c.yw,h=b.x-d,i=f+this.xw-Math.abs(h);if(i>0){var j=b.y-e,k=g+this.yw-Math.abs(j);if(k>0){k>i?0>h?(i*=-1,k=0):k=0:0>j?(i=0,k*=-1):i=0;var l=Math.sqrt(i*i+k*k);return this.reportCollisionVsBody(i,k,i/l,k/l,c),Phaser.Physics.Ninja.AABB.COL_AXIS}}return!1},collideAABBVsTile:function(a){var b=this.pos.x-a.pos.x,c=a.xw+this.xw-Math.abs(b);if(c>0){var d=this.pos.y-a.pos.y,e=a.yw+this.yw-Math.abs(d);if(e>0)return e>c?0>b?(c*=-1,e=0):e=0:0>d?(c=0,e*=-1):c=0,this.resolveTile(c,e,this,a)}return!1},resolveTile:function(a,b,c,d){return 0<d.id?this.aabbTileProjections[d.type](a,b,c,d):!1},projAABB_Full:function(a,b,c,d){var e=Math.sqrt(a*a+b*b);return c.reportCollisionVsWorld(a,b,a/e,b/e,d),Phaser.Physics.Ninja.AABB.COL_AXIS},projAABB_Half:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.x-e*c.xw-d.pos.x,h=c.pos.y-f*c.yw-d.pos.y,i=g*e+h*f;if(0>i){e*=-i,f*=-i;var j=Math.sqrt(e*e+f*f),k=Math.sqrt(a*a+b*b);return j>k?(c.reportCollisionVsWorld(a,b,a/k,b/k,d),Phaser.Physics.Ninja.AABB.COL_AXIS):(c.reportCollisionVsWorld(e,f,d.signx,d.signy,d),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_45Deg:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.x-e*c.xw-d.pos.x,h=c.pos.y-f*c.yw-d.pos.y,i=d.sx,j=d.sy,k=g*i+h*j;if(0>k){i*=-k,j*=-k;var l=Math.sqrt(i*i+j*j),m=Math.sqrt(a*a+b*b);return l>m?(c.reportCollisionVsWorld(a,b,a/m,b/m,d),Phaser.Physics.Ninja.AABB.COL_AXIS):(c.reportCollisionVsWorld(i,j,d.sx,d.sy),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegS:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.y-f*c.yw,h=d.pos.y-g;if(h*f>0){var i=c.pos.x-e*c.xw-(d.pos.x+e*d.xw),j=c.pos.y-f*c.yw-(d.pos.y-f*d.yw),k=d.sx,l=d.sy,m=i*k+j*l;if(0>m){k*=-m,l*=-m;var n=Math.sqrt(k*k+l*l),o=Math.sqrt(a*a+b*b),p=Math.abs(h);return n>o?o>p?(c.reportCollisionVsWorld(0,h,0,h/p,d),Phaser.Physics.Ninja.AABB.COL_OTHER):(c.reportCollisionVsWorld(a,b,a/o,b/o,d),Phaser.Physics.Ninja.AABB.COL_AXIS):n>p?(c.reportCollisionVsWorld(0,h,0,h/p,d),Phaser.Physics.Ninja.AABB.COL_OTHER):(c.reportCollisionVsWorld(k,l,d.sx,d.sy,d),Phaser.Physics.Ninja.AABB.COL_OTHER)}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegB:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.x-e*c.xw-(d.pos.x-e*d.xw),h=c.pos.y-f*c.yw-(d.pos.y+f*d.yw),i=d.sx,j=d.sy,k=g*i+h*j;if(0>k){i*=-k,j*=-k;var l=Math.sqrt(i*i+j*j),m=Math.sqrt(a*a+b*b);return l>m?(c.reportCollisionVsWorld(a,b,a/m,b/m,d),Phaser.Physics.Ninja.AABB.COL_AXIS):(c.reportCollisionVsWorld(i,j,d.sx,d.sy,d),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegS:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.x-e*c.xw,h=d.pos.x-g;if(h*e>0){var i=c.pos.x-e*c.xw-(d.pos.x-e*d.xw),j=c.pos.y-f*c.yw-(d.pos.y+f*d.yw),k=d.sx,l=d.sy,m=i*k+j*l;if(0>m){k*=-m,l*=-m;var n=Math.sqrt(k*k+l*l),o=Math.sqrt(a*a+b*b),p=Math.abs(h);return n>o?o>p?(c.reportCollisionVsWorld(h,0,h/p,0,d),Phaser.Physics.Ninja.AABB.COL_OTHER):(c.reportCollisionVsWorld(a,b,a/o,b/o,d),Phaser.Physics.Ninja.AABB.COL_AXIS):n>p?(c.reportCollisionVsWorld(h,0,h/p,0,d),Phaser.Physics.Ninja.AABB.COL_OTHER):(c.reportCollisionVsWorld(k,l,d.sx,d.sy,d),Phaser.Physics.Ninja.AABB.COL_OTHER)}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegB:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.x-e*c.xw-(d.pos.x+e*d.xw),h=c.pos.y-f*c.yw-(d.pos.y-f*d.yw),i=d.sx,j=d.sy,k=g*i+h*j;if(0>k){i*=-k,j*=-k;var l=Math.sqrt(i*i+j*j),m=Math.sqrt(a*a+b*b);return l>m?(c.reportCollisionVsWorld(a,b,a/m,b/m,d),Phaser.Physics.Ninja.AABB.COL_AXIS):(c.reportCollisionVsWorld(i,j,d.sx,d.sy,d),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Convex:function(a,b,c,d){var e=d.signx,f=d.signy,g=c.pos.x-e*c.xw-(d.pos.x-e*d.xw),h=c.pos.y-f*c.yw-(d.pos.y-f*d.yw),i=Math.sqrt(g*g+h*h),j=2*d.xw,k=Math.sqrt(j*j+0),l=k-i;if(0>e*g||0>f*h){var m=Math.sqrt(a*a+b*b);return c.reportCollisionVsWorld(a,b,a/m,b/m,d),Phaser.Physics.Ninja.AABB.COL_AXIS}return l>0?(g/=i,h/=i,c.reportCollisionVsWorld(g*l,h*l,g,h,d),Phaser.Physics.Ninja.AABB.COL_OTHER):Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Concave:function(a,b,c,d){var e=d.signx,f=d.signy,g=d.pos.x+e*d.xw-(c.pos.x-e*c.xw),h=d.pos.y+f*d.yw-(c.pos.y-f*c.yw),i=2*d.xw,j=Math.sqrt(i*i+0),k=Math.sqrt(g*g+h*h),l=k-j;if(l>0){var m=Math.sqrt(a*a+b*b);return l>m?(c.reportCollisionVsWorld(a,b,a/m,b/m,d),Phaser.Physics.Ninja.AABB.COL_AXIS):(g/=k,h/=k,c.reportCollisionVsWorld(g*l,h*l,g,h,d),Phaser.Physics.Ninja.AABB.COL_OTHER)}return Phaser.Physics.Ninja.AABB.COL_NONE},destroy:function(){this.body=null,this.system=null},render:function(a,b,c,d,e){var f=this.pos.x-this.xw-b,g=this.pos.y-this.yw-c;e?(a.fillStyle=d,a.fillRect(f,g,this.width,this.height)):(a.strokeStyle=d,a.strokeRect(f,g,this.width,this.height))}},Phaser.Physics.Ninja.Tile=function(a,b,c,d,e,f){"undefined"==typeof f&&(f=Phaser.Physics.Ninja.Tile.EMPTY),this.body=a,this.system=a.system,this.id=f,this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY,this.pos=new Phaser.Point(b,c),this.oldpos=new Phaser.Point(b,c),this.id>1&&this.id<30&&(e=d),this.xw=Math.abs(d/2),this.yw=Math.abs(e/2),this.width=d,this.height=e,this.velocity=new Phaser.Point,this.signx=0,this.signy=0,this.sx=0,this.sy=0,this.body.gravityScale=0,this.body.collideWorldBounds=!1,this.id>0&&this.setType(this.id)},Phaser.Physics.Ninja.Tile.prototype.constructor=Phaser.Physics.Ninja.Tile,Phaser.Physics.Ninja.Tile.prototype={integrate:function(){var a=this.pos.x,b=this.pos.y;this.pos.x+=this.body.drag*this.pos.x-this.body.drag*this.oldpos.x,this.pos.y+=this.body.drag*this.pos.y-this.body.drag*this.oldpos.y+this.system.gravity*this.body.gravityScale,this.velocity.set(this.pos.x-a,this.pos.y-b),this.oldpos.set(a,b)},collideWorldBounds:function(){var a=this.system.bounds.x-(this.pos.x-this.xw);a>0?this.reportCollisionVsWorld(a,0,1,0,null):(a=this.pos.x+this.xw-this.system.bounds.right,a>0&&this.reportCollisionVsWorld(-a,0,-1,0,null));var b=this.system.bounds.y-(this.pos.y-this.yw);b>0?this.reportCollisionVsWorld(0,b,0,1,null):(b=this.pos.y+this.yw-this.system.bounds.bottom,b>0&&this.reportCollisionVsWorld(0,-b,0,-1,null))},reportCollisionVsWorld:function(a,b,c,d){var e,f,g,h,i,j=this.pos,k=this.oldpos,l=j.x-k.x,m=j.y-k.y,n=l*c+m*d,o=n*c,p=n*d,q=l-o,r=m-p;0>n?(h=q*this.body.friction,i=r*this.body.friction,e=1+this.body.bounce,f=o*e,g=p*e,1===c?this.body.touching.left=!0:-1===c&&(this.body.touching.right=!0),1===d?this.body.touching.up=!0:-1===d&&(this.body.touching.down=!0)):f=g=h=i=0,j.x+=a,j.y+=b,k.x+=a+f+h,k.y+=b+g+i},setType:function(a){return a===Phaser.Physics.Ninja.Tile.EMPTY?this.clear():(this.id=a,this.updateType()),this},clear:function(){this.id=Phaser.Physics.Ninja.Tile.EMPTY,this.updateType()},destroy:function(){this.body=null,this.system=null},updateType:function(){if(0===this.id)return this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY,this.signx=0,this.signy=0,this.sx=0,this.sy=0,!0;if(this.id<Phaser.Physics.Ninja.Tile.TYPE_45DEG)this.type=Phaser.Physics.Ninja.Tile.TYPE_FULL,this.signx=0,this.signy=0,this.sx=0,this.sy=0;else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONCAVE)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_45DEG,this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn)this.signx=1,this.signy=-1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2;else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn)this.signx=-1,this.signy=-1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2;else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp)this.signx=-1,this.signy=1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2;else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp)return!1;this.signx=1,this.signy=1,this.sx=this.signx/Math.SQRT2,this.sy=this.signy/Math.SQRT2}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONVEX)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_CONCAVE,this.id==Phaser.Physics.Ninja.Tile.CONCAVEpn)this.signx=1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnn)this.signx=-1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnp)this.signx=-1,this.signy=1,this.sx=0,this.sy=0;else{if(this.id!=Phaser.Physics.Ninja.Tile.CONCAVEpp)return!1;this.signx=1,this.signy=1,this.sx=0,this.sy=0}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGs)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_CONVEX,this.id==Phaser.Physics.Ninja.Tile.CONVEXpn)this.signx=1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnn)this.signx=-1,this.signy=-1,this.sx=0,this.sy=0;else if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnp)this.signx=-1,this.signy=1,this.sx=0,this.sy=0;else{if(this.id!=Phaser.Physics.Ninja.Tile.CONVEXpp)return!1;this.signx=1,this.signy=1,this.sx=0,this.sy=0}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGb)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGs,this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS){this.signx=1,this.signy=-1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS){this.signx=-1,this.signy=-1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS){this.signx=-1,this.signy=1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS)return!1;this.signx=1,this.signy=1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGs)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGb,this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB){this.signx=1,this.signy=-1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB){this.signx=-1,this.signy=-1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB){this.signx=-1,this.signy=1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB)return!1;this.signx=1,this.signy=1;var a=Math.sqrt(5);this.sx=1*this.signx/a,this.sy=2*this.signy/a}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGb)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGs,this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS){this.signx=1,this.signy=-1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS){this.signx=-1,this.signy=-1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS){this.signx=-1,this.signy=1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS)return!1;this.signx=1,this.signy=1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else if(this.id<Phaser.Physics.Ninja.Tile.TYPE_HALF)if(this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGb,this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB){this.signx=1,this.signy=-1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB){this.signx=-1,this.signy=-1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB){this.signx=-1,this.signy=1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else{if(this.id!=Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB)return!1;this.signx=1,this.signy=1;var a=Math.sqrt(5);this.sx=2*this.signx/a,this.sy=1*this.signy/a}else if(this.type=Phaser.Physics.Ninja.Tile.TYPE_HALF,this.id==Phaser.Physics.Ninja.Tile.HALFd)this.signx=0,this.signy=-1,this.sx=this.signx,this.sy=this.signy;else if(this.id==Phaser.Physics.Ninja.Tile.HALFu)this.signx=0,this.signy=1,this.sx=this.signx,this.sy=this.signy;else if(this.id==Phaser.Physics.Ninja.Tile.HALFl)this.signx=1,this.signy=0,this.sx=this.signx,this.sy=this.signy;else{if(this.id!=Phaser.Physics.Ninja.Tile.HALFr)return!1;this.signx=-1,this.signy=0,this.sx=this.signx,this.sy=this.signy}}},Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"x",{get:function(){return this.pos.x-this.xw},set:function(a){this.pos.x=a}}),Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"y",{get:function(){return this.pos.y-this.yw},set:function(a){this.pos.y=a}}),Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"bottom",{get:function(){return this.pos.y+this.yw}}),Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"right",{get:function(){return this.pos.x+this.xw}}),Phaser.Physics.Ninja.Tile.EMPTY=0,Phaser.Physics.Ninja.Tile.FULL=1,Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn=2,Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn=3,Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp=4,Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp=5,Phaser.Physics.Ninja.Tile.CONCAVEpn=6,Phaser.Physics.Ninja.Tile.CONCAVEnn=7,Phaser.Physics.Ninja.Tile.CONCAVEnp=8,Phaser.Physics.Ninja.Tile.CONCAVEpp=9,Phaser.Physics.Ninja.Tile.CONVEXpn=10,Phaser.Physics.Ninja.Tile.CONVEXnn=11,Phaser.Physics.Ninja.Tile.CONVEXnp=12,Phaser.Physics.Ninja.Tile.CONVEXpp=13,Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS=14,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS=15,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS=16,Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS=17,Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB=18,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB=19,Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB=20,Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB=21,Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS=22,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS=23,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS=24,Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS=25,Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB=26,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB=27,Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB=28,Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB=29,Phaser.Physics.Ninja.Tile.HALFd=30,Phaser.Physics.Ninja.Tile.HALFr=31,Phaser.Physics.Ninja.Tile.HALFu=32,Phaser.Physics.Ninja.Tile.HALFl=33,Phaser.Physics.Ninja.Tile.TYPE_EMPTY=0,Phaser.Physics.Ninja.Tile.TYPE_FULL=1,Phaser.Physics.Ninja.Tile.TYPE_45DEG=2,Phaser.Physics.Ninja.Tile.TYPE_CONCAVE=6,Phaser.Physics.Ninja.Tile.TYPE_CONVEX=10,Phaser.Physics.Ninja.Tile.TYPE_22DEGs=14,Phaser.Physics.Ninja.Tile.TYPE_22DEGb=18,Phaser.Physics.Ninja.Tile.TYPE_67DEGs=22,Phaser.Physics.Ninja.Tile.TYPE_67DEGb=26,Phaser.Physics.Ninja.Tile.TYPE_HALF=30,Phaser.Physics.Ninja.Circle=function(a,b,c,d){this.body=a,this.system=a.system,this.pos=new Phaser.Point(b,c),this.oldpos=new Phaser.Point(b,c),this.radius=d,this.xw=d,this.yw=d,this.width=2*d,this.height=2*d,this.oH=0,this.oV=0,this.velocity=new Phaser.Point,this.circleTileProjections={},this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projCircle_Full,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projCircle_45Deg,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projCircle_Concave,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projCircle_Convex,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projCircle_22DegS,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projCircle_22DegB,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projCircle_67DegS,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projCircle_67DegB,this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projCircle_Half},Phaser.Physics.Ninja.Circle.prototype.constructor=Phaser.Physics.Ninja.Circle,Phaser.Physics.Ninja.Circle.COL_NONE=0,Phaser.Physics.Ninja.Circle.COL_AXIS=1,Phaser.Physics.Ninja.Circle.COL_OTHER=2,Phaser.Physics.Ninja.Circle.prototype={integrate:function(){var a=this.pos.x,b=this.pos.y;this.pos.x+=this.body.drag*this.pos.x-this.body.drag*this.oldpos.x,this.pos.y+=this.body.drag*this.pos.y-this.body.drag*this.oldpos.y+this.system.gravity*this.body.gravityScale,this.velocity.set(this.pos.x-a,this.pos.y-b),this.oldpos.set(a,b)},reportCollisionVsWorld:function(a,b,c,d){var e,f,g,h,i,j=this.pos,k=this.oldpos,l=j.x-k.x,m=j.y-k.y,n=l*c+m*d,o=n*c,p=n*d,q=l-o,r=m-p;0>n?(h=q*this.body.friction,i=r*this.body.friction,e=1+this.body.bounce,f=o*e,g=p*e,1===c?this.body.touching.left=!0:-1===c&&(this.body.touching.right=!0),1===d?this.body.touching.up=!0:-1===d&&(this.body.touching.down=!0)):f=g=h=i=0,j.x+=a,j.y+=b,k.x+=a+f+h,k.y+=b+g+i},collideWorldBounds:function(){var a=this.system.bounds.x-(this.pos.x-this.radius);a>0?this.reportCollisionVsWorld(a,0,1,0,null):(a=this.pos.x+this.radius-this.system.bounds.right,a>0&&this.reportCollisionVsWorld(-a,0,-1,0,null));var b=this.system.bounds.y-(this.pos.y-this.radius);b>0?this.reportCollisionVsWorld(0,b,0,1,null):(b=this.pos.y+this.radius-this.system.bounds.bottom,b>0&&this.reportCollisionVsWorld(0,-b,0,-1,null))},collideCircleVsTile:function(a){var b=this.pos,c=this.radius,d=a,e=d.pos.x,f=d.pos.y,g=d.xw,h=d.yw,i=b.x-e,j=g+c-Math.abs(i);if(j>0){var k=b.y-f,l=h+c-Math.abs(k);if(l>0)return this.oH=0,this.oV=0,-g>i?this.oH=-1:i>g&&(this.oH=1),-h>k?this.oV=-1:k>h&&(this.oV=1),this.resolveCircleTile(j,l,this.oH,this.oV,this,d)}},resolveCircleTile:function(a,b,c,d,e,f){return 0<f.id?this.circleTileProjections[f.type](a,b,c,d,e,f):!1},projCircle_Full:function(a,b,c,d,e,f){if(0===c){if(0===d){if(b>a){var g=e.pos.x-f.pos.x;return 0>g?(e.reportCollisionVsWorld(-a,0,-1,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(a,0,1,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS)}var h=e.pos.y-f.pos.y;return 0>h?(e.reportCollisionVsWorld(0,-b,0,-1,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(0,b,0,1,f),Phaser.Physics.Ninja.Circle.COL_AXIS)}return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS}if(0===d)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS; var i=f.pos.x+c*f.xw,j=f.pos.y+d*f.yw,g=e.pos.x-i,h=e.pos.y-j,k=Math.sqrt(g*g+h*h),l=e.radius-k;return l>0?(0===k?(g=c/Math.SQRT2,h=d/Math.SQRT2):(g/=k,h/=k),e.reportCollisionVsWorld(g*l,h*l,g,h,f),Phaser.Physics.Ninja.Circle.COL_OTHER):Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_45Deg:function(a,b,c,d,e,f){var g,h=f.signx,i=f.signy;if(0===c)if(0===d){var j=f.sx,k=f.sy,l=e.pos.x-j*e.radius-f.pos.x,m=e.pos.y-k*e.radius-f.pos.y,n=l*j+m*k;if(0>n){j*=-n,k*=-n,b>a?(g=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(g=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1));var o=Math.sqrt(j*j+k*k);return o>g?(e.reportCollisionVsWorld(a,b,a/g,b/g,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(j,k,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0>i*d)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=f.sx,k=f.sy,l=e.pos.x-(f.pos.x-h*f.xw),m=e.pos.y-(f.pos.y+d*f.yw),p=l*-k+m*j;if(p*h*i>0){var q=Math.sqrt(l*l+m*m),r=e.radius-q;if(r>0)return l/=q,m/=q,e.reportCollisionVsWorld(l*r,m*r,l,m,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var n=l*j+m*k,r=e.radius-Math.abs(n);if(r>0)return e.reportCollisionVsWorld(j*r,k*r,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else if(0===d){if(0>h*c)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=f.sx,k=f.sy,l=e.pos.x-(f.pos.x+c*f.xw),m=e.pos.y-(f.pos.y-i*f.yw),p=l*-k+m*j;if(0>p*h*i){var q=Math.sqrt(l*l+m*m),r=e.radius-q;if(r>0)return l/=q,m/=q,e.reportCollisionVsWorld(l*r,m*r,l,m,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var n=l*j+m*k,r=e.radius-Math.abs(n);if(r>0)return e.reportCollisionVsWorld(j*r,k*r,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(h*c+i*d>0)return Phaser.Physics.Ninja.Circle.COL_NONE;var s=f.pos.x+c*f.xw,t=f.pos.y+d*f.yw,u=e.pos.x-s,v=e.pos.y-t,q=Math.sqrt(u*u+v*v),r=e.radius-q;if(r>0)return 0===q?(u=c/Math.SQRT2,v=d/Math.SQRT2):(u/=q,v/=q),e.reportCollisionVsWorld(u*r,v*r,u,v,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Concave:function(a,b,c,d,e,f){var g,h=f.signx,i=f.signy;if(0===c){if(0===d){var j=f.pos.x+h*f.xw-e.pos.x,k=f.pos.y+i*f.yw-e.pos.y,l=2*f.xw,m=Math.sqrt(l*l+0),n=Math.sqrt(j*j+k*k),o=n+e.radius-m;return o>0?(b>a?(g=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(g=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1)),o>g?(e.reportCollisionVsWorld(a,b,a/g,b/g,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(j/=n,k/=n,e.reportCollisionVsWorld(j*o,k*o,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER)):Phaser.Physics.Ninja.Circle.COL_NONE}if(0>i*d)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var p=f.pos.x-h*f.xw,q=f.pos.y+d*f.yw,r=e.pos.x-p,s=e.pos.y-q,n=Math.sqrt(r*r+s*s),o=e.radius-n;if(o>0)return 0===n?(r=0,s=d):(r/=n,s/=n),e.reportCollisionVsWorld(r*o,s*o,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(0===d){if(0>h*c)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var p=f.pos.x+c*f.xw,q=f.pos.y-i*f.yw,r=e.pos.x-p,s=e.pos.y-q,n=Math.sqrt(r*r+s*s),o=e.radius-n;if(o>0)return 0===n?(r=c,s=0):(r/=n,s/=n),e.reportCollisionVsWorld(r*o,s*o,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{if(h*c+i*d>0)return Phaser.Physics.Ninja.Circle.COL_NONE;var p=f.pos.x+c*f.xw,q=f.pos.y+d*f.yw,r=e.pos.x-p,s=e.pos.y-q,n=Math.sqrt(r*r+s*s),o=e.radius-n;if(o>0)return 0===n?(r=c/Math.SQRT2,s=d/Math.SQRT2):(r/=n,s/=n),e.reportCollisionVsWorld(r*o,s*o,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Convex:function(a,b,c,d,e,f){var g,h=f.signx,i=f.signy;if(0===c)if(0===d){var j=e.pos.x-(f.pos.x-h*f.xw),k=e.pos.y-(f.pos.y-i*f.yw),l=2*f.xw,m=Math.sqrt(l*l+0),n=Math.sqrt(j*j+k*k),o=m+e.radius-n;if(o>0)return b>a?(g=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(g=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1)),o>g?(e.reportCollisionVsWorld(a,b,a/g,b/g,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(j/=n,k/=n,e.reportCollisionVsWorld(j*o,k*o,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER)}else{if(0>i*d)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=e.pos.x-(f.pos.x-h*f.xw),k=e.pos.y-(f.pos.y-i*f.yw),l=2*f.xw,m=Math.sqrt(l*l+0),n=Math.sqrt(j*j+k*k),o=m+e.radius-n;if(o>0)return j/=n,k/=n,e.reportCollisionVsWorld(j*o,k*o,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(0===d){if(0>h*c)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=e.pos.x-(f.pos.x-h*f.xw),k=e.pos.y-(f.pos.y-i*f.yw),l=2*f.xw,m=Math.sqrt(l*l+0),n=Math.sqrt(j*j+k*k),o=m+e.radius-n;if(o>0)return j/=n,k/=n,e.reportCollisionVsWorld(j*o,k*o,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(h*c+i*d>0){var j=e.pos.x-(f.pos.x-h*f.xw),k=e.pos.y-(f.pos.y-i*f.yw),l=2*f.xw,m=Math.sqrt(l*l+0),n=Math.sqrt(j*j+k*k),o=m+e.radius-n;if(o>0)return j/=n,k/=n,e.reportCollisionVsWorld(j*o,k*o,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var p=f.pos.x+c*f.xw,q=f.pos.y+d*f.yw,r=e.pos.x-p,s=e.pos.y-q,n=Math.sqrt(r*r+s*s),o=e.radius-n;if(o>0)return 0===n?(r=c/Math.SQRT2,s=d/Math.SQRT2):(r/=n,s/=n),e.reportCollisionVsWorld(r*o,s*o,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Half:function(a,b,c,d,e,f){var g=f.signx,h=f.signy,i=c*g+d*h;if(i>0)return Phaser.Physics.Ninja.Circle.COL_NONE;if(0===c)if(0===d){var j=e.radius,k=e.pos.x-g*j-f.pos.x,l=e.pos.y-h*j-f.pos.y,m=g,n=h,o=k*m+l*n;if(0>o){m*=-o,n*=-o;var p=Math.sqrt(m*m+n*n),q=Math.sqrt(a*a+b*b);return p>q?(e.reportCollisionVsWorld(a,b,a/q,b/q,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(m,n,f.signx,f.signy),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0!==i)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var r=e.pos.x-f.pos.x;if(0>r*g)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var s=e.pos.y-(f.pos.y+d*f.yw),t=Math.sqrt(r*r+s*s),u=e.radius-t;if(u>0)return 0===t?(r=g/Math.SQRT2,s=d/Math.SQRT2):(r/=t,s/=t),e.reportCollisionVsWorld(r*u,s*u,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else if(0===d){if(0!==i)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var s=e.pos.y-f.pos.y;if(0>s*h)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var r=e.pos.x-(f.pos.x+c*f.xw),t=Math.sqrt(r*r+s*s),u=e.radius-t;if(u>0)return 0===t?(r=g/Math.SQRT2,s=d/Math.SQRT2):(r/=t,s/=t),e.reportCollisionVsWorld(r*u,s*u,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var v=f.pos.x+c*f.xw,w=f.pos.y+d*f.yw,r=e.pos.x-v,s=e.pos.y-w,t=Math.sqrt(r*r+s*s),u=e.radius-t;if(u>0)return 0===t?(r=c/Math.SQRT2,s=d/Math.SQRT2):(r/=t,s/=t),e.reportCollisionVsWorld(r*u,s*u,r,s,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegS:function(a,b,c,d,e,f){var g,h=f.signx,i=f.signy;if(i*d>0)return Phaser.Physics.Ninja.Circle.COL_NONE;if(0===c){if(0!==d)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=f.sx,k=f.sy,l=e.radius,m=e.pos.x-(f.pos.x-h*f.xw),n=e.pos.y-f.pos.y,o=m*-k+n*j;if(o*h*i>0){var p=Math.sqrt(m*m+n*n),q=l-p;if(q>0)return m/=p,n/=p,e.reportCollisionVsWorld(m*q,n*q,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{m-=l*j,n-=l*k;var r=m*j+n*k;if(0>r){j*=-r,k*=-r;var s=Math.sqrt(j*j+k*k);return b>a?(g=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(g=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1)),s>g?(e.reportCollisionVsWorld(a,b,a/g,b/g,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(j,k,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER)}}}else if(0===d)if(0>h*c){var t=f.pos.x-h*f.xw,u=f.pos.y,v=e.pos.x-t,w=e.pos.y-u;if(0>w*i)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var p=Math.sqrt(v*v+w*w),q=e.radius-p;if(q>0)return 0===p?(v=c/Math.SQRT2,w=d/Math.SQRT2):(v/=p,w/=p),e.reportCollisionVsWorld(v*q,w*q,v,w,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var j=f.sx,k=f.sy,m=e.pos.x-(f.pos.x+c*f.xw),n=e.pos.y-(f.pos.y-i*f.yw),o=m*-k+n*j;if(0>o*h*i){var p=Math.sqrt(m*m+n*n),q=e.radius-p;if(q>0)return m/=p,n/=p,e.reportCollisionVsWorld(m*q,n*q,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var r=m*j+n*k,q=e.radius-Math.abs(r);if(q>0)return e.reportCollisionVsWorld(j*q,k*q,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var t=f.pos.x+c*f.xw,u=f.pos.y+d*f.yw,v=e.pos.x-t,w=e.pos.y-u,p=Math.sqrt(v*v+w*w),q=e.radius-p;if(q>0)return 0===p?(v=c/Math.SQRT2,w=d/Math.SQRT2):(v/=p,w/=p),e.reportCollisionVsWorld(v*q,w*q,v,w,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegB:function(a,b,c,d,e,f){var g,h=f.signx,i=f.signy;if(0===c)if(0===d){var j=f.sx,k=f.sy,l=e.radius,m=e.pos.x-j*l-(f.pos.x-h*f.xw),n=e.pos.y-k*l-(f.pos.y+i*f.yw),o=m*j+n*k;if(0>o){j*=-o,k*=-o;var p=Math.sqrt(j*j+k*k);return b>a?(g=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(g=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1)),p>g?(e.reportCollisionVsWorld(a,b,a/g,b/g,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(j,k,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0>i*d)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=f.sx,k=f.sy,m=e.pos.x-(f.pos.x-h*f.xw),n=e.pos.y-(f.pos.y+i*f.yw),q=m*-k+n*j;if(q*h*i>0){var r=Math.sqrt(m*m+n*n),s=e.radius-r;if(s>0)return m/=r,n/=r,e.reportCollisionVsWorld(m*s,n*s,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var o=m*j+n*k,s=e.radius-Math.abs(o);if(s>0)return e.reportCollisionVsWorld(j*s,k*s,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else if(0===d){if(0>h*c)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var m=e.pos.x-(f.pos.x+h*f.xw),n=e.pos.y-f.pos.y;if(0>n*i)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=f.sx,k=f.sy,q=m*-k+n*j;if(0>q*h*i){var r=Math.sqrt(m*m+n*n),s=e.radius-r;if(s>0)return m/=r,n/=r,e.reportCollisionVsWorld(m*s,n*s,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var o=m*j+n*k,s=e.radius-Math.abs(o);if(s>0)return e.reportCollisionVsWorld(j*s,k*s,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(h*c+i*d>0){var t=Math.sqrt(5),j=1*h/t,k=2*i/t,l=e.radius,m=e.pos.x-j*l-(f.pos.x-h*f.xw),n=e.pos.y-k*l-(f.pos.y+i*f.yw),o=m*j+n*k;return 0>o?(e.reportCollisionVsWorld(-j*o,-k*o,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER):Phaser.Physics.Ninja.Circle.COL_NONE}var u=f.pos.x+c*f.xw,v=f.pos.y+d*f.yw,w=e.pos.x-u,x=e.pos.y-v,r=Math.sqrt(w*w+x*x),s=e.radius-r;if(s>0)return 0===r?(w=c/Math.SQRT2,x=d/Math.SQRT2):(w/=r,x/=r),e.reportCollisionVsWorld(w*s,x*s,w,x,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegS:function(a,b,c,d,e,f){var g=f.signx,h=f.signy;if(g*c>0)return Phaser.Physics.Ninja.Circle.COL_NONE;if(0===c)if(0===d){var i,j=f.sx,k=f.sy,l=e.radius,m=e.pos.x-f.pos.x,n=e.pos.y-(f.pos.y-h*f.yw),o=m*-k+n*j;if(0>o*g*h){var p=Math.sqrt(m*m+n*n),q=l-p;if(q>0)return m/=p,n/=p,e.reportCollisionVsWorld(m*q,n*q,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{m-=l*j,n-=l*k;var r=m*j+n*k;if(0>r){j*=-r,k*=-r;var s=Math.sqrt(j*j+k*k);return b>a?(i=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(i=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1)),s>i?(e.reportCollisionVsWorld(a,b,a/i,b/i,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(j,k,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER)}}}else if(0>h*d){var t=f.pos.x,u=f.pos.y-h*f.yw,v=e.pos.x-t,w=e.pos.y-u;if(0>v*g)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var p=Math.sqrt(v*v+w*w),q=e.radius-p;if(q>0)return 0===p?(v=c/Math.SQRT2,w=d/Math.SQRT2):(v/=p,w/=p),e.reportCollisionVsWorld(v*q,w*q,v,w,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var j=f.sx,k=f.sy,m=e.pos.x-(f.pos.x-g*f.xw),n=e.pos.y-(f.pos.y+d*f.yw),o=m*-k+n*j;if(o*g*h>0){var p=Math.sqrt(m*m+n*n),q=e.radius-p;if(q>0)return m/=p,n/=p,e.reportCollisionVsWorld(m*q,n*q,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var r=m*j+n*k,q=e.radius-Math.abs(r);if(q>0)return e.reportCollisionVsWorld(j*q,k*q,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(0===d)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var t=f.pos.x+c*f.xw,u=f.pos.y+d*f.yw,v=e.pos.x-t,w=e.pos.y-u,p=Math.sqrt(v*v+w*w),q=e.radius-p;if(q>0)return 0===p?(v=c/Math.SQRT2,w=d/Math.SQRT2):(v/=p,w/=p),e.reportCollisionVsWorld(v*q,w*q,v,w,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegB:function(a,b,c,d,e,f){var g=f.signx,h=f.signy;if(0===c)if(0===d){var i,j=f.sx,k=f.sy,l=e.radius,m=e.pos.x-j*l-(f.pos.x+g*f.xw),n=e.pos.y-k*l-(f.pos.y-h*f.yw),o=m*j+n*k;if(0>o){j*=-o,k*=-o;var p=Math.sqrt(j*j+k*k);return b>a?(i=a,b=0,e.pos.x-f.pos.x<0&&(a*=-1)):(i=b,a=0,e.pos.y-f.pos.y<0&&(b*=-1)),p>i?(e.reportCollisionVsWorld(a,b,a/i,b/i,f),Phaser.Physics.Ninja.Circle.COL_AXIS):(e.reportCollisionVsWorld(j,k,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER)}}else{if(0>h*d)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var m=e.pos.x-f.pos.x,n=e.pos.y-(f.pos.y+h*f.yw);if(0>m*g)return e.reportCollisionVsWorld(0,b*d,0,d,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var j=f.sx,k=f.sy,q=m*-k+n*j;if(q*g*h>0){var r=Math.sqrt(m*m+n*n),s=e.radius-r;if(s>0)return m/=r,n/=r,e.reportCollisionVsWorld(m*s,n*s,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var o=m*j+n*k,s=e.radius-Math.abs(o);if(s>0)return e.reportCollisionVsWorld(j*s,k*s,j,k,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else if(0===d){if(0>g*c)return e.reportCollisionVsWorld(a*c,0,c,0,f),Phaser.Physics.Ninja.Circle.COL_AXIS;var t=Math.sqrt(5),j=2*g/t,k=1*h/t,m=e.pos.x-(f.pos.x+g*f.xw),n=e.pos.y-(f.pos.y-h*f.yw),q=m*-k+n*j;if(0>q*g*h){var r=Math.sqrt(m*m+n*n),s=e.radius-r;if(s>0)return m/=r,n/=r,e.reportCollisionVsWorld(m*s,n*s,m,n,f),Phaser.Physics.Ninja.Circle.COL_OTHER}else{var o=m*j+n*k,s=e.radius-Math.abs(o);if(s>0)return e.reportCollisionVsWorld(j*s,k*s,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER}}else{if(g*c+h*d>0){var j=f.sx,k=f.sy,l=e.radius,m=e.pos.x-j*l-(f.pos.x+g*f.xw),n=e.pos.y-k*l-(f.pos.y-h*f.yw),o=m*j+n*k;return 0>o?(e.reportCollisionVsWorld(-j*o,-k*o,f.sx,f.sy,f),Phaser.Physics.Ninja.Circle.COL_OTHER):Phaser.Physics.Ninja.Circle.COL_NONE}var u=f.pos.x+c*f.xw,v=f.pos.y+d*f.yw,w=e.pos.x-u,x=e.pos.y-v,r=Math.sqrt(w*w+x*x),s=e.radius-r;if(s>0)return 0===r?(w=c/Math.SQRT2,x=d/Math.SQRT2):(w/=r,x/=r),e.reportCollisionVsWorld(w*s,x*s,w,x,f),Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE},destroy:function(){this.body=null,this.system=null},render:function(a,b,c,d,e){var f=this.pos.x-b,g=this.pos.y-c;a.beginPath(),a.arc(f,g,this.radius,0,2*Math.PI,!1),e?(a.fillStyle=d,a.fill()):(a.strokeStyle=d,a.stroke())}},!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("p2",function(){return this.p2=a()}()):"undefined"!=typeof window?window.p2=a():"undefined"!=typeof global?self.p2=a():"undefined"!=typeof self&&(self.p2=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){if(!d)var d=1e-6;if(!e)var e="undefined"!=typeof Float32Array?Float32Array:Array;var f={};f.setMatrixArrayType=function(a){e=a},"undefined"!=typeof c&&(c.glMatrix=f);var g={};g.create=function(){var a=new e(2);return a[0]=0,a[1]=0,a},g.clone=function(a){var b=new e(2);return b[0]=a[0],b[1]=a[1],b},g.fromValues=function(a,b){var c=new e(2);return c[0]=a,c[1]=b,c},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},g.set=function(a,b,c){return a[0]=b,a[1]=c,a},g.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},g.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},g.sub=g.subtract,g.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},g.mul=g.multiply,g.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},g.div=g.divide,g.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},g.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},g.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},g.dist=g.distance,g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},g.sqrDist=g.squaredDistance,g.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},g.len=g.length,g.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},g.sqrLen=g.squaredLength,g.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},g.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},g.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},g.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},g.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},g.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},g.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},g.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},g.forEach=function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;i>h;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),g.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof c&&(c.vec2=g)},{}],2:[function(a,b){function c(){}var d=a("./Scalar");b.exports=c,c.lineInt=function(a,b,c){c=c||0;var e,f,g,h,i,j,k,l=[0,0];return e=a[1][1]-a[0][1],f=a[0][0]-a[1][0],g=e*a[0][0]+f*a[0][1],h=b[1][1]-b[0][1],i=b[0][0]-b[1][0],j=h*b[0][0]+i*b[0][1],k=e*i-h*f,d.eq(k,0,c)||(l[0]=(i*g-f*j)/k,l[1]=(e*j-h*g)/k),l},c.segmentsIntersect=function(a,b,c,d){var e=b[0]-a[0],f=b[1]-a[1],g=d[0]-c[0],h=d[1]-c[1];if(g*f-h*e==0)return!1;var i=(e*(c[1]-a[1])+f*(a[0]-c[0]))/(g*f-h*e),j=(g*(a[1]-c[1])+h*(c[0]-a[0]))/(h*e-g*f);return i>=0&&1>=i&&j>=0&&1>=j}},{"./Scalar":5}],3:[function(a,b){function c(){}b.exports=c,c.area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])},c.left=function(a,b,d){return c.area(a,b,d)>0},c.leftOn=function(a,b,d){return c.area(a,b,d)>=0},c.right=function(a,b,d){return c.area(a,b,d)<0},c.rightOn=function(a,b,d){return c.area(a,b,d)<=0};var d=[],e=[];c.collinear=function(a,b,f,g){if(g){var h=d,i=e;h[0]=b[0]-a[0],h[1]=b[1]-a[1],i[0]=f[0]-b[0],i[1]=f[1]-b[1];var j=h[0]*i[0]+h[1]*i[1],k=Math.sqrt(h[0]*h[0]+h[1]*h[1]),l=Math.sqrt(i[0]*i[0]+i[1]*i[1]),m=Math.acos(j/(k*l));return g>m}return 0==c.area(a,b,f)},c.sqdist=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d}},{}],4:[function(a,b){function c(){this.vertices=[]}function d(a,b,c,d,e){e=e||0;var f=b[1]-a[1],h=a[0]-b[0],i=f*a[0]+h*a[1],j=d[1]-c[1],k=c[0]-d[0],l=j*c[0]+k*c[1],m=f*k-j*h;return g.eq(m,0,e)?[0,0]:[(k*i-h*l)/m,(f*l-j*i)/m]}var e=a("./Line"),f=a("./Point"),g=a("./Scalar");b.exports=c,c.prototype.at=function(a){var b=this.vertices,c=b.length;return b[0>a?a%c+c:a%c]},c.prototype.first=function(){return this.vertices[0]},c.prototype.last=function(){return this.vertices[this.vertices.length-1]},c.prototype.clear=function(){this.vertices.length=0},c.prototype.append=function(a,b,c){if("undefined"==typeof b)throw new Error("From is not given!");if("undefined"==typeof c)throw new Error("To is not given!");if(b>c-1)throw new Error("lol1");if(c>a.vertices.length)throw new Error("lol2");if(0>b)throw new Error("lol3");for(var d=b;c>d;d++)this.vertices.push(a.vertices[d])},c.prototype.makeCCW=function(){for(var a=0,b=this.vertices,c=1;c<this.vertices.length;++c)(b[c][1]<b[a][1]||b[c][1]==b[a][1]&&b[c][0]>b[a][0])&&(a=c);f.left(this.at(a-1),this.at(a),this.at(a+1))||this.reverse()},c.prototype.reverse=function(){for(var a=[],b=0,c=this.vertices.length;b!==c;b++)a.push(this.vertices.pop());this.vertices=a},c.prototype.isReflex=function(a){return f.right(this.at(a-1),this.at(a),this.at(a+1))};var h=[],i=[];c.prototype.canSee=function(a,b){var c,d,g=h,j=i;if(f.leftOn(this.at(a+1),this.at(a),this.at(b))&&f.rightOn(this.at(a-1),this.at(a),this.at(b)))return!1;d=f.sqdist(this.at(a),this.at(b));for(var k=0;k!==this.vertices.length;++k)if((k+1)%this.vertices.length!==a&&k!==a&&f.leftOn(this.at(a),this.at(b),this.at(k+1))&&f.rightOn(this.at(a),this.at(b),this.at(k))&&(g[0]=this.at(a),g[1]=this.at(b),j[0]=this.at(k),j[1]=this.at(k+1),c=e.lineInt(g,j),f.sqdist(this.at(a),c)<d))return!1;return!0},c.prototype.copy=function(a,b,d){var e=d||new c;if(e.clear(),b>a)for(var f=a;b>=f;f++)e.vertices.push(this.vertices[f]);else{for(var f=0;b>=f;f++)e.vertices.push(this.vertices[f]);for(var f=a;f<this.vertices.length;f++)e.vertices.push(this.vertices[f])}return e},c.prototype.getCutEdges=function(){for(var a=[],b=[],d=[],e=new c,f=Number.MAX_VALUE,g=0;g<this.vertices.length;++g)if(this.isReflex(g))for(var h=0;h<this.vertices.length;++h)if(this.canSee(g,h)){b=this.copy(g,h,e).getCutEdges(),d=this.copy(h,g,e).getCutEdges();for(var i=0;i<d.length;i++)b.push(d[i]);b.length<f&&(a=b,f=b.length,a.push([this.at(g),this.at(h)]))}return a},c.prototype.decomp=function(){var a=this.getCutEdges();return a.length>0?this.slice(a):[this]},c.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var b=[this],c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e],g=f.slice(d);if(g){b.splice(e,1),b.push(g[0],g[1]);break}}return b}var d=a,c=this.vertices.indexOf(d[0]),e=this.vertices.indexOf(d[1]);return-1!=c&&-1!=e?[this.copy(c,e),this.copy(e,c)]:!1},c.prototype.isSimple=function(){for(var a=this.vertices,b=0;b<a.length-1;b++)for(var c=0;b-1>c;c++)if(e.segmentsIntersect(a[b],a[b+1],a[c],a[c+1]))return!1;for(var b=1;b<a.length-2;b++)if(e.segmentsIntersect(a[0],a[a.length-1],a[b],a[b+1]))return!1;return!0},c.prototype.quickDecomp=function(a,b,e,g,h,i){h=h||100,i=i||0,g=g||25,a="undefined"!=typeof a?a:[],b=b||[],e=e||[];var j=[0,0],k=[0,0],l=[0,0],m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=new c,u=new c,v=this,w=this.vertices;if(w.length<3)return a;if(i++,i>h)return console.warn("quickDecomp: max level ("+h+") reached."),a;for(var x=0;x<this.vertices.length;++x)if(v.isReflex(x)){b.push(v.vertices[x]),m=n=Number.MAX_VALUE;for(var y=0;y<this.vertices.length;++y)f.left(v.at(x-1),v.at(x),v.at(y))&&f.rightOn(v.at(x-1),v.at(x),v.at(y-1))&&(l=d(v.at(x-1),v.at(x),v.at(y),v.at(y-1)),f.right(v.at(x+1),v.at(x),l)&&(o=f.sqdist(v.vertices[x],l),n>o&&(n=o,k=l,r=y))),f.left(v.at(x+1),v.at(x),v.at(y+1))&&f.rightOn(v.at(x+1),v.at(x),v.at(y))&&(l=d(v.at(x+1),v.at(x),v.at(y),v.at(y+1)),f.left(v.at(x-1),v.at(x),l)&&(o=f.sqdist(v.vertices[x],l),m>o&&(m=o,j=l,q=y)));if(r==(q+1)%this.vertices.length)l[0]=(k[0]+j[0])/2,l[1]=(k[1]+j[1])/2,e.push(l),q>x?(t.append(v,x,q+1),t.vertices.push(l),u.vertices.push(l),0!=r&&u.append(v,r,v.vertices.length),u.append(v,0,x+1)):(0!=x&&t.append(v,x,v.vertices.length),t.append(v,0,q+1),t.vertices.push(l),u.vertices.push(l),u.append(v,r,x+1));else{if(r>q&&(q+=this.vertices.length),p=Number.MAX_VALUE,r>q)return a;for(var y=r;q>=y;++y)f.leftOn(v.at(x-1),v.at(x),v.at(y))&&f.rightOn(v.at(x+1),v.at(x),v.at(y))&&(o=f.sqdist(v.at(x),v.at(y)),p>o&&(p=o,s=y%this.vertices.length));s>x?(t.append(v,x,s+1),0!=s&&u.append(v,s,w.length),u.append(v,0,x+1)):(0!=x&&t.append(v,x,w.length),t.append(v,0,s+1),u.append(v,s,x+1))}return t.vertices.length<u.vertices.length?(t.quickDecomp(a,b,e,g,h,i),u.quickDecomp(a,b,e,g,h,i)):(u.quickDecomp(a,b,e,g,h,i),t.quickDecomp(a,b,e,g,h,i)),a}return a.push(this),a},c.prototype.removeCollinearPoints=function(a){for(var b=0,c=this.vertices.length-1;this.vertices.length>3&&c>=0;--c)f.collinear(this.at(c-1),this.at(c),this.at(c+1),a)&&(this.vertices.splice(c%this.vertices.length,1),c--,b++);return b}},{"./Line":2,"./Point":3,"./Scalar":5}],5:[function(a,b){function c(){}b.exports=c,c.eq=function(a,b,c){return c=c||0,Math.abs(a-b)<c}},{}],6:[function(a,b){b.exports={Polygon:a("./Polygon"),Point:a("./Point")}},{"./Point":3,"./Polygon":4}],7:[function(a,b){b.exports={name:"p2",version:"0.5.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","z-schema":"~2.4.6"},dependencies:{"poly-decomp":"0.1.0","gl-matrix":"2.1.0"}}},{}],8:[function(a,b){function c(a){this.lowerBound=d.create(),a&&a.lowerBound&&d.copy(this.lowerBound,a.lowerBound),this.upperBound=d.create(),a&&a.upperBound&&d.copy(this.upperBound,a.upperBound)}{var d=a("../math/vec2");a("../utils/Utils")}b.exports=c;var e=d.create();c.prototype.setFromPoints=function(a,b,c){var f=this.lowerBound,g=this.upperBound;d.set(f,Number.MAX_VALUE,Number.MAX_VALUE),d.set(g,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var h=0;h<a.length;h++){var i=a[h];"number"==typeof c&&(d.rotate(e,i,c),i=e);for(var j=0;2>j;j++)i[j]>g[j]&&(g[j]=i[j]),i[j]<f[j]&&(f[j]=i[j])}b&&(d.add(this.lowerBound,this.lowerBound,b),d.add(this.upperBound,this.upperBound,b))},c.prototype.copy=function(a){d.copy(this.lowerBound,a.lowerBound),d.copy(this.upperBound,a.upperBound)},c.prototype.extend=function(a){for(var b=0;2>b;b++)a.lowerBound[b]<this.lowerBound[b]&&(this.lowerBound[b]=a.lowerBound[b]),a.upperBound[b]>this.upperBound[b]&&(this.upperBound[b]=a.upperBound[b])},c.prototype.overlaps=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return(d[0]<=c[0]&&c[0]<=e[0]||b[0]<=e[0]&&e[0]<=c[0])&&(d[1]<=c[1]&&c[1]<=e[1]||b[1]<=e[1]&&e[1]<=c[1])}},{"../math/vec2":30,"../utils/Utils":47}],9:[function(a,b){function c(a){this.type=a,this.result=[],this.world=null,this.boundingVolumeType=c.AABB}var d=a("../math/vec2"),e=a("../objects/Body");b.exports=c,c.AABB=1,c.BOUNDING_CIRCLE=2,c.prototype.setWorld=function(a){this.world=a},c.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var f=d.create();c.boundingRadiusCheck=function(a,b){d.sub(f,a.position,b.position);var c=d.squaredLength(f),e=a.boundingRadius+b.boundingRadius;return e*e>=c},c.aabbCheck=function(a,b){return a.aabbNeedsUpdate&&a.updateAABB(),b.aabbNeedsUpdate&&b.updateAABB(),a.aabb.overlaps(b.aabb)},c.prototype.boundingVolumeCheck=function(a,b){var d;switch(this.boundingVolumeType){case c.BOUNDING_CIRCLE:d=c.boundingRadiusCheck(a,b);break;case c.AABB:d=c.aabbCheck(a,b);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return d},c.canCollide=function(a,b){return a.motionState===e.STATIC&&b.motionState===e.STATIC?!1:a.motionState===e.KINEMATIC&&b.motionState===e.STATIC||a.motionState===e.STATIC&&b.motionState===e.KINEMATIC?!1:a.motionState===e.KINEMATIC&&b.motionState===e.KINEMATIC?!1:a.sleepState===e.SLEEPING&&b.sleepState===e.SLEEPING?!1:a.sleepState===e.SLEEPING&&b.motionState===e.STATIC||b.sleepState===e.SLEEPING&&a.motionState===e.STATIC?!1:!0},c.NAIVE=1,c.SAP=2},{"../math/vec2":30,"../objects/Body":31}],10:[function(a,b){function c(a){d.apply(this),a=e.defaults(a,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10}),this.xmin=a.xmin,this.ymin=a.ymin,this.xmax=a.xmax,this.ymax=a.ymax,this.nx=a.nx,this.ny=a.ny,this.binsizeX=(this.xmax-this.xmin)/this.nx,this.binsizeY=(this.ymax-this.ymin)/this.ny}var d=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Particle"),a("../collision/Broadphase")),e=(a("../math/vec2"),a("../utils/Utils"));b.exports=c,c.prototype=new d,c.prototype.getCollisionPairs=function(a){for(var b=[],c=a.bodies,e=c.length,f=(this.binsizeX,this.binsizeY,this.nx),g=this.ny,h=this.xmin,i=this.ymin,j=this.xmax,k=this.ymax,l=[],m=f*g,n=0;m>n;n++)l.push([]);for(var o=f/(j-h),p=g/(k-i),n=0;n!==e;n++)for(var q=c[n],r=q.aabb,s=Math.max(r.lowerBound[0],h),t=Math.max(r.lowerBound[1],i),u=Math.min(r.upperBound[0],j),v=Math.min(r.upperBound[1],k),w=Math.floor(o*(s-h)),x=Math.floor(p*(t-i)),y=Math.floor(o*(u-h)),z=Math.floor(p*(v-i)),A=w;y>=A;A++)for(var B=x;z>=B;B++){var C=A,D=B,E=C*(g-1)+D;E>=0&&m>E&&l[E].push(q)}for(var n=0;n!==m;n++)for(var F=l[n],A=0,G=F.length;A!==G;A++)for(var q=F[A],B=0;B!==A;B++){var H=F[B];d.canCollide(q,H)&&this.boundingVolumeCheck(q,H)&&b.push(q,H)}return b}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../utils/Utils":47}],11:[function(a,b){function c(){d.call(this,d.NAIVE)}{var d=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2")}b.exports=c,c.prototype=new d,c.prototype.getCollisionPairs=function(a){var b=a.bodies,c=this.result;c.length=0;for(var e=0,f=b.length;e!==f;e++)for(var g=b[e],h=0;e>h;h++){var i=b[h];d.canCollide(g,i)&&this.boundingVolumeCheck(g,i)&&c.push(g,i)}return c}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Shape":42}],12:[function(a,b){function c(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[],this.restitution=0,this.stiffness=l.DEFAULT_STIFFNESS,this.relaxation=l.DEFAULT_RELAXATION,this.frictionStiffness=l.DEFAULT_STIFFNESS,this.frictionRelaxation=l.DEFAULT_RELAXATION,this.collidingBodiesLastStep=new k}function d(a,b){f.set(a.vertices[0],.5*-b.length,-b.radius),f.set(a.vertices[1],.5*b.length,-b.radius),f.set(a.vertices[2],.5*b.length,b.radius),f.set(a.vertices[3],.5*-b.length,b.radius)}function e(a,b,c,d){for(var e=R,i=S,j=T,k=U,l=a,m=b.vertices,n=null,o=0;o!==m.length+1;o++){var p=m[o%m.length],q=m[(o+1)%m.length];f.rotate(e,p,d),f.rotate(i,q,d),h(e,e,c),h(i,i,c),g(j,e,l),g(k,i,l);var r=f.crossLength(j,k);if(null===n&&(n=r),0>=r*n)return!1;n=r}return!0}var f=a("../math/vec2"),g=f.sub,h=f.add,i=f.dot,j=a("../utils/Utils"),k=a("../utils/TupleDictionary"),l=a("../equations/Equation"),m=a("../equations/ContactEquation"),n=a("../equations/FrictionEquation"),o=a("../shapes/Circle"),p=a("../shapes/Convex"),q=a("../shapes/Shape"),r=(a("../objects/Body"),a("../shapes/Rectangle"));b.exports=c;var s=f.fromValues(0,1),t=f.fromValues(0,0),u=f.fromValues(0,0),v=f.fromValues(0,0),w=f.fromValues(0,0),x=f.fromValues(0,0),y=f.fromValues(0,0),z=f.fromValues(0,0),A=f.fromValues(0,0),B=f.fromValues(0,0),C=f.fromValues(0,0),D=f.fromValues(0,0),E=f.fromValues(0,0),F=f.fromValues(0,0),G=f.fromValues(0,0),H=f.fromValues(0,0),I=f.fromValues(0,0),J=f.fromValues(0,0),K=f.fromValues(0,0),L=[];c.prototype.collidedLastStep=function(a,b){var c=0|a.id,d=0|b.id;return!!this.collidingBodiesLastStep.get(c,d)},c.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var a=0;a!==this.contactEquations.length;a++){var b=this.contactEquations[a],c=0|b.bodyA.id,d=0|b.bodyB.id;this.collidingBodiesLastStep.set(c,d,!0)}if(this.reuseObjects){var e=this.contactEquations,f=this.frictionEquations,g=this.reusableFrictionEquations,h=this.reusableContactEquations;j.appendArray(h,e),j.appendArray(g,f)}this.contactEquations.length=this.frictionEquations.length=0},c.prototype.createContactEquation=function(a,b,c,d){var e=this.reusableContactEquations.length?this.reusableContactEquations.pop():new m(a,b); return e.bodyA=a,e.bodyB=b,e.shapeA=c,e.shapeB=d,e.restitution=this.restitution,e.firstImpact=!this.collidedLastStep(a,b),e.stiffness=this.stiffness,e.relaxation=this.relaxation,e.needsUpdate=!0,e.enabled=!0,e},c.prototype.createFrictionEquation=function(a,b,c,d){var e=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new n(a,b);return e.bodyA=a,e.bodyB=b,e.shapeA=c,e.shapeB=d,e.setSlipForce(this.slipForce),e.frictionCoefficient=this.frictionCoefficient,e.relativeVelocity=this.surfaceVelocity,e.enabled=!0,e.needsUpdate=!0,e.stiffness=this.frictionStiffness,e.relaxation=this.frictionRelaxation,e},c.prototype.createFrictionFromContact=function(a){var b=this.createFrictionEquation(a.bodyA,a.bodyB,a.shapeA,a.shapeB);return f.copy(b.contactPointA,a.contactPointA),f.copy(b.contactPointB,a.contactPointB),f.rotate90cw(b.t,a.normalA),b.contactEquation=a,b},c.prototype[q.LINE|q.CONVEX]=c.prototype.convexLine=function(a,b,c,d,e,f,g,h,i){return i?!1:0},c.prototype[q.LINE|q.RECTANGLE]=c.prototype.lineRectangle=function(a,b,c,d,e,f,g,h,i){return i?!1:0};var M=new r(1,1),N=f.create();c.prototype[q.CAPSULE|q.CONVEX]=c.prototype[q.CAPSULE|q.RECTANGLE]=c.prototype.convexCapsule=function(a,b,c,e,g,h,i,j,k){var l=N;f.set(l,h.length/2,0),f.rotate(l,l,j),f.add(l,l,i);var m=this.circleConvex(g,h,l,j,a,b,c,e,k,h.radius);f.set(l,-h.length/2,0),f.rotate(l,l,j),f.add(l,l,i);var n=this.circleConvex(g,h,l,j,a,b,c,e,k,h.radius);if(k&&(m||n))return!0;var o=M;d(o,h);var p=this.convexConvex(a,b,c,e,g,o,i,j,k);return p+m+n},c.prototype[q.CAPSULE|q.LINE]=c.prototype.lineCapsule=function(a,b,c,d,e,f,g,h,i){return i?!1:0};var O=f.create(),P=f.create(),Q=new r(1,1);c.prototype[q.CAPSULE|q.CAPSULE]=c.prototype.capsuleCapsule=function(a,b,c,e,g,h,i,j,k){for(var l=O,m=P,n=0,o=0;2>o;o++){f.set(l,(0==o?-1:1)*b.length/2,0),f.rotate(l,l,e),f.add(l,l,c);for(var p=0;2>p;p++){f.set(m,(0==p?-1:1)*h.length/2,0),f.rotate(m,m,j),f.add(m,m,i);var q=this.circleCircle(a,b,l,e,g,h,m,j,k,b.radius,h.radius);if(k&&q)return!0;n+=q}}var r=Q;d(r,b);var s=this.convexCapsule(a,r,c,e,g,h,i,j,k);if(k&&s)return!0;n+=s,d(r,h);var t=this.convexCapsule(g,r,i,j,a,b,c,e,k);return k&&t?!0:n+=t},c.prototype[q.LINE|q.LINE]=c.prototype.lineLine=function(a,b,c,d,e,f,g,h,i){return i?!1:0},c.prototype[q.PLANE|q.LINE]=c.prototype.planeLine=function(a,b,c,d,e,j,k,l,m){var n=t,o=u,p=v,q=w,r=x,C=y,D=z,E=A,F=B,G=L;numContacts=0,f.set(n,-j.length/2,0),f.set(o,j.length/2,0),f.rotate(p,n,l),f.rotate(q,o,l),h(p,p,k),h(q,q,k),f.copy(n,p),f.copy(o,q),g(r,o,n),f.normalize(C,r),f.rotate90cw(F,C),f.rotate(E,s,d),G[0]=n,G[1]=o;for(var H=0;H<G.length;H++){var I=G[H];g(D,I,c);var J=i(D,E);if(0>J){if(m)return!0;var K=this.createContactEquation(a,e,b,j);numContacts++,f.copy(K.normalA,E),f.normalize(K.normalA,K.normalA),f.scale(D,E,J),g(K.contactPointA,I,D),g(K.contactPointA,K.contactPointA,a.position),g(K.contactPointB,I,k),h(K.contactPointB,K.contactPointB,k),g(K.contactPointB,K.contactPointB,e.position),this.contactEquations.push(K),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(K))}}return numContacts},c.prototype[q.PARTICLE|q.CAPSULE]=c.prototype.particleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius,0)},c.prototype[q.CIRCLE|q.LINE]=c.prototype.circleLine=function(a,b,c,d,e,j,k,l,m,n,o){var p=j,q=l,r=e,s=k,H=c,I=a,J=b,n=n||0,o="undefined"!=typeof o?o:J.radius,K=t,M=u,N=v,O=w,P=x,Q=y,R=z,S=A,T=B,U=C,V=D,W=E,X=F,Y=G,Z=L;f.set(S,-p.length/2,0),f.set(T,p.length/2,0),f.rotate(U,S,q),f.rotate(V,T,q),h(U,U,s),h(V,V,s),f.copy(S,U),f.copy(T,V),g(Q,T,S),f.normalize(R,Q),f.rotate90cw(P,R),g(W,H,S);var $=i(W,P);if(g(O,S,s),g(X,H,s),Math.abs($)<o+n){f.scale(K,P,$),g(N,H,K),f.scale(M,P,i(P,X)),f.normalize(M,M),f.scale(M,M,n),h(N,N,M);var _=i(R,N),ab=i(R,S),bb=i(R,T);if(_>ab&&bb>_){if(m)return!0;var cb=this.createContactEquation(I,r,b,j);return f.scale(cb.normalA,K,-1),f.normalize(cb.normalA,cb.normalA),f.scale(cb.contactPointA,cb.normalA,o),h(cb.contactPointA,cb.contactPointA,H),g(cb.contactPointA,cb.contactPointA,I.position),g(cb.contactPointB,N,s),h(cb.contactPointB,cb.contactPointB,s),g(cb.contactPointB,cb.contactPointB,r.position),this.contactEquations.push(cb),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(cb)),1}}Z[0]=S,Z[1]=T;for(var db=0;db<Z.length;db++){var eb=Z[db];if(g(W,eb,H),f.squaredLength(W)<(o+n)*(o+n)){if(m)return!0;var cb=this.createContactEquation(I,r,b,j);return f.copy(cb.normalA,W),f.normalize(cb.normalA,cb.normalA),f.scale(cb.contactPointA,cb.normalA,o),h(cb.contactPointA,cb.contactPointA,H),g(cb.contactPointA,cb.contactPointA,I.position),g(cb.contactPointB,eb,s),f.scale(Y,cb.normalA,-n),h(cb.contactPointB,cb.contactPointB,Y),h(cb.contactPointB,cb.contactPointB,s),g(cb.contactPointB,cb.contactPointB,r.position),this.contactEquations.push(cb),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(cb)),1}}return 0},c.prototype[q.CIRCLE|q.CAPSULE]=c.prototype.circleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius)},c.prototype[q.CIRCLE|q.CONVEX]=c.prototype[q.CIRCLE|q.RECTANGLE]=c.prototype.circleConvex=function(a,b,c,d,i,j,k,l,m,n){var o=j,p=l,q=i,r=k,s=c,y=a,z=b,n="number"==typeof n?n:z.radius,A=t,B=u,E=v,J=w,K=x,L=C,M=D,N=F,O=G,P=H,Q=I,R=!1,S=Number.MAX_VALUE;verts=o.vertices;for(var T=0;T!==verts.length+1;T++){var U=verts[T%verts.length],V=verts[(T+1)%verts.length];if(f.rotate(A,U,p),f.rotate(B,V,p),h(A,A,r),h(B,B,r),g(E,B,A),f.normalize(J,E),f.rotate90cw(K,J),f.scale(O,K,-z.radius),h(O,O,s),e(O,o,r,p)){f.sub(P,A,O);var W=Math.abs(f.dot(P,K));S>W&&(f.copy(Q,O),S=W,f.scale(N,K,W),f.add(N,N,O),R=!0)}}if(R){if(m)return!0;var X=this.createContactEquation(y,q,b,j);return f.sub(X.normalA,Q,s),f.normalize(X.normalA,X.normalA),f.scale(X.contactPointA,X.normalA,n),h(X.contactPointA,X.contactPointA,s),g(X.contactPointA,X.contactPointA,y.position),g(X.contactPointB,N,r),h(X.contactPointB,X.contactPointB,r),g(X.contactPointB,X.contactPointB,q.position),this.contactEquations.push(X),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(X)),1}if(n>0)for(var T=0;T<verts.length;T++){var Y=verts[T];if(f.rotate(M,Y,p),h(M,M,r),g(L,M,s),f.squaredLength(L)<n*n){if(m)return!0;var X=this.createContactEquation(y,q,b,j);return f.copy(X.normalA,L),f.normalize(X.normalA,X.normalA),f.scale(X.contactPointA,X.normalA,n),h(X.contactPointA,X.contactPointA,s),g(X.contactPointA,X.contactPointA,y.position),g(X.contactPointB,M,r),h(X.contactPointB,X.contactPointB,r),g(X.contactPointB,X.contactPointB,q.position),this.contactEquations.push(X),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(X)),1}}return 0};var R=f.create(),S=f.create(),T=f.create(),U=f.create();c.prototype[q.PARTICLE|q.CONVEX]=c.prototype[q.PARTICLE|q.RECTANGLE]=c.prototype.particleConvex=function(a,b,c,d,j,k,l,m,n){var o=k,p=m,q=j,r=l,s=c,A=a,B=t,D=u,E=v,G=w,H=x,I=y,L=z,M=C,N=F,O=J,P=K,Q=Number.MAX_VALUE,R=!1,S=o.vertices;if(!e(s,o,r,p))return 0;if(n)return!0;for(var T=0;T!==S.length+1;T++){var U=S[T%S.length],V=S[(T+1)%S.length];f.rotate(B,U,p),f.rotate(D,V,p),h(B,B,r),h(D,D,r),g(E,D,B),f.normalize(G,E),f.rotate90cw(H,G),g(M,s,B);{i(M,H)}g(I,B,r),g(L,s,r),f.sub(O,B,s);var W=Math.abs(f.dot(O,H));Q>W&&(Q=W,f.scale(N,H,W),f.add(N,N,s),f.copy(P,H),R=!0)}if(R){var X=this.createContactEquation(A,q,b,k);return f.scale(X.normalA,P,-1),f.normalize(X.normalA,X.normalA),f.set(X.contactPointA,0,0),h(X.contactPointA,X.contactPointA,s),g(X.contactPointA,X.contactPointA,A.position),g(X.contactPointB,N,r),h(X.contactPointB,X.contactPointB,r),g(X.contactPointB,X.contactPointB,q.position),this.contactEquations.push(X),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(X)),1}return 0},c.prototype[q.CIRCLE]=c.prototype.circleCircle=function(a,b,c,d,e,i,j,k,l,m,n){var o=a,p=b,q=c,r=e,s=i,u=j,v=t,m=m||p.radius,n=n||s.radius;g(v,c,j);var w=m+n;if(f.squaredLength(v)>w*w)return 0;if(l)return!0;var x=this.createContactEquation(o,r,b,i);return g(x.normalA,u,q),f.normalize(x.normalA,x.normalA),f.scale(x.contactPointA,x.normalA,m),f.scale(x.contactPointB,x.normalA,-n),h(x.contactPointA,x.contactPointA,q),g(x.contactPointA,x.contactPointA,o.position),h(x.contactPointB,x.contactPointB,u),g(x.contactPointB,x.contactPointB,r.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),1},c.prototype[q.PLANE|q.CONVEX]=c.prototype[q.PLANE|q.RECTANGLE]=c.prototype.planeConvex=function(a,b,d,e,j,k,l,m,n){var o=j,p=l,q=k,r=m,w=a,x=b,y=d,z=e,A=t,B=u,C=v,D=0;f.rotate(B,s,z);for(var E=0;E<q.vertices.length;E++){var F=q.vertices[E];if(f.rotate(A,F,r),h(A,A,p),g(C,A,y),i(C,B)<=c.convexPrecision){if(n)return!0;D++;var G=this.createContactEquation(w,o,x,q);g(C,A,y),f.copy(G.normalA,B);var H=i(C,G.normalA);f.scale(C,G.normalA,H),g(G.contactPointB,A,o.position),g(G.contactPointA,A,C),g(G.contactPointA,G.contactPointA,w.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G))}}return D},c.prototype.convexPlane=function(a,b,c,d,e,f,g,h,i){return console.warn("Narrowphase.prototype.convexPlane is deprecated. Use planeConvex instead!"),this.planeConvex(e,f,g,h,a,b,c,d,i)},c.prototype[q.PARTICLE|q.PLANE]=c.prototype.particlePlane=function(a,b,c,d,e,h,j,k,l){var m=a,n=c,o=e,p=j,q=k,r=t,v=u;q=q||0,g(r,n,p),f.rotate(v,s,q);var w=i(r,v);if(w>0)return 0;if(l)return!0;var x=this.createContactEquation(o,m,h,b);return f.copy(x.normalA,v),f.scale(r,x.normalA,w),g(x.contactPointA,n,r),g(x.contactPointA,x.contactPointA,o.position),g(x.contactPointB,n,m.position),this.contactEquations.push(x),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x)),1},c.prototype[q.CIRCLE|q.PARTICLE]=c.prototype.circleParticle=function(a,b,c,d,e,i,j,k,l){var m=a,n=b,o=c,p=e,q=j,r=t;if(g(r,q,o),f.squaredLength(r)>n.radius*n.radius)return 0;if(l)return!0;var s=this.createContactEquation(m,p,b,i);return f.copy(s.normalA,r),f.normalize(s.normalA,s.normalA),f.scale(s.contactPointA,s.normalA,n.radius),h(s.contactPointA,s.contactPointA,o),g(s.contactPointA,s.contactPointA,m.position),g(s.contactPointB,q,p.position),this.contactEquations.push(s),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(s)),1};{var V=new o(1),W=f.create(),X=f.create();f.create()}c.prototype[q.PLANE|q.CAPSULE]=c.prototype.planeCapsule=function(a,b,c,d,e,g,i,j,k){var l=W,m=X,n=V;f.set(l,-g.length/2,0),f.rotate(l,l,j),h(l,l,i),f.set(m,g.length/2,0),f.rotate(m,m,j),h(m,m,i),n.radius=g.radius;var o=this.circlePlane(e,n,l,0,a,b,c,d,k),p=this.circlePlane(e,n,m,0,a,b,c,d,k);return k?o||p:o+p},c.prototype.capsulePlane=function(a,b,c,d,e,f,g,h,i){return console.warn("Narrowphase.prototype.capsulePlane() is deprecated. Use .planeCapsule() instead!"),this.planeCapsule(e,f,g,h,a,b,c,d,i)},c.prototype[q.CIRCLE|q.PLANE]=c.prototype.circlePlane=function(a,b,c,d,e,j,k,l,m){var n=a,o=b,p=c,q=e,r=k,w=l;w=w||0;var x=t,y=u,z=v;g(x,p,r),f.rotate(y,s,w);var A=i(y,x);if(A>o.radius)return 0;if(m)return!0;var B=this.createContactEquation(q,n,j,b);return f.copy(B.normalA,y),f.scale(B.contactPointB,B.normalA,-o.radius),h(B.contactPointB,B.contactPointB,p),g(B.contactPointB,B.contactPointB,n.position),f.scale(z,B.normalA,A),g(B.contactPointA,x,z),h(B.contactPointA,B.contactPointA,r),g(B.contactPointA,B.contactPointA,q.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B)),1},c.convexPrecision=1e-7,c.prototype[q.CONVEX]=c.prototype[q.CONVEX|q.RECTANGLE]=c.prototype[q.RECTANGLE]=c.prototype.convexConvex=function(a,b,d,e,j,k,l,m,n,o){var p=t,q=u,r=v,s=w,y=x,C=z,D=A,E=B,F=0,o=o||c.convexPrecision,G=c.findSeparatingAxis(b,d,e,k,l,m,p);if(!G)return 0;g(D,l,d),i(p,D)>0&&f.scale(p,p,-1);var H=c.getClosestEdge(b,e,p,!0),I=c.getClosestEdge(k,m,p);if(-1===H||-1===I)return 0;for(var J=0;2>J;J++){var K=H,L=I,M=b,N=k,O=d,P=l,Q=e,R=m,S=a,T=j;if(0===J){var U;U=K,K=L,L=U,U=M,M=N,N=U,U=O,O=P,P=U,U=Q,Q=R,R=U,U=S,S=T,T=U}for(var V=L;L+2>V;V++){var W=N.vertices[(V+N.vertices.length)%N.vertices.length];f.rotate(q,W,R),h(q,q,P);for(var X=0,Y=K-1;K+2>Y;Y++){var Z=M.vertices[(Y+M.vertices.length)%M.vertices.length],$=M.vertices[(Y+1+M.vertices.length)%M.vertices.length];f.rotate(r,Z,Q),f.rotate(s,$,Q),h(r,r,O),h(s,s,O),g(y,s,r),f.rotate90cw(E,y),f.normalize(E,E),g(D,q,r);var _=i(E,D);o>=_&&X++}if(X>=3){if(n)return!0;var ab=this.createContactEquation(S,T,M,N);F++;var Z=M.vertices[K%M.vertices.length],$=M.vertices[(K+1)%M.vertices.length];f.rotate(r,Z,Q),f.rotate(s,$,Q),h(r,r,O),h(s,s,O),g(y,s,r),f.rotate90cw(ab.normalA,y),f.normalize(ab.normalA,ab.normalA),g(D,q,r);var _=i(ab.normalA,D);f.scale(C,ab.normalA,_),g(ab.contactPointA,q,O),g(ab.contactPointA,ab.contactPointA,C),h(ab.contactPointA,ab.contactPointA,O),g(ab.contactPointA,ab.contactPointA,S.position),g(ab.contactPointB,q,P),h(ab.contactPointB,ab.contactPointB,P),g(ab.contactPointB,ab.contactPointB,T.position),this.contactEquations.push(ab),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ab))}}}return F};var Y=f.fromValues(0,0);c.projectConvexOntoAxis=function(a,b,c,d,e){var g,h,j=null,k=null,l=Y;f.rotate(l,d,-c);for(var m=0;m<a.vertices.length;m++)g=a.vertices[m],h=i(g,l),(null===j||h>j)&&(j=h),(null===k||k>h)&&(k=h);if(k>j){var n=k;k=j,j=n}var o=i(b,d);f.set(e,k+o,j+o)};var Z=f.fromValues(0,0),$=f.fromValues(0,0),_=f.fromValues(0,0),ab=f.fromValues(0,0),bb=f.fromValues(0,0),cb=f.fromValues(0,0);c.findSeparatingAxis=function(a,b,d,e,h,i,j){for(var k=null,l=!1,m=!1,n=Z,o=$,p=_,q=ab,r=bb,s=cb,t=0;2!==t;t++){var u=a,v=d;1===t&&(u=e,v=i);for(var w=0;w!==u.vertices.length;w++){f.rotate(o,u.vertices[w],v),f.rotate(p,u.vertices[(w+1)%u.vertices.length],v),g(n,p,o),f.rotate90cw(q,n),f.normalize(q,q),c.projectConvexOntoAxis(a,b,d,q,r),c.projectConvexOntoAxis(e,h,i,q,s);var x=r,y=s,z=!1;r[0]>s[0]&&(y=r,x=s,z=!0);var A=y[0]-x[1];l=A<=c.convexPrecision,(null===k||A>k)&&(f.copy(j,q),k=A,m=l)}}return m};var db=f.fromValues(0,0),eb=f.fromValues(0,0),fb=f.fromValues(0,0);c.getClosestEdge=function(a,b,c,d){var e=db,h=eb,j=fb;f.rotate(e,c,-b),d&&f.scale(e,e,-1);for(var k=-1,l=a.vertices.length,m=0;m!==l;m++){g(h,a.vertices[(m+1)%l],a.vertices[m%l]),f.rotate90cw(j,h),f.normalize(j,j);var n=i(j,e);(-1==k||n>maxDot)&&(k=m%l,maxDot=n)}return k};var gb=f.create(),hb=f.create(),ib=f.create(),jb=f.create(),kb=f.create(),lb=f.create(),mb=f.create();c.prototype[q.CIRCLE|q.HEIGHTFIELD]=c.prototype.circleHeightfield=function(a,b,c,d,e,i,j,k,l,m){var n=i.data,m=m||b.radius,o=i.elementWidth,p=hb,q=gb,r=kb,s=mb,t=lb,u=ib,v=jb,w=Math.floor((c[0]-m-j[0])/o),x=Math.ceil((c[0]+m-j[0])/o);0>w&&(w=0),x>=n.length&&(x=n.length-1);for(var y=n[w],z=n[x],A=w;x>A;A++)n[A]<z&&(z=n[A]),n[A]>y&&(y=n[A]);if(c[1]-m>y)return l?!1:0;c[1]+m<z;for(var B=!1,A=w;x>A;A++){f.set(u,A*o,n[A]),f.set(v,(A+1)*o,n[A+1]),f.add(u,u,j),f.add(v,v,j),f.sub(t,v,u),f.rotate(t,t,Math.PI/2),f.normalize(t,t),f.scale(q,t,-m),f.add(q,q,c),f.sub(p,q,u);var C=f.dot(p,t);if(q[0]>=u[0]&&q[0]<v[0]&&0>=C){if(l)return!0;B=!0,f.scale(p,t,-C),f.add(r,q,p),f.copy(s,t);var D=this.createContactEquation(e,a,i,b);f.copy(D.normalA,s),f.scale(D.contactPointB,D.normalA,-m),h(D.contactPointB,D.contactPointB,c),g(D.contactPointB,D.contactPointB,a.position),f.copy(D.contactPointA,r),f.sub(D.contactPointA,D.contactPointA,e.position),this.contactEquations.push(D),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}if(B=!1,m>0)for(var A=w;x>=A;A++)if(f.set(u,A*o,n[A]),f.add(u,u,j),f.sub(p,c,u),f.squaredLength(p)<m*m){if(l)return!0;B=!0;var D=this.createContactEquation(e,a,i,b);f.copy(D.normalA,p),f.normalize(D.normalA,D.normalA),f.scale(D.contactPointB,D.normalA,-m),h(D.contactPointB,D.contactPointB,c),g(D.contactPointB,D.contactPointB,a.position),g(D.contactPointA,u,j),h(D.contactPointA,D.contactPointA,j),g(D.contactPointA,D.contactPointA,e.position),this.contactEquations.push(D),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}return B?1:0};var nb=f.create(),ob=f.create(),pb=f.create(),qb=new p([f.create(),f.create(),f.create(),f.create()]);c.prototype[q.RECTANGLE|q.HEIGHTFIELD]=c.prototype[q.CONVEX|q.HEIGHTFIELD]=c.prototype.convexHeightfield=function(a,b,c,d,e,g,h,i,j){var k=g.data,l=g.elementWidth,m=nb,n=ob,o=pb,p=qb,q=Math.floor((a.aabb.lowerBound[0]-h[0])/l),r=Math.ceil((a.aabb.upperBound[0]-h[0])/l);0>q&&(q=0),r>=k.length&&(r=k.length-1);for(var s=k[q],t=k[r],u=q;r>u;u++)k[u]<t&&(t=k[u]),k[u]>s&&(s=k[u]);if(a.aabb.lowerBound[1]>s)return j?!1:0;for(var v=0,u=q;r>u;u++){f.set(m,u*l,k[u]),f.set(n,(u+1)*l,k[u+1]),f.add(m,m,h),f.add(n,n,h);var w=100;f.set(o,.5*(n[0]+m[0]),.5*(n[1]+m[1]-w)),f.sub(p.vertices[0],n,o),f.sub(p.vertices[1],m,o),f.copy(p.vertices[2],p.vertices[1]),f.copy(p.vertices[3],p.vertices[0]),p.vertices[2][1]-=w,p.vertices[3][1]-=w,v+=this.convexConvex(a,b,c,d,e,p,o,0,j)}return v}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Rectangle":41,"../shapes/Shape":42,"../utils/TupleDictionary":46,"../utils/Utils":47}],13:[function(a,b){function c(){e.call(this,e.SAP),this.axisList=[],this.world=null,this.axisIndex=0;var a=this.axisList;this._addBodyHandler=function(b){a.push(b.body)},this._removeBodyHandler=function(b){var c=a.indexOf(b.body);-1!==c&&a.splice(c,1)}}var d=a("../utils/Utils"),e=a("../collision/Broadphase");b.exports=c,c.prototype=new e,c.prototype.setWorld=function(a){this.axisList.length=0,d.appendArray(this.axisList,a.bodies),a.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=a},c.sortAxisList=function(a,b){b=0|b;for(var c=1,d=a.length;d>c;c++){for(var e=a[c],f=c-1;f>=0&&!(a[f].aabb.lowerBound[b]<=e.aabb.lowerBound[b]);f--)a[f+1]=a[f];a[f+1]=e}return a},c.prototype.getCollisionPairs=function(){var a=this.axisList,b=this.result,d=this.axisIndex;b.length=0;for(var f=a.length;f--;){var g=a[f];g.aabbNeedsUpdate&&g.updateAABB()}c.sortAxisList(a,d);for(var h=0,i=0|a.length;h!==i;h++)for(var j=a[h],k=h+1;i>k;k++){var l=a[k],m=l.aabb.lowerBound[d]<=j.aabb.upperBound[d];if(!m)break;e.canCollide(j,l)&&this.boundingVolumeCheck(j,l)&&b.push(j,l)}return b}},{"../collision/Broadphase":9,"../utils/Utils":47}],14:[function(a,b){function c(a,b,c,e){this.type=c,e=d.defaults(e,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=b,this.collideConnected=e.collideConnected,e.wakeUpBodies&&(a&&a.wakeUp(),b&&b.wakeUp())}b.exports=c;var d=a("../utils/Utils");c.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},c.DISTANCE=1,c.GEAR=2,c.LOCK=3,c.PRISMATIC=4,c.REVOLUTE=5,c.prototype.setStiffness=function(a){for(var b=this.equations,c=0;c!==b.length;c++){var d=b[c];d.stiffness=a,d.needsUpdate=!0}},c.prototype.setRelaxation=function(a){for(var b=this.equations,c=0;c!==b.length;c++){var d=b[c];d.relaxation=a,d.needsUpdate=!0}}},{"../utils/Utils":47}],15:[function(a,b){function c(a,b,c,g){g=g||{},d.call(this,a,b,d.DISTANCE,g),this.distance=c,this.localAnchorA=f.create(),this.localAnchorB=f.create();var h,i=this.localAnchorA,j=this.localAnchorB;h="undefined"==typeof g.maxForce?Number.MAX_VALUE:g.maxForce;var k=new e(a,b,-h,h);this.equations=[k];var l=f.create(),m=f.create(),n=f.create(),o=this;k.computeGq=function(){{var a=this.bodyA,b=this.bodyB,c=a.position;b.position}return f.rotate(m,i,a.angle),f.rotate(n,j,b.angle),f.add(l,c,n),f.sub(l,l,m),f.sub(l,l,c),f.sub(l,b.position,a.position),f.length(l)-o.distance},this.setMaxForce(h)}var d=a("./Constraint"),e=a("../equations/Equation"),f=a("../math/vec2");b.exports=c,c.prototype=new d;var g=f.create(),h=f.create(),i=f.create();c.prototype.update=function(){var a=this.equations[0],b=this.bodyA,c=this.bodyB,d=(this.distance,b.position,c.position,a.G);f.rotate(h,this.localAnchorA,b.angle),f.rotate(i,this.localAnchorB,c.angle);f.crossLength(h,g),f.crossLength(i,g);f.sub(g,c.position,b.position),f.normalize(g,g),d[0]=-g[0],d[1]=-g[1],d[3]=g[0],d[4]=g[1]},c.prototype.setMaxForce=function(a){var b=this.equations[0];b.minForce=-a,b.maxForce=a},c.prototype.getMaxForce=function(){var a=this.equations[0];return a.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],16:[function(a,b){function c(a,b,c){c=c||{},d.call(this,a,b,d.GEAR,c),this.equations=[new e(a,b,c)],this.angle="number"==typeof c.angle?c.angle:0,this.ratio="number"==typeof c.ratio?c.ratio:1,"number"==typeof c.maxTorque&&this.setMaxTorque(c.maxTorque)}{var d=a("./Constraint"),e=(a("../equations/Equation"),a("../equations/AngleLockEquation"));a("../math/vec2")}b.exports=c,c.prototype=new d,c.prototype.update=function(){var a=this.equations[0];a.ratio!==this.ratio&&a.setRatio(this.ratio),a.angle=this.angle},c.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)},c.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(a,b){function c(a,b,c){c=c||{},d.call(this,a,b,d.LOCK,c);var g="undefined"==typeof c.maxForce?Number.MAX_VALUE:c.maxForce,h=c.localOffsetB||e.fromValues(0,0);h=e.fromValues(h[0],h[1]);var i=c.localAngleB||0,j=new f(a,b,-g,g),k=new f(a,b,-g,g),l=new f(a,b,-g,g),m=e.create(),n=e.create(),o=this;j.computeGq=function(){return e.rotate(m,o.localOffsetB,a.angle),e.sub(n,b.position,a.position),e.sub(n,n,m),n[0]},k.computeGq=function(){return e.rotate(m,o.localOffsetB,a.angle),e.sub(n,b.position,a.position),e.sub(n,n,m),n[1]};var p=e.create(),q=e.create();l.computeGq=function(){return e.rotate(p,o.localOffsetB,b.angle-o.localAngleB),e.scale(p,p,-1),e.sub(n,a.position,b.position),e.add(n,n,p),e.rotate(q,p,-Math.PI/2),e.normalize(q,q),e.dot(n,q)},this.localOffsetB=h,this.localAngleB=i,this.equations.push(j,k,l),this.setMaxForce(g)}var d=a("./Constraint"),e=a("../math/vec2"),f=a("../equations/Equation");b.exports=c,c.prototype=new d,c.prototype.setMaxForce=function(a){for(var b=this.equations,c=0;c<this.equations.length;c++)b[c].maxForce=a,b[c].minForce=-a},c.prototype.getMaxForce=function(){return this.equations[0].maxForce};var g=e.create(),h=e.create(),i=e.create(),j=e.fromValues(1,0),k=e.fromValues(0,1);c.prototype.update=function(){var a=this.equations[0],b=this.equations[1],c=this.equations[2],d=this.bodyA,f=this.bodyB;e.rotate(g,this.localOffsetB,d.angle),e.rotate(h,this.localOffsetB,f.angle-this.localAngleB),e.scale(h,h,-1),e.rotate(i,h,Math.PI/2),e.normalize(i,i),a.G[0]=-1,a.G[1]=0,a.G[2]=-e.crossLength(g,j),a.G[3]=1,b.G[0]=0,b.G[1]=-1,b.G[2]=-e.crossLength(g,k),b.G[4]=1,c.G[0]=-i[0],c.G[1]=-i[1],c.G[3]=i[0],c.G[4]=i[1],c.G[5]=e.crossLength(h,i)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(a,b){function c(a,b,c){c=c||{},d.call(this,a,b,d.PRISMATIC,c);var i=g.fromValues(0,0),j=g.fromValues(1,0),k=g.fromValues(0,0);c.localAnchorA&&g.copy(i,c.localAnchorA),c.localAxisA&&g.copy(j,c.localAxisA),c.localAnchorB&&g.copy(k,c.localAnchorB),this.localAnchorA=i,this.localAnchorB=k,this.localAxisA=j;var l=this.maxForce="undefined"!=typeof c.maxForce?c.maxForce:Number.MAX_VALUE,m=new f(a,b,-l,l),n=new g.create,o=new g.create,p=new g.create,q=new g.create;if(m.computeGq=function(){return g.dot(p,q)},m.updateJacobian=function(){var c=this.G,d=a.position,e=b.position;g.rotate(n,i,a.angle),g.rotate(o,k,b.angle),g.add(p,e,o),g.sub(p,p,d),g.sub(p,p,n),g.rotate(q,j,a.angle+Math.PI/2),c[0]=-q[0],c[1]=-q[1],c[2]=-g.crossLength(n,q)+g.crossLength(q,p),c[3]=q[0],c[4]=q[1],c[5]=g.crossLength(o,q)},this.equations.push(m),!c.disableRotationalLock){var r=new h(a,b,-l,l);this.equations.push(r)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof c.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof c.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof c.lowerLimit?c.lowerLimit:0,this.upperLimit="undefined"!=typeof c.upperLimit?c.upperLimit:1,this.upperLimitEquation=new e(a,b),this.lowerLimitEquation=new e(a,b),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=l,this.motorEquation=new f(a,b),this.motorEnabled=!1,this.motorSpeed=0;{var s=this,t=this.motorEquation;t.computeGW}t.computeGq=function(){return 0},t.computeGW=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.velocity,e=c.velocity,f=b.angularVelocity,g=c.angularVelocity;return this.transformedGmult(a,d,f,e,g)+s.motorSpeed}}var d=a("./Constraint"),e=a("../equations/ContactEquation"),f=a("../equations/Equation"),g=a("../math/vec2"),h=a("../equations/RotationalLockEquation");b.exports=c,c.prototype=new d;var i=g.create(),j=g.create(),k=g.create(),l=g.create(),m=g.create(),n=g.create();c.prototype.update=function(){var a=this.equations,b=a[0],c=this.upperLimit,d=this.lowerLimit,e=this.upperLimitEquation,f=this.lowerLimitEquation,h=this.bodyA,o=this.bodyB,p=this.localAxisA,q=this.localAnchorA,r=this.localAnchorB;b.updateJacobian(),g.rotate(i,p,h.angle),g.rotate(l,q,h.angle),g.add(j,l,h.position),g.rotate(m,r,o.angle),g.add(k,m,o.position);var s=this.position=g.dot(k,i)-g.dot(j,i);if(this.motorEnabled){var t=this.motorEquation.G;t[0]=i[0],t[1]=i[1],t[2]=g.crossLength(i,m),t[3]=-i[0],t[4]=-i[1],t[5]=-g.crossLength(i,l)}if(this.upperLimitEnabled&&s>c)g.scale(e.normalA,i,-1),g.sub(e.contactPointA,j,h.position),g.sub(e.contactPointB,k,o.position),g.scale(n,i,c),g.add(e.contactPointA,e.contactPointA,n),-1==a.indexOf(e)&&a.push(e);else{var u=a.indexOf(e);-1!=u&&a.splice(u,1)}if(this.lowerLimitEnabled&&d>s)g.scale(f.normalA,i,1),g.sub(f.contactPointA,j,h.position),g.sub(f.contactPointB,k,o.position),g.scale(n,i,d),g.sub(f.contactPointB,f.contactPointB,n),-1==a.indexOf(f)&&a.push(f);else{var u=a.indexOf(f);-1!=u&&a.splice(u,1)}},c.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},c.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1),this.motorEnabled=!1}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(a,b){function c(a,b,c,n,o){o=o||{},d.call(this,a,c,d.REVOLUTE,o);var p=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE;this.pivotA=h.fromValues(b[0],b[1]),this.pivotB=h.fromValues(n[0],n[1]);var q=this.equations=[new e(a,c,-p,p),new e(a,c,-p,p)],r=q[0],s=q[1],t=this;r.computeGq=function(){return h.rotate(i,t.pivotA,a.angle),h.rotate(j,t.pivotB,c.angle),h.add(m,c.position,j),h.sub(m,m,a.position),h.sub(m,m,i),h.dot(m,k)},s.computeGq=function(){return h.rotate(i,t.pivotA,a.angle),h.rotate(j,t.pivotB,c.angle),h.add(m,c.position,j),h.sub(m,m,a.position),h.sub(m,m,i),h.dot(m,l)},s.minForce=r.minForce=-p,s.maxForce=r.maxForce=p,this.motorEquation=new f(a,c),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new g(a,c),this.lowerLimitEquation=new g(a,c),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var d=a("./Constraint"),e=a("../equations/Equation"),f=a("../equations/RotationalVelocityEquation"),g=a("../equations/RotationalLockEquation"),h=a("../math/vec2");b.exports=c;var i=h.create(),j=h.create(),k=h.fromValues(1,0),l=h.fromValues(0,1),m=h.create();c.prototype=new d,c.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.pivotA,d=this.pivotB,e=this.equations,f=(e[0],e[1],e[0]),g=e[1],m=this.upperLimit,n=this.lowerLimit,o=this.upperLimitEquation,p=this.lowerLimitEquation,q=this.angle=b.angle-a.angle;if(this.upperLimitEnabled&&q>m)o.angle=m,-1==e.indexOf(o)&&e.push(o);else{var r=e.indexOf(o);-1!=r&&e.splice(r,1)}if(this.lowerLimitEnabled&&n>q)p.angle=n,-1==e.indexOf(p)&&e.push(p);else{var r=e.indexOf(p);-1!=r&&e.splice(r,1)}h.rotate(i,c,a.angle),h.rotate(j,d,b.angle),f.G[0]=-1,f.G[1]=0,f.G[2]=-h.crossLength(i,k),f.G[3]=1,f.G[4]=0,f.G[5]=h.crossLength(j,k),g.G[0]=0,g.G[1]=-1,g.G[2]=-h.crossLength(i,l),g.G[3]=0,g.G[4]=1,g.G[5]=h.crossLength(j,l)},c.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},c.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1),this.motorEnabled=!1}},c.prototype.motorIsEnabled=function(){return!!this.motorEnabled},c.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var b=this.equations.indexOf(this.motorEquation);this.equations[b].relativeVelocity=a}},c.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(a,b){function c(a,b,c){c=c||{},d.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=c.angle||0,this.ratio="number"==typeof c.ratio?c.ratio:1,this.setRatio(this.ratio)}{var d=a("./Equation");a("../math/vec2")}b.exports=c,c.prototype=new d,c.prototype.constructor=c,c.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},c.prototype.setRatio=function(a){var b=this.G;b[2]=a,b[5]=-1,this.ratio=a},c.prototype.setMaxTorque=function(a){this.maxForce=a,this.minForce=-a}},{"../math/vec2":30,"./Equation":22}],21:[function(a,b){function c(a,b){d.call(this,a,b,0,Number.MAX_VALUE),this.contactPointA=e.create(),this.penetrationVec=e.create(),this.contactPointB=e.create(),this.normalA=e.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var d=a("./Equation"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.constructor=c,c.prototype.computeB=function(a,b,c){var d=this.bodyA,f=this.bodyB,g=this.contactPointA,h=this.contactPointB,i=d.position,j=f.position,k=this.penetrationVec,l=this.normalA,m=this.G,n=e.crossLength(g,l),o=e.crossLength(h,l);m[0]=-l[0],m[1]=-l[1],m[2]=-n,m[3]=l[0],m[4]=l[1],m[5]=o,e.add(k,j,h),e.sub(k,k,i),e.sub(k,k,g);var p,q;this.firstImpact&&0!==this.restitution?(q=0,p=1/b*(1+this.restitution)*this.computeGW()):(q=e.dot(l,k),p=this.computeGW());var r=this.computeGiMf(),s=-q*a-p*b-c*r;return s}},{"../math/vec2":30,"./Equation":22}],22:[function(a,b){function c(a,b,d,e){this.minForce="undefined"==typeof d?-Number.MAX_VALUE:d,this.maxForce="undefined"==typeof e?Number.MAX_VALUE:e,this.bodyA=a,this.bodyB=b,this.stiffness=c.DEFAULT_STIFFNESS,this.relaxation=c.DEFAULT_RELAXATION,this.G=new h.ARRAY_TYPE(6);for(var f=0;6>f;f++)this.G[f]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}function d(a,b,c,d,e){return a[0]*b[0]+a[1]*b[1]+a[2]*c+a[3]*d[0]+a[4]*d[1]+a[5]*e}function e(a){return a.sleepState===i.SLEEPING?0:a.invMass}function f(a){return a.sleepState===i.SLEEPING?0:a.invInertia}b.exports=c;var g=a("../math/vec2"),h=a("../utils/Utils"),i=a("../objects/Body");c.prototype.constructor=c,c.DEFAULT_STIFFNESS=1e6,c.DEFAULT_RELAXATION=4,c.prototype.update=function(){var a=this.stiffness,b=this.relaxation,c=this.timeStep;this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.epsilon=4/(c*c*a*(1+4*b)),this.needsUpdate=!1},c.prototype.computeB=function(a,b,c){var d=this.computeGW(),e=this.computeGq(),f=this.computeGiMf();return-e*a-d*b-f*c};var j=g.create(),k=g.create();c.prototype.computeGq=function(){var a=this.G,b=this.bodyA,c=this.bodyB,e=(b.position,c.position,b.angle),f=c.angle;return d(a,j,e,k,f)+this.offset },c.prototype.computeGW=function(){var a=this.G,b=this.bodyA,c=this.bodyB,e=b.velocity,f=c.velocity,g=b.angularVelocity,h=c.angularVelocity;return d(a,e,g,f,h)+this.relativeVelocity},c.prototype.computeGWlambda=function(){var a=this.G,b=this.bodyA,c=this.bodyB,e=b.vlambda,f=c.vlambda,g=b.wlambda,h=c.wlambda;return d(a,e,g,f,h)};var l=g.create(),m=g.create();c.prototype.computeGiMf=function(){var a=this.bodyA,b=this.bodyB,c=a.force,h=a.angularForce,i=b.force,j=b.angularForce,k=e(a),n=e(b),o=f(a),p=f(b),q=this.G;return g.scale(l,c,k),g.scale(m,i,n),d(q,l,h*o,m,j*p)},c.prototype.computeGiMGt=function(){var a=this.bodyA,b=this.bodyB,c=e(a),d=e(b),g=f(a),h=f(b),i=this.G;return i[0]*i[0]*c+i[1]*i[1]*c+i[2]*i[2]*g+i[3]*i[3]*d+i[4]*i[4]*d+i[5]*i[5]*h};{var n=g.create(),o=g.create(),p=g.create();g.create(),g.create(),g.create()}c.prototype.addToWlambda=function(a){var b=this.bodyA,c=this.bodyB,d=n,h=o,i=p,j=e(b),k=e(c),l=f(b),m=f(c),q=this.G;h[0]=q[0],h[1]=q[1],i[0]=q[3],i[1]=q[4],g.scale(d,h,j*a),g.add(b.vlambda,b.vlambda,d),b.wlambda+=l*q[2]*a,g.scale(d,i,k*a),g.add(c.vlambda,c.vlambda,d),c.wlambda+=m*q[5]*a},c.prototype.computeInvC=function(a){return 1/(this.computeGiMGt()+a)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":47}],23:[function(a,b){function c(a,b,c){e.call(this,a,b,-c,c),this.contactPointA=d.create(),this.contactPointB=d.create(),this.t=d.create(),this.contactEquation=null,this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}{var d=a("../math/vec2"),e=a("./Equation");a("../utils/Utils")}b.exports=c,c.prototype=new e,c.prototype.constructor=c,c.prototype.setSlipForce=function(a){this.maxForce=a,this.minForce=-a},c.prototype.getSlipForce=function(){return this.maxForce},c.prototype.computeB=function(a,b,c){var e=(this.bodyA,this.bodyB,this.contactPointA),f=this.contactPointB,g=this.t,h=this.G;h[0]=-g[0],h[1]=-g[1],h[2]=-d.crossLength(e,g),h[3]=g[0],h[4]=g[1],h[5]=d.crossLength(f,g);var i=this.computeGW(),j=this.computeGiMf(),k=-i*b-c*j;return k}},{"../math/vec2":30,"../utils/Utils":47,"./Equation":22}],24:[function(a,b){function c(a,b,c){c=c||{},d.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=c.angle||0;var e=this.G;e[2]=1,e[5]=-1}var d=a("./Equation"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.constructor=c;var f=e.create(),g=e.create(),h=e.fromValues(1,0),i=e.fromValues(0,1);c.prototype.computeGq=function(){return e.rotate(f,h,this.bodyA.angle+this.angle),e.rotate(g,i,this.bodyB.angle),e.dot(f,g)}},{"../math/vec2":30,"./Equation":22}],25:[function(a,b){function c(a,b){d.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}{var d=a("./Equation");a("../math/vec2")}b.exports=c,c.prototype=new d,c.prototype.constructor=c,c.prototype.computeB=function(a,b,c){var d=this.G;d[2]=-1,d[5]=this.ratio;var e=this.computeGiMf(),f=this.computeGW(),g=-f*b-c*e;return g}},{"../math/vec2":30,"./Equation":22}],26:[function(a,b){var c=function(){};b.exports=c,c.prototype={constructor:c,on:function(a,b,c){b.context=c||this,void 0===this._listeners&&(this._listeners={});var d=this._listeners;return void 0===d[a]&&(d[a]=[]),-1===d[a].indexOf(b)&&d[a].push(b),this},has:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;if(b){if(void 0!==c[a]&&-1!==c[a].indexOf(b))return!0}else if(void 0!==c[a])return!0;return!1},off:function(a,b){if(void 0===this._listeners)return this;var c=this._listeners,d=c[a].indexOf(b);return-1!==d&&c[a].splice(d,1),this},emit:function(a){if(void 0===this._listeners)return this;var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++){var f=c[d];f.call(f.context,a)}}return this}}},{}],27:[function(a,b){function c(a,b,f){if(f=f||{},!(a instanceof d&&b instanceof d))throw new Error("First two arguments must be Material instances.");this.id=c.idCounter++,this.materialA=a,this.materialB=b,this.friction="undefined"!=typeof f.friction?Number(f.friction):.3,this.restitution="undefined"!=typeof f.restitution?Number(f.restitution):0,this.stiffness="undefined"!=typeof f.stiffness?Number(f.stiffness):e.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof f.relaxation?Number(f.relaxation):e.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof f.frictionStiffness?Number(f.frictionStiffness):e.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof f.frictionRelaxation?Number(f.frictionRelaxation):e.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof f.surfaceVelocity?Number(f.surfaceVelocity):0}var d=a("./Material"),e=a("../equations/Equation");b.exports=c,c.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(a,b){function c(){this.id=c.idCounter++}b.exports=c,c.idCounter=0},{}],29:[function(a,b){var c={};c.GetArea=function(a){if(a.length<6)return 0;for(var b=a.length-2,c=0,d=0;b>d;d+=2)c+=(a[d+2]-a[d])*(a[d+1]+a[d+3]);return c+=(a[0]-a[b])*(a[b+1]+a[1]),.5*-c},c.Triangulate=function(a){var b=a.length>>1;if(3>b)return[];for(var d=[],e=[],f=0;b>f;f++)e.push(f);for(var f=0,g=b;g>3;){var h=e[(f+0)%g],i=e[(f+1)%g],j=e[(f+2)%g],k=a[2*h],l=a[2*h+1],m=a[2*i],n=a[2*i+1],o=a[2*j],p=a[2*j+1],q=!1;if(c._convex(k,l,m,n,o,p)){q=!0;for(var r=0;g>r;r++){var s=e[r];if(s!=h&&s!=i&&s!=j&&c._PointInTriangle(a[2*s],a[2*s+1],k,l,m,n,o,p)){q=!1;break}}}if(q)d.push(h,i,j),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g)break}return d.push(e[0],e[1],e[2]),d},c._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},c._convex=function(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0},b.exports=c},{}],30:[function(a,b){var c=a("../../build/vec2").vec2;c.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},c.crossVZ=function(a,b,d){return c.rotate(a,b,-Math.PI/2),c.scale(a,a,d),a},c.crossZV=function(a,b,d){return c.rotate(a,d,Math.PI/2),c.scale(a,a,b),a},c.rotate=function(a,b,c){var d=Math.cos(c),e=Math.sin(c),f=b[0],g=b[1];a[0]=d*f-e*g,a[1]=e*f+d*g},c.rotate90cw=function(a,b){a[0]=b[1],a[1]=-b[0]},c.toLocalFrame=function(a,b,d,e){c.copy(a,b),c.sub(a,a,d),c.rotate(a,a,-e)},c.toGlobalFrame=function(a,b,d,e){c.copy(a,b),c.rotate(a,a,e),c.add(a,a,d)},c.centroid=function(a,b,d,e){return c.add(a,b,d),c.add(a,a,e),c.scale(a,a,1/3),a},b.exports=c},{"../../build/vec2":1}],31:[function(a,b){function c(a){a=a||{},h.call(this),this.id=++c._idCounter,this.world=null,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=a.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.fixedRotation=!!a.fixedRotation||!1,this.position=d.fromValues(0,0),a.position&&d.copy(this.position,a.position),this.interpolatedPosition=d.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=d.fromValues(0,0),this.previousAngle=0,this.velocity=d.fromValues(0,0),a.velocity&&d.copy(this.velocity,a.velocity),this.vlambda=d.fromValues(0,0),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=d.create(),a.force&&d.copy(this.force,a.force),this.angularForce=a.angularForce||0,this.damping="number"==typeof a.damping?a.damping:.1,this.angularDamping="number"==typeof a.angularDamping?a.angularDamping:.1,this.motionState=0===this.mass?c.STATIC:c.DYNAMIC,this.boundingRadius=0,this.aabb=new g,this.aabbNeedsUpdate=!0,this.allowSleep=!0,this.wantsToSleep=!1,this.sleepState=c.AWAKE,this.sleepSpeedLimit=.2,this.sleepTimeLimit=1,this.gravityScale=1,this.timeLastSleepy=0,this.concavePath=null,this.lastDampingScale=1,this.lastAngularDampingScale=1,this.lastDampingTimeStep=-1,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var d=a("../math/vec2"),e=a("poly-decomp"),f=a("../shapes/Convex"),g=a("../collision/AABB"),h=a("../events/EventEmitter");b.exports=c,c.prototype=new h,c._idCounter=0,c.prototype.setDensity=function(a){var b=this.getArea();this.mass=b*a,this.updateMassProperties()},c.prototype.getArea=function(){for(var a=0,b=0;b<this.shapes.length;b++)a+=this.shapes[b].area;return a};var i=new g,j=d.create();c.prototype.updateAABB=function(){for(var a=this.shapes,b=this.shapeOffsets,c=this.shapeAngles,e=a.length,f=0;f!==e;f++){var g=a[f],h=j,k=c[f]+this.angle;d.rotate(h,b[f],this.angle),d.add(h,h,this.position),g.computeAABB(i,h,k),0===f?this.aabb.copy(i):this.aabb.extend(i)}this.aabbNeedsUpdate=!1},c.prototype.updateBoundingRadius=function(){for(var a=this.shapes,b=this.shapeOffsets,c=a.length,e=0,f=0;f!==c;f++){var g=a[f],h=d.length(b[f]),i=g.boundingRadius;h+i>e&&(e=h+i)}this.boundingRadius=e},c.prototype.addShape=function(a,b,c){c=c||0,b=b?d.fromValues(b[0],b[1]):d.fromValues(0,0),this.shapes.push(a),this.shapeOffsets.push(b),this.shapeAngles.push(c),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},c.prototype.removeShape=function(a){var b=this.shapes.indexOf(a);return-1!==b?(this.shapes.splice(b,1),this.shapeOffsets.splice(b,1),this.shapeAngles.splice(b,1),this.aabbNeedsUpdate=!0,!0):!1},c.prototype.updateMassProperties=function(){if(this.motionState===c.STATIC||this.motionState===c.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var a=this.shapes,b=a.length,e=this.mass/b,f=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var g=0;b>g;g++){var h=a[g],i=d.squaredLength(this.shapeOffsets[g]),j=h.computeMomentOfInertia(e);f+=j+e*i}this.inertia=f,this.invInertia=f>0?1/f:0}this.invMass=1/this.mass}};var k=d.create();c.prototype.applyForce=function(a,b){var c=k;d.sub(c,b,this.position),d.add(this.force,this.force,a);var e=d.crossLength(c,a);this.angularForce+=e},c.prototype.toLocalFrame=function(a,b){d.toLocalFrame(a,b,this.position,this.angle)},c.prototype.toWorldFrame=function(a,b){d.toGlobalFrame(a,b,this.position,this.angle)},c.prototype.fromPolygon=function(a,b){b=b||{};for(var c=this.shapes.length;c>=0;--c)this.removeShape(this.shapes[c]);var g=new e.Polygon;if(g.vertices=a,g.makeCCW(),"number"==typeof b.removeCollinearPoints&&g.removeCollinearPoints(b.removeCollinearPoints),"undefined"==typeof b.skipSimpleCheck&&!g.isSimple())return!1;this.concavePath=g.vertices.slice(0);for(var c=0;c<this.concavePath.length;c++){var h=[0,0];d.copy(h,this.concavePath[c]),this.concavePath[c]=h}var i;i=b.optimalDecomp?g.decomp():g.quickDecomp();for(var j=d.create(),c=0;c!==i.length;c++){for(var k=new f(i[c].vertices),l=0;l!==k.vertices.length;l++){var h=k.vertices[l];d.sub(h,h,k.centerOfMass)}d.scale(j,k.centerOfMass,1),k.updateTriangles(),k.updateCenterOfMass(),k.updateBoundingRadius(),this.addShape(k,j)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var l=(d.fromValues(0,0),d.fromValues(0,0)),m=d.fromValues(0,0),n=d.fromValues(0,0);c.prototype.adjustCenterOfMass=function(){var a=l,b=m,c=n,e=0;d.set(b,0,0);for(var f=0;f!==this.shapes.length;f++){var g=this.shapes[f],h=this.shapeOffsets[f];d.scale(a,h,g.area),d.add(b,b,a),e+=g.area}d.scale(c,b,1/e);for(var f=0;f!==this.shapes.length;f++){var g=this.shapes[f],h=this.shapeOffsets[f];h||(h=this.shapeOffsets[f]=d.create()),d.sub(h,h,c)}d.add(this.position,this.position,c);for(var f=0;this.concavePath&&f<this.concavePath.length;f++)d.sub(this.concavePath[f],this.concavePath[f],c);this.updateMassProperties(),this.updateBoundingRadius()},c.prototype.setZeroForce=function(){d.set(this.force,0,0),this.angularForce=0},c.prototype.resetConstraintVelocity=function(){var a=this,b=a.vlambda;d.set(b,0,0),a.wlambda=0},c.prototype.addConstraintVelocity=function(){var a=this,b=a.velocity;d.add(b,b,a.vlambda),a.angularVelocity+=a.wlambda},c.prototype.applyDamping=function(a){if(this.motionState===c.DYNAMIC){a!==this.lastDampingTimeStep&&(this.lastDampingScale=Math.pow(1-this.damping,a),this.lastAngularDampingScale=Math.pow(1-this.angularDamping,a),this.lastDampingTimeStep=a);var b=this.velocity;d.scale(b,b,this.lastDampingScale),this.angularVelocity*=this.lastAngularDampingScale}},c.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=c.AWAKE,this.idleTime=0,a!==c.AWAKE&&this.emit(c.wakeUpEvent)},c.prototype.sleep=function(){this.sleepState=c.SLEEPING,this.angularVelocity=0,this.angularForce=0,d.set(this.velocity,0,0),d.set(this.force,0,0),this.emit(c.sleepEvent)},c.prototype.sleepTick=function(a,b,e){if(this.allowSleep&&this.motionState!==c.SLEEPING){this.wantsToSleep=!1;var f=(this.sleepState,d.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),g=Math.pow(this.sleepSpeedLimit,2);f>=g?(this.idleTime=0,this.sleepState=c.AWAKE):(this.idleTime+=e,this.sleepState=c.SLEEPY),this.idleTime>this.sleepTimeLimit&&(b?this.wantsToSleep=!0:this.sleep())}},c.prototype.getVelocityFromPosition=function(a,b){return a=a||d.create(),d.sub(a,this.position,this.previousPosition),d.scale(a,a,1/b),a},c.prototype.getAngularVelocityFromPosition=function(a){return(this.angle-this.previousAngle)/a},c.sleepyEvent={type:"sleepy"},c.sleepEvent={type:"sleep"},c.wakeUpEvent={type:"wakeup"},c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4,c.AWAKE=0,c.SLEEPY=1,c.SLEEPING=2},{"../collision/AABB":8,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":36,"poly-decomp":6}],32:[function(a,b){function c(a,b,c){c=e.defaults(c,{restLength:1,stiffness:100,damping:1,localAnchorA:[0,0],localAnchorB:[0,0]}),this.restLength=c.restLength,this.stiffness=c.stiffness,this.damping=c.damping,this.bodyA=a,this.bodyB=b,this.localAnchorA=d.create(),d.copy(this.localAnchorA,c.localAnchorA),this.localAnchorB=d.create(),d.copy(this.localAnchorB,c.localAnchorB),c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA),c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB)}var d=a("../math/vec2"),e=a("../utils/Utils");b.exports=c,c.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)},c.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)},c.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)},c.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var f=d.create(),g=d.create(),h=d.create(),i=d.create(),j=d.create(),k=d.create(),l=d.create(),m=d.create(),n=d.create();c.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,e=this.bodyA,o=this.bodyB,p=f,q=g,r=h,s=i,t=n,u=j,v=k,w=l,x=m;this.getWorldAnchorA(u),this.getWorldAnchorB(v),d.sub(w,u,e.position),d.sub(x,v,o.position),d.sub(p,v,u);var y=d.len(p);d.normalize(q,p),d.sub(r,o.velocity,e.velocity),d.crossZV(t,o.angularVelocity,x),d.add(r,r,t),d.crossZV(t,e.angularVelocity,w),d.sub(r,r,t),d.scale(s,q,-a*(y-c)-b*d.dot(r,q)),d.sub(e.force,e.force,s),d.add(o.force,o.force,s);var z=d.crossLength(w,s),A=d.crossLength(x,s);e.angularForce-=z,o.angularForce+=A}},{"../math/vec2":30,"../utils/Utils":47}],33:[function(a,b){b.exports={AABB:a("./collision/AABB"),AngleLockEquation:a("./equations/AngleLockEquation"),Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./equations/FrictionEquation"),GearConstraint:a("./constraints/GearConstraint"),GridBroadphase:a("./collision/GridBroadphase"),GSSolver:a("./solver/GSSolver"),Heightfield:a("./shapes/Heightfield"),Line:a("./shapes/Line"),LockConstraint:a("./constraints/LockConstraint"),Material:a("./material/Material"),Narrowphase:a("./collision/Narrowphase"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),RevoluteConstraint:a("./constraints/RevoluteConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),Rectangle:a("./shapes/Rectangle"),RotationalVelocityEquation:a("./equations/RotationalVelocityEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),Utils:a("./utils/Utils"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version}},{"../package.json":7,"./collision/AABB":8,"./collision/Broadphase":9,"./collision/GridBroadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/Spring":32,"./shapes/Capsule":34,"./shapes/Circle":35,"./shapes/Convex":36,"./shapes/Heightfield":37,"./shapes/Line":38,"./shapes/Particle":39,"./shapes/Plane":40,"./shapes/Rectangle":41,"./shapes/Shape":42,"./solver/GSSolver":43,"./solver/Solver":44,"./utils/Utils":47,"./world/World":51}],34:[function(a,b){function c(a,b){this.length=a||1,this.radius=b||1,d.call(this,d.CAPSULE)}var d=a("./Shape"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){var b=this.radius,c=this.length+b,d=2*b;return a*(d*d+c*c)/12},c.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},c.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var f=e.create();c.prototype.computeAABB=function(a,b,c){var d=this.radius;e.set(f,this.length,0),e.rotate(f,f,c),e.set(a.upperBound,Math.max(f[0]+d,-f[0]+d),Math.max(f[1]+d,-f[1]+d)),e.set(a.lowerBound,Math.min(f[0]-d,-f[0]-d),Math.min(f[1]-d,-f[1]-d)),e.add(a.lowerBound,a.lowerBound,b),e.add(a.upperBound,a.upperBound,b)}},{"../math/vec2":30,"./Shape":42}],35:[function(a,b){function c(a){this.radius=a||1,d.call(this,d.CIRCLE)}var d=a("./Shape"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){var b=this.radius;return a*b*b/2},c.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},c.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},c.prototype.computeAABB=function(a,b){var c=this.radius;e.set(a.upperBound,c,c),e.set(a.lowerBound,-c,-c),b&&(e.add(a.lowerBound,a.lowerBound,b),e.add(a.upperBound,a.upperBound,b))}},{"../math/vec2":30,"./Shape":42}],36:[function(a,b){function c(a){this.vertices=[];for(var b=0;b<a.length;b++){var c=e.create();e.copy(c,a[b]),this.vertices.push(c)}if(this.centerOfMass=e.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,d.call(this,d.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}{var d=a("./Shape"),e=a("../math/vec2"),f=a("../math/polyk");a("poly-decomp")}b.exports=c,c.prototype=new d,c.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],b=0;b<this.vertices.length;b++){var c=this.vertices[b];a.push(c[0],c[1])}for(var d=f.Triangulate(a),b=0;b<d.length;b+=3){var e=d[b],g=d[b+1],h=d[b+2];this.triangles.push([e,g,h])}};{var g=e.create(),h=e.create(),i=e.create(),j=e.create(),k=e.create();e.create(),e.create(),e.create(),e.create()}c.prototype.updateCenterOfMass=function(){var a=this.triangles,b=this.vertices,d=this.centerOfMass,f=g,l=i,m=j,n=k,o=h;e.set(d,0,0);for(var p=0,q=0;q!==a.length;q++){var r=a[q],l=b[r[0]],m=b[r[1]],n=b[r[2]];e.centroid(f,l,m,n);var s=c.triangleArea(l,m,n);p+=s,e.scale(o,f,s),e.add(d,d,o)}e.scale(d,d,1/p)},c.prototype.computeMomentOfInertia=function(a){for(var b=0,c=0,d=this.vertices.length,f=d-1,g=0;d>g;f=g,g++){var h=this.vertices[f],i=this.vertices[g],j=Math.abs(e.crossLength(h,i)),k=e.dot(i,i)+e.dot(i,h)+e.dot(h,h);b+=j*k,c+=j}return a/6*(b/c)},c.prototype.updateBoundingRadius=function(){for(var a=this.vertices,b=0,c=0;c!==a.length;c++){var d=e.squaredLength(a[c]);d>b&&(b=d)}this.boundingRadius=Math.sqrt(b)},c.triangleArea=function(a,b,c){return.5*((b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]))},c.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var a=this.triangles,b=this.vertices,d=0;d!==a.length;d++){var e=a[d],f=b[e[0]],g=b[e[1]],h=b[e[2]],i=c.triangleArea(f,g,h);this.area+=i}},c.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c)}},{"../math/polyk":29,"../math/vec2":30,"./Shape":42,"poly-decomp":6}],37:[function(a,b){function c(a,b){if(b=e.defaults(b,{maxValue:null,minValue:null,elementWidth:.1}),null===b.minValue||null===b.maxValue){b.maxValue=a[0],b.minValue=a[0];for(var c=0;c!==a.length;c++){var f=a[c];f>b.maxValue&&(b.maxValue=f),f<b.minValue&&(b.minValue=f)}}this.data=a,this.maxValue=b.maxValue,this.minValue=b.minValue,this.elementWidth=b.elementWidth,d.call(this,d.HEIGHTFIELD)}var d=a("./Shape"),e=(a("../math/vec2"),a("../utils/Utils"));b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},c.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},c.prototype.updateArea=function(){for(var a=this.data,b=0,c=0;c<a.length-1;c++)b+=(a[c]+a[c+1])/2*this.elementWidth;this.area=b},c.prototype.computeAABB=function(a,b){a.upperBound[0]=this.elementWidth*this.data.length+b[0],a.upperBound[1]=this.maxValue+b[1],a.lowerBound[0]=b[0],a.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],38:[function(a,b){function c(a){this.length=a||1,d.call(this,d.LINE)}var d=a("./Shape"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12},c.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var f=[e.create(),e.create()];c.prototype.computeAABB=function(a,b,c){var d=this.length;e.set(f[0],-d/2,0),e.set(f[1],d/2,0),a.setFromPoints(f,b,c)}},{"../math/vec2":30,"./Shape":42}],39:[function(a,b){function c(){d.call(this,d.PARTICLE)}var d=a("./Shape"),e=a("../math/vec2");b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return 0},c.prototype.updateBoundingRadius=function(){this.boundingRadius=0},c.prototype.computeAABB=function(a,b){this.length;e.copy(a.lowerBound,b),e.copy(a.upperBound,b)}},{"../math/vec2":30,"./Shape":42}],40:[function(a,b){function c(){d.call(this,d.PLANE)}{var d=a("./Shape"),e=a("../math/vec2");a("../utils/Utils")}b.exports=c,c.prototype=new d,c.prototype.computeMomentOfInertia=function(){return 0},c.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},c.prototype.computeAABB=function(a,b,c){var d=0,f=e.set;"number"==typeof c&&(d=c%(2*Math.PI)),0==d?(f(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),f(a.upperBound,Number.MAX_VALUE,0)):d==Math.PI/2?(f(a.lowerBound,0,-Number.MAX_VALUE),f(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):d==Math.PI?(f(a.lowerBound,-Number.MAX_VALUE,0),f(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):d==3*Math.PI/2?(f(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),f(a.upperBound,0,Number.MAX_VALUE)):(f(a.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),f(a.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)),e.add(a.lowerBound,a.lowerBound,b),e.add(a.upperBound,a.upperBound,b)},c.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],41:[function(a,b){function c(a,b){a=a||1,b=b||1;var c=[d.fromValues(-a/2,-b/2),d.fromValues(a/2,-b/2),d.fromValues(a/2,b/2),d.fromValues(-a/2,b/2)];this.width=a,this.height=b,f.call(this,c),this.type=e.RECTANGLE}var d=a("../math/vec2"),e=a("./Shape"),f=a("./Convex");b.exports=c,c.prototype=new f([]),c.prototype.computeMomentOfInertia=function(a){var b=this.width,c=this.height;return a*(c*c+b*b)/12},c.prototype.updateBoundingRadius=function(){var a=this.width,b=this.height;this.boundingRadius=Math.sqrt(a*a+b*b)/2};d.create(),d.create(),d.create(),d.create();c.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c)},c.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":36,"./Shape":42}],42:[function(a,b){function c(a){this.type=a,this.id=c.idCounter++,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,a&&this.updateBoundingRadius(),this.material=null,this.area=0,this.sensor=!1,this.updateArea()}b.exports=c,c.idCounter=0,c.CIRCLE=1,c.PARTICLE=2,c.PLANE=4,c.CONVEX=8,c.LINE=16,c.RECTANGLE=32,c.CAPSULE=64,c.HEIGHTFIELD=128,c.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},c.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")},c.prototype.updateArea=function(){},c.prototype.computeAABB=function(){}},{}],43:[function(a,b){function c(a){f.call(this,a,f.GS),a=a||{},this.iterations=a.iterations||10,this.tolerance=a.tolerance||1e-10,this.arrayStep=30,this.lambda=new g.ARRAY_TYPE(this.arrayStep),this.Bs=new g.ARRAY_TYPE(this.arrayStep),this.invCs=new g.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function d(a){for(var b=a.length;b--;)a[b]=0}var e=a("../math/vec2"),f=a("./Solver"),g=a("../utils/Utils"),h=a("../equations/FrictionEquation");b.exports=c,c.prototype=new f,c.prototype.solve=function(a,b){this.sortEquations();var f=0,i=this.iterations,j=this.frictionIterations,k=this.equations,l=k.length,m=Math.pow(this.tolerance*l,2),n=b.bodies,o=b.bodies.length,p=(e.add,e.set,this.useZeroRHS),q=this.lambda;this.usedIterations=0,q.length<l&&(q=this.lambda=new g.ARRAY_TYPE(l+this.arrayStep),this.Bs=new g.ARRAY_TYPE(l+this.arrayStep),this.invCs=new g.ARRAY_TYPE(l+this.arrayStep)),d(q);for(var r=this.invCs,s=this.Bs,q=this.lambda,t=0;t!==k.length;t++){var u=k[t];(u.timeStep!==a||u.needsUpdate)&&(u.timeStep=a,u.update()),s[t]=u.computeB(u.a,u.b,a),r[t]=u.computeInvC(u.epsilon)}var u,v,t,w;if(0!==l){for(t=0;t!==o;t++)n[t].resetConstraintVelocity();if(j){for(f=0;f!==j;f++){for(v=0,w=0;w!==l;w++){u=k[w];var x=c.iterateEquation(w,u,u.epsilon,s,r,q,p,a,f);v+=Math.abs(x)}if(this.usedIterations++,m>=v*v)break}for(c.updateMultipliers(k,q,1/a),w=0;w!==l;w++){var y=k[w];if(y instanceof h){var z=y.contactEquation.multiplier*y.frictionCoefficient;y.maxForce=z,y.minForce=-z}}}for(f=0;f!==i;f++){for(v=0,w=0;w!==l;w++){u=k[w];var x=c.iterateEquation(w,u,u.epsilon,s,r,q,p,a,f);v+=Math.abs(x)}if(this.usedIterations++,m>=v*v)break}for(t=0;t!==o;t++)n[t].addConstraintVelocity();c.updateMultipliers(k,q,1/a)}},c.updateMultipliers=function(a,b,c){for(var d=a.length;d--;)a[d].multiplier=b[d]*c},c.iterateEquation=function(a,b,c,d,e,f,g,h){var i=d[a],j=e[a],k=f[a],l=b.computeGWlambda(),m=b.maxForce,n=b.minForce;g&&(i=0);var o=j*(i-l-c*k),p=k+o;return n*h>p?o=n*h-k:p>m*h&&(o=m*h-k),f[a]+=o,b.addToWlambda(o),o}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":47,"./Solver":44}],44:[function(a,b){function c(a,b){a=a||{},d.call(this),this.type=b,this.equations=[],this.equationSortFunction=a.equationSortFunction||!1}var d=(a("../utils/Utils"),a("../events/EventEmitter"));b.exports=c,c.prototype=new d,c.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var e={bodies:[]};c.prototype.solveIsland=function(a,b){this.removeAllEquations(),b.equations.length&&(this.addEquations(b.equations),e.bodies.length=0,b.getBodies(e.bodies),e.bodies.length&&this.solve(a,e))},c.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},c.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)},c.prototype.addEquations=function(a){for(var b=0,c=a.length;b!==c;b++){var d=a[b];d.enabled&&this.equations.push(d)}},c.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!==b&&this.equations.splice(b,1)},c.prototype.removeAllEquations=function(){this.equations.length=0},c.GS=1,c.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":47}],45:[function(a,b){function c(){this.overlappingLastState=new e,this.overlappingCurrentState=new e,this.recordPool=[],this.tmpDict=new e,this.tmpArray1=[]}function d(a,b,c,d){this.shapeA=b,this.shapeB=d,this.bodyA=a,this.bodyB=c}{var e=a("./TupleDictionary");a("./Utils")}b.exports=c,c.prototype.tick=function(){for(var a=this.overlappingLastState,b=this.overlappingCurrentState,c=b.keys.length;c--;){var d=b.keys[c];this.recordPool.push(b.getByKey(d))}a.reset(),a.copy(b),b.reset()},c.prototype.setOverlapping=function(a,b,c,e){var f=(this.overlappingLastState,this.overlappingCurrentState);if(!f.get(b.id,e.id)){var g;g=this.recordPool.length?this.recordPool.pop():new d(a,b,c,e),f.set(b.id,e.id,g)}},c.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingLastState,this.overlappingCurrentState,a)},c.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingCurrentState,this.overlappingLastState,a)},c.prototype.getDiff=function(a,b,c){var c=c||[],d=a,e=b;c.length=0;for(var f=e.keys.length;f--;){var g=e.keys[f],h=e.data[g];if(!h)throw new Error("Key "+g+" had no data!");var i=d.data[g];i||c.push(h)}return c},c.prototype.isNewOverlap=function(a,b){var c=0|a.id,d=0|b.id;return!this.overlappingLastState.get(c,d)&&!!this.overlappingCurrentState.get(c,d)},c.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)},c.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)},c.prototype.getBodyDiff=function(a,b){b=b||[];for(var c=this.tmpDict,d=a.length;d--;){var e=a[d];c.set(0|e.bodyA.id,0|e.bodyB.id,e)}for(d=c.keys.length;d--;){var e=c.keys[d];b.push(e.bodyA,e.bodyB)}return c.reset(),b},d.prototype.set=function(a,b,c,e){d.call(this,a,b,c,e)}},{"./TupleDictionary":46,"./Utils":47}],46:[function(a,b){function c(){this.data=[],this.keys=[]}var d=a("./Utils");b.exports=c,c.prototype.getKey=function(a,b){return a=0|a,b=0|b,(0|a)===(0|b)?-1:0|((0|a)>(0|b)?a<<16|65535&b:b<<16|65535&a)},c.prototype.getByKey=function(a){return a=0|a,this.data[a]},c.prototype.get=function(a,b){a=0|a,b=0|b;var c=0|this.getKey(a,b);return this.data[c]},c.prototype.set=function(a,b,c){if(!c)throw new Error("No data!");a=0|a,b=0|b;var d=0|this.getKey(a,b);return this.get(a,b)||this.keys.push(d),this.data[d]=c,d},c.prototype.reset=function(){for(var a=this.data,b=this.keys,c=0|b.length;c--;){var d=0|b[c];a[d]=void 0}b.length=0},c.prototype.copy=function(a){this.reset(),d.appendArray(this.keys,a.keys);for(var b=0|a.keys.length;b--;){var c=0|a.keys[b];this.data[c]=a.data[c]}}},{"./Utils":47}],47:[function(a,b){function c(){}b.exports=c,c.appendArray=function(a,b){if(b.length<15e4)a.push.apply(a,b);else for(var c=0,d=b.length;c!==d;++c)a.push(b[c])},c.splice=function(a,b,c){c=c||1;for(var d=b,e=a.length-c;e>d;d++)a[d]=a[d+c];a.length=e},c.ARRAY_TYPE=window.Float32Array||Array,c.extend=function(a,b){for(var c in b)a[c]=b[c]},c.defaults=function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a}},{}],48:[function(a,b){function c(){this.equations=[],this.bodies=[]}var d=a("../objects/Body");b.exports=c,c.prototype.reset=function(){this.equations.length=this.bodies.length=0};var e=[];c.prototype.getBodies=function(a){var b=a||[],c=this.equations;e.length=0;for(var d=0;d!==c.length;d++){var f=c[d];-1===e.indexOf(f.bodyA.id)&&(b.push(f.bodyA),e.push(f.bodyA.id)),-1===e.indexOf(f.bodyB.id)&&(b.push(f.bodyB),e.push(f.bodyB.id))}return b},c.prototype.wantsToSleep=function(){for(var a=0;a<this.bodies.length;a++){var b=this.bodies[a]; if(b.motionState===d.DYNAMIC&&!b.wantsToSleep)return!1}return!0},c.prototype.sleep=function(){for(var a=0;a<this.bodies.length;a++){var b=this.bodies[a];b.sleep()}return!0}},{"../objects/Body":31}],49:[function(a,b){function c(){this._nodePool=[],this._islandPool=[],this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var d=(a("../math/vec2"),a("./Island")),e=a("./IslandNode"),f=a("../objects/Body");b.exports=c,c.getUnvisitedNode=function(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!d.visited&&d.body.motionState===f.DYNAMIC)return d}return!1},c.prototype.visit=function(a,b,c){b.push(a.body);for(var d=a.equations.length,e=0;e!==d;e++){var f=a.equations[e];-1===c.indexOf(f)&&c.push(f)}},c.prototype.bfs=function(a,b,d){var e=this.queue;for(e.length=0,e.push(a),a.visited=!0,this.visit(a,b,d);e.length;)for(var g,h=e.pop();g=c.getUnvisitedNode(h.neighbors);)g.visited=!0,this.visit(g,b,d),g.body.motionState===f.DYNAMIC&&e.push(g)},c.prototype.split=function(a){for(var b=a.bodies,f=this.nodes,g=this.equations;f.length;)this._nodePool.push(f.pop());for(var h=0;h!==b.length;h++)if(this._nodePool.length){var i=this._nodePool.pop();i.reset(),i.body=b[h],f.push(i)}else f.push(new e(b[h]));for(var j=0;j!==g.length;j++){var k=g[j],h=b.indexOf(k.bodyA),l=b.indexOf(k.bodyB),m=f[h],n=f[l];m.neighbors.push(n),n.neighbors.push(m),m.equations.push(k),n.equations.push(k)}for(var o=this.islands;o.length;){var p=o.pop();p.reset(),this._islandPool.push(p)}for(var q;q=c.getUnvisitedNode(f);){var p=this._islandPool.length?this._islandPool.pop():new d;this.bfs(q,p.bodies,p.equations),o.push(p)}return o}},{"../math/vec2":30,"../objects/Body":31,"./Island":48,"./IslandNode":50}],50:[function(a,b){function c(a){this.body=a,this.neighbors=[],this.equations=[],this.visited=!1}b.exports=c,c.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],51:[function(a,b){function c(a){r.apply(this),a=a||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=a.solver||new g,this.narrowphase=new G(this),this.islandManager=new J,this.gravity=j.fromValues(0,-9.78),a.gravity&&j.copy(this.gravity,a.gravity),this.frictionGravity=j.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.doProfiling=a.doProfiling||!1,this.lastStepTime=0,this.broadphase=a.broadphase||new i,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new v,this.defaultContactMaterial=new w(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.fixedStepTime=0,this.islandSplit="undefined"!=typeof a.islandSplit?!!a.islandSplit:!1,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.enableBodySleeping=!1,this.enableIslandSleeping=!1,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new I}function d(a){return a?[a[0],a[1]]:a}function e(a,b){for(var c in b)a[c]=b[c]}function f(a){return{id:a.id,materialA:a.materialA.id,materialB:a.materialB.id,friction:a.friction,restitution:a.restitution,stiffness:a.stiffness,relaxation:a.relaxation,frictionStiffness:a.frictionStiffness,frictionRelaxation:a.frictionRelaxation}}var g=a("../solver/GSSolver"),h=a("../solver/Solver"),i=a("../collision/NaiveBroadphase"),j=a("../math/vec2"),k=a("../shapes/Circle"),l=a("../shapes/Rectangle"),m=a("../shapes/Convex"),n=a("../shapes/Line"),o=a("../shapes/Plane"),p=a("../shapes/Capsule"),q=a("../shapes/Particle"),r=a("../events/EventEmitter"),s=a("../objects/Body"),t=a("../shapes/Shape"),u=a("../objects/Spring"),v=a("../material/Material"),w=a("../material/ContactMaterial"),x=a("../constraints/DistanceConstraint"),y=a("../constraints/Constraint"),z=a("../constraints/LockConstraint"),A=a("../constraints/RevoluteConstraint"),B=a("../constraints/PrismaticConstraint"),C=a("../constraints/GearConstraint"),D=a("../../package.json"),E=a("../collision/Broadphase"),F=a("../collision/SAPBroadphase"),G=a("../collision/Narrowphase"),H=a("../utils/Utils"),I=a("../utils/OverlapKeeper"),J=a("./IslandManager");if(b.exports=c,"undefined"==typeof performance&&(performance={}),!performance.now){var K=Date.now();performance.timing&&performance.timing.navigationStart&&(K=performance.timing.navigationStart),performance.now=function(){return Date.now()-K}}c.prototype=new Object(r.prototype),c.prototype.addConstraint=function(a){this.constraints.push(a)},c.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)},c.prototype.removeContactMaterial=function(a){var b=this.contactMaterials.indexOf(a);-1!==b&&H.splice(this.contactMaterials,b,1)},c.prototype.getContactMaterial=function(a,b){for(var c=this.contactMaterials,d=0,e=c.length;d!==e;d++){var f=c[d];if(f.materialA===a&&f.materialB===b||f.materialA===b&&f.materialB===a)return f}return!1},c.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&H.splice(this.constraints,b,1)};var L=(j.create(),j.create(),j.create(),j.create(),j.create(),j.create(),j.create()),M=j.fromValues(0,0),N=j.fromValues(0,0),O=(j.fromValues(0,0),j.fromValues(0,0));c.prototype.step=function(a,b,c){if(c=c||10,b=b||0,0===b)this.internalStep(a),this.time+=a;else{var d=Math.floor((this.time+b)/a)-Math.floor(this.time/a);d=Math.min(d,c);for(var e=0;e!==d;e++)this.internalStep(a);this.time+=b;for(var f=this.time%a,g=f/a,h=0;h!==this.bodies.length;h++){var i=this.bodies[h];i.motionState!==s.STATIC&&i.sleepState!==s.SLEEPING?(j.sub(O,i.position,i.previousPosition),j.scale(O,O,g),j.add(i.interpolatedPosition,i.position,O),i.interpolatedAngle=i.angle+(i.angle-i.previousAngle)*g):(j.copy(i.interpolatedPosition,i.position),i.interpolatedAngle=i.angle)}}};var P=[];c.prototype.internalStep=function(a){this.stepping=!0;var b,d,e=this,f=this.doProfiling,g=this.springs.length,h=this.springs,i=this.bodies,k=this.gravity,l=this.solver,m=this.bodies.length,n=this.broadphase,o=this.narrowphase,p=this.constraints,q=L,r=(j.scale,j.add),t=(j.rotate,this.islandManager);if(this.lastTimeStep=a,f&&(b=performance.now()),this.useWorldGravityAsFrictionGravity){var u=j.length(this.gravity);0===u&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=u)}if(this.applyGravity)for(var v=0;v!==m;v++){var w=i[v],x=w.force;w.motionState===s.DYNAMIC&&w.sleepState!==s.SLEEPING&&(j.scale(q,k,w.mass*w.gravityScale),r(x,x,q))}if(this.applySpringForces)for(var v=0;v!==g;v++){var y=h[v];y.applyForce()}if(this.applyDamping)for(var v=0;v!==m;v++){var w=i[v];w.motionState===s.DYNAMIC&&w.applyDamping(a)}for(var z=n.getCollisionPairs(this),A=this.disabledBodyCollisionPairs,v=A.length-2;v>=0;v-=2)for(var B=z.length-2;B>=0;B-=2)(A[v]===z[B]&&A[v+1]===z[B+1]||A[v+1]===z[B]&&A[v]===z[B+1])&&z.splice(B,2);var C=p.length;for(v=0;v!==C;v++){var D=p[v];if(!D.collideConnected)for(var B=z.length-2;B>=0;B-=2)(D.bodyA===z[B]&&D.bodyB===z[B+1]||D.bodyB===z[B]&&D.bodyA===z[B+1])&&z.splice(B,2)}this.postBroadphaseEvent.pairs=z,this.emit(this.postBroadphaseEvent),o.reset(this);for(var v=0,E=z.length;v!==E;v+=2)for(var F=z[v],G=z[v+1],I=0,J=F.shapes.length;I!==J;I++)for(var K=F.shapes[I],M=F.shapeOffsets[I],N=F.shapeAngles[I],O=0,Q=G.shapes.length;O!==Q;O++){var R=G.shapes[O],S=G.shapeOffsets[O],T=G.shapeAngles[O],U=this.defaultContactMaterial;if(K.material&&R.material){var V=this.getContactMaterial(K.material,R.material);V&&(U=V)}this.runNarrowphase(o,F,K,M,N,G,R,S,T,U,this.frictionGravity)}for(var v=0;v!==m;v++){var W=i[v];W._wakeUpAfterNarrowphase&&(W.wakeUp(),W._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(P);for(var X=this.endContactEvent,O=P.length;O--;){var Y=P[O];X.shapeA=Y.shapeA,X.shapeB=Y.shapeB,X.bodyA=Y.bodyA,X.bodyB=Y.bodyA,this.emit(X)}}this.overlapKeeper.tick();var Z=this.preSolveEvent;Z.contactEquations=o.contactEquations,Z.frictionEquations=o.frictionEquations,this.emit(Z);var C=p.length;for(v=0;v!==C;v++)p[v].update();if(o.contactEquations.length||o.frictionEquations.length||p.length)if(this.islandSplit){for(t.equations.length=0,H.appendArray(t.equations,o.contactEquations),H.appendArray(t.equations,o.frictionEquations),v=0;v!==C;v++)H.appendArray(t.equations,p[v].equations);t.split(this);for(var v=0;v!==t.islands.length;v++){var $=t.islands[v];$.equations.length&&l.solveIsland(a,$)}}else{for(l.addEquations(o.contactEquations),l.addEquations(o.frictionEquations),v=0;v!==C;v++)l.addEquations(p[v].equations);this.solveConstraints&&l.solve(a,this),l.removeAllEquations()}for(var v=0;v!==m;v++){var W=i[v];W.sleepState!==s.SLEEPING&&W.motionState!==s.STATIC&&c.integrateBody(W,a)}for(var v=0;v!==m;v++)i[v].setZeroForce();if(f&&(d=performance.now(),e.lastStepTime=d-b),this.emitImpactEvent&&this.has("impact"))for(var _=this.impactEvent,v=0;v!==o.contactEquations.length;v++){var ab=o.contactEquations[v];ab.firstImpact&&(_.bodyA=ab.bodyA,_.bodyB=ab.bodyB,_.shapeA=ab.shapeA,_.shapeB=ab.shapeB,_.contactEquation=ab,this.emit(_))}if(this.enableBodySleeping)for(v=0;v!==m;v++)i[v].sleepTick(this.time,!1,a);else if(this.enableIslandSleeping&&this.islandSplit){for(v=0;v!==m;v++)i[v].sleepTick(this.time,!0,a);for(var v=0;v<this.islandManager.islands.length;v++){var $=this.islandManager.islands[v];$.wantsToSleep()&&$.sleep()}}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(var v=0;v!==this.bodiesToBeRemoved.length;v++)this.removeBody(this.bodiesToBeRemoved[v]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var Q=j.create(),R=j.create();c.integrateBody=function(a,b){var c=a.invMass,d=a.force,e=a.position,f=a.velocity;j.copy(a.previousPosition,a.position),a.previousAngle=a.angle,a.fixedRotation||(a.angularVelocity+=a.angularForce*a.invInertia*b,a.angle+=a.angularVelocity*b),j.scale(Q,d,b*c),j.add(f,Q,f),j.scale(R,f,b),j.add(e,e,R),a.aabbNeedsUpdate=!0},c.prototype.runNarrowphase=function(a,b,c,d,e,f,g,h,i,k,l){if(0!==(c.collisionGroup&g.collisionMask)&&0!==(g.collisionGroup&c.collisionMask)){j.rotate(M,d,b.angle),j.rotate(N,h,f.angle),j.add(M,M,b.position),j.add(N,N,f.position);var m=e+b.angle,n=i+f.angle;a.enableFriction=k.friction>0,a.frictionCoefficient=k.friction;var o;o=b.motionState===s.STATIC||b.motionState===s.KINEMATIC?f.mass:f.motionState===s.STATIC||f.motionState===s.KINEMATIC?b.mass:b.mass*f.mass/(b.mass+f.mass),a.slipForce=k.friction*l*o,a.restitution=k.restitution,a.surfaceVelocity=k.surfaceVelocity,a.frictionStiffness=k.frictionStiffness,a.frictionRelaxation=k.frictionRelaxation,a.stiffness=k.stiffness,a.relaxation=k.relaxation;var p=a[c.type|g.type],q=0;if(p){var r=c.sensor||g.sensor,t=a.frictionEquations.length;q=c.type<g.type?p.call(a,b,c,M,m,f,g,N,n,r):p.call(a,f,g,N,n,b,c,M,m,r);var u=a.frictionEquations.length-t;if(q){if(b.allowSleep&&b.motionState===s.DYNAMIC&&b.sleepState===s.SLEEPING&&f.sleepState===s.AWAKE&&f.motionState!==s.STATIC){var v=j.squaredLength(f.velocity)+Math.pow(f.angularVelocity,2),w=Math.pow(f.sleepSpeedLimit,2);v>=2*w&&(b._wakeUpAfterNarrowphase=!0)}if(f.allowSleep&&f.motionState===s.DYNAMIC&&f.sleepState===s.SLEEPING&&b.sleepState===s.AWAKE&&b.motionState!==s.STATIC){var x=j.squaredLength(b.velocity)+Math.pow(b.angularVelocity,2),y=Math.pow(b.sleepSpeedLimit,2);x>=2*y&&(f._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(b,c,f,g),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(c,g)){var z=this.beginContactEvent;if(z.shapeA=c,z.shapeB=g,z.bodyA=b,z.bodyB=f,z.contactEquations.length=0,"number"==typeof q)for(var A=a.contactEquations.length-q;A<a.contactEquations.length;A++)z.contactEquations.push(a.contactEquations[A]);this.emit(z)}if("number"==typeof q&&u>1)for(var A=a.frictionEquations.length-u;A<a.frictionEquations.length;A++){var B=a.frictionEquations[A];B.setSlipForce(B.getSlipForce()/u)}}}}},c.prototype.addSpring=function(a){this.springs.push(a),this.addSpringEvent.spring=a,this.emit(this.addSpringEvent)},c.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1===b&&H.splice(this.springs,b,1)},c.prototype.addBody=function(a){-1===this.bodies.indexOf(a)&&(this.bodies.push(a),a.world=this,this.addBodyEvent.body=a,this.emit(this.addBodyEvent))},c.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);else{a.world=null;var b=this.bodies.indexOf(a);-1!==b&&(H.splice(this.bodies,b,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}},c.prototype.getBodyById=function(a){for(var b=this.bodies,c=0;c<b.length;c++){var d=b[c];if(d.id===a)return d}return!1},c.prototype.disableBodyCollision=function(a,b){this.disabledBodyCollisionPairs.push(a,b)},c.prototype.enableBodyCollision=function(a,b){for(var c=this.disabledBodyCollisionPairs,d=0;d<c.length;d+=2)if(c[d]===a&&c[d+1]===b||c[d+1]===a&&c[d]===b)return void c.splice(d,2)},c.prototype.toJSON=function(){var a=this,b={p2:D.version,bodies:[],springs:[],solver:{},gravity:d(a.gravity),broadphase:{},distanceConstraints:[],revoluteConstraints:[],prismaticConstraints:[],lockConstraints:[],gearConstraints:[],contactMaterials:[],materials:[],defaultContactMaterial:f(a.defaultContactMaterial),islandSplit:a.islandSplit,enableIslandSleeping:a.enableIslandSleeping,enableBodySleeping:a.enableBodySleeping},c=b.solver,g=a.solver;g.type===h.GS&&(c.type="GSSolver",c.iterations=g.iterations);var i=b.broadphase,j=a.broadphase;j.type===E.NAIVE?i.type="NaiveBroadphase":j.type===E.SAP?i.type="SAPBroadphase":console.error("Broadphase not supported: "+j.type);for(var k=0;k!==a.springs.length;k++){var g=a.springs[k];b.springs.push({bodyA:a.bodies.indexOf(g.bodyA),bodyB:a.bodies.indexOf(g.bodyB),stiffness:g.stiffness,damping:g.damping,restLength:g.restLength,localAnchorA:d(g.localAnchorA),localAnchorB:d(g.localAnchorB)})}for(var k=0;k<a.constraints.length;k++){var l=a.constraints[k],m={bodyA:a.bodies.indexOf(l.bodyA),bodyB:a.bodies.indexOf(l.bodyB),collideConnected:l.collideConnected};switch(l.type){case y.DISTANCE:e(m,{distance:l.distance,maxForce:l.getMaxForce()}),b.distanceConstraints.push(m);break;case y.REVOLUTE:e(m,{pivotA:d(l.pivotA),pivotB:d(l.pivotB),maxForce:l.maxForce,motorSpeed:l.getMotorSpeed()||0,motorEnabled:!!l.getMotorSpeed(),lowerLimit:l.lowerLimit,lowerLimitEnabled:l.lowerLimitEnabled,upperLimit:l.upperLimit,upperLimitEnabled:l.upperLimitEnabled}),b.revoluteConstraints.push(m);break;case y.PRISMATIC:e(m,{localAxisA:d(l.localAxisA),localAnchorA:d(l.localAnchorA),localAnchorB:d(l.localAnchorB),maxForce:l.maxForce,upperLimitEnabled:l.upperLimitEnabled,lowerLimitEnabled:l.lowerLimitEnabled,upperLimit:l.upperLimit,lowerLimit:l.lowerLimit,motorEnabled:l.motorEnabled,motorSpeed:l.motorSpeed}),b.prismaticConstraints.push(m);break;case y.LOCK:e(m,{localOffsetB:d(l.localOffsetB),localAngleB:l.localAngleB,maxForce:l.getMaxForce()}),b.lockConstraints.push(m);break;case y.GEAR:e(m,{angle:l.angle,ratio:l.ratio,maxForce:l.maxForce||1e6}),b.gearConstraints.push(m);break;default:console.error("Constraint not supported yet: ",l.type)}}for(var k=0;k!==a.bodies.length;k++){var n=a.bodies[k],o=n.shapes,p={id:n.id,mass:n.mass,angle:n.angle,position:d(n.position),velocity:d(n.velocity),angularVelocity:n.angularVelocity,force:d(n.force),motionState:n.motionState,fixedRotation:n.fixedRotation,circleShapes:[],planeShapes:[],particleShapes:[],lineShapes:[],rectangleShapes:[],convexShapes:[],capsuleShapes:[]};n.concavePath&&(p.concavePath=n.concavePath);for(var q=0;q<o.length;q++){var g=o[q],r={};switch(r.offset=d(n.shapeOffsets[q]),r.angle=n.shapeAngles[q],r.collisionGroup=g.collisionGroup,r.collisionMask=g.collisionMask,r.material=g.material?g.material.id:null,g.type){case t.CIRCLE:e(r,{radius:g.radius}),p.circleShapes.push(r);break;case t.PLANE:p.planeShapes.push(r);break;case t.PARTICLE:p.particleShapes.push(r);break;case t.LINE:r.length=g.length,p.lineShapes.push(r);break;case t.RECTANGLE:e(r,{width:g.width,height:g.height}),p.rectangleShapes.push(r);break;case t.CONVEX:for(var s=[],u=0;u<g.vertices.length;u++)s.push(d(g.vertices[u]));e(r,{vertices:s}),p.convexShapes.push(r);break;case t.CAPSULE:e(r,{length:g.length,radius:g.radius}),p.capsuleShapes.push(r);break;default:console.error("Shape type not supported yet!")}}b.bodies.push(p)}for(var k=0;k<a.contactMaterials.length;k++){var v=a.contactMaterials[k];b.contactMaterials.push(f(v))}for(var w={},k=0;k<a.contactMaterials.length;k++){var v=a.contactMaterials[k];w[v.materialA.id+""]=v.materialA,w[v.materialB.id+""]=v.materialB}for(var x in w){var z=w[parseInt(x)];b.materials.push({id:z.id})}return b},c.prototype.fromJSON=function(a){function b(a,b,c){b.collisionMask=c.collisionMask,b.collisionGroup=c.collisionGroup,c.material&&(b.material=h[c.material+""]),a.addShape(b,c.offset,c.angle)}if(this.clear(),!a.p2)return!1;var c=this;switch(j.copy(c.gravity,a.gravity),c.islandSplit=a.islandSplit,c.enableIslandSleeping=a.enableIslandSleeping,c.enableBodySleeping=a.enableBodySleeping,a.solver.type){case"GSSolver":var d=a.solver,e=new g;c.solver=e,e.iterations=d.iterations;break;default:throw new Error("Solver type not recognized: "+a.solver.type)}switch(a.broadphase.type){case"NaiveBroadphase":c.broadphase=new i;break;case"SAPBroadphase":c.broadphase=new F}c.broadphase.setWorld(c);for(var f=c.bodies,h={},r=0;r!==a.materials.length;r++){var t=a.materials[r],y=new v;h[t.id+""]=y,y.id=t.id}c.defaultMaterial.id=a.defaultContactMaterial.materialA;for(var r=0;r!==a.bodies.length;r++){var D=a.bodies[r],E=new s({mass:D.mass,position:D.position,angle:D.angle,velocity:D.velocity,angularVelocity:D.angularVelocity,force:D.force,fixedRotation:D.fixedRotation});E.id=D.id,E.motionState=D.motionState;for(var G=0;G<D.circleShapes.length;G++){var e=D.circleShapes[G];b(E,new k(e.radius),e)}for(var G=0;G<D.planeShapes.length;G++){var e=D.planeShapes[G];b(E,new o,e)}for(var G=0;G<D.particleShapes.length;G++){var e=D.particleShapes[G];b(E,new q,e)}for(var G=0;G<D.lineShapes.length;G++){var e=D.lineShapes[G];b(E,new n(e.length),e)}for(var G=0;G<D.rectangleShapes.length;G++){var e=D.rectangleShapes[G];b(E,new l(e.width,e.height),e)}for(var G=0;G<D.convexShapes.length;G++){var e=D.convexShapes[G];b(E,new m(e.vertices),e)}for(var G=0;G<D.capsuleShapes.length;G++){var e=D.capsuleShapes[G];b(E,new p(e.length,e.radius),e)}D.concavePath&&(E.concavePath=D.concavePath),c.addBody(E)}for(var r=0;r<a.springs.length;r++){var d=a.springs[r],H=f[d.bodyA],I=f[d.bodyB];if(!H)return this.error="instance.springs["+r+"] references instance.body["+d.bodyA+"], which does not exist.",!1;if(!I)return this.error="instance.springs["+r+"] references instance.body["+d.bodyB+"], which does not exist.",!1;var e=new u(H,I,{stiffness:d.stiffness,damping:d.damping,restLength:d.restLength,localAnchorA:d.localAnchorA,localAnchorB:d.localAnchorB});c.addSpring(e)}for(var r=0;r<a.contactMaterials.length;r++){var t=a.contactMaterials[r],J=h[t.materialA+""],K=h[t.materialB+""];if(!J)return this.error="Reference to material id "+t.materialA+": material not found",!1;if(!K)return this.error="Reference to material id "+t.materialB+": material not found",!1;var L=new w(J,K,{friction:t.friction,restitution:t.restitution,stiffness:t.stiffness,relaxation:t.relaxation,frictionStiffness:t.frictionStiffness,frictionRelaxation:t.frictionRelaxation});L.id=t.id,c.addContactMaterial(L)}var t=a.defaultContactMaterial,J=c.defaultMaterial,K=c.defaultMaterial,L=new w(J,K,{friction:t.friction,restitution:t.restitution,stiffness:t.stiffness,relaxation:t.relaxation,frictionStiffness:t.frictionStiffness,frictionRelaxation:t.frictionRelaxation});L.id=t.id,c.defaultContactMaterial=L;for(var r=0;r<a.distanceConstraints.length;r++){var M=a.distanceConstraints[r];c.addConstraint(new x(f[M.bodyA],f[M.bodyB],M.distance,{maxForce:M.maxForce,collideConnected:M.collideConnected}))}for(var r=0;r<a.revoluteConstraints.length;r++){var M=a.revoluteConstraints[r],N=new A(f[M.bodyA],M.pivotA,f[M.bodyB],M.pivotB,{maxForce:M.maxForce,collideConnected:M.collideConnected});M.motorEnabled&&N.enableMotor(),N.setMotorSpeed(M.motorSpeed),N.lowerLimit=M.lowerLimit,N.upperLimit=M.upperLimit,N.lowerLimitEnabled=M.lowerLimitEnabled,N.upperLimitEnabled=M.upperLimitEnabled,c.addConstraint(N)}for(var r=0;r<a.prismaticConstraints.length;r++){var M=a.prismaticConstraints[r],O=new B(f[M.bodyA],f[M.bodyB],{maxForce:M.maxForce,localAxisA:M.localAxisA,localAnchorA:M.localAnchorA,localAnchorB:M.localAnchorB,collideConnected:M.collideConnected});O.motorSpeed=M.motorSpeed,c.addConstraint(O)}for(var r=0;r<a.lockConstraints.length;r++){var M=a.lockConstraints[r];c.addConstraint(new z(f[M.bodyA],f[M.bodyB],{maxForce:M.maxForce,localOffsetB:M.localOffsetB,localAngleB:M.localAngleB,collideConnected:M.collideConnected}))}for(var r=0;r<a.gearConstraints.length;r++){var M=a.gearConstraints[r];c.addConstraint(new C(f[M.bodyA],f[M.bodyB],{maxForce:M.maxForce,angle:M.angle,ratio:M.ratio,collideConnected:M.collideConnected}))}return!0},c.prototype.clear=function(){this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,b=a.length-1;b>=0;b--)this.removeConstraint(a[b]);for(var d=this.bodies,b=d.length-1;b>=0;b--)this.removeBody(d[b]);for(var e=this.springs,b=e.length-1;b>=0;b--)this.removeSpring(e[b]);for(var f=this.contactMaterials,b=f.length-1;b>=0;b--)this.removeContactMaterial(f[b]);c.apply(this)},c.prototype.clone=function(){var a=new c;return a.fromJSON(this.toJSON()),a};var S=j.create(),T=j.fromValues(0,0),U=j.fromValues(0,0);c.prototype.hitTest=function(a,b,c){c=c||0;var d=new s({position:a}),e=new q,f=a,g=0,h=S,i=T,l=U;d.addShape(e);for(var n=this.narrowphase,r=[],t=0,u=b.length;t!==u;t++)for(var v=b[t],w=0,x=v.shapes.length;w!==x;w++){var y=v.shapes[w],z=v.shapeOffsets[w]||i,A=v.shapeAngles[w]||0;j.rotate(h,z,v.angle),j.add(h,h,v.position);var B=A+v.angle;(y instanceof k&&n.circleParticle(v,y,h,B,d,e,f,g,!0)||y instanceof m&&n.particleConvex(d,e,f,g,v,y,h,B,!0)||y instanceof o&&n.particlePlane(d,e,f,g,v,y,h,B,!0)||y instanceof p&&n.particleCapsule(d,e,f,g,v,y,h,B,!0)||y instanceof q&&j.squaredLength(j.sub(l,h,a))<c*c)&&r.push(v)}return r},c.prototype.setGlobalEquationParameters=function(a){a=a||{};for(var b=0;b!==this.constraints.length;b++)for(var c=this.constraints[b],d=0;d!==c.equations.length;d++){var e=c.equations[d];"undefined"!=typeof a.stiffness&&(e.stiffness=a.stiffness),"undefined"!=typeof a.relaxation&&(e.relaxation=a.relaxation),e.needsUpdate=!0}for(var b=0;b!==this.contactMaterials.length;b++){var c=this.contactMaterials[b];"undefined"!=typeof a.stiffness&&(c.stiffness=a.stiffness,c.frictionStiffness=a.stiffness),"undefined"!=typeof a.relaxation&&(c.relaxation=a.relaxation,c.frictionRelaxation=a.relaxation)}var c=this.defaultContactMaterial;"undefined"!=typeof a.stiffness&&(c.stiffness=a.stiffness,c.frictionStiffness=a.stiffness),"undefined"!=typeof a.relaxation&&(c.relaxation=a.relaxation,c.frictionRelaxation=a.relaxation)},c.prototype.setGlobalStiffness=function(a){this.setGlobalEquationParameters({stiffness:a})},c.prototype.setGlobalRelaxation=function(a){this.setGlobalEquationParameters({relaxation:a})}},{"../../package.json":7,"../collision/Broadphase":9,"../collision/NaiveBroadphase":11,"../collision/Narrowphase":12,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/Spring":32,"../shapes/Capsule":34,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Line":38,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Rectangle":41,"../shapes/Shape":42,"../solver/GSSolver":43,"../solver/Solver":44,"../utils/OverlapKeeper":45,"../utils/Utils":47,"./IslandManager":49}]},{},[33])(33)}),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,Phaser.Physics.P2=function(a,b){this.game=a,"undefined"!=typeof b&&b.hasOwnProperty("gravity")&&b.hasOwnProperty("broadphase")||(b={gravity:[0,0],broadphase:new p2.SAPBroadphase}),this.world=new p2.World(b),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new Phaser.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new Phaser.Signal,this.onBodyRemoved=new Phaser.Signal,this.onSpringAdded=new Phaser.Signal,this.onSpringRemoved=new Phaser.Signal,this.onConstraintAdded=new Phaser.Signal,this.onConstraintRemoved=new Phaser.Signal,this.onContactMaterialAdded=new Phaser.Signal,this.onContactMaterialRemoved=new Phaser.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new Phaser.Signal,this.onEndContact=new Phaser.Signal,b.hasOwnProperty("mpx")&&b.hasOwnProperty("pxm")&&b.hasOwnProperty("mpxi")&&b.hasOwnProperty("pxmi")&&(this.mpx=b.mpx,this.mpxi=b.mpxi,this.pxm=b.pxm,this.pxmi=b.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},Phaser.Physics.P2.prototype={removeBodyNextStep:function(a){this._toRemove.push(a)},preUpdate:function(){for(var a=this._toRemove.length;a--;)this.removeBody(this._toRemove[a]);this._toRemove.length=0},enable:function(a,b,c){"undefined"==typeof b&&(b=!1),"undefined"==typeof c&&(c=!0);var d=1;if(Array.isArray(a))for(d=a.length;d--;)a[d]instanceof Phaser.Group?this.enable(a[d].children,b,c):(this.enableBody(a[d],b),c&&a[d].hasOwnProperty("children")&&a[d].children.length>0&&this.enable(a[d],b,!0));else a instanceof Phaser.Group?this.enable(a.children,b,c):(this.enableBody(a,b),c&&a.hasOwnProperty("children")&&a.children.length>0&&this.enable(a.children,b,!0))},enableBody:function(a,b){a.hasOwnProperty("body")&&null===a.body&&(a.body=new Phaser.Physics.P2.Body(this.game,a,a.x,a.y,1),a.body.debug=b,a.anchor.set(.5))},setImpactEvents:function(a){a?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(a,b){this.postBroadphaseCallback=a,this.callbackContext=b,null!==a?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(a){if(this.postBroadphaseCallback)for(var b=a.pairs.length;b-=2;)a.pairs[b].parent&&a.pairs[b+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,a.pairs[b].parent,a.pairs[b+1].parent)&&a.pairs.splice(b,2)},impactHandler:function(a){if(a.bodyA.parent&&a.bodyB.parent){var b=a.bodyA.parent,c=a.bodyB.parent;b._bodyCallbacks[a.bodyB.id]&&b._bodyCallbacks[a.bodyB.id].call(b._bodyCallbackContext[a.bodyB.id],b,c,a.shapeA,a.shapeB),c._bodyCallbacks[a.bodyA.id]&&c._bodyCallbacks[a.bodyA.id].call(c._bodyCallbackContext[a.bodyA.id],c,b,a.shapeB,a.shapeA),b._groupCallbacks[a.shapeB.collisionGroup]&&b._groupCallbacks[a.shapeB.collisionGroup].call(b._groupCallbackContext[a.shapeB.collisionGroup],b,c,a.shapeA,a.shapeB),c._groupCallbacks[a.shapeA.collisionGroup]&&c._groupCallbacks[a.shapeA.collisionGroup].call(c._groupCallbackContext[a.shapeA.collisionGroup],c,b,a.shapeB,a.shapeA)}},beginContactHandler:function(a){this.onBeginContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB,a.contactEquations),a.bodyA.parent&&a.bodyA.parent.onBeginContact.dispatch(a.bodyB.parent,a.shapeA,a.shapeB,a.contactEquations),a.bodyB.parent&&a.bodyB.parent.onBeginContact.dispatch(a.bodyA.parent,a.shapeB,a.shapeA,a.contactEquations)},endContactHandler:function(a){this.onEndContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB),a.bodyA.parent&&a.bodyA.parent.onEndContact.dispatch(a.bodyB.parent,a.shapeA,a.shapeB),a.bodyB.parent&&a.bodyB.parent.onEndContact.dispatch(a.bodyA.parent,a.shapeB,a.shapeA)},setBoundsToWorld:function(a,b,c,d,e){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,a,b,c,d,e)},setWorldMaterial:function(a,b,c,d,e){"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=!0),b&&this.walls.left&&(this.walls.left.shapes[0].material=a),c&&this.walls.right&&(this.walls.right.shapes[0].material=a),d&&this.walls.top&&(this.walls.top.shapes[0].material=a),e&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=a)},updateBoundsCollisionGroup:function(a){var b=this.everythingCollisionGroup.mask;"undefined"==typeof a&&(b=this.boundsCollisionGroup.mask),this.walls.left&&(this.walls.left.shapes[0].collisionGroup=b),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=b),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=b),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=b)},setBounds:function(a,b,c,d,e,f,g,h,i){"undefined"==typeof e&&(e=!0),"undefined"==typeof f&&(f=!0),"undefined"==typeof g&&(g=!0),"undefined"==typeof h&&(h=!0),"undefined"==typeof i&&(i=!0),this.walls.left&&this.world.removeBody(this.walls.left),this.walls.right&&this.world.removeBody(this.walls.right),this.walls.top&&this.world.removeBody(this.walls.top),this.walls.bottom&&this.world.removeBody(this.walls.bottom),e&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(a),this.pxmi(b)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),i&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left)),f&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(a+c),this.pxmi(b)],angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),i&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right)),g&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(a),this.pxmi(b)],angle:-3.141592653589793}),this.walls.top.addShape(new p2.Plane),i&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top)),h&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(a),this.pxmi(b+d)]}),this.walls.bottom.addShape(new p2.Plane),i&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom))},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||this.world.step(this.useElapsedTime?this.game.time.physicsElapsed:this.frameRate)},clear:function(){this.world.clear(),this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this._collisionGroupID=2,this.boundsCollidesWith=[]},destroy:function(){this.clear(),this.game=null},addBody:function(a){return a.data.world?!1:(this.world.addBody(a.data),this.onBodyAdded.dispatch(a),!0) },removeBody:function(a){return a.data.world==this.world&&(this.world.removeBody(a.data),this.onBodyRemoved.dispatch(a)),a},addSpring:function(a){return this.world.addSpring(a),this.onSpringAdded.dispatch(a),a},removeSpring:function(a){return this.world.removeSpring(a),this.onSpringRemoved.dispatch(a),a},createDistanceConstraint:function(a,b,c,d){return a=this.getBody(a),b=this.getBody(b),a&&b?this.addConstraint(new Phaser.Physics.P2.DistanceConstraint(this,a,b,c,d)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(a,b,c,d){return a=this.getBody(a),b=this.getBody(b),a&&b?this.addConstraint(new Phaser.Physics.P2.GearConstraint(this,a,b,c,d)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(a,b,c,d,e){return a=this.getBody(a),c=this.getBody(c),a&&c?this.addConstraint(new Phaser.Physics.P2.RevoluteConstraint(this,a,b,c,d,e)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(a,b,c,d,e){return a=this.getBody(a),b=this.getBody(b),a&&b?this.addConstraint(new Phaser.Physics.P2.LockConstraint(this,a,b,c,d,e)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(a,b,c,d,e,f,g){return a=this.getBody(a),b=this.getBody(b),a&&b?this.addConstraint(new Phaser.Physics.P2.PrismaticConstraint(this,a,b,c,d,e,f,g)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(a){return this.world.addConstraint(a),this.onConstraintAdded.dispatch(a),a},removeConstraint:function(a){return this.world.removeConstraint(a),this.onConstraintRemoved.dispatch(a),a},addContactMaterial:function(a){return this.world.addContactMaterial(a),this.onContactMaterialAdded.dispatch(a),a},removeContactMaterial:function(a){return this.world.removeContactMaterial(a),this.onContactMaterialRemoved.dispatch(a),a},getContactMaterial:function(a,b){return this.world.getContactMaterial(a,b)},setMaterial:function(a,b){for(var c=b.length;c--;)b[c].setMaterial(a)},createMaterial:function(a,b){a=a||"";var c=new Phaser.Physics.P2.Material(a);return this.materials.push(c),"undefined"!=typeof b&&b.setMaterial(c),c},createContactMaterial:function(a,b,c){"undefined"==typeof a&&(a=this.createMaterial()),"undefined"==typeof b&&(b=this.createMaterial());var d=new Phaser.Physics.P2.ContactMaterial(a,b,c);return this.addContactMaterial(d)},getBodies:function(){for(var a=[],b=this.world.bodies.length;b--;)a.push(this.world.bodies[b].parent);return a},getBody:function(a){return a instanceof p2.Body?a:a instanceof Phaser.Physics.P2.Body?a.data:a.body&&a.body.type===Phaser.Physics.P2JS?a.body.data:null},getSprings:function(){for(var a=[],b=this.world.springs.length;b--;)a.push(this.world.springs[b].parent);return a},getConstraints:function(){for(var a=[],b=this.world.constraints.length;b--;)a.push(this.world.constraints[b].parent);return a},hitTest:function(a,b,c,d){"undefined"==typeof b&&(b=this.world.bodies),"undefined"==typeof c&&(c=5),"undefined"==typeof d&&(d=!1);for(var e=[this.pxmi(a.x),this.pxmi(a.y)],f=[],g=b.length;g--;)b[g]instanceof Phaser.Physics.P2.Body&&(!d||b[g].data.motionState!==p2.Body.STATIC)?f.push(b[g].data):b[g]instanceof p2.Body&&b[g].parent&&(!d||b[g].motionState!==p2.Body.STATIC)?f.push(b[g]):b[g]instanceof Phaser.Sprite&&b[g].hasOwnProperty("body")&&(!d||b[g].body.data.motionState!==p2.Body.STATIC)&&f.push(b[g].body.data);return this.world.hitTest(e,f,c)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(a){var b=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|b),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|b),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|b),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|b),this._collisionGroupID++;var c=new Phaser.Physics.P2.CollisionGroup(b);return this.collisionGroups.push(c),a&&this.setCollisionGroup(a,c),c},setCollisionGroup:function(a,b){if(a instanceof Phaser.Group)for(var c=0;c<a.total;c++)a.children[c].body&&a.children[c].body.type===Phaser.Physics.P2JS&&a.children[c].body.setCollisionGroup(b);else a.body.setCollisionGroup(b)},createSpring:function(a,b,c,d,e,f,g,h,i){return a=this.getBody(a),b=this.getBody(b),a&&b?this.addSpring(new Phaser.Physics.P2.Spring(this,a,b,c,d,e,f,g,h,i)):void console.warn("Cannot create Spring, invalid body objects given")},createBody:function(a,b,c,d,e,f){"undefined"==typeof d&&(d=!1);var g=new Phaser.Physics.P2.Body(this.game,null,a,b,c);if(f){var h=g.addPolygon(e,f);if(!h)return!1}return d&&this.world.addBody(g.data),g},createParticle:function(a,b,c,d,e,f){"undefined"==typeof d&&(d=!1);var g=new Phaser.Physics.P2.Body(this.game,null,a,b,c);if(f){var h=g.addPolygon(e,f);if(!h)return!1}return d&&this.world.addBody(g.data),g},convertCollisionObjects:function(a,b,c){"undefined"==typeof c&&(c=!0);for(var d=[],e=0,f=a.collision[b].length;f>e;e++){var g=a.collision[b][e],h=this.createBody(g.x,g.y,0,c,{},g.polyline);h&&d.push(h)}return d},clearTilemapLayerBodies:function(a,b){b=a.getLayer(b);for(var c=a.layers[b].bodies.length;c--;)a.layers[b].bodies[c].destroy();a.layers[b].bodies.length=0},convertTilemap:function(a,b,c,d){b=a.getLayer(b),"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=!0),this.clearTilemapLayerBodies(a,b);for(var e=0,f=0,g=0,h=0,i=a.layers[b].height;i>h;h++){e=0;for(var j=0,k=a.layers[b].width;k>j;j++){var l=a.layers[b].data[h][j];if(l&&l.index>-1&&l.collides)if(d){var m=a.getTileRight(b,j,h);if(0===e&&(f=l.x*l.width,g=l.y*l.height,e=l.width),m&&m.collides)e+=l.width;else{var n=this.createBody(f,g,0,!1);n.addRectangle(e,l.height,e/2,l.height/2,0),c&&this.addBody(n),a.layers[b].bodies.push(n),e=0}}else{var n=this.createBody(l.x*l.width,l.y*l.height,0,!1);n.addRectangle(l.width,l.height,l.width/2,l.height/2,0),c&&this.addBody(n),a.layers[b].bodies.push(n)}}}return a.layers[b].bodies},mpx:function(a){return a*=20},pxm:function(a){return.05*a},mpxi:function(a){return a*=-20},pxmi:function(a){return a*-.05}},Object.defineProperty(Phaser.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"defaultFriction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"defaultRestitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(a){this.world.defaultContactMaterial=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(a){this.world.applySpringForces=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(a){this.world.applyDamping=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(a){this.world.applyGravity=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(a){this.world.solveConstraints=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(Phaser.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(a){this.world.emitImpactEvent=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"enableBodySleeping",{get:function(){return this.world.enableBodySleeping},set:function(a){this.world.enableBodySleeping=a}}),Object.defineProperty(Phaser.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),Phaser.Physics.P2.FixtureList=function(a){Array.isArray(a)||(a=[a]),this.rawList=a,this.init(),this.parse(this.rawList)},Phaser.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(a,b){var c=function(b){b.collisionGroup=a};this.getFixtures(b).forEach(c)},setMask:function(a,b){var c=function(b){b.collisionMask=a};this.getFixtures(b).forEach(c)},setSensor:function(a,b){var c=function(b){b.sensor=a};this.getFixtures(b).forEach(c)},setMaterial:function(a,b){var c=function(b){b.material=a};this.getFixtures(b).forEach(c)},getFixtures:function(a){var b=[];if(a){a instanceof Array||(a=[a]);var c=this;return a.forEach(function(a){c.namedFixtures[a]&&b.push(c.namedFixtures[a])}),this.flatten(b)}return this.allFixtures},getFixtureByKey:function(a){return this.namedFixtures[a]},getGroup:function(a){return this.groupedFixtures[a]},parse:function(){var a,b,c,d;c=this.rawList,d=[];for(a in c)b=c[a],isNaN(a-0)?this.namedFixtures[a]=this.flatten(b):(this.groupedFixtures[a]=this.groupedFixtures[a]||[],this.groupedFixtures[a]=this.groupedFixtures[a].concat(b)),d.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(a){var b,c;return b=[],c=arguments.callee,a.forEach(function(a){return Array.prototype.push.apply(b,Array.isArray(a)?c(a):[a])}),b}},Phaser.Physics.P2.PointProxy=function(a,b){this.world=a,this.destination=b},Phaser.Physics.P2.PointProxy.prototype.constructor=Phaser.Physics.P2.PointProxy,Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=this.world.pxm(a)}}),Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=this.world.pxm(a)}}),Phaser.Physics.P2.InversePointProxy=function(a,b){this.world=a,this.destination=b},Phaser.Physics.P2.InversePointProxy.prototype.constructor=Phaser.Physics.P2.InversePointProxy,Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=this.world.pxm(-a)}}),Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=this.world.pxm(-a)}}),Phaser.Physics.P2.Body=function(a,b,c,d,e){b=b||null,c=c||0,d=d||0,"undefined"==typeof e&&(e=1),this.game=a,this.world=a.physics.p2,this.sprite=b,this.type=Phaser.Physics.P2JS,this.offset=new Phaser.Point,this.data=new p2.Body({position:[this.world.pxmi(c),this.world.pxmi(d)],mass:e}),this.data.parent=this,this.velocity=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new Phaser.Point,this.onBeginContact=new Phaser.Signal,this.onEndContact=new Phaser.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},b&&(this.setRectangleFromSprite(b),b.exists&&this.game.physics.p2.addBody(this))},Phaser.Physics.P2.Body.prototype={createBodyCallback:function(a,b,c){var d=-1;a.id?d=a.id:a.body&&(d=a.body.id),d>-1&&(null===b?(delete this._bodyCallbacks[d],delete this._bodyCallbackContext[d]):(this._bodyCallbacks[d]=b,this._bodyCallbackContext[d]=c))},createGroupCallback:function(a,b,c){null===b?(delete this._groupCallbacks[a.mask],delete this._groupCallbacksContext[a.mask]):(this._groupCallbacks[a.mask]=b,this._groupCallbackContext[a.mask]=c)},getCollisionMask:function(){var a=0;this._collideWorldBounds&&(a=this.game.physics.p2.boundsCollisionGroup.mask);for(var b=0;b<this.collidesWith.length;b++)a|=this.collidesWith[b].mask;return a},updateCollisionMask:function(a){var b=this.getCollisionMask();if("undefined"==typeof a)for(var c=this.data.shapes.length-1;c>=0;c--)this.data.shapes[c].collisionMask=b;else a.collisionMask=b},setCollisionGroup:function(a,b){var c=this.getCollisionMask();if("undefined"==typeof b)for(var d=this.data.shapes.length-1;d>=0;d--)this.data.shapes[d].collisionGroup=a.mask,this.data.shapes[d].collisionMask=c;else b.collisionGroup=a.mask,b.collisionMask=c},clearCollision:function(a,b,c){if("undefined"==typeof c)for(var d=this.data.shapes.length-1;d>=0;d--)a&&(this.data.shapes[d].collisionGroup=null),b&&(this.data.shapes[d].collisionMask=null);else a&&(c.collisionGroup=null),b&&(c.collisionMask=null);a&&(this.collidesWith.length=0)},collides:function(a,b,c,d){if(Array.isArray(a))for(var e=0;e<a.length;e++)-1===this.collidesWith.indexOf(a[e])&&(this.collidesWith.push(a[e]),b&&this.createGroupCallback(a[e],b,c));else-1===this.collidesWith.indexOf(a)&&(this.collidesWith.push(a),b&&this.createGroupCallback(a,b,c));var f=this.getCollisionMask();if("undefined"==typeof d)for(var e=this.data.shapes.length-1;e>=0;e--)this.data.shapes[e].collisionMask=f;else d.collisionMask=f},adjustCenterOfMass:function(){this.data.adjustCenterOfMass()},applyDamping:function(a){this.data.applyDamping(a)},applyForce:function(a,b,c){this.data.applyForce(a,[this.world.pxmi(b),this.world.pxmi(c)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(a,b){return this.data.toLocalFrame(a,b)},toWorldFrame:function(a,b){return this.data.toWorldFrame(a,b)},rotateLeft:function(a){this.data.angularVelocity=this.world.pxm(-a)},rotateRight:function(a){this.data.angularVelocity=this.world.pxm(a)},moveForward:function(a){var b=this.world.pxmi(-a),c=this.data.angle+Math.PI/2;this.data.velocity[0]=b*Math.cos(c),this.data.velocity[1]=b*Math.sin(c)},moveBackward:function(a){var b=this.world.pxmi(-a),c=this.data.angle+Math.PI/2;this.data.velocity[0]=-(b*Math.cos(c)),this.data.velocity[1]=-(b*Math.sin(c))},thrust:function(a){var b=this.world.pxmi(-a),c=this.data.angle+Math.PI/2;this.data.force[0]+=b*Math.cos(c),this.data.force[1]+=b*Math.sin(c)},reverse:function(a){var b=this.world.pxmi(-a),c=this.data.angle+Math.PI/2;this.data.force[0]-=b*Math.cos(c),this.data.force[1]-=b*Math.sin(c)},moveLeft:function(a){this.data.velocity[0]=this.world.pxmi(-a)},moveRight:function(a){this.data.velocity[0]=this.world.pxmi(a)},moveUp:function(a){this.data.velocity[1]=this.world.pxmi(-a)},moveDown:function(a){this.data.velocity[1]=this.world.pxmi(a)},preUpdate:function(){this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]),this.sprite.y=this.world.mpxi(this.data.position[1]),this.fixedRotation||(this.sprite.rotation=this.data.angle)},reset:function(a,b,c,d){"undefined"==typeof c&&(c=!1),"undefined"==typeof d&&(d=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),c&&this.setZeroDamping(),d&&(this.mass=1),this.x=a,this.y=b},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var a=0;a<this.game.physics.p2._toRemove.length;a++)this.game.physics.p2._toRemove[a]===this&&this.game.physics.p2._toRemove.splice(a,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(),this.debugBody=null,this.sprite=null},clearShapes:function(){for(var a=this.data.shapes.length;a--;)this.data.removeShape(this.data.shapes[a]);this.shapeChanged()},addShape:function(a,b,c,d){return"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.data.addShape(a,[this.world.pxmi(b),this.world.pxmi(c)],d),this.shapeChanged(),a},addCircle:function(a,b,c,d){var e=new p2.Circle(this.world.pxm(a));return this.addShape(e,b,c,d)},addRectangle:function(a,b,c,d,e){var f=new p2.Rectangle(this.world.pxm(a),this.world.pxm(b));return this.addShape(f,c,d,e)},addPlane:function(a,b,c){var d=new p2.Plane;return this.addShape(d,a,b,c)},addParticle:function(a,b,c){var d=new p2.Particle;return this.addShape(d,a,b,c)},addLine:function(a,b,c,d){var e=new p2.Line(this.world.pxm(a));return this.addShape(e,b,c,d)},addCapsule:function(a,b,c,d,e){var f=new p2.Capsule(this.world.pxm(a),b);return this.addShape(f,c,d,e)},addPolygon:function(a,b){a=a||{},b=Array.prototype.slice.call(arguments,1);var c=[];if(1===b.length&&Array.isArray(b[0]))c=b[0].slice(0);else if(Array.isArray(b[0]))c=b[0].slice(0);else if("number"==typeof b[0])for(var d=0,e=b.length;e>d;d+=2)c.push([b[d],b[d+1]]);var f=c.length-1;c[f][0]===c[0][0]&&c[f][1]===c[0][1]&&c.pop();for(var g=0;g<c.length;g++)c[g][0]=this.world.pxmi(c[g][0]),c[g][1]=this.world.pxmi(c[g][1]);var h=this.data.fromPolygon(c,a);return this.shapeChanged(),h},removeShape:function(a){var b=this.data.removeShape(a);return this.shapeChanged(),b},setCircle:function(a,b,c,d){return this.clearShapes(),this.addCircle(a,b,c,d)},setRectangle:function(a,b,c,d,e){return"undefined"==typeof a&&(a=16),"undefined"==typeof b&&(b=16),this.clearShapes(),this.addRectangle(a,b,c,d,e)},setRectangleFromSprite:function(a){return"undefined"==typeof a&&(a=this.sprite),this.clearShapes(),this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(a,b){if("undefined"==typeof b)for(var c=this.data.shapes.length-1;c>=0;c--)this.data.shapes[c].material=a;else b.material=a},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(a,b){for(var c=this.game.cache.getPhysicsData(a,b),d=[],e=0;e<c.length;e++){var f=c[e],g=this.addFixture(f);d[f.filter.group]=d[f.filter.group]||[],d[f.filter.group]=d[f.filter.group].concat(g),f.fixtureKey&&(d[f.fixtureKey]=g)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),d},addFixture:function(a){var b=[];if(a.circle){var c=new p2.Circle(this.world.pxm(a.circle.radius));c.collisionGroup=a.filter.categoryBits,c.collisionMask=a.filter.maskBits,c.sensor=a.isSensor;var d=p2.vec2.create();d[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2),d[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2),this.data.addShape(c,d),b.push(c)}else for(var e=a.polygons,f=p2.vec2.create(),g=0;g<e.length;g++){for(var h=e[g],i=[],j=0;j<h.length;j+=2)i.push([this.world.pxmi(h[j]),this.world.pxmi(h[j+1])]);for(var c=new p2.Convex(i),k=0;k!==c.vertices.length;k++){var l=c.vertices[k];p2.vec2.sub(l,l,c.centerOfMass)}p2.vec2.scale(f,c.centerOfMass,1),f[0]-=this.world.pxmi(this.sprite.width/2),f[1]-=this.world.pxmi(this.sprite.height/2),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),c.collisionGroup=a.filter.categoryBits,c.collisionMask=a.filter.maskBits,c.sensor=a.isSensor,this.data.addShape(c,f),b.push(c)}return b},loadPolygon:function(a,b){for(var c=this.game.cache.getPhysicsData(a,b),d=p2.vec2.create(),e=0;e<c.length;e++){for(var f=[],g=0;g<c[e].shape.length;g+=2)f.push([this.world.pxmi(c[e].shape[g]),this.world.pxmi(c[e].shape[g+1])]);for(var h=new p2.Convex(f),i=0;i!==h.vertices.length;i++){var j=h.vertices[i];p2.vec2.sub(j,j,h.centerOfMass)}p2.vec2.scale(d,h.centerOfMass,1),d[0]-=this.world.pxmi(this.sprite.width/2),d[1]-=this.world.pxmi(this.sprite.height/2),h.updateTriangles(),h.updateCenterOfMass(),h.updateBoundingRadius(),this.data.addShape(h,d)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0},loadData:function(a,b){var c=this.game.cache.getPhysicsData(a,b);return c&&c.shape?(this.mass=c.density,this.loadPolygon(a,b)):void 0}},Phaser.Physics.P2.Body.prototype.constructor=Phaser.Physics.P2.Body,Phaser.Physics.P2.Body.DYNAMIC=1,Phaser.Physics.P2.Body.STATIC=2,Phaser.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(Phaser.Physics.P2.Body.prototype,"static",{get:function(){return this.data.motionState===Phaser.Physics.P2.Body.STATIC},set:function(a){a&&this.data.motionState!==Phaser.Physics.P2.Body.STATIC?(this.data.motionState=Phaser.Physics.P2.Body.STATIC,this.mass=0):a||this.data.motionState!==Phaser.Physics.P2.Body.STATIC||(this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1))}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.motionState===Phaser.Physics.P2.Body.DYNAMIC},set:function(a){a&&this.data.motionState!==Phaser.Physics.P2.Body.DYNAMIC?(this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC,0===this.mass&&(this.mass=1)):a||this.data.motionState!==Phaser.Physics.P2.Body.DYNAMIC||(this.data.motionState=Phaser.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.motionState===Phaser.Physics.P2.Body.KINEMATIC},set:function(a){a&&this.data.motionState!==Phaser.Physics.P2.Body.KINEMATIC?(this.data.motionState=Phaser.Physics.P2.Body.KINEMATIC,this.mass=4):a||this.data.motionState!==Phaser.Physics.P2.Body.KINEMATIC||(this.data.motionState=Phaser.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(a){a!==this.data.allowSleep&&(this.data.allowSleep=a)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.angle))},set:function(a){this.data.angle=Phaser.Math.degToRad(Phaser.Math.wrapAngle(a))}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(a){this.data.damping=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(a){a!==this.data.fixedRotation&&(this.data.fixedRotation=a)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(a){a!==this.data.mass&&(this.data.mass=a,this.data.updateMassProperties())}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.motionState},set:function(a){a!==this.data.motionState&&(this.data.motionState=a)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(a){this.data.angle=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(a){this.data.sleepSpeedLimit=a}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=this.world.pxmi(a)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=this.world.pxmi(a)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(a){a&&!this.debugBody?this.debugBody=new Phaser.Physics.P2.BodyDebug(this.game,this.data):!a&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(Phaser.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(a){a&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!a&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),Phaser.Physics.P2.BodyDebug=function(a,b,c){Phaser.Group.call(this,a);var d={pixelsPerLengthUnit:20,debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=Phaser.Utils.extend(d,c),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=b,this.canvas=new Phaser.Graphics(a),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw()},Phaser.Physics.P2.BodyDebug.prototype=Object.create(Phaser.Group.prototype),Phaser.Physics.P2.BodyDebug.prototype.constructor=Phaser.Physics.P2.BodyDebug,Phaser.Utils.extend(Phaser.Physics.P2.BodyDebug.prototype,{update:function(){this.updateSpriteTransform()},updateSpriteTransform:function(){return this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(h=this.body,j=this.canvas,j.clear(),c=parseInt(this.randomPastelHex(),16),f=16711680,g=this.lineWidth,h instanceof p2.Body&&h.shapes.length){var p=h.shapes.length;for(d=0;d!==p;){if(b=h.shapes[d],i=h.shapeOffsets[d],a=h.shapeAngles[d],i=i||0,a=a||0,b instanceof p2.Circle)this.drawCircle(j,i[0]*this.ppu,i[1]*this.ppu,a,b.radius*this.ppu,c,g);else if(b instanceof p2.Convex){for(l=[],m=p2.vec2.create(),e=n=0,o=b.vertices.length;o>=0?o>n:n>o;e=o>=0?++n:--n)k=b.vertices[e],p2.vec2.rotate(m,k,a),l.push([(m[0]+i[0])*this.ppu,-(m[1]+i[1])*this.ppu]);this.drawConvex(j,l,b.triangles,f,c,g,this.settings.debugPolygons,[i[0]*this.ppu,-i[1]*this.ppu])}else b instanceof p2.Plane?this.drawPlane(j,i[0]*this.ppu,-i[1]*this.ppu,c,f,5*g,10*g,10*g,100*this.ppu,a):b instanceof p2.Line?this.drawLine(j,b.length*this.ppu,f,g):b instanceof p2.Rectangle&&this.drawRectangle(j,i[0]*this.ppu,-i[1]*this.ppu,a,b.width*this.ppu,b.height*this.ppu,f,c,g);d++}}},drawRectangle:function(a,b,c,d,e,f,g,h,i){"undefined"==typeof i&&(i=1),"undefined"==typeof g&&(g=0),a.lineStyle(i,g,1),a.beginFill(h),a.drawRect(b-e/2,c-f/2,e,f)},drawCircle:function(a,b,c,d,e,f,g){"undefined"==typeof g&&(g=1),"undefined"==typeof f&&(f=16777215),a.lineStyle(g,0,1),a.beginFill(f,1),a.drawCircle(b,c,-e),a.endFill(),a.moveTo(b,c),a.lineTo(b+e*Math.cos(-d),c+e*Math.sin(-d))},drawLine:function(a,b,c,d){"undefined"==typeof d&&(d=1),"undefined"==typeof c&&(c=0),a.lineStyle(5*d,c,1),a.moveTo(-b/2,0),a.lineTo(b/2,0)},drawConvex:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if("undefined"==typeof f&&(f=1),"undefined"==typeof d&&(d=0),g){for(i=[16711680,65280,255],j=0;j!==b.length+1;)l=b[j%b.length],m=b[(j+1)%b.length],o=l[0],r=l[1],p=m[0],s=m[1],a.lineStyle(f,i[j%i.length],1),a.moveTo(o,-r),a.lineTo(p,-s),a.drawCircle(o,-r,2*f),j++;return a.lineStyle(f,0,1),a.drawCircle(h[0],h[1],2*f)}for(a.lineStyle(f,d,1),a.beginFill(e),j=0;j!==b.length;)k=b[j],n=k[0],q=k[1],0===j?a.moveTo(n,-q):a.lineTo(n,-q),j++;return a.endFill(),b.length>2?(a.moveTo(b[b.length-1][0],-b[b.length-1][1]),a.lineTo(b[0][0],-b[0][1])):void 0},drawPath:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;for("undefined"==typeof e&&(e=1),"undefined"==typeof c&&(c=0),a.lineStyle(e,c,1),"number"==typeof d&&a.beginFill(d),h=null,i=null,g=0;g<b.length;)p=b[g],q=p[0],r=p[1],(q!==h||r!==i)&&(0===g?a.moveTo(q,r):(j=h,k=i,l=q,m=r,n=b[(g+1)%b.length][0],o=b[(g+1)%b.length][1],f=(l-j)*(o-k)-(n-j)*(m-k),0!==f&&a.lineTo(q,r)),h=q,i=r),g++;"number"==typeof d&&a.endFill(),b.length>2&&"number"==typeof d&&(a.moveTo(b[b.length-1][0],b[b.length-1][1]),a.lineTo(b[0][0],b[0][1]))},drawPlane:function(a,b,c,d,e,f,g,h,i,j){var k,l,m;"undefined"==typeof f&&(f=1),"undefined"==typeof d&&(d=16777215),a.lineStyle(f,e,11),a.beginFill(d),k=i,a.moveTo(b,-c),l=b+Math.cos(j)*this.game.width,m=c+Math.sin(j)*this.game.height,a.lineTo(l,-m),a.moveTo(b,-c),l=b+Math.cos(j)*-this.game.width,m=c+Math.sin(j)*-this.game.height,a.lineTo(l,-m)},randomPastelHex:function(){var a,b,c,d;return c=[255,255,255],d=Math.floor(256*Math.random()),b=Math.floor(256*Math.random()),a=Math.floor(256*Math.random()),d=Math.floor((d+3*c[0])/4),b=Math.floor((b+3*c[1])/4),a=Math.floor((a+3*c[2])/4),this.rgbToHex(d,b,a)},rgbToHex:function(a,b,c){return this.componentToHex(a)+this.componentToHex(b)+this.componentToHex(c)},componentToHex:function(a){var b;return b=a.toString(16),2===b.len?b:b+"0"}}),Phaser.Physics.P2.Spring=function(a,b,c,d,e,f,g,h,i,j){this.game=a.game,this.world=a,"undefined"==typeof d&&(d=1),"undefined"==typeof e&&(e=100),"undefined"==typeof f&&(f=1),d=a.pxm(d);var k={restLength:d,stiffness:e,damping:f};"undefined"!=typeof g&&null!==g&&(k.worldAnchorA=[a.pxm(g[0]),a.pxm(g[1])]),"undefined"!=typeof h&&null!==h&&(k.worldAnchorB=[a.pxm(h[0]),a.pxm(h[1])]),"undefined"!=typeof i&&null!==i&&(k.localAnchorA=[a.pxm(i[0]),a.pxm(i[1])]),"undefined"!=typeof j&&null!==j&&(k.localAnchorB=[a.pxm(j[0]),a.pxm(j[1])]),p2.Spring.call(this,b,c,k)},Phaser.Physics.P2.Spring.prototype=Object.create(p2.Spring.prototype),Phaser.Physics.P2.Spring.prototype.constructor=Phaser.Physics.P2.Spring,Phaser.Physics.P2.Material=function(a){this.name=a,p2.Material.call(this)},Phaser.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),Phaser.Physics.P2.Material.prototype.constructor=Phaser.Physics.P2.Material,Phaser.Physics.P2.ContactMaterial=function(a,b,c){p2.ContactMaterial.call(this,a,b,c)},Phaser.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),Phaser.Physics.P2.ContactMaterial.prototype.constructor=Phaser.Physics.P2.ContactMaterial,Phaser.Physics.P2.CollisionGroup=function(a){this.mask=a},Phaser.Physics.P2.DistanceConstraint=function(a,b,c,d,e){"undefined"==typeof d&&(d=100),this.game=a.game,this.world=a,d=a.pxm(d),p2.DistanceConstraint.call(this,b,c,d,{maxForce:e})},Phaser.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),Phaser.Physics.P2.DistanceConstraint.prototype.constructor=Phaser.Physics.P2.DistanceConstraint,Phaser.Physics.P2.GearConstraint=function(a,b,c,d,e){"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=1),this.game=a.game,this.world=a;var f={angle:d,ratio:e};p2.GearConstraint.call(this,b,c,f)},Phaser.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),Phaser.Physics.P2.GearConstraint.prototype.constructor=Phaser.Physics.P2.GearConstraint,Phaser.Physics.P2.LockConstraint=function(a,b,c,d,e,f){"undefined"==typeof d&&(d=[0,0]),"undefined"==typeof e&&(e=0),"undefined"==typeof f&&(f=Number.MAX_VALUE),this.game=a.game,this.world=a,d=[a.pxm(d[0]),a.pxm(d[1])];var g={localOffsetB:d,localAngleB:e,maxForce:f};p2.LockConstraint.call(this,b,c,g)},Phaser.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),Phaser.Physics.P2.LockConstraint.prototype.constructor=Phaser.Physics.P2.LockConstraint,Phaser.Physics.P2.PrismaticConstraint=function(a,b,c,d,e,f,g,h){"undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=[0,0]),"undefined"==typeof f&&(f=[0,0]),"undefined"==typeof g&&(g=[0,0]),"undefined"==typeof h&&(h=Number.MAX_VALUE),this.game=a.game,this.world=a,e=[a.pxmi(e[0]),a.pxmi(e[1])],f=[a.pxmi(f[0]),a.pxmi(f[1])];var i={localAnchorA:e,localAnchorB:f,localAxisA:g,maxForce:h,disableRotationalLock:!d}; p2.PrismaticConstraint.call(this,b,c,i)},Phaser.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),Phaser.Physics.P2.PrismaticConstraint.prototype.constructor=Phaser.Physics.P2.PrismaticConstraint,Phaser.Physics.P2.RevoluteConstraint=function(a,b,c,d,e,f){"undefined"==typeof f&&(f=Number.MAX_VALUE),this.game=a.game,this.world=a,c=[a.pxmi(c[0]),a.pxmi(c[1])],e=[a.pxmi(e[0]),a.pxmi(e[1])],p2.RevoluteConstraint.call(this,b,c,d,e,{maxForce:f})},Phaser.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),Phaser.Physics.P2.RevoluteConstraint.prototype.constructor=Phaser.Physics.P2.RevoluteConstraint; //# sourceMappingURL=phaser.map
>>>>>>> origin/gh-pages
